$Revision$
  $Author$ $Date$
	1. ошибка доступа при вызове EnableColorer не находясь в редакторе
	2. поправлен размер диалога настроек
	3. обновлен far2sdk
	4. из OpenPluginW убраны ненужные действия

#Revision: 1380
  Author: ctapmex Date: 2010-02-12 12:29:27 +0500 (Пт, 12 фев 2010)
	1. реализована очистка всех окон редактора при отключении плагина.

#Revision: 1379
  Author: ctapmex Date: 2010-02-12 09:55:35 +0500 (Пт, 12 фев 2010)
	1. поправлены makefile для учета нового tools.cpp
		!!Но, в shared в непонятной (не нужной?) папке exparse есть свой tools... надо что то делать
	2. для dropAllEditors добавлен параметр "чистить или нет последствия работы"
	3. ускоряем cleanEditor() за счет хака far

#Revision: 1378
  Author: ctapmex Date: 2010-02-11 23:43:09 +0500 (Чт, 11 фев 2010)
	1. вспомогательные функции (trim, ExpandEnvironment) вынесены из FarEditorSet.cpp в 
		отдельный модуль tools.cpp
	2. новая функция PathToFool - конвертирует путь до файла в полный или UNC, проверяя на переменные окружения,
		относительность пути, текущую директорию, кавычки вокруг пути.
		!!! unc пути работают только в windows, только в юникодных функциях. в пути не должно быть символов /
	3. ExpandEnvironment заменена на PathToFool
	4. исправлен размер массива для вывода ошибок в функции viewFile

#Revision: 1372
  Author: ctapmex Date: 2010-02-11 17:18:25 +0500 (Чт, 11 фев 2010)
	1. из диалога настроек убрана кнопка "Тест catalog.xml" за не надобностью, т.к. кнопка "Ок" перед сохранением
		делает это же. Раньше "Ок" не выполняло этой функции.

#Revision: 1371
  Author: ctapmex Date: 2010-02-11 16:31:38 +0500 (Чт, 11 фев 2010)
	1. опечатка в r1369
	2. поправил название функции ApplySettingsToEditors, для отображения действительности
	3. из getCurrentEditor выделил код в отдельную функцию addNewEditor

#Revision: 1369
  Author: ctapmex Date: 2010-02-11 15:13:01 +0500 (Чт, 11 фев 2010)
	1. продолжение r1368.2

#Revision: 1368
  Author: ctapmex Date: 2010-02-11 13:50:25 +0500 (Чт, 11 фев 2010)
	1. автоматизация шапки этого файла не очень удачная-)
	2. убрано часть security функций по работе со строками и поправлены хедеры для сборки под cygwin

#Revision: 1367
	Author: ctapmex Date: 2010-02-11 12:23:01 +0500 (Чт, 11 фев 2010)
	1. исправлена ошибка игнорирования EEREDRAW_CHANGE, что например проявлялось с плагином AutoComplete

#Revision: 1338
	Author: ctapmex Date: 2010-02-09 10:42:55 +0500 (Вт, 09 фев 2010)
	1. Поправил бардак с предыдущей ревизии
	2. Пробую автоматизировать шапку этого файла. 

#revision 1313
	ctapmex 05.02.2010 22:10
	промежуточная ревизия. все работает, но бардак в коде. прошу пока не пинать.
	1. Для диалога настроек используем отдельную функцию, для обработки сообщений.
	2. функции для чтения настроек, записи настроек, и применения их на редакторы.

#revision 1312
	ctapmex 05.02.2010 16:22
	1. Убрал info (PluginStartupInfo) из FarEditorSet. Вместо него используется глобальная
    переменная Info.

#revision 1302
	ctapmex 04.02.2010 23:40
	1. рефакторинг работы с реестром
		а) уберем отрицание из имен параметров. 
		б) define заменены на константы
		в) добавлены значения по умолчанию для параметров
		г) функции для чтения параметров принимают значение по умолчанию
		д) функция для записи всех настроек по умолчанию

#revision 1299
	ctapmex 04.02.2010 12:13
	1. поправлены valid тесты
	2. устанавливаем версию плагинов в 1.0.2.4 и собираем релиз
	3. сборка схем. тесты проходят на 100%
	4. файл истории изменения FarColor

#revision 1298
	ctapmex 04.02.2010 11:11
	1. поправлен баг в makefile, с отображением #<< . заменены тесты для него
	2. слияние с 1287

#revision 1297
	ctapmex 04.02.2010 09:58
	1. меню "Список функций" (FarEditor::showOutliner)
		а) комбинация Ctrl-Enter вставляла в редактор текст в иероглифах ( неверная кодировка)
		б) нормально вводяться в фильтр клавиши ":;-_"
		в) дополнены файлы помощи и языковые файлы
	  г) ускоренное получение строк из фара 

#revision 1296
	ctapmex 03.02.2010 15:35
	1. r1273 пункт 2 отменим, и переделаем по другому - добавим в тип xml расширение wxs и fb2
	2. исправлены дублирующие горячие клавиши в меню настройки
	3. в FarEditor::updateHighlighting добавлен быстрый доступ к строкам
	4. для типа "plain text" добалено .log и LICENSE
	5. в связи с ускорением работы, глюк с срабатыванием колорера (загрузка процессора) на неизвестных типах файлов
		по схеме <type name="default"><scheme name='default'/> можно считать исчерпанным. Т.к. если сделать какое то 
		ограничение в коде на обработку этого типа, то пропадает возможность настройки своего типа по умолчанию.

#revision 1295
	ctapmex 03.02.2010 10:52
	1. в FarEditor::editorInput не использовался хак фара для быстрого доступа к строкам. после исправления существенно
		увеличилась скорость
	2. в BaseEditor::validate исправлено возможное зацикливание
	3. маленькая оптимизация кода 

#revision 1278
	ctapmex 25.01.2010 10:21
	1. переделал r1183 , т.к. оказалось, что хелп pcolorer2 не соответсвовал описанию в ParserFactory.h
		но так же учитываем, что HOMEPATH в Windows не содержит имя диска
		итого, сейчас следующий порядок поиска
		для Windows 
		- Каталог с dll плагина, на уровень выше, на два уровня выше.
		- %COLORER5CATALOG%
		- %HOMEDRIVE%%HOMEPATH%\.colorer5catalog
		- %SYSTEMROOT%/.colorer5catalog (или %WINDIR% в w9x)
		для nix 
		- $COLORER5CATALOG
		- $HOME\.colorer5catalog
		- $HOMEPATH/.colorer5catalog
		- /usr/share/colorer/catalog.xml
		- /usr/local/share/colorer/catalog.xml	
	2. изменения отражены в хелпе

#revision 1273
	ctapmex 18.01.2010 15:03
	1. исправим умолчание в proto.hrc  - use GNU make only = false , иначе мейки от VC отображаются коряво
	2. исправим в proto.hrc вес для plain text , иначе, например xml файлы по содержанию, но по имени похожем
		на install*.* отображаются как plain text

#revision 1268
	ctapmex 17.01.2010 15:29
	1. поправлена схема assa.hrc. Но нужны доп. правки. описание в todo.txt, а примеры в папке test

#revision 1267
	ctapmex 16.01.2010 17:58
	1. переделана функция rGetValueSz. вызывается по другому, предыдущая содержала возможную утечку памяти
	2. косметика - в файлах плагина pcolorer2 заменен null на NULL . 

#revision 1264
	ctapmex 15.01.2010 12:20
	1. изменил размеры и положение некоторых элементов в окне настроек
	2. устанавливаем версию плагина в 1.0.2.3 и собираем релиз
	3. обновление языковых файлов и файлов помощи 
	4. обновление истории изменения FarColor	

#revision 1263
	ctapmex 15.01.2010 11:54
	1. критическая ошибка, возникала на части копьютеров
		я понимаю, что сглупил, но вот проявление этой ошибки интересное
		http://forum.vingrad.ru/forum/topic-287378.html

#revision 1262
	ctapmex 15.01.2010 10:48
	1. исправление дублирующих имен переменных
	2. ошибка доступа к памяти при сохранении параметров при первом запуске фара

#revision 1257
	ctapmex 14.01.2010 10:28
	1. добавил файл todo.txt , для сохранения жалоб и пожеланий в работе плагина.
	зы. я не против если кто то что то исправит ;)

#revision 1242
	ctapmex 13.01.2010 23:28
	1. устанавливаем версию плагинов в 1.0.2.2 и собираем релиз
	2. сборка схем. тесты проходят на 100%
	3. файл истории изменения FarColor

#revision 1241
	ctapmex 13.01.2010 17:03
	1. заменил часть вызовов функций работы с строками на безопасные их аналоги 
	2. слияние с ревизиями 1180,1190,1191,1193,1196,1200,1217-1219,1240 - изменение/добавление схем
	3. тест схем, замена на новые valid версии

#revision 1238
	ctapmex 13.01.2010 11:47
	1. убрана опция "Время до показа диалога отмены" , т.к. фактически ни где в коде не используется
	2. обновление языковых файлов и файлов помощи 
  3. переделана диалог настроек ( размер , положение...)
	4. исправлена ошибка при отмене выбора цветового стиля
	5. убраны лишние языковые константы

#revision 1235
	ctapmex 12.01.2010 21:23
	1. обновление языковых файлов и файлов помощи, для отражения последних изменений
	2. удалена лишняя константа

#revision 1234
	ctapmex 12.01.2010 20:16
	1. r1234 пункт 1 - ничего не поменял. видимо у меня только локальная копия изменилась, а подумал что еще и в хранилище
	2. обновил far2 sdk

#revision 1233
	ctapmex 12.01.2010 19:37
	1. поправил файлы бибилиотеки zlib на оригинальные , в некоторые когда то затисались id после попытки компиляции в gcc
	2. JARInputSource::openStream - утечки памяти при возникновении ошибок. Например не найден файл в архиве.

#revision 1232
	ctapmex 12.01.2010 17:29
	1. Для "Reload" и "Reload all" используется функция FarEditorSet::TestLoadBase . Она использует локальные переменные
		для теста базы. За счет чего не портятся FarEditorSet.parserFactory и другие, что раньше требовало перезагрузку базы.
	2. Небольшой рефакторинг - выделение кода в отдельные функции
	3. переделка r1220 пункт 3. Итог
		а) если плагин отключен, то при загрузке имя цветовой схемы пишится без описания.
		б) "Reload" тестирует возможность загрузки catalog.xml и цветовой схемы, основываясь на данных что отображены в окне настроек,
			реестр игнорируется. При ошибке загрузки не отключает плагин.
		в) "Reload all" в начале вызывает "Reload", а потом тестирует оставшиеся схемы.
		г) При закрытии настроек по "Ок" базы перезагружаются только при смене цветовой схемы или пути до catalog.xml.

#revision 1231
	ctapmex 12.01.2010 11:21
	1. конец запаркам с String и DString - переход на SString  ;)
	2. перевод комментариев в коде на англ.
	3. changelog перевел в UTF8, надеюсь в транке будет нормально отображаться

#revision 1220
	ctapmex 10.01.2010 22:29
	1. свежий взгляд на r1201, убрал malloc в пользу new
	2. ошибка при отмене выбора цветовой схемы. ( ох уж эти String и DString, запарился с ними за последние 3 дня :-) )
	3. сценарий работы окна настроек
		а) если плагин отключен, то при загрузке имя цветовой схемы пишится без описания.
		б) "Reload" тестирует возможность загрузки catalog.xml и цветовой схемы, основываясь на данных что отображены в окне настроек,
			реестр игнорируется. При ошибке загрузки не отключает плагин.
		в) "Reload all" в начале вызывает "Reload", а потом тестирует оставшиеся схемы.
    г) При закрытии настроек по "Ок" мы перегружаем базы всегда.
	!из-за этого создадим пункт в меню для перезагрузки базы.
		д) при закрытии по "Cancel" перегружаем базы если были нажатия на "Reload"
	4. поправлены файлы помощи и языковые файлы pcolorer2 для отражения пункта 3 
	5. назначил номер версии плагина 1.0.2.2 beta. Отдам на тестирование добровольцам.

#revision 1216
	ctapmex 10.01.2010 19:39
	1. мы не обязаны обрабатывать ошибки пользователя - если он залез в реестр или в какой то файл и что то напортачил, 
		то надо говорить ему об этом и все. Trim будем применять только при сохранении настроек из диалога.
	2. функция rGetValueSz для чтения реестра - сама выделяет нужное количество памяти под строку.
	3. Переделал диалог настройки. Раньше могли происходить утечки памяти на стороне фара, из-за того что мы не освобождали
		хэндл открытого окна.
		 Кнопка "Reload" теперь служит для проверки базы и цветовой схемы, указанной в диалоге настройки, а не читая значения из реестра.
	4. поправлена ошибка обработки пользовательского пути до catalog.xml, приводящая к полному игнорированию этого пути
		
		!!!надо внимательно протестировать работу меню настройки!!!

#revision 1201
	ctapmex 06.01.2010 23:41
	1. команда clr не работала если имя файла передавалось в кавычках
	!!!на ближайшее будущее, пересмотреть OpenPluginW свежим взглядом - слишком много операций над строками!!!

#revision 1197
	ctapmex 05.01.2010 23:47
	1. если плагин отключен, то зачем производить кучу ненужных действий при старте редактора? исправлено
	2. мелкие оптимизации
	3. добавлен модуль vld.h в дебаг версию. Visual Leak Detector http://sites.google.com/site/dmoulding/vld
		можно удалить, если нету его.

#revision 1195
	ctapmex 05.01.2010 21:24
	1. мелкие оптимизации

#revision 1194
	ctapmex 05.01.2010 20:11
	1. мелкие оптимизации и убирание ненужного

#revision 1189
	ctapmex 04.01.2010 16:41
	1. поправил схему c.hrc для нормального отображения переменных окружения
	2. слияние с r1180

#revision 1188
	ctapmex 03.01.2010
	1. продолжение r1187, не учитывался вариант с относительным длинным путем. Написан более изящный вариант
		с использsванием API Far 
	2. отказ от build_message
		Не удобно, когда разбивается путь к файлу на строки (нельзя скопировать). Да и стало известно, что в фаре 
		можно курсором перейти на длинную строку и просмотреть её полностью. Надежда на то, что в будущих версиях
		фара будет интуитивно понятно, что данная строка в сообщении об ошибке длинная, и её можно прокрутить
	3. в сообщения об ошибках info->Message добавил флаг FMSG_WARNING

#revision 1187
	ctapmex 30.12.2009 15:45
	1. команда clr: поддерживает длинные пути windows (более 260 символов), и переменные окружения
		
#revision 1186
	ctapmex 30.12.2009 11:51
	1. убрал один warning
	2. в пути до catalog.xml можно указывать переменные окружения. Например %programfiles%\far2\plugins\colorer_se\catalog.xml

#revision 1185
	ctapmex 30.12.2009 10:51
	1. вывод ошибки в viewfile сделал через функцию build_message, чтобы было полностью видно имя файла
	2. поправлены файлы помощи для pcolorer2 для отражения r1183

	Поддержка pcolorer будет проходить на остаточном принципе. Если будет время и желание.

#revision 1184
	ctapmex 30.12.2009 09:56
	1. в TextConsoleViewer::view  в вызове CreateConsoleScreenBuffer установил разрешение на чтение/запись. Иначе 
		приводит к "зависанию" некоторых программ. "При использовании команды clr:!.! для просмотра файлов far "зависает". В ConEmu." (C)Maximus5

#revision 1183
	ctapmex 30.12.2009 09:48
	1. в ParserFactory.SearchPath поиск catalog.xml шёл не в том порядке, как написанно в хелпе для pcolorer2.
		Так же не учитывалось, что HOMEPATH в Windows не содержит имя диска
		установим такой порядок поиска
		для Windows 
		- %COLORER5CATALOG%
		- %HOMEDRIVE%%HOMEPATH%\.colorer5catalog
		- %SYSTEMROOT%/.colorer5catalog (или %WINDIR% в w9x)
		- Каталог с dll плагина, на уровень выше, на два уровня выше.
		для nix 
		- %COLORER5CATALOG%
		- %HOME%\.colorer5catalog
		- /usr/share/colorer/catalog.xml
		- /usr/local/share/colorer/catalog.xml		

#revision 1182 
  ctapmex 29.12.2009 16:06
	1. повторяю слова t-rex, реально запарило.
	"Все изменения в коде только косметические. Тупо надоела уже мешанина табов и пробелов и т.п.
   Прогрнал на сорцы следующее:
   AStyle --style=ansi --indent=tab=4 --brackets=break --indent-classes --indent-switches --indent-namespaces --indent-preprocessor --break-blocks --delete-empty-lines --unpad-paren --keep-one-line-statements --keep-one-line-blocks
   Не идеально конечно, но уже намного приятней.
  
   Так что не забываем, в коде нужно использовать табы. Таб == 4 пробела."

	Изменения касаются только pcolorer2

#revision 1181 
  ctapmex 29.12.2009 15:51
	1. функция build_message для построения сообщения об ошибке. Разбивает длинную строку (длиннее ширины консоли).
			на более мелкие.
	2. для ошибки открытия файла добавлено имя этого файла.

#revision 1179 
  ctapmex 24.12.2009 16:25
	1. для r1169 пункт 3 забыл мелочь одну

#revision 1178 
  ctapmex 23.12.2009 23:44
	1. очередная правка файлов помощи для плагинов фара
	2. устанавливаем версию плагинов в 1.0.2.1 и собираем релиз
	3. сборка схем. тесты проходят на 100%

#revision 1177 
  ctapmex 23.12.2009 17:34
	1. слил с ревизией 1174.
	2. отредактированы файлы помощи для плагинов фара 
	3. поправлен список изменений в схемах
	С пунктом 1 возможно и бегу в переди паровоза, но думаю на большем количестве людей оно быстрее оттестируется.
	Планирую в течении суток сделать релиз с полным набором - плагин + схемы

#revision 1176 
  ctapmex 23.12.2009 12:10
	1. отредактированы языковые файлы и файлы помощи для плагинов фара

#revision 1175 
  ctapmex 23.12.2009 11:45
  1. в pcolorer внесены примерно теже изменения, что и в pcolorer2 в этом бранче
		- исправлены утечки памяти
		- плагин убирает за собой при отключении
		- ошибки при работе с не trim строками
	2. в pcolorer2 исправлена небольшая ошибка при работе с не trim строками

#revision 1173 
  ctapmex 22.12.2009 22:06
  1. для pcolorer создан проект в VC 2008
	2. исправлены файлы для нормальной сборки под vc, соответсвенно поправлены и makefile

#revision 1172 
  ctapmex 22.12.2009 21:20
  1. исправлены файлы помощи и языковые файлы плагина pcolorer

#revision 1171
  ctapmex 22.12.2009 21:08
	1. исправлен makefile.vc для pcolorer.
	2. обновлен farsdk
	3. плагин pcolorer приведен к состоянию собирается/работает

#revision 1170
  ctapmex 22.12.2009 20:09
	1. исправлен makefile.vc для pcolorer2. таргет clean работал не правильно, не мог вызвать rmdir
	2. из shared/_dependencies.dep удалены ненужные упоминания файлов плагина для фара

#revision 1169
  ctapmex 18.12.2009 21:33
  1. colorer\hrc\auto\far.hrc переименован в colorer\hrc\auto\fartypes.hrc - часто создается путаница
		с lib/far.hrc
  2. в far.hrc исправлена ошибка с неверным путем до схемы раскраски макросов (r1150)
	3. для "Config, INI and CTL" убран вес маски типов файлов. иначе схема не вызывается никогда. отличительной
		чертой от "Other INI" - начальный символ #

#revision 1168
  ctapmex 18.12.2009 21:07
  1. немного поправлен reg.hrc , для красоты и приемственности старой раскраски
  2. для вызова схемы "Far macros" добавлены актуальные шаблоны имени файлов

#revision 1167
  ctapmex 18.12.2009 15:45
	1. переработана схема reg.hrc
		 в ревизиях 1159-1161 был переделан reg.hrc, переписан с нуля. После написаниея  выяснялось, 
			что существует два подхода к написанию схем. Жадный и не жадный. я писал его по жадному алгоритму.
	  - обычный (не жадный), который применяется во всех схемах. идя слева на право с текста беря ближайший 
				нужный элемент (скобка, кавычка). При таком подходе часты ситуации , когда из-за одной ошибки все 
				ниже идущее раскрашивается как ошибка
		- жадный. мы пытаемся в частично неверной строке найти верные части и указать ошибки. Для рег файла в 
			итоге получилось неплохо. Но не идеально.. ограничения моих способностей и самой библиотеки, а скорее 
			всего и самого подхода
		 жадный - более красивое отображение при ошибках, но есть случаи которые не сделать никак. Например 
		 	двойственное понимание строки	"name"="string" ;dfsd" . тут может быть ;dfsd" комментарием, а может 
		 	быть частью значения с ошибкой , где средняя кавычка не экранирована
		 не жадный - отображается на корректных файлах нормально, но на ошибках может раскрасить неверно весь файл
		
		лучше корректность на корректных файлах чем красота на некорректных
		ревизии 1159-1161 интересны как попытка применения другого подхода. Так сказать академический интерес

#revision 1166
  ctapmex 18.12.2009 10:09
	1. в c.hrc добавлено корректное отображение переменных окружения  %PATH%

#revision 1165
  ctapmex 17.12.2009 20:01
	1. удалил test.reg из тестов, т.к. он заменен в ревизии 1159 на более объемный тест
	2. поправлен config.hrc . Комментарии должны быть или с начала строки , или миниму через 
		пробельный символ от последнего текста. пример qwqwq=qwqwqw#sdsds   , тут # значение параметра
	3. исправлен valid файл для config.hrc , ruby.rb , build.xml, forth (внешне все нормально)
  4. исправлена раскраска awk.hrc ,теперь проходит тест

#revision 1164
  ctapmex 17.12.2009 15:12
	1. правка shortcuts.reg для работы с far2

#revision 1163
  ctapmex 17.12.2009 12:25
	1. слияние ревизий 1029-1068,1071-1078,1080-1099,1105-1107,1110 из бранча EFREMOV-BASE2

#revision 1162
  ctapmex 15.12.2009 11:44
	1. исправление в русском языковом файле плагина для far

--------------------
 в ревизиях 1159-1161 был переделан reg.hrc
 работает теперь по жадному алгоритму, т.е. пытается даже в ошибочной строке найти "хорошую строку" 
  и указать на ошибки в ней. Благодаря чему стала хорошо работать подсветка экранируемых символов, 
  и деление на имя параметра и значение параметра . Так же теперь при ошибках в одной строке не светятся 
  ошибочными нижележащие.
 Далее, убрана подсветка переменных ( %чтото% и $чтото ) в именах параметров. оно надо ?
 Строковое значение параметра (в кавычках) должно быть в одной строке , иначе подсвечивается как ошибка.
 подсветка unc путей.
 и другие мелочи
 но есть 2 бага: 
 	1. если в имени параметра встречается "= (даже с пробелами между ними) строка делится на части не правильно.
	 экранирование кавычки не поможет.
 	2. например такой случай 
 		 @="" ;"
 		 когда в комментарии идет кавычка, даже экранированная. жадный алгоритм считает что тут нет комментария.
-------------------

#revision 1161
  ctapmex 14.12.2009 17:42
	1. в схеме reg.hrc в подгруппе far не обрабатывались щначения по умолчанию @

#revision 1160
  ctapmex 14.12.2009 17:03
	1. в схеме reg.hrc поправлено отображение UNC путей

#revision 1159
  ctapmex 14.12.2009 16:48
	1. переработана схема reg.hrc
		разобраны все возможные случаи, кроме одного - последний символ в файле должен быть \r\n. Как это 
			сделать, и возможно ли не знаю.
		ошибки связанные с макросами фара не правились, это отдельная схема.


#revision 1158 
  ctapmex 04.12.2009 12:40
	1. правки языковых файлов плагина
	2. установка номера версии плагина в 1.0.2

#revision 1157 
  ctapmex 04.12.2009 11:44
	1. изменено значение опции "Крест".
	 [ ] Не показывать никогда
     [?] Показывать если включено в схеме
     [x] Показывать всегда
     исправлено имя ключа в реестре, для отражения сути 
    2. исправлены файлы помощи и языковые файлы плагина

#revision 1156 
  ctapmex 03.12.2009 17:02
	1. взяты изменения транка ревизии 1146, но сделано немного по другому - зачем выделять
	   память под класс, если на следующем шаге она уже освобождается