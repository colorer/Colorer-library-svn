<html><body style='color:#000000; background:#ffffff; '><pre>
  0: <span style='color:#696969; '>|******************************************************************************</span>
  1: <span style='color:#696969; '>|* tfzzz0458m002s  0  VRC B402 c4 land</span>
  2: <span style='color:#696969; '>|* Печать формы № Т-1а</span>
  3: <span style='color:#696969; '>|* Белугин Максим                </span>
  4: <span style='color:#696969; '>|* 2001-08-13</span>
  5: <span style='color:#696969; '>|******************************************************************************</span>
  6: <span style='color:#696969; '>|* Main table tfzzz058 Движение работников, Form Type 4</span>
  7: <span style='color:#696969; '>|******************************************************************************</span>
  8:                                                                                 
  9: <span style='color:#696969; '>|****************************** declaration section ***************************</span>
 10: <span style='color:#bb7977; font-weight:bold; '>declaration</span><span style='color:#808030; '>:</span>
 11:     <span style='color:#004a43; '>#include</span> <span style='color:#0000e6; '>"itfzzzcommon"</span>
 12:     <span style='color:#004a43; '>#include</span> <span style='color:#0000e6; '>"itfzzydomains"</span>
 13:     <span style='color:#004a43; '>#include</span> <span style='color:#0000e6; '>"itfzzyerrors"</span>
 14:     
 15:     <span style='color:#004a43; '>#pragma</span> used dll otfzzzdll064m01
 16:     <span style='color:#004a43; '>#pragma</span> used dll otfzzzdll003m01
 17:     <span style='color:#004a43; '>#pragma</span> used dll otfzzzdll193
 18:     <span style='color:#004a43; '>#pragma</span> used dll otfzzzdll056m01
 19:     <span style='color:#004a43; '>#pragma</span> used dll otfzzzdll058m01
 20:     <span style='color:#004a43; '>#pragma</span> used dll otfzzzdll058m00
 21:     <span style='color:#004a43; '>#pragma</span> used dll otfzzzdll021m01
 22:     <span style='color:#004a43; '>#pragma</span> used dll otfzzzdll017m01
 23:     <span style='color:#004a43; '>#pragma</span> used dll otfzzzdll019m01
 24:     <span style='color:#004a43; '>#pragma</span> used dll otfzzzdll192
 25:     <span style='color:#004a43; '>#pragma</span> used dll otfzzzdllt8
 26:     
 27:     <span style='color:#004a43; '>#define</span> CR_REP_NAME <span style='color:#0000e6; '>"rtfzzz045811004.rpt"</span>
 28: 
 29:     <span style='color:#004a43; '>#pragma</span> used dll otudlldllreport
 30:     <span style='color:#004a43; '>#include</span>    <span style='color:#0000e6; '>"itudllreports"</span>
 31: 
 32:     <span style='color:#800000; font-weight:bold; '>table</span>    ttfzzz058    <span style='color:#696969; '>| Движение работников</span>
 33: 
 34:     <span style='color:#800000; font-weight:bold; '>extern</span> <span style='color:#800000; font-weight:bold; '>domain</span> tfzzz<span style='color:#008c00; '>.</span>str10 number
 35:     <span style='color:#800000; font-weight:bold; '>extern</span> TDate date<span style='color:#008c00; '>.</span>from<span style='color:#808030; '>,</span> date<span style='color:#008c00; '>.</span>to<span style='color:#808030; '>,</span> pr<span style='color:#008c00; '>.</span>date
 36:     <span style='color:#800000; font-weight:bold; '>extern</span> TCheck only<span style='color:#008c00; '>.</span>done
 37:     
 38: <span style='color:#004a43; '>#define</span> kind tfzzz<span style='color:#008c00; '>.</span>pnp<span style='color:#008c00; '>.</span>type<span style='color:#008c00; '>.</span>dismission
 39:     
 40: <span style='color:#bb7977; font-weight:bold; '>before.program</span><span style='color:#808030; '>:</span>
 41:     date<span style='color:#008c00; '>.</span>from<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span>
 42:     date<span style='color:#008c00; '>.</span>to<span style='color:#808030; '>=</span>DR_MAX_DATE
 43: 
 44: <span style='color:#bb7977; font-weight:bold; '>form.1</span><span style='color:#808030; '>:</span>
 45:     <span style='color:#bb7977; font-weight:bold; '>init.form</span><span style='color:#808030; '>:</span>
 46:         <span style='color:#808030; '>get.screen.defaults</span><span style='color:#808030; '>(</span><span style='color:#808030; '>)</span>
 47: 
 48: <span style='color:#696969; '>|****************************** choice section ********************************</span>
 49: 
 50: <span style='color:#bb7977; font-weight:bold; '>choice.cont.process</span><span style='color:#808030; '>:</span>
 51:     <span style='color:#bb7977; font-weight:bold; '>on.choice</span><span style='color:#808030; '>:</span>
 52:         <span style='color:#808030; '>execute</span><span style='color:#808030; '>(</span><span style='color:#7d0045; '>print.data</span><span style='color:#808030; '>)</span>
 53: 
 54: <span style='color:#bb7977; font-weight:bold; '>choice.print.data</span><span style='color:#808030; '>:</span>
 55:     <span style='color:#bb7977; font-weight:bold; '>on.choice</span><span style='color:#808030; '>:</span>
 56:         read<span style='color:#008c00; '>.</span>main<span style='color:#008c00; '>.</span>table<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span>
 57:         <span style='color:#005fd2; '>showCurrentError</span><span style='color:#808030; '>(</span><span style='color:#808030; '>)</span>
 58: 
 59: <span style='color:#bb7977; font-weight:bold; '>field.number:</span>
 60:     <span style='color:#bb7977; font-weight:bold; '>before.zoom</span><span style='color:#808030; '>:</span>
 61:         <span style='color:#808030; '>set.enum.values</span><span style='color:#808030; '>(</span>kind<span style='color:#808030; '>)</span> 
 62: 
 63:     <span style='color:#bb7977; font-weight:bold; '>after.input</span><span style='color:#808030; '>:</span>
 64:         DetectDate<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>true</span><span style='color:#808030; '>)</span>
 65: 
 66: <span style='color:#bb7977; font-weight:bold; '>field.pr.date:</span>
 67:     <span style='color:#bb7977; font-weight:bold; '>before.zoom</span><span style='color:#808030; '>:</span>
 68:         <span style='color:#808030; '>set.enum.values</span><span style='color:#808030; '>(</span>kind<span style='color:#808030; '>)</span> 
 69: 
 70:     <span style='color:#bb7977; font-weight:bold; '>before.input</span><span style='color:#808030; '>:</span>
 71:         DetectDate<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>false</span><span style='color:#808030; '>)</span>
 72: 
 73: <span style='color:#696969; '>|****************************** function section ******************************</span>
 74: 
 75: <span style='color:#bb7977; font-weight:bold; '>functions</span><span style='color:#808030; '>:</span>
 76: <span style='color:#800000; font-weight:bold; '>function</span> <span style='color:#800000; font-weight:bold; '>String</span> dat<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>long</span> X<span style='color:#808030; '>)</span><span style='color:#808030; '>{</span>
 77:    <span style='color:#800000; font-weight:bold; '> if</span> <span style='color:#808030; '>(</span>X<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>or</span> <span style='color:#808030; '>(</span>X<span style='color:#808030; '>=</span>DR_MAX_DATE<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>then</span>
 78:         <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>)</span>
 79:    <span style='color:#800000; font-weight:bold; '> endif</span>
 80:     <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#808030; '>(</span><span style='color:#005fd2; '>cr.date</span><span style='color:#808030; '>(</span>X<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
 81: <span style='color:#808030; '>}</span>
 82: 
 83: <span style='color:#800000; font-weight:bold; '>function</span> read<span style='color:#008c00; '>.</span>main<span style='color:#008c00; '>.</span>table<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>{</span>
 84:     DECLARE_ROWSET<span style='color:#808030; '>(</span>rsReport<span style='color:#808030; '>)</span>
 85:     <span style='color:#800000; font-weight:bold; '>String</span> rsFile<span style='color:#808030; '>(</span><span style='color:#008c00; '>128</span><span style='color:#808030; '>)</span>
 86:     assert<span style='color:#008c00; '>.</span>v<span style='color:#808030; '>(</span>
 87:         <span style='color:#005fd2; '>open.xml.rowset</span><span style='color:#808030; '>(</span>spool<span style='color:#008c00; '>.</span>report<span style='color:#808030; '>,</span> rsFile<span style='color:#808030; '>,</span> USE_ROWSET<span style='color:#808030; '>(</span>rsReport<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>></span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> 
 88:         <span style='color:#0000e6; '>"Проблема при генерации отчета"</span>
 89:     <span style='color:#808030; '>)</span>
 90:     Date docDate
 91:     docDate<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span>
 92:     <span style='color:#004a43; '>select</span>    tfzzz058.<span style='color:#808030; '>*</span>
 93:     <span style='color:#004a43; '>from</span>    tfzzz058<span style='color:#808030; '>,</span> tfzzz100
 94:     <span style='color:#004a43; '>where</span> 
 95:         <span style='color:#808030; '>(</span>
 96:                tfzzz058._index4 <span style='color:#004a43; '>inrange</span> 
 97:             <span style='color:#808030; '>{</span>tfzzz.checkbox.true<span style='color:#808030; '>,</span>  :<span style='color:#005fd2; '>date.from</span><span style='color:#808030; '>}</span> <span style='color:#004a43; '>and</span> 
 98:             <span style='color:#808030; '>{</span>tfzzz.checkbox.true<span style='color:#808030; '>,</span> :<span style='color:#005fd2; '>date.to</span><span style='color:#808030; '>}</span>
 99:             <span style='color:#004a43; '>or</span>
100:             <span style='color:#808030; '>(</span>tfzzz058._index4 <span style='color:#004a43; '>inrange</span> 
101:               <span style='color:#808030; '>{</span>tfzzz.checkbox.false<span style='color:#808030; '>,</span>  :<span style='color:#005fd2; '>date.from</span><span style='color:#808030; '>}</span> <span style='color:#004a43; '>and</span> 
102:               <span style='color:#808030; '>{</span>tfzzz.checkbox.false<span style='color:#808030; '>,</span> :<span style='color:#005fd2; '>date.to</span><span style='color:#808030; '>}</span>
103:               <span style='color:#004a43; '>and</span>
104:               :<span style='color:#005fd2; '>only.done</span><span style='color:#808030; '>=</span>tfzzz.checkbox.false
105:             <span style='color:#808030; '>)</span>
106:         <span style='color:#808030; '>)</span>        
107:         <span style='color:#004a43; '>and</span>
108:         tfzzz058._index5<span style='color:#808030; '>=</span><span style='color:#808030; '>{</span>:<span style='color:#005fd2; '>number</span><span style='color:#808030; '>,</span> :<span style='color:#005fd2; '>pr.date</span><span style='color:#808030; '>}</span>
109:         <span style='color:#004a43; '>and</span>
110:         tfzzz058.pnplopty <span style='color:#004a43; '>refers</span> <span style='color:#004a43; '>to</span> tfzzz100
111:         <span style='color:#004a43; '>and</span>
112:         tfzzz100.opertype<span style='color:#808030; '>=</span>kind
113:     <span style='color:#004a43; '>selectdo</span>
114:        <span style='color:#800000; font-weight:bold; '> if</span> docDate<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>then</span>
115:             docDate<span style='color:#808030; '>=</span>pr<span style='color:#008c00; '>.</span>date
116:        <span style='color:#800000; font-weight:bold; '> endif</span>
117:         <span style='color:#005fd2; '>fire.setProps</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>true</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
118:             HERR<span style='color:#008c00; '>.</span>V
119:         <span style='color:#005fd2; '>write.xml.row</span> <span style='color:#808030; '>(</span> USE_ROWSET<span style='color:#808030; '>(</span>rsReport<span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span>
120:     <span style='color:#004a43; '>endselect</span>
121:     
122:     <span style='color:#800000; font-weight:bold; '>long</span> dummy
123:     dummy<span style='color:#808030; '>=</span><span style='color:#005fd2; '>close.xml.rowset</span><span style='color:#808030; '>(</span>USE_ROWSET<span style='color:#808030; '>(</span>rsReport<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
124:     
125:     <span style='color:#800000; font-weight:bold; '>long</span>    activ<span style='color:#008c00; '>.</span>record
126:     <span style='color:#800000; font-weight:bold; '>string</span>  server<span style='color:#008c00; '>.</span>file<span style='color:#808030; '>(</span><span style='color:#008c00; '>128</span><span style='color:#808030; '>)</span>
127:     activ<span style='color:#008c00; '>.</span>record <span style='color:#808030; '>=</span> <span style='color:#005fd2; '>crystal.request.open</span><span style='color:#808030; '>(</span>CR_REP_NAME<span style='color:#808030; '>,</span> PLAIN_ROWSET<span style='color:#808030; '>,</span> rsFile<span style='color:#808030; '>,</span> server<span style='color:#008c00; '>.</span>file<span style='color:#808030; '>)</span>
128:      assert<span style='color:#008c00; '>.</span>v<span style='color:#808030; '>(</span>activ<span style='color:#008c00; '>.</span>record<span style='color:#808030; '>&lt;</span><span style='color:#808030; '>></span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"Запись активации не создана"</span><span style='color:#808030; '>)</span>
129: 
130:    <span style='color:#800000; font-weight:bold; '> if</span> <span style='color:#005fd2; '>crystal.close.request</span><span style='color:#808030; '>(</span>activ<span style='color:#008c00; '>.</span>record<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>then</span><span style='color:#800000; font-weight:bold; '> endif</span>
131:    <span style='color:#800000; font-weight:bold; '> if</span> <span style='color:#005fd2; '>launch.rview</span><span style='color:#808030; '>(</span>server<span style='color:#008c00; '>.</span>file<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>then</span><span style='color:#800000; font-weight:bold; '> endif</span>
132: <span style='color:#808030; '>}</span>
133: 
134: <span style='color:#800000; font-weight:bold; '>function</span> <span style='color:#800000; font-weight:bold; '>void</span> detectDate<span style='color:#808030; '>(</span>TBOOL lMode<span style='color:#808030; '>)</span><span style='color:#808030; '>{</span>
135:    <span style='color:#800000; font-weight:bold; '> if</span> <span style='color:#808030; '>(</span>pr<span style='color:#008c00; '>.</span>date<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>or</span> lMode <span style='color:#800000; font-weight:bold; '>then</span>
136:         <span style='color:#004a43; '>select</span>    tfzzz058.pnplprdt:<span style='color:#005fd2; '>pr.date</span> <span style='color:#004a43; '>from</span> tfzzz058 <span style='color:#004a43; '>where</span>    tfzzz058._index5 <span style='color:#808030; '>=</span> <span style='color:#808030; '>{</span>:<span style='color:#005fd2; '>number</span><span style='color:#808030; '>}</span>
137:         <span style='color:#004a43; '>as</span> <span style='color:#004a43; '>set</span> <span style='color:#004a43; '>with</span> 1 <span style='color:#004a43; '>rows</span>
138:         <span style='color:#004a43; '>selectdo</span>
139:         <span style='color:#004a43; '>endselect</span>
140:    <span style='color:#800000; font-weight:bold; '> endif</span>
141: <span style='color:#808030; '>}</span>
142: 
</pre></body></html>
