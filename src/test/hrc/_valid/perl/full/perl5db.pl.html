<html><body style='color:#000000; background:#ffffff; '><pre>
   0: <span style='color:#800000; font-weight:bold; '>package </span>DB<span style='color:#800080; '>;</span>
   1: 
   2: <span style='color:#696969; '># Debugger for Perl 5.00x; perl5db.pl patch level:</span>
   3: 
   4: $VERSION <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1.</span><span style='color:#008c00; '>07</span><span style='color:#800080; '>;</span>
   5: $header <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"perl5db.pl version </span><span style='color:#0000e6; '>$VERSION</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
   6: 
   7: <span style='color:#696969; '>#</span>
   8: <span style='color:#696969; '># This file is automatically included if you do perl -d.</span>
   9: <span style='color:#696969; '># It's probably not useful to include this yourself.</span>
  10: <span style='color:#696969; '>#</span>
  11: <span style='color:#696969; '># Perl supplies the values for %sub.  It effectively inserts</span>
  12: <span style='color:#696969; '># a &amp;DB'DB(); in front of every place that can have a</span>
  13: <span style='color:#696969; '># breakpoint. Instead of a subroutine call it calls &amp;DB::sub with</span>
  14: <span style='color:#696969; '># $DB::sub being the called subroutine. It also inserts a BEGIN</span>
  15: <span style='color:#696969; '># {require 'perl5db.pl'} before the first line.</span>
  16: <span style='color:#696969; '>#</span>
  17: <span style='color:#696969; '># After each `require'd file is compiled, but before it is executed, a</span>
  18: <span style='color:#696969; '># call to DB::postponed($main::{'_&lt;'.$filename}) is emulated. Here the</span>
  19: <span style='color:#696969; '># $filename is the expanded name of the `require'd file (as found as</span>
  20: <span style='color:#696969; '># value of %INC).</span>
  21: <span style='color:#696969; '>#</span>
  22: <span style='color:#696969; '># Additional services from Perl interpreter:</span>
  23: <span style='color:#696969; '>#</span>
  24: <span style='color:#696969; '># if caller() is called from the package DB, it provides some</span>
  25: <span style='color:#696969; '># additional data.</span>
  26: <span style='color:#696969; '>#</span>
  27: <span style='color:#696969; '># The array @{$main::{'_&lt;'.$filename}} is the line-by-line contents of</span>
  28: <span style='color:#696969; '># $filename.</span>
  29: <span style='color:#696969; '>#</span>
  30: <span style='color:#696969; '># The hash %{'_&lt;'.$filename} contains breakpoints and action (it is</span>
  31: <span style='color:#696969; '># keyed by line number), and individual entries are settable (as</span>
  32: <span style='color:#696969; '># opposed to the whole hash). Only true/false is important to the</span>
  33: <span style='color:#696969; '># interpreter, though the values used by perl5db.pl have the form</span>
  34: <span style='color:#696969; '># "$break_condition\0$action". Values are magical in numeric context.</span>
  35: <span style='color:#696969; '>#</span>
  36: <span style='color:#696969; '># The scalar ${'_&lt;'.$filename} contains $filename.</span>
  37: <span style='color:#696969; '>#</span>
  38: <span style='color:#696969; '># Note that no subroutine call is possible until &amp;DB::sub is defined</span>
  39: <span style='color:#696969; '># (for subroutines defined outside of the package DB). In fact the same is</span>
  40: <span style='color:#696969; '># true if $deep is not defined.</span>
  41: <span style='color:#696969; '>#</span>
  42: 
  43: <span style='color:#696969; '>#</span>
  44: <span style='color:#696969; '># At start reads $rcfile that may set important options.  This file</span>
  45: <span style='color:#696969; '># may define a subroutine &amp;afterinit that will be executed after the</span>
  46: <span style='color:#696969; '># debugger is initialized.</span>
  47: <span style='color:#696969; '>#</span>
  48: <span style='color:#696969; '># After $rcfile is read reads environment variable PERLDB_OPTS and parses</span>
  49: <span style='color:#696969; '># it as a rest of `O ...' line in debugger prompt.</span>
  50: <span style='color:#696969; '>#</span>
  51: <span style='color:#696969; '># The options that can be specified only at startup:</span>
  52: <span style='color:#696969; '># [To set in $rcfile, call &amp;parse_options("optionName=new_value").]</span>
  53: <span style='color:#696969; '>#</span>
  54: <span style='color:#696969; '># TTY  - the TTY to use for debugging i/o.</span>
  55: <span style='color:#696969; '>#</span>
  56: <span style='color:#696969; '># noTTY - if set, goes in NonStop mode.  On interrupt if TTY is not set</span>
  57: <span style='color:#696969; '># uses the value of noTTY or "/tmp/perldbtty$$" to find TTY using</span>
  58: <span style='color:#696969; '># Term::Rendezvous.  Current variant is to have the name of TTY in this</span>
  59: <span style='color:#696969; '># file.</span>
  60: <span style='color:#696969; '>#</span>
  61: <span style='color:#696969; '># ReadLine - If false, dummy ReadLine is used, so you can debug</span>
  62: <span style='color:#696969; '># ReadLine applications.</span>
  63: <span style='color:#696969; '>#</span>
  64: <span style='color:#696969; '># NonStop - if true, no i/o is performed until interrupt.</span>
  65: <span style='color:#696969; '>#</span>
  66: <span style='color:#696969; '># LineInfo - file or pipe to print line number info to.  If it is a</span>
  67: <span style='color:#696969; '># pipe, a short "emacs like" message is used.</span>
  68: <span style='color:#696969; '>#</span>
  69: <span style='color:#696969; '># RemotePort - host:port to connect to on remote host for remote debugging.</span>
  70: <span style='color:#696969; '>#</span>
  71: <span style='color:#696969; '># Example $rcfile: (delete leading hashes!)</span>
  72: <span style='color:#696969; '>#</span>
  73: <span style='color:#696969; '># &amp;parse_options("NonStop=1 LineInfo=db.out");</span>
  74: <span style='color:#696969; '># sub afterinit { $trace = 1; }</span>
  75: <span style='color:#696969; '>#</span>
  76: <span style='color:#696969; '># The script will run without human intervention, putting trace</span>
  77: <span style='color:#696969; '># information into db.out.  (If you interrupt it, you would better</span>
  78: <span style='color:#696969; '># reset LineInfo to something "interactive"!)</span>
  79: <span style='color:#696969; '>#</span>
  80: <span style='color:#696969; '>##################################################################</span>
  81: 
  82: <span style='color:#696969; '># Enhanced by </span><span style='color:#7144c4; '>ilya@math.ohio-state.edu</span><span style='color:#696969; '> (Ilya Zakharevich)</span>
  83: <span style='color:#696969; '># Latest version available: </span><span style='color:#5555dd; '>ftp://ftp.math.ohio-state.edu/pub/users/ilya/perl</span>
  84: 
  85: <span style='color:#696969; '># modified Perl debugger, to be run from Emacs in perldb-mode</span>
  86: <span style='color:#696969; '># Ray Lischner (uunet!mntgfx!lisch) as of 5 Nov 1990</span>
  87: <span style='color:#696969; '># Johan Vromans -- upgrade to 4.0 pl 10</span>
  88: <span style='color:#696969; '># Ilya Zakharevich -- patches after 5.001 (and some before ;-)</span>
  89: 
  90: <span style='color:#696969; '># Changelog:</span>
  91: 
  92: <span style='color:#696969; '># A lot of things changed after 0.94. First of all, core now informs</span>
  93: <span style='color:#696969; '># debugger about entry into XSUBs, overloaded operators, tied operations,</span>
  94: <span style='color:#696969; '># BEGIN and END. Handy with `O f=2'.</span>
  95: 
  96: <span style='color:#696969; '># This can make debugger a little bit too verbose, please be patient</span>
  97: <span style='color:#696969; '># and report your problems promptly.</span>
  98: 
  99: <span style='color:#696969; '># Now the option frame has 3 values: 0,1,2.</span>
 100: 
 101: <span style='color:#696969; '># Note that if DESTROY returns a reference to the object (or object),</span>
 102: <span style='color:#696969; '># the deletion of data may be postponed until the next function call,</span>
 103: <span style='color:#696969; '># due to the need to examine the return value.</span>
 104: 
 105: <span style='color:#696969; '># Changes: 0.95: `v' command shows versions.</span>
 106: <span style='color:#696969; '># Changes: 0.96: `v' command shows version of readline.</span>
 107: <span style='color:#696969; '>#    primitive completion works (dynamic variables, subs for `b' and `l',</span>
 108: <span style='color:#696969; '>#        options). Can `p %var'</span>
 109: <span style='color:#696969; '>#    Better help (`h &lt;' now works). New commands &lt;&lt;, >>, {, {{.</span>
 110: <span style='color:#696969; '>#    {dump|print}_trace() coded (to be able to do it from &lt;&lt;cmd).</span>
 111: <span style='color:#696969; '>#    `c sub' documented.</span>
 112: <span style='color:#696969; '>#    At last enough magic combined to stop after the end of debuggee.</span>
 113: <span style='color:#696969; '>#    </span><span style='color:#ffffff; background:#808000; '>!!</span><span style='color:#696969; '> should work now (thanks to Emacs bracket matching an extra</span>
 114: <span style='color:#696969; '>#    `]' in a regexp is caught).</span>
 115: <span style='color:#696969; '>#    `L', `D' and `A' span files now (as documented).</span>
 116: <span style='color:#696969; '>#    Breakpoints in `require'd code are possible (used in `R').</span>
 117: <span style='color:#696969; '>#    Some additional words on internal work of debugger.</span>
 118: <span style='color:#696969; '>#    `b load filename' implemented.</span>
 119: <span style='color:#696969; '>#    `b postpone subr' implemented.</span>
 120: <span style='color:#696969; '>#    now only `q' exits debugger (overwriteable on $inhibit_exit).</span>
 121: <span style='color:#696969; '>#    When restarting debugger breakpoints/actions persist.</span>
 122: <span style='color:#696969; '>#     Buglet: When restarting debugger only one breakpoint/action per </span>
 123: <span style='color:#696969; '>#        autoloaded function persists.</span>
 124: <span style='color:#696969; '># Changes: 0.97: NonStop will not stop in at_exit().</span>
 125: <span style='color:#696969; '>#    Option AutoTrace implemented.</span>
 126: <span style='color:#696969; '>#    Trace printed differently if frames are printed too.</span>
 127: <span style='color:#696969; '>#    new `inhibitExit' option.</span>
 128: <span style='color:#696969; '>#    printing of a very long statement interruptible.</span>
 129: <span style='color:#696969; '># Changes: 0.98: New command `m' for printing possible methods</span>
 130: <span style='color:#696969; '>#    'l -' is a synonim for `-'.</span>
 131: <span style='color:#696969; '>#    Cosmetic bugs in printing stack trace.</span>
 132: <span style='color:#696969; '>#    `frame' &amp; 8 to print "expanded args" in stack trace.</span>
 133: <span style='color:#696969; '>#    Can list/break in imported subs.</span>
 134: <span style='color:#696969; '>#    new `maxTraceLen' option.</span>
 135: <span style='color:#696969; '>#    frame &amp; 4 and frame &amp; 8 granted.</span>
 136: <span style='color:#696969; '>#    new command `m'</span>
 137: <span style='color:#696969; '>#    nonstoppable lines do not have `:' near the line number.</span>
 138: <span style='color:#696969; '>#    `b compile subname' implemented.</span>
 139: <span style='color:#696969; '>#    Will not use $` any more.</span>
 140: <span style='color:#696969; '>#    `-' behaves sane now.</span>
 141: <span style='color:#696969; '># Changes: 0.99: Completion for `f', `m'.</span>
 142: <span style='color:#696969; '>#    `m' will remove duplicate names instead of duplicate functions.</span>
 143: <span style='color:#696969; '>#    `b load' strips trailing whitespace.</span>
 144: <span style='color:#696969; '>#    completion ignores leading `|'; takes into account current package</span>
 145: <span style='color:#696969; '>#    when completing a subroutine name (same for `l').</span>
 146: <span style='color:#696969; '># Changes: 1.07: Many fixed by tchrist 13-March-2000</span>
 147: <span style='color:#696969; '>#   </span><span style='color:#ffffff; background:#808000; '>BUG FIXES:</span>
 148: <span style='color:#696969; '>#   + Added bare mimimal security checks on perldb rc files, plus</span>
 149: <span style='color:#696969; '>#     comments on what else is needed.</span>
 150: <span style='color:#696969; '>#   + Fixed the ornaments that made "|h" completely unusable.</span>
 151: <span style='color:#696969; '>#     They are not used in print_help if they will hurt.  Strip pod</span>
 152: <span style='color:#696969; '>#     if we're paging to less.</span>
 153: <span style='color:#696969; '>#   + Fixed mis-formatting of help messages caused by ornaments</span>
 154: <span style='color:#696969; '>#     to restore Larry's original formatting.  </span>
 155: <span style='color:#696969; '>#   + Fixed many other formatting errors.  The code is still suboptimal, </span>
 156: <span style='color:#696969; '>#     and needs a lot of work at restructuing. It's also misindented</span>
 157: <span style='color:#696969; '>#     in many places.</span>
 158: <span style='color:#696969; '>#   + Fixed </span><span style='color:#ffffff; background:#808000; '>bug where trying to look at an option like your pager</span>
 159: <span style='color:#696969; '>#     shows "1".  </span>
 160: <span style='color:#696969; '>#   + Fixed some $? processing.  Note: if you use csh or tcsh, you will</span>
 161: <span style='color:#696969; '>#     lose.  You should consider shell escapes not using their shell,</span>
 162: <span style='color:#696969; '>#     or else not caring about detailed status.  This should really be</span>
 163: <span style='color:#696969; '>#     unified into one place, too.</span>
 164: <span style='color:#696969; '>#   + Fixed </span><span style='color:#ffffff; background:#808000; '>bug where invisible trailing whitespace on commands hoses you,</span>
 165: <span style='color:#696969; '>#     tricking Perl into thinking you wern't calling a debugger command!</span>
 166: <span style='color:#696969; '>#   + Fixed </span><span style='color:#ffffff; background:#808000; '>bug where leading whitespace on commands hoses you.  (One</span>
 167: <span style='color:#696969; '>#     suggests a leading semicolon or any other irrelevant non-whitespace</span>
 168: <span style='color:#696969; '>#     to indicate literal Perl code.)</span>
 169: <span style='color:#696969; '>#   + Fixed bugs that ate warnings due to wrong selected handle.</span>
 170: <span style='color:#696969; '>#   + Fixed a precedence </span><span style='color:#ffffff; background:#808000; '>bug on signal stuff.</span>
 171: <span style='color:#696969; '>#   + Fixed some unseemly wording.</span>
 172: <span style='color:#696969; '>#   + Fixed </span><span style='color:#ffffff; background:#808000; '>bug in help command trying to call perl method code.</span>
 173: <span style='color:#696969; '>#   + Fixed to call dumpvar from exception handler.  SIGPIPE killed us.</span>
 174: <span style='color:#696969; '>#   ENHANCEMENTS:</span>
 175: <span style='color:#696969; '>#   + Added some comments.  This code is still nasty spaghetti.</span>
 176: <span style='color:#696969; '>#   + Added message if you clear your pre/post command stacks which was</span>
 177: <span style='color:#696969; '>#     very easy to do if you just typed a bare >, &lt;, or {.  (A command</span>
 178: <span style='color:#696969; '>#     without an argument should *never* be a destructive action; this</span>
 179: <span style='color:#696969; '>#     API is fundamentally screwed up; likewise option setting, which</span>
 180: <span style='color:#696969; '>#     is equally buggered.)</span>
 181: <span style='color:#696969; '>#   + Added command stack dump on argument of "?" for >, &lt;, or {.</span>
 182: <span style='color:#696969; '>#   + Added a semi-built-in doc viewer command that calls man with the</span>
 183: <span style='color:#696969; '>#     proper %Config::Config path (and thus gets caching, man -k, etc),</span>
 184: <span style='color:#696969; '>#     or else perldoc on obstreperous platforms.</span>
 185: <span style='color:#696969; '>#   + Added to and rearranged the help information.</span>
 186: <span style='color:#696969; '>#   + Detected apparent misuse of { ... } to declare a block; this used</span>
 187: <span style='color:#696969; '>#     to work but now is a command, and mysteriously gave no complaint.</span>
 188: 
 189: <span style='color:#696969; '>####################################################################</span>
 190: 
 191: <span style='color:#696969; '># Needed for the statement after exec():</span>
 192: 
 193: <span style='color:#800000; font-weight:bold; '>BEGIN</span> <span style='color:#800080; '>{</span> $ini_warn <span style='color:#808030; '>=</span> $^W<span style='color:#800080; '>;</span> $^W <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#800080; '>}</span> <span style='color:#696969; '># Switch compilation warnings off until another BEGIN.</span>
 194: <span style='color:#800000; font-weight:bold; '>local</span><span style='color:#808030; '>(</span>$^W<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>            <span style='color:#696969; '># Switch run-time warnings off during init.</span>
 195: <span style='color:#800000; font-weight:bold; '>warn</span> <span style='color:#808030; '>(</span>            <span style='color:#696969; '># Do not ;-)</span>
 196:       $dumpvar<span style='color:#808030; '>::</span>hashDepth<span style='color:#808030; '>,</span>     
 197:       $dumpvar<span style='color:#808030; '>::</span>arrayDepth<span style='color:#808030; '>,</span>    
 198:       $dumpvar<span style='color:#808030; '>::</span>dumpDBFiles<span style='color:#808030; '>,</span>   
 199:       $dumpvar<span style='color:#808030; '>::</span>dumpPackages<span style='color:#808030; '>,</span>  
 200:       $dumpvar<span style='color:#808030; '>::</span>quoteHighBit<span style='color:#808030; '>,</span>  
 201:       $dumpvar<span style='color:#808030; '>::</span>printUndef<span style='color:#808030; '>,</span>    
 202:       $dumpvar<span style='color:#808030; '>::</span>globPrint<span style='color:#808030; '>,</span>     
 203:       $dumpvar<span style='color:#808030; '>::</span>usageOnly<span style='color:#808030; '>,</span>
 204:       @ARGS<span style='color:#808030; '>,</span>
 205:       $Carp<span style='color:#808030; '>::</span>CarpLevel<span style='color:#808030; '>,</span>
 206:       $panic<span style='color:#808030; '>,</span>
 207:       $second_time<span style='color:#808030; '>,</span>
 208:      <span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 209: 
 210: <span style='color:#696969; '># Command-line + PERLLIB:</span>
 211: @ini_INC <span style='color:#808030; '>=</span> @INC<span style='color:#800080; '>;</span>
 212: 
 213: <span style='color:#696969; '># $prevwarn = $prevdie = $prevbus = $prevsegv = ''; # Does not </span><span style='color:#ffffff; background:#808000; '>help?!</span>
 214: 
 215: $trace <span style='color:#808030; '>=</span> $signal <span style='color:#808030; '>=</span> $single <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>    <span style='color:#696969; '># Uninitialized warning suppression</span>
 216:                                 <span style='color:#696969; '># (local $^W cannot help - other packages!).</span>
 217: $inhibit_exit <span style='color:#808030; '>=</span> $option<span style='color:#800080; '>{</span>PrintRet<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 218: 
 219: @options     <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>qw</span><span style='color:#800000; '>(</span><span style='color:#0000e6; '>hashDepth arrayDepth DumpDBFiles DumpPackages DumpReused</span>
 220: <span style='color:#0000e6; '>          compactDump veryCompact quote HighBit undefPrint</span>
 221: <span style='color:#0000e6; '>          globPrint PrintRet UsageOnly frame AutoTrace</span>
 222: <span style='color:#0000e6; '>          TTY noTTY ReadLine NonStop LineInfo maxTraceLen</span>
 223: <span style='color:#0000e6; '>          recallCommand ShellBang pager tkRunning ornaments</span>
 224: <span style='color:#0000e6; '>          signalLevel warnLevel dieLevel inhibit_exit</span>
 225: <span style='color:#0000e6; '>          ImmediateStop bareStringify</span>
 226: <span style='color:#0000e6; '>          RemotePort</span><span style='color:#800000; '>)</span><span style='color:#800080; '>;</span>
 227: 
 228: %optionVars    <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>
 229:          hashDepth    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span>$dumpvar<span style='color:#808030; '>::</span>hashDepth<span style='color:#808030; '>,</span>
 230:          arrayDepth    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span>$dumpvar<span style='color:#808030; '>::</span>arrayDepth<span style='color:#808030; '>,</span>
 231:          DumpDBFiles    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span>$dumpvar<span style='color:#808030; '>::</span>dumpDBFiles<span style='color:#808030; '>,</span>
 232:          DumpPackages    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span>$dumpvar<span style='color:#808030; '>::</span>dumpPackages<span style='color:#808030; '>,</span>
 233:          DumpReused    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span>$dumpvar<span style='color:#808030; '>::</span>dumpReused<span style='color:#808030; '>,</span>
 234:          HighBit    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span>$dumpvar<span style='color:#808030; '>::</span>quoteHighBit<span style='color:#808030; '>,</span>
 235:          undefPrint    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span>$dumpvar<span style='color:#808030; '>::</span>printUndef<span style='color:#808030; '>,</span>
 236:          globPrint    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span>$dumpvar<span style='color:#808030; '>::</span>globPrint<span style='color:#808030; '>,</span>
 237:          UsageOnly    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span>$dumpvar<span style='color:#808030; '>::</span>usageOnly<span style='color:#808030; '>,</span>     
 238:          bareStringify    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span>$dumpvar<span style='color:#808030; '>::</span>bareStringify<span style='color:#808030; '>,</span>
 239:          frame          <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span>$frame<span style='color:#808030; '>,</span>
 240:          AutoTrace      <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span>$trace<span style='color:#808030; '>,</span>
 241:          inhibit_exit   <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span>$inhibit_exit<span style='color:#808030; '>,</span>
 242:          maxTraceLen    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span>$maxtrace<span style='color:#808030; '>,</span>
 243:          ImmediateStop    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span>$ImmediateStop<span style='color:#808030; '>,</span>
 244:          RemotePort    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span>$remoteport<span style='color:#808030; '>,</span>
 245: <span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 246: 
 247: %optionAction  <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>
 248:           compactDump    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span><span style='color:#bb7977; font-weight:bold; '>dumpvar</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>compactDump</span><span style='color:#808030; '>,</span>
 249:           veryCompact    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span><span style='color:#bb7977; font-weight:bold; '>dumpvar</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>veryCompact</span><span style='color:#808030; '>,</span>
 250:           quote        <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span><span style='color:#bb7977; font-weight:bold; '>dumpvar</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>quote</span><span style='color:#808030; '>,</span>
 251:           TTY        <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span>TTY<span style='color:#808030; '>,</span>
 252:           noTTY        <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span>noTTY<span style='color:#808030; '>,</span>
 253:           ReadLine    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span>ReadLine<span style='color:#808030; '>,</span>
 254:           NonStop    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span>NonStop<span style='color:#808030; '>,</span>
 255:           LineInfo    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span>LineInfo<span style='color:#808030; '>,</span>
 256:           recallCommand    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span>recallCommand<span style='color:#808030; '>,</span>
 257:           ShellBang    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span>shellBang<span style='color:#808030; '>,</span>
 258:           pager        <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span>pager<span style='color:#808030; '>,</span>
 259:           signalLevel    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span>signalLevel<span style='color:#808030; '>,</span>
 260:           warnLevel    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span>warnLevel<span style='color:#808030; '>,</span>
 261:           dieLevel    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span>dieLevel<span style='color:#808030; '>,</span>
 262:           tkRunning    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span>tkRunning<span style='color:#808030; '>,</span>
 263:           ornaments    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span>ornaments<span style='color:#808030; '>,</span>
 264:           RemotePort    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span>RemotePort<span style='color:#808030; '>,</span>
 265:          <span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 266: 
 267: %optionRequire <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>
 268:           compactDump    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#0000e6; '>'dumpvar.pl'</span><span style='color:#808030; '>,</span>
 269:           veryCompact    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#0000e6; '>'dumpvar.pl'</span><span style='color:#808030; '>,</span>
 270:           quote        <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#0000e6; '>'dumpvar.pl'</span><span style='color:#808030; '>,</span>
 271:          <span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 272: 
 273: <span style='color:#696969; '># These guys may be defined in $ENV{PERL5DB} :</span>
 274: $rl        <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span>    <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>defined</span> $rl<span style='color:#800080; '>;</span>
 275: $warnLevel    <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span>    <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>defined</span> $warnLevel<span style='color:#800080; '>;</span>
 276: $dieLevel    <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span>    <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>defined</span> $dieLevel<span style='color:#800080; '>;</span>
 277: $signalLevel    <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span>    <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>defined</span> $signalLevel<span style='color:#800080; '>;</span>
 278: $pre        <span style='color:#808030; '>=</span> <span style='color:#808030; '>[</span><span style='color:#808030; '>]</span>    <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>defined</span> $pre<span style='color:#800080; '>;</span>
 279: $post        <span style='color:#808030; '>=</span> <span style='color:#808030; '>[</span><span style='color:#808030; '>]</span>    <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>defined</span> $post<span style='color:#800080; '>;</span>
 280: $pretype    <span style='color:#808030; '>=</span> <span style='color:#808030; '>[</span><span style='color:#808030; '>]</span>    <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>defined</span> $pretype<span style='color:#800080; '>;</span>
 281: 
 282: warnLevel<span style='color:#808030; '>(</span>$warnLevel<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 283: dieLevel<span style='color:#808030; '>(</span>$dieLevel<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 284: signalLevel<span style='color:#808030; '>(</span>$signalLevel<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 285: 
 286: <span style='color:#808030; '>&amp;</span>pager<span style='color:#808030; '>(</span>
 287:     <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span><span style='color:#808030; '>(</span>$ENV<span style='color:#800080; '>{</span>PAGER<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span> 
 288:     <span style='color:#808030; '>?</span> $ENV<span style='color:#800080; '>{</span>PAGER<span style='color:#800080; '>}</span>
 289:     <span style='color:#808030; '>:</span> <span style='color:#808030; '>(</span>$^O <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'os2'</span> 
 290:        <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>'cmd /c more'</span> 
 291:        <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>'more'</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>defined</span> $pager<span style='color:#800080; '>;</span>
 292: setman<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 293: <span style='color:#808030; '>&amp;</span>recallCommand<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"!"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>defined</span> $prc<span style='color:#800080; '>;</span>
 294: <span style='color:#808030; '>&amp;</span>shellBang<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"!"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>defined</span> $psh<span style='color:#800080; '>;</span>
 295: $maxtrace <span style='color:#808030; '>=</span> <span style='color:#008c00; '>400</span> <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>defined</span> $maxtrace<span style='color:#800080; '>;</span>
 296: 
 297: <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>-e</span> <span style='color:#0000e6; '>"/dev/tty"</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>  <span style='color:#696969; '># this is the wrong metric!</span>
 298:   $rcfile<span style='color:#808030; '>=</span><span style='color:#0000e6; '>".perldb"</span><span style='color:#800080; '>;</span>
 299: <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
 300:   $rcfile<span style='color:#808030; '>=</span><span style='color:#0000e6; '>"perldb.ini"</span><span style='color:#800080; '>;</span>
 301: <span style='color:#800080; '>}</span>
 302: 
 303: <span style='color:#696969; '># This isn't really safe, because there's a race</span>
 304: <span style='color:#696969; '># between checking and opening.  The solution is to</span>
 305: <span style='color:#696969; '># open and fstat the handle, but then you have to read and</span>
 306: <span style='color:#696969; '># eval the contents.  But then the silly thing gets</span>
 307: <span style='color:#696969; '># your lexical scope, which is unfortunately at best.</span>
 308: <span style='color:#800000; font-weight:bold; '>sub </span>safe_do <span style='color:#800080; '>{</span> 
 309:     <span style='color:#800000; font-weight:bold; '>my</span> $file <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
 310: 
 311:     <span style='color:#696969; '># Just exactly what part of the word "CORE::" don't you understand?</span>
 312:     <span style='color:#800000; font-weight:bold; '>local</span> $SIG<span style='color:#800080; '>{</span>__WARN__<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>  
 313:     <span style='color:#800000; font-weight:bold; '>local</span> $SIG<span style='color:#800080; '>{</span>__DIE__<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>    
 314: 
 315:     <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#808030; '>(</span>is_safe_file<span style='color:#808030; '>(</span>$file<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 316:     <span style='color:#800000; font-weight:bold; '>CORE</span><span style='color:#808030; '>:</span><span style='color:#808030; '>:</span><span style='color:#800000; font-weight:bold; '>warn</span> <span style='color:#800000; '>&lt;&lt;</span><span style='color:#e34adc; '>EO_GRIPE</span><span style='color:#0000e6; '>;</span>
 317: <span style='color:#0000e6; '>perldb: Must not source insecure rcfile </span><span style='color:#0000e6; '>$file</span><span style='color:#0000e6; '>.</span>
 318: <span style='color:#0000e6; '>        You or the superuser must be the owner, and it must not </span>
 319: <span style='color:#0000e6; '>    be writable by anyone but its owner.</span>
 320: <span style='color:#e34adc; '>EO_GRIPE</span>
 321:     <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
 322:     <span style='color:#800080; '>}</span> 
 323: 
 324:     <span style='color:#800000; font-weight:bold; '>do</span> $file<span style='color:#800080; '>;</span>
 325:     <span style='color:#800000; font-weight:bold; '>CORE</span><span style='color:#808030; '>:</span><span style='color:#808030; '>:</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"perldb: couldn't parse </span><span style='color:#0000e6; '>$file</span><span style='color:#0000e6; '>: $@"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>if</span> $@<span style='color:#800080; '>;</span>
 326: <span style='color:#800080; '>}</span>
 327: 
 328: 
 329: <span style='color:#696969; '># Verifies that owner is either real user or superuser and that no</span>
 330: <span style='color:#696969; '># one but owner may write to it.  This function is of limited use</span>
 331: <span style='color:#696969; '># when called on a path instead of upon a handle, because there are</span>
 332: <span style='color:#696969; '># no guarantees that filename (by dirent) whose file (by ino) is</span>
 333: <span style='color:#696969; '># eventually accessed is the same as the one tested. </span>
 334: <span style='color:#696969; '># Assumes that the file's existence is not in doubt.</span>
 335: <span style='color:#800000; font-weight:bold; '>sub </span>is_safe_file <span style='color:#800080; '>{</span>
 336:     <span style='color:#800000; font-weight:bold; '>my</span> $path <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
 337:     <span style='color:#800000; font-weight:bold; '>stat</span><span style='color:#808030; '>(</span>$path<span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>    <span style='color:#696969; '># mysteriously vaporized</span>
 338:     <span style='color:#800000; font-weight:bold; '>my</span><span style='color:#808030; '>(</span>$dev<span style='color:#808030; '>,</span>$ino<span style='color:#808030; '>,</span>$mode<span style='color:#808030; '>,</span>$nlink<span style='color:#808030; '>,</span>$uid<span style='color:#808030; '>,</span>$gid<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>stat</span><span style='color:#808030; '>(</span>_<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 339: 
 340:     <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>if</span> $uid <span style='color:#808030; '>!</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> $uid <span style='color:#808030; '>!</span><span style='color:#808030; '>=</span> $&lt;<span style='color:#800080; '>;</span>
 341:     <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>if</span> $mode <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>022</span><span style='color:#800080; '>;</span>
 342:     <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 343: <span style='color:#800080; '>}</span>
 344: 
 345: <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>-f</span> $rcfile<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 346:     safe_do<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"./</span><span style='color:#0000e6; '>$rcfile</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 347: <span style='color:#800080; '>}</span> 
 348: <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $ENV<span style='color:#800080; '>{</span>HOME<span style='color:#800080; '>}</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>-f</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$ENV</span><span style='color:#0000e6; '>{HOME}/</span><span style='color:#0000e6; '>$rcfile</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 349:     safe_do<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$ENV</span><span style='color:#0000e6; '>{HOME}/</span><span style='color:#0000e6; '>$rcfile</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 350: <span style='color:#800080; '>}</span>
 351: <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $ENV<span style='color:#800080; '>{</span>LOGDIR<span style='color:#800080; '>}</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>-f</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$ENV</span><span style='color:#0000e6; '>{LOGDIR}/</span><span style='color:#0000e6; '>$rcfile</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 352:     safe_do<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$ENV</span><span style='color:#0000e6; '>{LOGDIR}/</span><span style='color:#0000e6; '>$rcfile</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 353: <span style='color:#800080; '>}</span>
 354: 
 355: <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $ENV<span style='color:#800080; '>{</span>PERLDB_OPTS<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 356:   parse_options<span style='color:#808030; '>(</span>$ENV<span style='color:#800080; '>{</span>PERLDB_OPTS<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 357: <span style='color:#800080; '>}</span>
 358: 
 359: <span style='color:#696969; '># Here begin the unreadable code.  It needs fixing.</span>
 360: 
 361: <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>exists</span> $ENV<span style='color:#800080; '>{</span>PERLDB_RESTART<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 362:   <span style='color:#800000; font-weight:bold; '>delete</span> $ENV<span style='color:#800080; '>{</span>PERLDB_RESTART<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 363:   <span style='color:#696969; '># $restart = 1;</span>
 364:   @hist <span style='color:#808030; '>=</span> get_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>'PERLDB_HIST'</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 365:   %break_on_load <span style='color:#808030; '>=</span> get_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_ON_LOAD"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 366:   %postponed <span style='color:#808030; '>=</span> get_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_POSTPONE"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 367:   <span style='color:#800000; font-weight:bold; '>my</span> @had_breakpoints<span style='color:#808030; '>=</span> get_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_VISITED"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 368:   <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span> <span style='color:#808030; '>..</span> $#had_breakpoints<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 369:     <span style='color:#800000; font-weight:bold; '>my</span> %pf <span style='color:#808030; '>=</span> get_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_FILE_</span><span style='color:#0000e6; '>$_</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 370:     $postponed_file<span style='color:#800080; '>{</span>$had_breakpoints<span style='color:#808030; '>[</span>$_<span style='color:#808030; '>]</span><span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span>%pf <span style='color:#800000; font-weight:bold; '>if</span> %pf<span style='color:#800080; '>;</span>
 371:   <span style='color:#800080; '>}</span>
 372:   <span style='color:#800000; font-weight:bold; '>my</span> %opt <span style='color:#808030; '>=</span> get_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_OPT"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 373:   <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$opt<span style='color:#808030; '>,</span>$val<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 374:   <span style='color:#800000; font-weight:bold; '>while</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>$opt<span style='color:#808030; '>,</span>$val<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>each</span> %opt<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 375:     $val <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>[</span><span style='color:#0f69ff; '>\\</span><span style='color:#0f69ff; '>\'</span><span style='color:#808030; '>]</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\\</span><span style='color:#0000e6; '>$1</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>g</span><span style='color:#800080; '>;</span>
 376:     parse_options<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$opt</span><span style='color:#0000e6; '>'</span><span style='color:#0000e6; '>$val</span><span style='color:#0000e6; '>'"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 377:   <span style='color:#800080; '>}</span>
 378:   @INC <span style='color:#808030; '>=</span> get_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_INC"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 379:   @ini_INC <span style='color:#808030; '>=</span> @INC<span style='color:#800080; '>;</span>
 380:   $pretype <span style='color:#808030; '>=</span> <span style='color:#808030; '>[</span>get_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_PRETYPE"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
 381:   $pre <span style='color:#808030; '>=</span> <span style='color:#808030; '>[</span>get_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_PRE"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
 382:   $post <span style='color:#808030; '>=</span> <span style='color:#808030; '>[</span>get_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_POST"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
 383:   @typeahead <span style='color:#808030; '>=</span> get_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_TYPEAHEAD"</span><span style='color:#808030; '>,</span> @typeahead<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 384: <span style='color:#800080; '>}</span>
 385: 
 386: <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$notty<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 387:   $runnonstop <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 388: <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
 389:   <span style='color:#696969; '># Is Perl being run from a slave editor or graphical debugger?</span>
 390:   $slave_editor <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $main<span style='color:#808030; '>::</span>ARGV<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>and</span> <span style='color:#808030; '>(</span>$main<span style='color:#808030; '>::</span>ARGV<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'-emacs'</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 391:   $rl <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#808030; '>(</span>@main<span style='color:#808030; '>::</span>ARGV<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>if</span> $slave_editor<span style='color:#800080; '>;</span>
 392: 
 393:   <span style='color:#696969; '>#require Term::ReadLine;</span>
 394: 
 395:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$^O <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'cygwin'</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 396:     <span style='color:#696969; '># /dev/tty is binary. use stdin for textmode</span>
 397:     <span style='color:#800000; font-weight:bold; '>undef</span> $console<span style='color:#800080; '>;</span>
 398:   <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>-e</span> <span style='color:#0000e6; '>"/dev/tty"</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 399:     $console <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"/dev/tty"</span><span style='color:#800080; '>;</span>
 400:   <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span>$^O <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'dos'</span> <span style='color:#808030; '>or</span> <span style='color:#800000; font-weight:bold; '>-e</span> <span style='color:#0000e6; '>"con"</span> <span style='color:#808030; '>or</span> $^O <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'MSWin32'</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 401:     $console <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"con"</span><span style='color:#800080; '>;</span>
 402:   <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span>$^O <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'MacOS'</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 403:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$MacPerl<span style='color:#808030; '>::</span>Version <span style='color:#808030; '>!~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>MPW</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 404:       $console <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"Dev:Console:Perl Debug"</span><span style='color:#800080; '>;</span> <span style='color:#696969; '># Separate window for application</span>
 405:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
 406:       $console <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"Dev:Console"</span><span style='color:#800080; '>;</span>
 407:     <span style='color:#800080; '>}</span>
 408:   <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
 409:     $console <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"sys</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>command"</span><span style='color:#800080; '>;</span>
 410:   <span style='color:#800080; '>}</span>
 411: 
 412:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>$^O <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'MSWin32'</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>and</span> <span style='color:#808030; '>(</span>$slave_editor <span style='color:#808030; '>or</span> <span style='color:#800000; font-weight:bold; '>defined</span> $ENV<span style='color:#800080; '>{</span>EMACS<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 413:     $console <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>undef</span><span style='color:#800080; '>;</span>
 414:   <span style='color:#800080; '>}</span>
 415: 
 416:   <span style='color:#696969; '># Around a </span><span style='color:#ffffff; background:#808000; '>bug:</span>
 417:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $ENV<span style='color:#800080; '>{</span>OS2_SHELL<span style='color:#800080; '>}</span> <span style='color:#808030; '>and</span> <span style='color:#808030; '>(</span>$slave_editor <span style='color:#808030; '>or</span> $ENV<span style='color:#800080; '>{</span>WINDOWID<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#696969; '># In OS/2</span>
 418:     $console <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>undef</span><span style='color:#800080; '>;</span>
 419:   <span style='color:#800080; '>}</span>
 420: 
 421:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$^O <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'epoc'</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 422:     $console <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>undef</span><span style='color:#800080; '>;</span>
 423:   <span style='color:#800080; '>}</span>
 424: 
 425:   $console <span style='color:#808030; '>=</span> $tty <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>defined</span> $tty<span style='color:#800080; '>;</span>
 426: 
 427:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $remoteport<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 428:     <span style='color:#800000; font-weight:bold; '>require</span> <span style='color:#bb7977; font-weight:bold; '>IO::Socket</span><span style='color:#800080; '>;</span>
 429:     $OUT <span style='color:#808030; '>=</span> new <span style='color:#bb7977; font-weight:bold; '>IO::Socket</span><span style='color:#808030; '>:</span><span style='color:#808030; '>:</span>INET<span style='color:#808030; '>(</span> Timeout  <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#0000e6; '>'10'</span><span style='color:#808030; '>,</span>
 430:                                  PeerAddr <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> $remoteport<span style='color:#808030; '>,</span>
 431:                                  Proto    <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#0000e6; '>'tcp'</span><span style='color:#808030; '>,</span>
 432:                                <span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 433:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>$OUT<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>die</span> <span style='color:#0000e6; '>"Unable to connect to remote host: </span><span style='color:#0000e6; '>$remoteport</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span>
 434:     $IN <span style='color:#808030; '>=</span> $OUT<span style='color:#800080; '>;</span>
 435:   <span style='color:#800080; '>}</span>
 436:   <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
 437:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $console<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 438:       <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>IN<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"+&lt;</span><span style='color:#0000e6; '>$console</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>IN<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"&lt;</span><span style='color:#0000e6; '>$console</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>IN<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"&lt;&amp;STDIN"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 439:       <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>OUT<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"+></span><span style='color:#0000e6; '>$console</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>OUT<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"></span><span style='color:#0000e6; '>$console</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>OUT<span style='color:#808030; '>,</span><span style='color:#0000e6; '>">&amp;STDERR"</span><span style='color:#808030; '>)</span>
 440:         <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>OUT<span style='color:#808030; '>,</span><span style='color:#0000e6; '>">&amp;STDOUT"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>    <span style='color:#696969; '># so we don't dongle stdout</span>
 441:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
 442:       <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>IN<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"&lt;&amp;STDIN"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 443:       <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>OUT<span style='color:#808030; '>,</span><span style='color:#0000e6; '>">&amp;STDERR"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>OUT<span style='color:#808030; '>,</span><span style='color:#0000e6; '>">&amp;STDOUT"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span> <span style='color:#696969; '># so we don't dongle stdout</span>
 444:       $console <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'STDIN/OUT'</span><span style='color:#800080; '>;</span>
 445:     <span style='color:#800080; '>}</span>
 446:     <span style='color:#696969; '># so open("|more") can read from STDOUT and so we don't dingle stdin</span>
 447:     $IN <span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span>*IN<span style='color:#800080; '>;</span>
 448: 
 449:     $OUT <span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span>*OUT<span style='color:#800080; '>;</span>
 450:   <span style='color:#800080; '>}</span>
 451:   <span style='color:#800000; font-weight:bold; '>select</span><span style='color:#808030; '>(</span>$OUT<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 452:   $| <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>            <span style='color:#696969; '># for DB::OUT</span>
 453:   <span style='color:#800000; font-weight:bold; '>select</span><span style='color:#808030; '>(</span>STDOUT<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 454: 
 455:   $LINEINFO <span style='color:#808030; '>=</span> $OUT <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>defined</span> $LINEINFO<span style='color:#800080; '>;</span>
 456:   $lineinfo <span style='color:#808030; '>=</span> $console <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>defined</span> $lineinfo<span style='color:#800080; '>;</span>
 457: 
 458:   $| <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>            <span style='color:#696969; '># for real STDOUT</span>
 459: 
 460:   $header <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>.</span><span style='color:#0000e6; '>Header: </span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>,</span><span style='color:#808030; '>]</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>,v</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#0000e6; '>\S</span><span style='color:#808030; '>+</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#0000e6; '>\S</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>$1</span><span style='color:#0000e6; '>$2</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 461:   <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#808030; '>(</span>$runnonstop<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 462:     <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>Loading DB routines from </span><span style='color:#0000e6; '>$header</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 463:     <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Editor support "</span><span style='color:#808030; '>,</span>
 464:         $slave_editor <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>"enabled"</span> <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>"available"</span><span style='color:#808030; '>,</span>
 465:         <span style='color:#0000e6; '>".</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 466:     <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>Enter h or `h h' for help, or `</span><span style='color:#0000e6; '>$doccmd</span><span style='color:#0000e6; '> perldebug' for more help.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 467:   <span style='color:#800080; '>}</span>
 468: <span style='color:#800080; '>}</span>
 469: 
 470: @ARGS <span style='color:#808030; '>=</span> @ARGV<span style='color:#800080; '>;</span>
 471: <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span>@args<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 472:     <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\'</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\\</span><span style='color:#0f69ff; '>\'</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>g</span><span style='color:#800080; '>;</span>
 473:     <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>'</span><span style='color:#0000e6; '>$1</span><span style='color:#0000e6; '>'</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>unless</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>-</span><span style='color:#808030; '>?</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>\d</span><span style='color:#0000e6; '>.</span><span style='color:#808030; '>]</span><span style='color:#808030; '>+</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 474: <span style='color:#800080; '>}</span>
 475: 
 476: <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> <span style='color:#808030; '>&amp;</span>afterinit<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>    <span style='color:#696969; '># May be defined in $rcfile</span>
 477:   <span style='color:#808030; '>&amp;</span>afterinit<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 478: <span style='color:#800080; '>}</span>
 479: 
 480: $I_m_init <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 481: 
 482: <span style='color:#696969; '>############################################################ Subroutines</span>
 483: 
 484: <span style='color:#800000; font-weight:bold; '>sub </span>DB <span style='color:#800080; '>{</span>
 485:     <span style='color:#696969; '># _After_ the perl program is compiled, $single is set to 1:</span>
 486:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$single <span style='color:#808030; '>and</span> <span style='color:#808030; '>not</span> $second_time<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 487:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$runnonstop<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>    <span style='color:#696969; '># Disable until signal</span>
 488:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span>$i<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> $i <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> $stack_depth<span style='color:#800080; '>;</span> <span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 489:         $stack<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>=</span> <span style='color:#808030; '>~</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 490:     <span style='color:#800080; '>}</span>
 491:     $single <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 492:     <span style='color:#696969; '># return;            # Would not print trace!</span>
 493:       <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span>$ImmediateStop<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 494:     $ImmediateStop <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 495:     $signal <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 496:       <span style='color:#800080; '>}</span>
 497:     <span style='color:#800080; '>}</span>
 498:     $runnonstop <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>if</span> $single <span style='color:#808030; '>or</span> $signal<span style='color:#800080; '>;</span> <span style='color:#696969; '># Disable it if interactive.</span>
 499:     <span style='color:#808030; '>&amp;</span>save<span style='color:#800080; '>;</span>
 500:     <span style='color:#808030; '>(</span>$package<span style='color:#808030; '>,</span> $filename<span style='color:#808030; '>,</span> $line<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>caller</span><span style='color:#800080; '>;</span>
 501:     $filename_ini <span style='color:#808030; '>=</span> $filename<span style='color:#800080; '>;</span>
 502:     $usercontext <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'($@, $!, $^E, $,, $/, $\, $^W) = @saved;'</span> <span style='color:#808030; '>.</span>
 503:       <span style='color:#0000e6; '>"package </span><span style='color:#0000e6; '>$package</span><span style='color:#0000e6; '>;"</span><span style='color:#800080; '>;</span>    <span style='color:#696969; '># this won't let them modify, alas</span>
 504:     <span style='color:#800000; font-weight:bold; '>local</span><span style='color:#808030; '>(</span>*dbline<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> $main<span style='color:#808030; '>:</span><span style='color:#808030; '>:</span><span style='color:#800080; '>{</span><span style='color:#0000e6; '>'_&lt;'</span> <span style='color:#808030; '>.</span> $filename<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 505:     $max <span style='color:#808030; '>=</span> $#dbline<span style='color:#800080; '>;</span>
 506:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>$stop<span style='color:#808030; '>,</span>$action<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>split</span><span style='color:#808030; '>(</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\0</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span>$dbline<span style='color:#800080; '>{</span>$line<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 507:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$stop <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'1'</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 508:         $signal <span style='color:#808030; '>|</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 509:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span>$stop<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 510:         $evalarg <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>DB::signal |= </span><span style='color:#008c00; '>1</span><span style='color:#0000e6; '> if do {</span><span style='color:#0000e6; '>$stop</span><span style='color:#0000e6; '>}"</span><span style='color:#800080; '>;</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>eval</span><span style='color:#800080; '>;</span>
 511:         $dbline<span style='color:#800080; '>{</span>$line<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>;9</span><span style='color:#808030; '>(</span><span style='color:#808030; '>$</span><span style='color:#800080; '>|</span><span style='color:#0f69ff; '>\0</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>$1</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 512:     <span style='color:#800080; '>}</span>
 513:     <span style='color:#800080; '>}</span>
 514:     <span style='color:#800000; font-weight:bold; '>my</span> $was_signal <span style='color:#808030; '>=</span> $signal<span style='color:#800080; '>;</span>
 515:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$trace <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 516:       <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>my</span> $n <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> $n <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> $#to_watch<span style='color:#800080; '>;</span> $n<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 517:     $evalarg <span style='color:#808030; '>=</span> $to_watch<span style='color:#808030; '>[</span>$n<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
 518:     <span style='color:#800000; font-weight:bold; '>local</span> $onetimeDump<span style='color:#800080; '>;</span>    <span style='color:#696969; '># Do not output results</span>
 519:     <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$val<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>eval</span><span style='color:#800080; '>;</span>    <span style='color:#696969; '># </span><span style='color:#ffffff; background:#808000; '>Fix context (&amp;eval is doing array)?</span>
 520:     $val <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $val<span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>"'</span><span style='color:#0000e6; '>$val</span><span style='color:#0000e6; '>'"</span> <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>'undef'</span> <span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 521:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$val <span style='color:#808030; '>ne</span> $old_watch<span style='color:#808030; '>[</span>$n<span style='color:#808030; '>]</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 522:       $signal <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 523:       <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#800000; '>&lt;&lt;</span><span style='color:#e34adc; '>EOP</span><span style='color:#0000e6; '>;</span>
 524: <span style='color:#0000e6; '>Watchpoint </span><span style='color:#0000e6; '>$n</span><span style='color:#0000e6; '>:</span><span style='color:#0f69ff; '>\t</span><span style='color:#0000e6; '>$to_watch</span><span style='color:#0000e6; '>[</span><span style='color:#0000e6; '>$n</span><span style='color:#0000e6; '>] changed:</span>
 525: <span style='color:#0000e6; '>    old value:</span><span style='color:#0f69ff; '>\t</span><span style='color:#0000e6; '>$old_watch</span><span style='color:#0000e6; '>[</span><span style='color:#0000e6; '>$n</span><span style='color:#0000e6; '>]</span>
 526: <span style='color:#0000e6; '>    new value:</span><span style='color:#0f69ff; '>\t</span><span style='color:#0000e6; '>$val</span><span style='color:#0000e6; '></span>
 527: <span style='color:#e34adc; '>EOP</span>
 528:       $old_watch<span style='color:#808030; '>[</span>$n<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> $val<span style='color:#800080; '>;</span>
 529:     <span style='color:#800080; '>}</span>
 530:       <span style='color:#800080; '>}</span>
 531:     <span style='color:#800080; '>}</span>
 532:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$trace <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>4</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>        <span style='color:#696969; '># User-installed watch</span>
 533:       <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#800000; font-weight:bold; '>if</span> watchfunction<span style='color:#808030; '>(</span>$package<span style='color:#808030; '>,</span> $filename<span style='color:#808030; '>,</span> $line<span style='color:#808030; '>)</span> 
 534:     <span style='color:#808030; '>and</span> <span style='color:#808030; '>not</span> $single <span style='color:#808030; '>and</span> <span style='color:#808030; '>not</span> $was_signal <span style='color:#808030; '>and</span> <span style='color:#808030; '>not</span> <span style='color:#808030; '>(</span>$trace <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span><span style='color:#008c00; '>4</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 535:     <span style='color:#800080; '>}</span>
 536:     $was_signal <span style='color:#808030; '>=</span> $signal<span style='color:#800080; '>;</span>
 537:     $signal <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 538:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$single <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>$trace <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> $was_signal<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 539:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$slave_editor<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 540:         $position <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\032</span><span style='color:#0f69ff; '>\032</span><span style='color:#0000e6; '>$filename</span><span style='color:#0000e6; '>:</span><span style='color:#0000e6; '>$line</span><span style='color:#0000e6; '>:</span><span style='color:#008c00; '>0</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 541:         <span style='color:#800000; font-weight:bold; '>print</span> $LINEINFO $position<span style='color:#800080; '>;</span>
 542:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span>$package <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'DB::fake'</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 543:       $term <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>&amp;</span>setterm<span style='color:#800080; '>;</span>
 544:       print_help<span style='color:#808030; '>(</span><span style='color:#800000; '>&lt;&lt;</span><span style='color:#e34adc; '>EOP</span><span style='color:#0000e6; '>);</span>
 545: <span style='color:#0000e6; '>Debugged program terminated.  Use B&lt;q> to quit or B&lt;R> to restart,</span>
 546: <span style='color:#0000e6; '>  use B&lt;O> I&lt;inhibit_exit> to avoid stopping after program termination,</span>
 547: <span style='color:#0000e6; '>  B&lt;h q>, B&lt;h R> or B&lt;h O> to get additional info.  </span>
 548: <span style='color:#e34adc; '>EOP</span>
 549:       $package <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'main'</span><span style='color:#800080; '>;</span>
 550:       $usercontext <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'($@, $!, $^E, $,, $/, $\, $^W) = @saved;'</span> <span style='color:#808030; '>.</span>
 551:         <span style='color:#0000e6; '>"package </span><span style='color:#0000e6; '>$package</span><span style='color:#0000e6; '>;"</span><span style='color:#800080; '>;</span>    <span style='color:#696969; '># this won't let them modify, alas</span>
 552:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
 553:         $sub <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\'</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>::</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 554:         $prefix <span style='color:#808030; '>=</span> $sub <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>::</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>""</span> <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>${</span><span style='color:#808030; '>'</span><span style='color:#0000e6; '>package'}</span><span style='color:#0000e6; '>::"</span><span style='color:#800080; '>;</span>
 555:         $prefix <span style='color:#808030; '>.</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$sub</span><span style='color:#0000e6; '>(</span><span style='color:#0000e6; '>$filename</span><span style='color:#0000e6; '>:"</span><span style='color:#800080; '>;</span>
 556:         $after <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$dbline<span style='color:#808030; '>[</span>$line<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\n</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>''</span> <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 557:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>length</span><span style='color:#808030; '>(</span>$prefix<span style='color:#808030; '>)</span> <span style='color:#808030; '>></span> <span style='color:#008c00; '>30</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 558:             $position <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$prefix</span><span style='color:#0000e6; '>$line</span><span style='color:#0000e6; '>):</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>$line</span><span style='color:#0000e6; '>:</span><span style='color:#0f69ff; '>\t</span><span style='color:#0000e6; '>$dbline</span><span style='color:#0000e6; '>[</span><span style='color:#0000e6; '>$line</span><span style='color:#0000e6; '>]</span><span style='color:#0000e6; '>$after</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 559:         $prefix <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>""</span><span style='color:#800080; '>;</span>
 560:         $infix <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>":</span><span style='color:#0f69ff; '>\t</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 561:         <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
 562:         $infix <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"):</span><span style='color:#0f69ff; '>\t</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 563:         $position <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$prefix</span><span style='color:#0000e6; '>$line</span><span style='color:#0000e6; '>$infix</span><span style='color:#0000e6; '>$dbline</span><span style='color:#0000e6; '>[</span><span style='color:#0000e6; '>$line</span><span style='color:#0000e6; '>]</span><span style='color:#0000e6; '>$after</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 564:         <span style='color:#800080; '>}</span>
 565:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$frame<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 566:         <span style='color:#800000; font-weight:bold; '>print</span> $LINEINFO <span style='color:#0000e6; '>' '</span> <span style='color:#800000; font-weight:bold; '>x</span> $stack_depth<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$line</span><span style='color:#0000e6; '>:</span><span style='color:#0f69ff; '>\t</span><span style='color:#0000e6; '>$dbline</span><span style='color:#0000e6; '>[</span><span style='color:#0000e6; '>$line</span><span style='color:#0000e6; '>]</span><span style='color:#0000e6; '>$after</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 567:         <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
 568:         <span style='color:#800000; font-weight:bold; '>print</span> $LINEINFO $position<span style='color:#800080; '>;</span>
 569:         <span style='color:#800080; '>}</span>
 570:         <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span>$i <span style='color:#808030; '>=</span> $line <span style='color:#808030; '>+</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span> $i <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> $max <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> $dbline<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> <span style='color:#808030; '>+</span><span style='color:#808030; '>+</span>$i<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#696969; '>#{ vi</span>
 571:         <span style='color:#800000; font-weight:bold; '>last</span> <span style='color:#800000; font-weight:bold; '>if</span> $dbline<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>[</span><span style='color:#0f69ff; '>\;</span><span style='color:#0f69ff; '>\}</span><span style='color:#0f69ff; '>\#</span><span style='color:#0f69ff; '>\n</span><span style='color:#808030; '>]</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 572:         <span style='color:#800000; font-weight:bold; '>last</span> <span style='color:#800000; font-weight:bold; '>if</span> $signal<span style='color:#800080; '>;</span>
 573:         $after <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$dbline<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\n</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>''</span> <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 574:         $incr_pos <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$prefix</span><span style='color:#0000e6; '>$i</span><span style='color:#0000e6; '>$infix</span><span style='color:#0000e6; '>$dbline</span><span style='color:#0000e6; '>[</span><span style='color:#0000e6; '>$i</span><span style='color:#0000e6; '>]</span><span style='color:#0000e6; '>$after</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 575:         $position <span style='color:#808030; '>.</span><span style='color:#808030; '>=</span> $incr_pos<span style='color:#800080; '>;</span>
 576:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$frame<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 577:             <span style='color:#800000; font-weight:bold; '>print</span> $LINEINFO <span style='color:#0000e6; '>' '</span> <span style='color:#800000; font-weight:bold; '>x</span> $stack_depth<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$i</span><span style='color:#0000e6; '>:</span><span style='color:#0f69ff; '>\t</span><span style='color:#0000e6; '>$dbline</span><span style='color:#0000e6; '>[</span><span style='color:#0000e6; '>$i</span><span style='color:#0000e6; '>]</span><span style='color:#0000e6; '>$after</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 578:         <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
 579:             <span style='color:#800000; font-weight:bold; '>print</span> $LINEINFO $incr_pos<span style='color:#800080; '>;</span>
 580:         <span style='color:#800080; '>}</span>
 581:         <span style='color:#800080; '>}</span>
 582:     <span style='color:#800080; '>}</span>
 583:     <span style='color:#800080; '>}</span>
 584:     $evalarg <span style='color:#808030; '>=</span> $action<span style='color:#808030; '>,</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800000; font-weight:bold; '>if</span> $action<span style='color:#800080; '>;</span>
 585:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$single <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> $was_signal<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 586:     <span style='color:#800000; font-weight:bold; '>local</span> $level <span style='color:#808030; '>=</span> $level <span style='color:#808030; '>+</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 587:     <span style='color:#800000; font-weight:bold; '>foreach</span> $evalarg <span style='color:#808030; '>(</span>@$pre<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 588:       <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>eval</span><span style='color:#800080; '>;</span>
 589:     <span style='color:#800080; '>}</span>
 590:     <span style='color:#800000; font-weight:bold; '>print</span> $OUT $stack_depth <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>" levels deep in subroutine calls!</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
 591:       <span style='color:#800000; font-weight:bold; '>if</span> $single <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>4</span><span style='color:#800080; '>;</span>
 592:     $start <span style='color:#808030; '>=</span> $line<span style='color:#800080; '>;</span>
 593:     $incr <span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>        <span style='color:#696969; '># for backward motion.</span>
 594:     @typeahead <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>@$pretype<span style='color:#808030; '>,</span> @typeahead<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 595:       <span style='color:#e34adc; '>CMD:</span>
 596:     <span style='color:#800000; font-weight:bold; '>while</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>$term <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>&amp;</span>setterm<span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>
 597:            <span style='color:#808030; '>(</span>$term_pid <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> $$ <span style='color:#808030; '>or</span> <span style='color:#808030; '>&amp;</span>resetterm<span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>
 598:            <span style='color:#800000; font-weight:bold; '>defined</span> <span style='color:#808030; '>(</span>$cmd<span style='color:#808030; '>=</span><span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>readline</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"  DB"</span> <span style='color:#808030; '>.</span> <span style='color:#808030; '>(</span><span style='color:#0000e6; '>'&lt;'</span> <span style='color:#800000; font-weight:bold; '>x</span> $level<span style='color:#808030; '>)</span> <span style='color:#808030; '>.</span>
 599:                        <span style='color:#808030; '>(</span>$#hist<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>.</span> <span style='color:#808030; '>(</span><span style='color:#0000e6; '>'>'</span> <span style='color:#800000; font-weight:bold; '>x</span> $level<span style='color:#808030; '>)</span> <span style='color:#808030; '>.</span>
 600:                        <span style='color:#0000e6; '>" "</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> 
 601:         <span style='color:#800080; '>{</span>
 602:         $single <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 603:         $signal <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 604:         $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\\</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\n</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 605:             $cmd <span style='color:#808030; '>.</span><span style='color:#808030; '>=</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>readline</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"  cont: "</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 606:             <span style='color:#800000; font-weight:bold; '>redo</span> CMD<span style='color:#800080; '>;</span>
 607:         <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 608:         $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>$cmd <span style='color:#808030; '>=</span> $laststep<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 609:         <span style='color:#800000; font-weight:bold; '>push</span><span style='color:#808030; '>(</span>@hist<span style='color:#808030; '>,</span>$cmd<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>length</span><span style='color:#808030; '>(</span>$cmd<span style='color:#808030; '>)</span> <span style='color:#808030; '>></span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 610:           <span style='color:#e34adc; '>PIPE:</span> <span style='color:#800080; '>{</span>
 611:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800080; '>;</span>   <span style='color:#696969; '># trim annoying leading whitespace</span>
 612:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800080; '>;</span>   <span style='color:#696969; '># trim annoying trailing whitespace</span>
 613:             <span style='color:#808030; '>(</span>$i<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>split</span><span style='color:#808030; '>(</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span>$cmd<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 614:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$alias<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> 
 615:             <span style='color:#696969; '># squelch the sigmangler</span>
 616:             <span style='color:#800000; font-weight:bold; '>local</span> $SIG<span style='color:#800080; '>{</span>__DIE__<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 617:             <span style='color:#800000; font-weight:bold; '>local</span> $SIG<span style='color:#800080; '>{</span>__WARN__<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 618:             <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>cmd =~ </span><span style='color:#0000e6; '>$alias</span><span style='color:#0000e6; '>{</span><span style='color:#0000e6; '>$i</span><span style='color:#0000e6; '>}"</span><span style='color:#800080; '>;</span>
 619:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$@<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 620:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Couldn't evaluate `</span><span style='color:#0000e6; '>$i</span><span style='color:#0000e6; '>' alias: $@"</span><span style='color:#800080; '>;</span>
 621:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span>
 622:             <span style='color:#800080; '>}</span> 
 623:             <span style='color:#800080; '>}</span>
 624:                    $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>q</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>$fall_off_end <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>exit</span> $?<span style='color:#800080; '>;</span>
 625:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>h</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 626:             print_help<span style='color:#808030; '>(</span>$help<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 627:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 628:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>h</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#0000e6; '>h</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 629:             print_help<span style='color:#808030; '>(</span>$summary<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 630:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 631:             <span style='color:#696969; '># support long commands; otherwise bogus errors</span>
 632:             <span style='color:#696969; '># happen when you ask for h on &lt;CR> for example</span>
 633:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>h</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\S</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>      
 634:             <span style='color:#800000; font-weight:bold; '>my</span> $asked <span style='color:#808030; '>=</span> $1<span style='color:#800080; '>;</span>            <span style='color:#696969; '># for proper errmsg</span>
 635:             <span style='color:#800000; font-weight:bold; '>my</span> $qasked <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>quotemeta</span><span style='color:#808030; '>(</span>$asked<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span> <span style='color:#696969; '># for searching</span>
 636:             <span style='color:#696969; '># XXX: finds CR but not &lt;CR></span>
 637:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$help <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>&lt;</span><span style='color:#808030; '>?</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>?</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>IB</span><span style='color:#808030; '>]</span><span style='color:#0000e6; '>&lt;</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>$qasked</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>m</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 638:               <span style='color:#800000; font-weight:bold; '>while</span> <span style='color:#808030; '>(</span>$help <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>&lt;</span><span style='color:#808030; '>?</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>?</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>IB</span><span style='color:#808030; '>]</span><span style='color:#0000e6; '>&lt;</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>$qasked</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>\s</span><span style='color:#0000e6; '>\S</span><span style='color:#808030; '>]</span><span style='color:#808030; '>*</span><span style='color:#808030; '>?</span><span style='color:#808030; '>)</span><span style='color:#0f69ff; '>\n</span><span style='color:#808030; '>)</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>?!</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>mg</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 639:                 print_help<span style='color:#808030; '>(</span>$1<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 640:               <span style='color:#800080; '>}</span>
 641:             <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
 642:                 print_help<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"B&lt;</span><span style='color:#0000e6; '>$asked</span><span style='color:#0000e6; '>> is not a debugger command.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 643:             <span style='color:#800080; '>}</span>
 644:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 645:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>t</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 646:             $trace <span style='color:#808030; '>^</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 647:             <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Trace = "</span> <span style='color:#808030; '>.</span>
 648:                 <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>$trace <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>"on"</span> <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>"off"</span> <span style='color:#808030; '>)</span> <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 649:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 650:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>S</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>!</span><span style='color:#808030; '>)</span><span style='color:#808030; '>?</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>?</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 651:             $Srev <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>defined</span> $2<span style='color:#800080; '>;</span> $Spatt <span style='color:#808030; '>=</span> $3<span style='color:#800080; '>;</span> $Snocheck <span style='color:#808030; '>=</span> <span style='color:#808030; '>!</span> <span style='color:#800000; font-weight:bold; '>defined</span> $1<span style='color:#800080; '>;</span>
 652:             <span style='color:#800000; font-weight:bold; '>foreach</span> $subname <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>sort</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>keys</span> %sub<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 653:                 <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$Snocheck <span style='color:#808030; '>or</span> $Srev<span style='color:#808030; '>^</span><span style='color:#808030; '>(</span>$subname <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>$Spatt</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 654:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT $subname<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 655:                 <span style='color:#800080; '>}</span>
 656:             <span style='color:#800080; '>}</span>
 657:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 658:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>v</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 659:             list_versions<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span> <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 660:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>X</span><span style='color:#0f69ff; '>\b</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>V </span><span style='color:#0000e6; '>$package</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 661:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>V</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 662:             $cmd <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"V </span><span style='color:#0000e6; '>$package</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 663:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>V</span><span style='color:#0f69ff; '>\b</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\S</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 664:             <span style='color:#800000; font-weight:bold; '>local</span> <span style='color:#808030; '>(</span>$savout<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>select</span><span style='color:#808030; '>(</span>$OUT<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 665:             $packname <span style='color:#808030; '>=</span> $1<span style='color:#800080; '>;</span>
 666:             @vars <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>split</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>' '</span><span style='color:#808030; '>,</span>$2<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 667:             <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#0000e6; '>'dumpvar.pl'</span> <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>defined</span> <span style='color:#808030; '>&amp;</span><span style='color:#bb7977; font-weight:bold; '>main</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>dumpvar</span><span style='color:#800080; '>;</span>
 668:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> <span style='color:#808030; '>&amp;</span><span style='color:#bb7977; font-weight:bold; '>main</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>dumpvar</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 669:                 <span style='color:#800000; font-weight:bold; '>local</span> $frame <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 670:                 <span style='color:#800000; font-weight:bold; '>local</span> $doret <span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>2</span><span style='color:#800080; '>;</span>
 671:                 <span style='color:#696969; '># must detect sigpipe failures</span>
 672:                 <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#808030; '>&amp;</span><span style='color:#bb7977; font-weight:bold; '>main</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>dumpvar</span><span style='color:#808030; '>(</span>$packname<span style='color:#808030; '>,</span>@vars<span style='color:#808030; '>)</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 673:                 <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$@<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 674:                 <span style='color:#800000; font-weight:bold; '>die</span> <span style='color:#800000; font-weight:bold; '>unless</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>dumpvar print failed</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 675:                 <span style='color:#800080; '>}</span> 
 676:             <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
 677:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"dumpvar.pl not available.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 678:             <span style='color:#800080; '>}</span>
 679:             <span style='color:#800000; font-weight:bold; '>select</span> <span style='color:#808030; '>(</span>$savout<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 680:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 681:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>x</span><span style='color:#0f69ff; '>\b</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span> <span style='color:#696969; '># So that will be evaled</span>
 682:             $onetimeDump <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'dump'</span><span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 683:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>m</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>\w</span><span style='color:#0000e6; '>:</span><span style='color:#808030; '>]</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 684:             methods<span style='color:#808030; '>(</span>$1<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span> <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 685:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>m</span><span style='color:#0f69ff; '>\b</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span> <span style='color:#696969; '># So this will be evaled</span>
 686:             $onetimeDump <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'methods'</span><span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 687:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>f</span><span style='color:#0f69ff; '>\b</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 688:             $file <span style='color:#808030; '>=</span> $1<span style='color:#800080; '>;</span>
 689:             $file <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 690:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>$file<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 691:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"The old f command is now the r command.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 692:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"The new f command switches filenames.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 693:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span>
 694:             <span style='color:#800080; '>}</span>
 695:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span><span style='color:#800000; font-weight:bold; '>defined</span> $main<span style='color:#808030; '>:</span><span style='color:#808030; '>:</span><span style='color:#800080; '>{</span><span style='color:#0000e6; '>'_&lt;'</span> <span style='color:#808030; '>.</span> $file<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 696:                 <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>$try<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>grep</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>m</span><span style='color:#800000; '>#</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>_&lt;</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#0000e6; '>$file</span><span style='color:#800000; '>#</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>keys</span> %main<span style='color:#808030; '>:</span><span style='color:#808030; '>:</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span><span style='color:#800080; '>{</span>
 697:                           $try <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>substr</span><span style='color:#808030; '>(</span>$try<span style='color:#808030; '>,</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 698:                           <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Choosing </span><span style='color:#0000e6; '>$try</span><span style='color:#0000e6; '> matching `</span><span style='color:#0000e6; '>$file</span><span style='color:#0000e6; '>':</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 699:                           $file <span style='color:#808030; '>=</span> $try<span style='color:#800080; '>;</span>
 700:                       <span style='color:#800080; '>}</span><span style='color:#800080; '>}</span>
 701:             <span style='color:#800080; '>}</span>
 702:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span><span style='color:#800000; font-weight:bold; '>defined</span> $main<span style='color:#808030; '>:</span><span style='color:#808030; '>:</span><span style='color:#800080; '>{</span><span style='color:#0000e6; '>'_&lt;'</span> <span style='color:#808030; '>.</span> $file<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 703:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"No file matching `</span><span style='color:#0000e6; '>$file</span><span style='color:#0000e6; '>' is loaded.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 704:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span>
 705:             <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span>$file <span style='color:#808030; '>ne</span> $filename<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 706:                 *dbline <span style='color:#808030; '>=</span> $main<span style='color:#808030; '>:</span><span style='color:#808030; '>:</span><span style='color:#800080; '>{</span><span style='color:#0000e6; '>'_&lt;'</span> <span style='color:#808030; '>.</span> $file<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 707:                 $max <span style='color:#808030; '>=</span> $#dbline<span style='color:#800080; '>;</span>
 708:                 $filename <span style='color:#808030; '>=</span> $file<span style='color:#800080; '>;</span>
 709:                 $start <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 710:                 $cmd <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"l"</span><span style='color:#800080; '>;</span>
 711:               <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
 712:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Already in </span><span style='color:#0000e6; '>$file</span><span style='color:#0000e6; '>.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 713:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span>
 714:               <span style='color:#800080; '>}</span>
 715:               <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 716:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>l</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#0000e6; '>-</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>-</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 717:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>lb</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#0f69ff; '>\b</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#0f69ff; '>\$</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>s</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 718:             $evalarg <span style='color:#808030; '>=</span> $2<span style='color:#800080; '>;</span>
 719:             <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$s<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>eval</span><span style='color:#800080; '>;</span>
 720:             <span style='color:#800000; font-weight:bold; '>print</span><span style='color:#808030; '>(</span>$OUT <span style='color:#0000e6; '>"Error: $@</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>next</span> CMD <span style='color:#800000; font-weight:bold; '>if</span> $@<span style='color:#800080; '>;</span>
 721:             $s <span style='color:#808030; '>=</span> CvGV_name<span style='color:#808030; '>(</span>$s<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 722:             <span style='color:#800000; font-weight:bold; '>print</span><span style='color:#808030; '>(</span>$OUT <span style='color:#0000e6; '>"Interpreted as: </span><span style='color:#0000e6; '>$1</span><span style='color:#0000e6; '> </span><span style='color:#0000e6; '>$s</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 723:             $cmd <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$1</span><span style='color:#0000e6; '> </span><span style='color:#0000e6; '>$s</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 724:             <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 725:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>l</span><span style='color:#0f69ff; '>\b</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#0f69ff; '>\'</span><span style='color:#0000e6; '>:A</span><span style='color:#808030; '>-</span><span style='color:#0000e6; '>Za</span><span style='color:#808030; '>-</span><span style='color:#0000e6; '>z_</span><span style='color:#808030; '>]</span><span style='color:#808030; '>[</span><span style='color:#0f69ff; '>\'</span><span style='color:#0000e6; '>:</span><span style='color:#0000e6; '>\w</span><span style='color:#808030; '>]</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#0f69ff; '>\[</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#0f69ff; '>\]</span><span style='color:#808030; '>)</span><span style='color:#808030; '>?</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>s</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 726:             $subname <span style='color:#808030; '>=</span> $1<span style='color:#800080; '>;</span>
 727:             $subname <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\'</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>::</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 728:             $subname <span style='color:#808030; '>=</span> $package<span style='color:#808030; '>.</span><span style='color:#0000e6; '>"::"</span><span style='color:#808030; '>.</span>$subname 
 729:               <span style='color:#800000; font-weight:bold; '>unless</span> $subname <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>::</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 730:             $subname <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"main"</span><span style='color:#808030; '>.</span>$subname <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>substr</span><span style='color:#808030; '>(</span>$subname<span style='color:#808030; '>,</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>"::"</span><span style='color:#800080; '>;</span>
 731:             @pieces <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>split</span><span style='color:#808030; '>(</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>:</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span>find_sub<span style='color:#808030; '>(</span>$subname<span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> $sub<span style='color:#800080; '>{</span>$subname<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 732:             $subrange <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>pop</span> @pieces<span style='color:#800080; '>;</span>
 733:             $file <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>join</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>':'</span><span style='color:#808030; '>,</span> @pieces<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 734:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$file <span style='color:#808030; '>ne</span> $filename<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 735:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Switching to file '</span><span style='color:#0000e6; '>$file</span><span style='color:#0000e6; '>'.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
 736:                 <span style='color:#800000; font-weight:bold; '>unless</span> $slave_editor<span style='color:#800080; '>;</span>
 737:                 *dbline <span style='color:#808030; '>=</span> $main<span style='color:#808030; '>:</span><span style='color:#808030; '>:</span><span style='color:#800080; '>{</span><span style='color:#0000e6; '>'_&lt;'</span> <span style='color:#808030; '>.</span> $file<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 738:                 $max <span style='color:#808030; '>=</span> $#dbline<span style='color:#800080; '>;</span>
 739:                 $filename <span style='color:#808030; '>=</span> $file<span style='color:#800080; '>;</span>
 740:             <span style='color:#800080; '>}</span>
 741:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$subrange<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 742:                 <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>eval</span><span style='color:#808030; '>(</span>$subrange<span style='color:#808030; '>)</span> <span style='color:#808030; '>&lt;</span> <span style='color:#808030; '>-</span>$window<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 743:                 $subrange <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>-</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>+</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 744:                 <span style='color:#800080; '>}</span>
 745:                 $cmd <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"l </span><span style='color:#0000e6; '>$subrange</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 746:             <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
 747:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Subroutine </span><span style='color:#0000e6; '>$subname</span><span style='color:#0000e6; '> not found.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 748:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span>
 749:             <span style='color:#800080; '>}</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 750:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\.</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 751:             $incr <span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>        <span style='color:#696969; '># for backward motion.</span>
 752:             $start <span style='color:#808030; '>=</span> $line<span style='color:#800080; '>;</span>
 753:             $filename <span style='color:#808030; '>=</span> $filename_ini<span style='color:#800080; '>;</span>
 754:             *dbline <span style='color:#808030; '>=</span> $main<span style='color:#808030; '>:</span><span style='color:#808030; '>:</span><span style='color:#800080; '>{</span><span style='color:#0000e6; '>'_&lt;'</span> <span style='color:#808030; '>.</span> $filename<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 755:             $max <span style='color:#808030; '>=</span> $#dbline<span style='color:#800080; '>;</span>
 756:             <span style='color:#800000; font-weight:bold; '>print</span> $LINEINFO $position<span style='color:#800080; '>;</span>
 757:             <span style='color:#800000; font-weight:bold; '>next</span> CMD <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 758:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>w</span><span style='color:#0f69ff; '>\b</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\d</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 759:             $incr <span style='color:#808030; '>=</span> $window <span style='color:#808030; '>-</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 760:             $start <span style='color:#808030; '>=</span> $1 <span style='color:#800000; font-weight:bold; '>if</span> $1<span style='color:#800080; '>;</span>
 761:             $start <span style='color:#808030; '>-</span><span style='color:#808030; '>=</span> $preview<span style='color:#800080; '>;</span>
 762:             <span style='color:#696969; '>#print $OUT 'l ' . $start . '-' . ($start + $incr);</span>
 763:             $cmd <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'l '</span> <span style='color:#808030; '>.</span> $start <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>'-'</span> <span style='color:#808030; '>.</span> <span style='color:#808030; '>(</span>$start <span style='color:#808030; '>+</span> $incr<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 764:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>-</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 765:             $start <span style='color:#808030; '>-</span><span style='color:#808030; '>=</span> $incr <span style='color:#808030; '>+</span> $window <span style='color:#808030; '>+</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 766:             $start <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>if</span> $start <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 767:             $incr <span style='color:#808030; '>=</span> $window <span style='color:#808030; '>-</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 768:             $cmd <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'l '</span> <span style='color:#808030; '>.</span> <span style='color:#808030; '>(</span>$start<span style='color:#808030; '>)</span> <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>'+'</span><span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 769:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>l</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 770:             $incr <span style='color:#808030; '>=</span> $window <span style='color:#808030; '>-</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 771:             $cmd <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'l '</span> <span style='color:#808030; '>.</span> $start <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>'-'</span> <span style='color:#808030; '>.</span> <span style='color:#808030; '>(</span>$start <span style='color:#808030; '>+</span> $incr<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 772:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>l</span><span style='color:#0f69ff; '>\b</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\d</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#0f69ff; '>\+</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\d</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 773:             $start <span style='color:#808030; '>=</span> $1 <span style='color:#800000; font-weight:bold; '>if</span> $1<span style='color:#800080; '>;</span>
 774:             $incr <span style='color:#808030; '>=</span> $2<span style='color:#800080; '>;</span>
 775:             $incr <span style='color:#808030; '>=</span> $window <span style='color:#808030; '>-</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>unless</span> $incr<span style='color:#800080; '>;</span>
 776:             $cmd <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'l '</span> <span style='color:#808030; '>.</span> $start <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>'-'</span> <span style='color:#808030; '>.</span> <span style='color:#808030; '>(</span>$start <span style='color:#808030; '>+</span> $incr<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 777:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>l</span><span style='color:#0f69ff; '>\b</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>-</span><span style='color:#808030; '>?</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>\d</span><span style='color:#0f69ff; '>\$</span><span style='color:#0f69ff; '>\.</span><span style='color:#808030; '>]</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#808030; '>-</span><span style='color:#0000e6; '>,</span><span style='color:#808030; '>]</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>\d</span><span style='color:#0f69ff; '>\$</span><span style='color:#0f69ff; '>\.</span><span style='color:#808030; '>]</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>?</span><span style='color:#808030; '>)</span><span style='color:#808030; '>?</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 778:             $end <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span><span style='color:#800000; font-weight:bold; '>defined</span> $2<span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> $max <span style='color:#808030; '>:</span> <span style='color:#808030; '>(</span>$4 <span style='color:#808030; '>?</span> $4 <span style='color:#808030; '>:</span> $2<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 779:             $end <span style='color:#808030; '>=</span> $max <span style='color:#800000; font-weight:bold; '>if</span> $end <span style='color:#808030; '>></span> $max<span style='color:#800080; '>;</span>
 780:             $i <span style='color:#808030; '>=</span> $2<span style='color:#800080; '>;</span>
 781:             $i <span style='color:#808030; '>=</span> $line <span style='color:#800000; font-weight:bold; '>if</span> $i <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'.'</span><span style='color:#800080; '>;</span>
 782:             $i <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>if</span> $i <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 783:             $incr <span style='color:#808030; '>=</span> $end <span style='color:#808030; '>-</span> $i<span style='color:#800080; '>;</span>
 784:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$slave_editor<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 785:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\032</span><span style='color:#0f69ff; '>\032</span><span style='color:#0000e6; '>$filename</span><span style='color:#0000e6; '>:</span><span style='color:#0000e6; '>$i</span><span style='color:#0000e6; '>:</span><span style='color:#008c00; '>0</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 786:                 $i <span style='color:#808030; '>=</span> $end<span style='color:#800080; '>;</span>
 787:             <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
 788:                 <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#800080; '>;</span> $i <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> $end<span style='color:#800080; '>;</span> $i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 789:                     <span style='color:#808030; '>(</span>$stop<span style='color:#808030; '>,</span>$action<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>split</span><span style='color:#808030; '>(</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\0</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 790:                     $arrow <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$i<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>$line 
 791:                       <span style='color:#808030; '>and</span> $filename <span style='color:#808030; '>eq</span> $filename_ini<span style='color:#808030; '>)</span> 
 792:                   <span style='color:#808030; '>?</span>  <span style='color:#0000e6; '>'==>'</span> 
 793:                     <span style='color:#808030; '>:</span> <span style='color:#808030; '>(</span>$dbline<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span><span style='color:#808030; '>+</span><span style='color:#008c00; '>0</span> <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>':'</span> <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>' '</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>;</span>
 794:                 $arrow <span style='color:#808030; '>.</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'b'</span> <span style='color:#800000; font-weight:bold; '>if</span> $stop<span style='color:#800080; '>;</span>
 795:                 $arrow <span style='color:#808030; '>.</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'a'</span> <span style='color:#800000; font-weight:bold; '>if</span> $action<span style='color:#800080; '>;</span>
 796:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$i</span><span style='color:#0000e6; '>$arrow</span><span style='color:#0f69ff; '>\t</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>,</span> $dbline<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
 797:                 $i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>last</span> <span style='color:#800000; font-weight:bold; '>if</span> $signal<span style='color:#800080; '>;</span>
 798:                 <span style='color:#800080; '>}</span>
 799:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800000; font-weight:bold; '>unless</span> $dbline<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\n</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 800:             <span style='color:#800080; '>}</span>
 801:             $start <span style='color:#808030; '>=</span> $i<span style='color:#800080; '>;</span> <span style='color:#696969; '># remember in case they want more</span>
 802:             $start <span style='color:#808030; '>=</span> $max <span style='color:#800000; font-weight:bold; '>if</span> $start <span style='color:#808030; '>></span> $max<span style='color:#800080; '>;</span>
 803:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 804:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>D</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 805:               <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Deleting all breakpoints...</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 806:               <span style='color:#800000; font-weight:bold; '>my</span> $file<span style='color:#800080; '>;</span>
 807:               <span style='color:#800000; font-weight:bold; '>for</span> $file <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>keys</span> %had_breakpoints<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 808:             <span style='color:#800000; font-weight:bold; '>local</span> *dbline <span style='color:#808030; '>=</span> $main<span style='color:#808030; '>:</span><span style='color:#808030; '>:</span><span style='color:#800080; '>{</span><span style='color:#0000e6; '>'_&lt;'</span> <span style='color:#808030; '>.</span> $file<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 809:             <span style='color:#800000; font-weight:bold; '>my</span> $max <span style='color:#808030; '>=</span> $#dbline<span style='color:#800080; '>;</span>
 810:             <span style='color:#800000; font-weight:bold; '>my</span> $was<span style='color:#800080; '>;</span>
 811:             
 812:             <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span>$i <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span> $i <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> $max <span style='color:#800080; '>;</span> $i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 813:                 <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 814:                 $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>+</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 815:                 <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\0</span><span style='color:#808030; '>?</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 816:                     <span style='color:#800000; font-weight:bold; '>delete</span> $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 817:                 <span style='color:#800080; '>}</span>
 818:                 <span style='color:#800080; '>}</span>
 819:             <span style='color:#800080; '>}</span>
 820:             
 821:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>not</span> $had_breakpoints<span style='color:#800080; '>{</span>$file<span style='color:#800080; '>}</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>=</span> <span style='color:#808030; '>~</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 822:                 <span style='color:#800000; font-weight:bold; '>delete</span> $had_breakpoints<span style='color:#800080; '>{</span>$file<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 823:             <span style='color:#800080; '>}</span>
 824:               <span style='color:#800080; '>}</span>
 825:               <span style='color:#800000; font-weight:bold; '>undef</span> %postponed<span style='color:#800080; '>;</span>
 826:               <span style='color:#800000; font-weight:bold; '>undef</span> %postponed_file<span style='color:#800080; '>;</span>
 827:               <span style='color:#800000; font-weight:bold; '>undef</span> %break_on_load<span style='color:#800080; '>;</span>
 828:               <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 829:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>L</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 830:               <span style='color:#800000; font-weight:bold; '>my</span> $file<span style='color:#800080; '>;</span>
 831:               <span style='color:#800000; font-weight:bold; '>for</span> $file <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>keys</span> %had_breakpoints<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 832:             <span style='color:#800000; font-weight:bold; '>local</span> *dbline <span style='color:#808030; '>=</span> $main<span style='color:#808030; '>:</span><span style='color:#808030; '>:</span><span style='color:#800080; '>{</span><span style='color:#0000e6; '>'_&lt;'</span> <span style='color:#808030; '>.</span> $file<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 833:             <span style='color:#800000; font-weight:bold; '>my</span> $max <span style='color:#808030; '>=</span> $#dbline<span style='color:#800080; '>;</span>
 834:             <span style='color:#800000; font-weight:bold; '>my</span> $was<span style='color:#800080; '>;</span>
 835:             
 836:             <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span>$i <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span> $i <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> $max<span style='color:#800080; '>;</span> $i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 837:                 <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 838:                     <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$file</span><span style='color:#0000e6; '>:</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800000; font-weight:bold; '>unless</span> $was<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 839:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>" </span><span style='color:#0000e6; '>$i</span><span style='color:#0000e6; '>:</span><span style='color:#0f69ff; '>\t</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>,</span> $dbline<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
 840:                 <span style='color:#808030; '>(</span>$stop<span style='color:#808030; '>,</span>$action<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>split</span><span style='color:#808030; '>(</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\0</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 841:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"   break if ("</span><span style='color:#808030; '>,</span> $stop<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>")</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
 842:                   <span style='color:#800000; font-weight:bold; '>if</span> $stop<span style='color:#800080; '>;</span>
 843:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"   action:  "</span><span style='color:#808030; '>,</span> $action<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
 844:                   <span style='color:#800000; font-weight:bold; '>if</span> $action<span style='color:#800080; '>;</span>
 845:                 <span style='color:#800000; font-weight:bold; '>last</span> <span style='color:#800000; font-weight:bold; '>if</span> $signal<span style='color:#800080; '>;</span>
 846:                 <span style='color:#800080; '>}</span>
 847:             <span style='color:#800080; '>}</span>
 848:               <span style='color:#800080; '>}</span>
 849:               <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>%postponed<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 850:             <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Postponed breakpoints in subroutines:</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 851:             <span style='color:#800000; font-weight:bold; '>my</span> $subname<span style='color:#800080; '>;</span>
 852:             <span style='color:#800000; font-weight:bold; '>for</span> $subname <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>keys</span> %postponed<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 853:               <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>" </span><span style='color:#0000e6; '>$subname</span><span style='color:#0f69ff; '>\t</span><span style='color:#0000e6; '>$postponed</span><span style='color:#0000e6; '>{</span><span style='color:#0000e6; '>$subname</span><span style='color:#0000e6; '>}</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 854:               <span style='color:#800000; font-weight:bold; '>last</span> <span style='color:#800000; font-weight:bold; '>if</span> $signal<span style='color:#800080; '>;</span>
 855:             <span style='color:#800080; '>}</span>
 856:               <span style='color:#800080; '>}</span>
 857:               <span style='color:#800000; font-weight:bold; '>my</span> @have <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>map</span> <span style='color:#800080; '>{</span> <span style='color:#696969; '># Combined keys</span>
 858:             <span style='color:#800000; font-weight:bold; '>keys</span> %{$postponed_file<span style='color:#800080; '>{</span>$_<span style='color:#800080; '>}</span>}
 859:               <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>keys</span> %postponed_file<span style='color:#800080; '>;</span>
 860:               <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>@have<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 861:             <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Postponed breakpoints in files:</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 862:             <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$file<span style='color:#808030; '>,</span> $line<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 863:             <span style='color:#800000; font-weight:bold; '>for</span> $file <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>keys</span> %postponed_file<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 864:               <span style='color:#800000; font-weight:bold; '>my</span> $db <span style='color:#808030; '>=</span> $postponed_file<span style='color:#800080; '>{</span>$file<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 865:               <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>" </span><span style='color:#0000e6; '>$file</span><span style='color:#0000e6; '>:</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 866:               <span style='color:#800000; font-weight:bold; '>for</span> $line <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>sort</span> <span style='color:#800080; '>{</span>$a <span style='color:#40015a; '>&lt;=></span> $b<span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>keys</span> <span style='color:#808030; '>%</span>$db<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 867:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"  </span><span style='color:#0000e6; '>$line</span><span style='color:#0000e6; '>:</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 868:                 <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$stop<span style='color:#808030; '>,</span>$action<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>split</span><span style='color:#808030; '>(</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\0</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $$db<span style='color:#800080; '>{</span>$line<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 869:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"    break if ("</span><span style='color:#808030; '>,</span> $stop<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>")</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
 870:                   <span style='color:#800000; font-weight:bold; '>if</span> $stop<span style='color:#800080; '>;</span>
 871:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"    action:  "</span><span style='color:#808030; '>,</span> $action<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
 872:                   <span style='color:#800000; font-weight:bold; '>if</span> $action<span style='color:#800080; '>;</span>
 873:                 <span style='color:#800000; font-weight:bold; '>last</span> <span style='color:#800000; font-weight:bold; '>if</span> $signal<span style='color:#800080; '>;</span>
 874:               <span style='color:#800080; '>}</span>
 875:               <span style='color:#800000; font-weight:bold; '>last</span> <span style='color:#800000; font-weight:bold; '>if</span> $signal<span style='color:#800080; '>;</span>
 876:             <span style='color:#800080; '>}</span>
 877:               <span style='color:#800080; '>}</span>
 878:               <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>%break_on_load<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 879:             <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Breakpoints on load:</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 880:             <span style='color:#800000; font-weight:bold; '>my</span> $file<span style='color:#800080; '>;</span>
 881:             <span style='color:#800000; font-weight:bold; '>for</span> $file <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>keys</span> %break_on_load<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 882:               <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>" </span><span style='color:#0000e6; '>$file</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 883:               <span style='color:#800000; font-weight:bold; '>last</span> <span style='color:#800000; font-weight:bold; '>if</span> $signal<span style='color:#800080; '>;</span>
 884:             <span style='color:#800080; '>}</span>
 885:               <span style='color:#800080; '>}</span>
 886:               <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$trace <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 887:             <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Watch-expressions:</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 888:             <span style='color:#800000; font-weight:bold; '>my</span> $expr<span style='color:#800080; '>;</span>
 889:             <span style='color:#800000; font-weight:bold; '>for</span> $expr <span style='color:#808030; '>(</span>@to_watch<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 890:               <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>" </span><span style='color:#0000e6; '>$expr</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 891:               <span style='color:#800000; font-weight:bold; '>last</span> <span style='color:#800000; font-weight:bold; '>if</span> $signal<span style='color:#800080; '>;</span>
 892:             <span style='color:#800080; '>}</span>
 893:               <span style='color:#800080; '>}</span>
 894:               <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 895:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>b</span><span style='color:#0f69ff; '>\b</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#0000e6; '>load</span><span style='color:#0f69ff; '>\b</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 896:             <span style='color:#800000; font-weight:bold; '>my</span> $file <span style='color:#808030; '>=</span> $1<span style='color:#800080; '>;</span> $file <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 897:             <span style='color:#800080; '>{</span>
 898:               $break_on_load<span style='color:#800080; '>{</span>$file<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 899:               $break_on_load<span style='color:#800080; '>{</span>$<span style='color:#808030; '>::</span>INC<span style='color:#800080; '>{</span>$file<span style='color:#800080; '>}</span><span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>if</span> $<span style='color:#808030; '>::</span>INC<span style='color:#800080; '>{</span>$file<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 900:               $file <span style='color:#808030; '>.</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'.pm'</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>redo</span> <span style='color:#800000; font-weight:bold; '>unless</span> $file <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\.</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 901:             <span style='color:#800080; '>}</span>
 902:             $had_breakpoints<span style='color:#800080; '>{</span>$file<span style='color:#800080; '>}</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 903:             <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Will stop on load of `</span><span style='color:#0000e6; '>@{[join '\', `', sort keys %break_on_load]}</span><span style='color:#0000e6; '>'.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 904:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 905:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>b</span><span style='color:#0f69ff; '>\b</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>postpone</span><span style='color:#800080; '>|</span><span style='color:#0000e6; '>compile</span><span style='color:#808030; '>)</span><span style='color:#0f69ff; '>\b</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>':A</span><span style='color:#808030; '>-</span><span style='color:#0000e6; '>Za</span><span style='color:#808030; '>-</span><span style='color:#0000e6; '>z_</span><span style='color:#808030; '>]</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>':</span><span style='color:#0000e6; '>\w</span><span style='color:#808030; '>]</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 906:             <span style='color:#800000; font-weight:bold; '>my</span> $cond <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>length</span> $3 <span style='color:#808030; '>?</span> $3 <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>'1'</span><span style='color:#800080; '>;</span>
 907:             <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$subname<span style='color:#808030; '>,</span> $break<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$2<span style='color:#808030; '>,</span> $1 <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'postpone'</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 908:             $subname <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\'</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>::</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>g</span><span style='color:#800080; '>;</span>
 909:             $subname <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>${</span><span style='color:#808030; '>'</span><span style='color:#0000e6; '>package'}</span><span style='color:#0000e6; '>::"</span> <span style='color:#808030; '>.</span> $subname
 910:               <span style='color:#800000; font-weight:bold; '>unless</span> $subname <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>::</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 911:             $subname <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"main"</span><span style='color:#808030; '>.</span>$subname <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>substr</span><span style='color:#808030; '>(</span>$subname<span style='color:#808030; '>,</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>"::"</span><span style='color:#800080; '>;</span>
 912:             $postponed<span style='color:#800080; '>{</span>$subname<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> $break 
 913:               <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>"break +</span><span style='color:#008c00; '>0</span><span style='color:#0000e6; '> if </span><span style='color:#0000e6; '>$cond</span><span style='color:#0000e6; '>"</span> <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>"compile"</span><span style='color:#800080; '>;</span>
 914:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 915:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>b</span><span style='color:#0f69ff; '>\b</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>':A</span><span style='color:#808030; '>-</span><span style='color:#0000e6; '>Za</span><span style='color:#808030; '>-</span><span style='color:#0000e6; '>z_</span><span style='color:#808030; '>]</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>':</span><span style='color:#0000e6; '>\w</span><span style='color:#808030; '>]</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>?</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#0f69ff; '>\[</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#0f69ff; '>\]</span><span style='color:#808030; '>)</span><span style='color:#808030; '>?</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 916:             $subname <span style='color:#808030; '>=</span> $1<span style='color:#800080; '>;</span>
 917:             $cond <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>length</span> $2 <span style='color:#808030; '>?</span> $2 <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>'1'</span><span style='color:#800080; '>;</span>
 918:             $subname <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\'</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>::</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>g</span><span style='color:#800080; '>;</span>
 919:             $subname <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>${</span><span style='color:#808030; '>'</span><span style='color:#0000e6; '>package'}</span><span style='color:#0000e6; '>::"</span> <span style='color:#808030; '>.</span> $subname
 920:               <span style='color:#800000; font-weight:bold; '>unless</span> $subname <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>::</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 921:             $subname <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"main"</span><span style='color:#808030; '>.</span>$subname <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>substr</span><span style='color:#808030; '>(</span>$subname<span style='color:#808030; '>,</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>"::"</span><span style='color:#800080; '>;</span>
 922:             <span style='color:#696969; '># Filename below can contain ':'</span>
 923:             <span style='color:#808030; '>(</span>$file<span style='color:#808030; '>,</span>$i<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>find_sub<span style='color:#808030; '>(</span>$subname<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>:</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 924:             $i <span style='color:#808030; '>+</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 925:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$i<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 926:                 <span style='color:#800000; font-weight:bold; '>local</span> $filename <span style='color:#808030; '>=</span> $file<span style='color:#800080; '>;</span>
 927:                 <span style='color:#800000; font-weight:bold; '>local</span> *dbline <span style='color:#808030; '>=</span> $main<span style='color:#808030; '>:</span><span style='color:#808030; '>:</span><span style='color:#800080; '>{</span><span style='color:#0000e6; '>'_&lt;'</span> <span style='color:#808030; '>.</span> $filename<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 928:                 $had_breakpoints<span style='color:#800080; '>{</span>$filename<span style='color:#800080; '>}</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 929:                 $max <span style='color:#808030; '>=</span> $#dbline<span style='color:#800080; '>;</span>
 930:                 <span style='color:#808030; '>+</span><span style='color:#808030; '>+</span>$i <span style='color:#800000; font-weight:bold; '>while</span> $dbline<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> $i <span style='color:#808030; '>&lt;</span> $max<span style='color:#800080; '>;</span>
 931:                 $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>*</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>$cond</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 932:             <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
 933:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Subroutine </span><span style='color:#0000e6; '>$subname</span><span style='color:#0000e6; '> not found.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 934:             <span style='color:#800080; '>}</span>
 935:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 936:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>b</span><span style='color:#0f69ff; '>\b</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\d</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 937:             $i <span style='color:#808030; '>=</span> $1 <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> $line<span style='color:#800080; '>;</span>
 938:             $cond <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>length</span> $2 <span style='color:#808030; '>?</span> $2 <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>'1'</span><span style='color:#800080; '>;</span>
 939:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$dbline<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 940:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Line </span><span style='color:#0000e6; '>$i</span><span style='color:#0000e6; '> not breakable.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 941:             <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
 942:                 $had_breakpoints<span style='color:#800080; '>{</span>$filename<span style='color:#800080; '>}</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 943:                 $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>*</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>$cond</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 944:             <span style='color:#800080; '>}</span>
 945:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 946:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>d</span><span style='color:#0f69ff; '>\b</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\d</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 947:             $i <span style='color:#808030; '>=</span> $1 <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> $line<span style='color:#800080; '>;</span>
 948:                         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$dbline<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 949:                             <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Line </span><span style='color:#0000e6; '>$i</span><span style='color:#0000e6; '> not breakable.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 950:                         <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
 951:                 $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>*</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 952:                 <span style='color:#800000; font-weight:bold; '>delete</span> $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>if</span> $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#800080; '>;</span>
 953:                         <span style='color:#800080; '>}</span>
 954:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 955:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>A</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 956:               <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Deleting all actions...</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 957:               <span style='color:#800000; font-weight:bold; '>my</span> $file<span style='color:#800080; '>;</span>
 958:               <span style='color:#800000; font-weight:bold; '>for</span> $file <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>keys</span> %had_breakpoints<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 959:             <span style='color:#800000; font-weight:bold; '>local</span> *dbline <span style='color:#808030; '>=</span> $main<span style='color:#808030; '>:</span><span style='color:#808030; '>:</span><span style='color:#800080; '>{</span><span style='color:#0000e6; '>'_&lt;'</span> <span style='color:#808030; '>.</span> $file<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 960:             <span style='color:#800000; font-weight:bold; '>my</span> $max <span style='color:#808030; '>=</span> $#dbline<span style='color:#800080; '>;</span>
 961:             <span style='color:#800000; font-weight:bold; '>my</span> $was<span style='color:#800080; '>;</span>
 962:             
 963:             <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span>$i <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span> $i <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> $max <span style='color:#800080; '>;</span> $i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 964:                 <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 965:                 $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\0</span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>*</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 966:                 <span style='color:#800000; font-weight:bold; '>delete</span> $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>if</span> $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#800080; '>;</span>
 967:                 <span style='color:#800080; '>}</span>
 968:             <span style='color:#800080; '>}</span>
 969:             
 970:             <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#808030; '>(</span>$had_breakpoints<span style='color:#800080; '>{</span>$file<span style='color:#800080; '>}</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>=</span> <span style='color:#808030; '>~</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 971:                 <span style='color:#800000; font-weight:bold; '>delete</span> $had_breakpoints<span style='color:#800080; '>{</span>$file<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 972:             <span style='color:#800080; '>}</span>
 973:               <span style='color:#800080; '>}</span>
 974:               <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 975:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>O</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 976:             <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span>@options<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 977:                 <span style='color:#808030; '>&amp;</span>dump_option<span style='color:#808030; '>(</span>$_<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 978:             <span style='color:#800080; '>}</span>
 979:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 980:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>O</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\S</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 981:             parse_options<span style='color:#808030; '>(</span>$1<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 982:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 983:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\&lt;</span><span style='color:#0f69ff; '>\&lt;</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span> <span style='color:#696969; '># \&lt;\&lt; for CPerl sake: not HERE</span>
 984:             <span style='color:#800000; font-weight:bold; '>push</span> @$pre<span style='color:#808030; '>,</span> action<span style='color:#808030; '>(</span>$1<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 985:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 986:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>>></span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 987:             <span style='color:#800000; font-weight:bold; '>push</span> @$post<span style='color:#808030; '>,</span> action<span style='color:#808030; '>(</span>$1<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 988:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 989:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>&lt;</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
 990:             <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#808030; '>(</span>$1<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 991:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"All &lt; actions cleared.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 992:                 $pre <span style='color:#808030; '>=</span> <span style='color:#808030; '>[</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
 993:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span>
 994:             <span style='color:#800080; '>}</span> 
 995:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$1 <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'?'</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 996:                 <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#808030; '>(</span>@$pre<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 997:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"No pre-prompt Perl actions.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 998:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span>
 999:                 <span style='color:#800080; '>}</span> 
1000:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Perl commands run before each prompt:</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1001:                 <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#800000; font-weight:bold; '>my</span> $action <span style='color:#808030; '>(</span> @$pre <span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1002:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\t</span><span style='color:#0000e6; '>&lt; -- </span><span style='color:#0000e6; '>$action</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1003:                 <span style='color:#800080; '>}</span> 
1004:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span>
1005:             <span style='color:#800080; '>}</span> 
1006:             $pre <span style='color:#808030; '>=</span> <span style='color:#808030; '>[</span>action<span style='color:#808030; '>(</span>$1<span style='color:#808030; '>)</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
1007:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1008:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>></span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1009:             <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#808030; '>(</span>$1<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1010:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"All > actions cleared.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1011:                 $post <span style='color:#808030; '>=</span> <span style='color:#808030; '>[</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
1012:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span>
1013:             <span style='color:#800080; '>}</span>
1014:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$1 <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'?'</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1015:                 <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#808030; '>(</span>@$post<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1016:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"No post-prompt Perl actions.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1017:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span>
1018:                 <span style='color:#800080; '>}</span> 
1019:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Perl commands run after each prompt:</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1020:                 <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#800000; font-weight:bold; '>my</span> $action <span style='color:#808030; '>(</span> @$post <span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1021:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\t</span><span style='color:#0000e6; '>> -- </span><span style='color:#0000e6; '>$action</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1022:                 <span style='color:#800080; '>}</span> 
1023:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span>
1024:             <span style='color:#800080; '>}</span> 
1025:             $post <span style='color:#808030; '>=</span> <span style='color:#808030; '>[</span>action<span style='color:#808030; '>(</span>$1<span style='color:#808030; '>)</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
1026:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1027:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\{</span><span style='color:#0f69ff; '>\{</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1028:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\{</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#0f69ff; '>\}</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> unbalanced<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>substr</span><span style='color:#808030; '>(</span>$cmd<span style='color:#808030; '>,</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> 
1029:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"{{ is now a debugger command</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>,</span>
1030:                 <span style='color:#0000e6; '>"use `;{{' if you mean Perl code</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1031:                 $cmd <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"h {{"</span><span style='color:#800080; '>;</span>
1032:                 <span style='color:#800000; font-weight:bold; '>redo</span> CMD<span style='color:#800080; '>;</span>
1033:             <span style='color:#800080; '>}</span> 
1034:             <span style='color:#800000; font-weight:bold; '>push</span> @$pretype<span style='color:#808030; '>,</span> $1<span style='color:#800080; '>;</span>
1035:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1036:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\{</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1037:             <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#808030; '>(</span>$1<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1038:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"All { actions cleared.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1039:                 $pretype <span style='color:#808030; '>=</span> <span style='color:#808030; '>[</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
1040:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span>
1041:             <span style='color:#800080; '>}</span>
1042:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$1 <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'?'</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1043:                 <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#808030; '>(</span>@$pretype<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1044:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"No pre-prompt debugger actions.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1045:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span>
1046:                 <span style='color:#800080; '>}</span> 
1047:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Debugger commands run before each prompt:</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1048:                 <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#800000; font-weight:bold; '>my</span> $action <span style='color:#808030; '>(</span> @$pretype <span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1049:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\t</span><span style='color:#0000e6; '>{ -- </span><span style='color:#0000e6; '>$action</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1050:                 <span style='color:#800080; '>}</span> 
1051:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span>
1052:             <span style='color:#800080; '>}</span> 
1053:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\{</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#0f69ff; '>\}</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> unbalanced<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>substr</span><span style='color:#808030; '>(</span>$cmd<span style='color:#808030; '>,</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> 
1054:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"{ is now a debugger command</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>,</span>
1055:                 <span style='color:#0000e6; '>"use `;{' if you mean Perl code</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1056:                 $cmd <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"h {"</span><span style='color:#800080; '>;</span>
1057:                 <span style='color:#800000; font-weight:bold; '>redo</span> CMD<span style='color:#800080; '>;</span>
1058:             <span style='color:#800080; '>}</span> 
1059:             $pretype <span style='color:#808030; '>=</span> <span style='color:#808030; '>[</span>$1<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
1060:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1061:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>a</span><span style='color:#0f69ff; '>\b</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\d</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1062:             $i <span style='color:#808030; '>=</span> $1 <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> $line<span style='color:#800080; '>;</span> $j <span style='color:#808030; '>=</span> $2<span style='color:#800080; '>;</span>
1063:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>length</span> $j<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1064:                 <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$dbline<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1065:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Line </span><span style='color:#0000e6; '>$i</span><span style='color:#0000e6; '> may not have an action.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1066:                 <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1067:                 $had_breakpoints<span style='color:#800080; '>{</span>$filename<span style='color:#800080; '>}</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>2</span><span style='color:#800080; '>;</span>
1068:                 $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\0</span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>*</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
1069:                 $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span> <span style='color:#808030; '>.</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"\</span><span style='color:#008c00; '>0</span><span style='color:#0000e6; '>"</span> <span style='color:#808030; '>.</span> action<span style='color:#808030; '>(</span>$j<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1070:                 <span style='color:#800080; '>}</span>
1071:             <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1072:                 $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\0</span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>*</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
1073:                 <span style='color:#800000; font-weight:bold; '>delete</span> $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>if</span> $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#800080; '>;</span>
1074:             <span style='color:#800080; '>}</span>
1075:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1076:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>n</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1077:                 end_report<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>next</span> CMD <span style='color:#800000; font-weight:bold; '>if</span> $finished <span style='color:#808030; '>and</span> $level <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1078:             $single <span style='color:#808030; '>=</span> <span style='color:#008c00; '>2</span><span style='color:#800080; '>;</span>
1079:             $laststep <span style='color:#808030; '>=</span> $cmd<span style='color:#800080; '>;</span>
1080:             <span style='color:#800000; font-weight:bold; '>last</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1081:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>s</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1082:                 end_report<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>next</span> CMD <span style='color:#800000; font-weight:bold; '>if</span> $finished <span style='color:#808030; '>and</span> $level <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1083:             $single <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1084:             $laststep <span style='color:#808030; '>=</span> $cmd<span style='color:#800080; '>;</span>
1085:             <span style='color:#800000; font-weight:bold; '>last</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1086:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>c</span><span style='color:#0f69ff; '>\b</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>\w</span><span style='color:#0000e6; '>:</span><span style='color:#808030; '>]</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1087:                 end_report<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>next</span> CMD <span style='color:#800000; font-weight:bold; '>if</span> $finished <span style='color:#808030; '>and</span> $level <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1088:             $subname <span style='color:#808030; '>=</span> $i <span style='color:#808030; '>=</span> $1<span style='color:#800080; '>;</span>
1089:             <span style='color:#696969; '>#  Probably not needed, since we finish an interactive</span>
1090:             <span style='color:#696969; '>#  sub-session anyway...</span>
1091:             <span style='color:#696969; '># local $filename = $filename;</span>
1092:             <span style='color:#696969; '># local *dbline = *dbline;    # XXX Would this </span><span style='color:#ffffff; background:#808000; '>work?!</span>
1093:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$i <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>\D</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#696969; '># subroutine name</span>
1094:                 $subname <span style='color:#808030; '>=</span> $package<span style='color:#808030; '>.</span><span style='color:#0000e6; '>"::"</span><span style='color:#808030; '>.</span>$subname 
1095:                     <span style='color:#800000; font-weight:bold; '>unless</span> $subname <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>::</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
1096:                 <span style='color:#808030; '>(</span>$file<span style='color:#808030; '>,</span>$i<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>find_sub<span style='color:#808030; '>(</span>$subname<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>:</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1097:                 $i <span style='color:#808030; '>+</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1098:                 <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$i<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1099:                     $filename <span style='color:#808030; '>=</span> $file<span style='color:#800080; '>;</span>
1100:                 *dbline <span style='color:#808030; '>=</span> $main<span style='color:#808030; '>:</span><span style='color:#808030; '>:</span><span style='color:#800080; '>{</span><span style='color:#0000e6; '>'_&lt;'</span> <span style='color:#808030; '>.</span> $filename<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1101:                 $had_breakpoints<span style='color:#800080; '>{</span>$filename<span style='color:#800080; '>}</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1102:                 $max <span style='color:#808030; '>=</span> $#dbline<span style='color:#800080; '>;</span>
1103:                 <span style='color:#808030; '>+</span><span style='color:#808030; '>+</span>$i <span style='color:#800000; font-weight:bold; '>while</span> $dbline<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> $i <span style='color:#808030; '>&lt;</span> $max<span style='color:#800080; '>;</span>
1104:                 <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1105:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Subroutine </span><span style='color:#0000e6; '>$subname</span><span style='color:#0000e6; '> not found.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1106:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> 
1107:                 <span style='color:#800080; '>}</span>
1108:             <span style='color:#800080; '>}</span>
1109:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$i<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1110:                 <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$dbline<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1111:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Line </span><span style='color:#0000e6; '>$i</span><span style='color:#0000e6; '> not breakable.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1112:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span>
1113:                 <span style='color:#800080; '>}</span>
1114:                 $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>(</span><span style='color:#808030; '>$</span><span style='color:#800080; '>|</span><span style='color:#0f69ff; '>\0</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>;</span><span style='color:#008c00; '>9</span><span style='color:#0000e6; '>$1</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span> <span style='color:#696969; '># add one-time-only b.p.</span>
1115:             <span style='color:#800080; '>}</span>
1116:             <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span>$i<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> $i <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> $stack_depth<span style='color:#800080; '>;</span> <span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1117:                 $stack<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>=</span> <span style='color:#808030; '>~</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1118:             <span style='color:#800080; '>}</span>
1119:             <span style='color:#800000; font-weight:bold; '>last</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1120:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>r</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1121:                 end_report<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>next</span> CMD <span style='color:#800000; font-weight:bold; '>if</span> $finished <span style='color:#808030; '>and</span> $level <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1122:             $stack<span style='color:#808030; '>[</span>$stack_depth<span style='color:#808030; '>]</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1123:             $doret <span style='color:#808030; '>=</span> $option<span style='color:#800080; '>{</span>PrintRet<span style='color:#800080; '>}</span> <span style='color:#808030; '>?</span> $stack_depth <span style='color:#808030; '>-</span> <span style='color:#008c00; '>1</span> <span style='color:#808030; '>:</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>2</span><span style='color:#800080; '>;</span>
1124:             <span style='color:#800000; font-weight:bold; '>last</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1125:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>R</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1126:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Warning: some settings and command-line options may be lost!</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1127:             <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>@script<span style='color:#808030; '>,</span> @flags<span style='color:#808030; '>,</span> $cl<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1128:             <span style='color:#800000; font-weight:bold; '>push</span> @flags<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'-w'</span> <span style='color:#800000; font-weight:bold; '>if</span> $ini_warn<span style='color:#800080; '>;</span>
1129:             <span style='color:#696969; '># Put all the old includes at the start to get</span>
1130:             <span style='color:#696969; '># the same debugger.</span>
1131:             <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span>@ini_INC<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1132:               <span style='color:#800000; font-weight:bold; '>push</span> @flags<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'-I'</span><span style='color:#808030; '>,</span> $_<span style='color:#800080; '>;</span>
1133:             <span style='color:#800080; '>}</span>
1134:             <span style='color:#696969; '># Arrange for setting the old INC:</span>
1135:             set_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_INC"</span><span style='color:#808030; '>,</span> @ini_INC<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1136:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$0 <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'-e'</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1137:               <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>1.</span><span style='color:#808030; '>.</span>$#{<span style='color:#0000e6; '>'::_&lt;-e'</span>}<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#696969; '># The first line is PERL5DB</span>
1138:                     <span style='color:#800000; font-weight:bold; '>chomp</span> <span style='color:#808030; '>(</span>$cl <span style='color:#808030; '>=</span>  ${<span style='color:#0000e6; '>'::_&lt;-e'</span>}<span style='color:#808030; '>[</span>$_<span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1139:                 <span style='color:#800000; font-weight:bold; '>push</span> @script<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'-e'</span><span style='color:#808030; '>,</span> $cl<span style='color:#800080; '>;</span>
1140:               <span style='color:#800080; '>}</span>
1141:             <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1142:               @script <span style='color:#808030; '>=</span> $0<span style='color:#800080; '>;</span>
1143:             <span style='color:#800080; '>}</span>
1144:             set_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_HIST"</span><span style='color:#808030; '>,</span> 
1145:                  $term<span style='color:#808030; '>-></span>Features<span style='color:#808030; '>-></span><span style='color:#800080; '>{</span>getHistory<span style='color:#800080; '>}</span> 
1146:                  <span style='color:#808030; '>?</span> $term<span style='color:#808030; '>-></span>GetHistory <span style='color:#808030; '>:</span> @hist<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1147:             <span style='color:#800000; font-weight:bold; '>my</span> @had_breakpoints <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>keys</span> %had_breakpoints<span style='color:#800080; '>;</span>
1148:             set_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_VISITED"</span><span style='color:#808030; '>,</span> @had_breakpoints<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1149:             set_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_OPT"</span><span style='color:#808030; '>,</span> %option<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1150:             set_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_ON_LOAD"</span><span style='color:#808030; '>,</span> %break_on_load<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1151:             <span style='color:#800000; font-weight:bold; '>my</span> @hard<span style='color:#800080; '>;</span>
1152:             <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span> <span style='color:#808030; '>..</span> $#had_breakpoints<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1153:               <span style='color:#800000; font-weight:bold; '>my</span> $file <span style='color:#808030; '>=</span> $had_breakpoints<span style='color:#808030; '>[</span>$_<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
1154:               *dbline <span style='color:#808030; '>=</span> $main<span style='color:#808030; '>:</span><span style='color:#808030; '>:</span><span style='color:#800080; '>{</span><span style='color:#0000e6; '>'_&lt;'</span> <span style='color:#808030; '>.</span> $file<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1155:               <span style='color:#800000; font-weight:bold; '>next</span> <span style='color:#800000; font-weight:bold; '>unless</span> %dbline <span style='color:#808030; '>or</span> $postponed_file<span style='color:#800080; '>{</span>$file<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1156:               <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>push</span> @hard<span style='color:#808030; '>,</span> $file<span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>next</span> 
1157:                 <span style='color:#800000; font-weight:bold; '>if</span> $file <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\(</span><span style='color:#0000e6; '>eval </span><span style='color:#0000e6; '>\d</span><span style='color:#808030; '>+</span><span style='color:#0f69ff; '>\)</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
1158:               <span style='color:#800000; font-weight:bold; '>my</span> @add<span style='color:#800080; '>;</span>
1159:               @add <span style='color:#808030; '>=</span> %{$postponed_file<span style='color:#800080; '>{</span>$file<span style='color:#800080; '>}</span>}
1160:                 <span style='color:#800000; font-weight:bold; '>if</span> $postponed_file<span style='color:#800080; '>{</span>$file<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1161:               set_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_FILE_</span><span style='color:#0000e6; '>$_</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>,</span> %dbline<span style='color:#808030; '>,</span> @add<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1162:             <span style='color:#800080; '>}</span>
1163:             <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span>@hard<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#696969; '># Yes, really-really...</span>
1164:               <span style='color:#696969; '># Find the subroutines in this eval</span>
1165:               *dbline <span style='color:#808030; '>=</span> $main<span style='color:#808030; '>:</span><span style='color:#808030; '>:</span><span style='color:#800080; '>{</span><span style='color:#0000e6; '>'_&lt;'</span> <span style='color:#808030; '>.</span> $_<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1166:               <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$quoted<span style='color:#808030; '>,</span> $sub<span style='color:#808030; '>,</span> %subs<span style='color:#808030; '>,</span> $line<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>quotemeta</span> $_<span style='color:#800080; '>;</span>
1167:               <span style='color:#800000; font-weight:bold; '>for</span> $sub <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>keys</span> %sub<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1168:                 <span style='color:#800000; font-weight:bold; '>next</span> <span style='color:#800000; font-weight:bold; '>unless</span> $sub<span style='color:#800080; '>{</span>$sub<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>$quoted</span><span style='color:#0000e6; '>:</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\d</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>-</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\d</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
1169:                 $subs<span style='color:#800080; '>{</span>$sub<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>[</span>$1<span style='color:#808030; '>,</span> $2<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
1170:               <span style='color:#800080; '>}</span>
1171:               <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#808030; '>(</span>%subs<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1172:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT
1173:                   <span style='color:#0000e6; '>"No subroutines in </span><span style='color:#0000e6; '>$_</span><span style='color:#0000e6; '>, ignoring breakpoints.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1174:                 <span style='color:#800000; font-weight:bold; '>next</span><span style='color:#800080; '>;</span>
1175:               <span style='color:#800080; '>}</span>
1176:             <span style='color:#e34adc; '>LINES:</span> <span style='color:#800000; font-weight:bold; '>for</span> $line <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>keys</span> %dbline<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1177:                 <span style='color:#696969; '># One breakpoint per sub only:</span>
1178:                 <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$offset<span style='color:#808030; '>,</span> $sub<span style='color:#808030; '>,</span> $found<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1179:               <span style='color:#e34adc; '>SUBS:</span> <span style='color:#800000; font-weight:bold; '>for</span> $sub <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>keys</span> %subs<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1180:                   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$subs<span style='color:#800080; '>{</span>$sub<span style='color:#800080; '>}</span><span style='color:#808030; '>-></span><span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>></span><span style='color:#808030; '>=</span> $line <span style='color:#696969; '># Not after the subroutine</span>
1181:                   <span style='color:#808030; '>and</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>not</span> <span style='color:#800000; font-weight:bold; '>defined</span> $offset <span style='color:#696969; '># Not caught</span>
1182:                        <span style='color:#808030; '>or</span> $offset <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#696969; '># or badly caught</span>
1183:                 $found <span style='color:#808030; '>=</span> $sub<span style='color:#800080; '>;</span>
1184:                 $offset <span style='color:#808030; '>=</span> $line <span style='color:#808030; '>-</span> $subs<span style='color:#800080; '>{</span>$sub<span style='color:#800080; '>}</span><span style='color:#808030; '>-></span><span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
1185:                 $offset <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"+</span><span style='color:#0000e6; '>$offset</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>last</span> SUBS <span style='color:#800000; font-weight:bold; '>if</span> $offset <span style='color:#808030; '>></span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1186:                   <span style='color:#800080; '>}</span>
1187:                 <span style='color:#800080; '>}</span>
1188:                 <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $offset<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1189:                   $postponed<span style='color:#800080; '>{</span>$found<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span>
1190:                 <span style='color:#0000e6; '>"break </span><span style='color:#0000e6; '>$offset</span><span style='color:#0000e6; '> if </span><span style='color:#0000e6; '>$dbline</span><span style='color:#0000e6; '>{</span><span style='color:#0000e6; '>$line</span><span style='color:#0000e6; '>}"</span><span style='color:#800080; '>;</span>
1191:                 <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1192:                   <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Breakpoint in </span><span style='color:#0000e6; '>$_</span><span style='color:#0000e6; '>:</span><span style='color:#0000e6; '>$line</span><span style='color:#0000e6; '> ignored: after all the subroutines.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1193:                 <span style='color:#800080; '>}</span>
1194:               <span style='color:#800080; '>}</span>
1195:             <span style='color:#800080; '>}</span>
1196:             set_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_POSTPONE"</span><span style='color:#808030; '>,</span> %postponed<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1197:             set_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_PRETYPE"</span><span style='color:#808030; '>,</span> @$pretype<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1198:             set_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_PRE"</span><span style='color:#808030; '>,</span> @$pre<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1199:             set_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_POST"</span><span style='color:#808030; '>,</span> @$post<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1200:             set_list<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"PERLDB_TYPEAHEAD"</span><span style='color:#808030; '>,</span> @typeahead<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1201:             $ENV<span style='color:#800080; '>{</span>PERLDB_RESTART<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1202:             <span style='color:#696969; '>#print "$^X, '-d', @flags, @script, ($slave_editor ? '-emacs' : ()), @ARGS";</span>
1203:             <span style='color:#800000; font-weight:bold; '>exec</span> $^X<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'-d'</span><span style='color:#808030; '>,</span> @flags<span style='color:#808030; '>,</span> @script<span style='color:#808030; '>,</span> <span style='color:#808030; '>(</span>$slave_editor <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>'-emacs'</span> <span style='color:#808030; '>:</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> @ARGS<span style='color:#800080; '>;</span>
1204:             <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"exec failed: $!</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1205:             <span style='color:#800000; font-weight:bold; '>last</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1206:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>T</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1207:             print_trace<span style='color:#808030; '>(</span>$OUT<span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span> <span style='color:#696969; '># skip DB</span>
1208:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1209:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>W</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1210:             $trace <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>=</span> <span style='color:#808030; '>~</span><span style='color:#008c00; '>2</span><span style='color:#800080; '>;</span>
1211:             @to_watch <span style='color:#808030; '>=</span> @old_watch <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1212:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1213:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>W</span><span style='color:#0f69ff; '>\b</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>s</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1214:             <span style='color:#800000; font-weight:bold; '>push</span> @to_watch<span style='color:#808030; '>,</span> $1<span style='color:#800080; '>;</span>
1215:             $evalarg <span style='color:#808030; '>=</span> $1<span style='color:#800080; '>;</span>
1216:             <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$val<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>eval</span><span style='color:#800080; '>;</span>
1217:             $val <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $val<span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>"'</span><span style='color:#0000e6; '>$val</span><span style='color:#0000e6; '>'"</span> <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>'undef'</span> <span style='color:#800080; '>;</span>
1218:             <span style='color:#800000; font-weight:bold; '>push</span> @old_watch<span style='color:#808030; '>,</span> $val<span style='color:#800080; '>;</span>
1219:             $trace <span style='color:#808030; '>|</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>2</span><span style='color:#800080; '>;</span>
1220:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1221:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\/</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1222:             $inpat <span style='color:#808030; '>=</span> $1<span style='color:#800080; '>;</span>
1223:             $inpat <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>:</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\\</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>/</span><span style='color:#808030; '>$</span><span style='color:#800000; '>:</span><span style='color:#0000e6; '>$1</span><span style='color:#800000; '>:</span><span style='color:#800080; '>;</span>
1224:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$inpat <span style='color:#808030; '>ne</span> <span style='color:#0000e6; '>""</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1225:                 <span style='color:#696969; '># squelch the sigmangler</span>
1226:                 <span style='color:#800000; font-weight:bold; '>local</span> $SIG<span style='color:#800080; '>{</span>__DIE__<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1227:                 <span style='color:#800000; font-weight:bold; '>local</span> $SIG<span style='color:#800080; '>{</span>__WARN__<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1228:                 <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#0000e6; '>'$inpat =~ m'</span><span style='color:#808030; '>.</span><span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\a</span><span style='color:#0000e6; '>$inpat</span><span style='color:#0f69ff; '>\a</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>    
1229:                 <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$@ <span style='color:#808030; '>ne</span> <span style='color:#0000e6; '>""</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1230:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"$@"</span><span style='color:#800080; '>;</span>
1231:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span>
1232:                 <span style='color:#800080; '>}</span>
1233:                 $pat <span style='color:#808030; '>=</span> $inpat<span style='color:#800080; '>;</span>
1234:             <span style='color:#800080; '>}</span>
1235:             $end <span style='color:#808030; '>=</span> $start<span style='color:#800080; '>;</span>
1236:             $incr <span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1237:             <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#0000e6; '>'</span>
1238: <span style='color:#0000e6; '>                for (;;) {</span>
1239: <span style='color:#0000e6; '>                ++$start;</span>
1240: <span style='color:#0000e6; '>                $start = 1 if ($start > $max);</span>
1241: <span style='color:#0000e6; '>                last if ($start == $end);</span>
1242: <span style='color:#0000e6; '>                if ($dbline[$start] =~ m'</span> <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\a</span><span style='color:#0000e6; '>$pat</span><span style='color:#0f69ff; '>\a</span><span style='color:#0000e6; '>"</span> <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>'i) {</span>
1243: <span style='color:#0000e6; '>                    if ($slave_editor) {</span>
1244: <span style='color:#0000e6; '>                    print $OUT "\032\032$filename:$start:0\n";</span>
1245: <span style='color:#0000e6; '>                    } else {</span>
1246: <span style='color:#0000e6; '>                    print $OUT "$start:\t", $dbline[$start], "\n";</span>
1247: <span style='color:#0000e6; '>                    }</span>
1248: <span style='color:#0000e6; '>                    last;</span>
1249: <span style='color:#0000e6; '>                }</span>
1250: <span style='color:#0000e6; '>                } '</span><span style='color:#800080; '>;</span>
1251:             <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"/</span><span style='color:#0000e6; '>$pat</span><span style='color:#0000e6; '>/: not found</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$start <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> $end<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1252:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1253:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\?</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1254:             $inpat <span style='color:#808030; '>=</span> $1<span style='color:#800080; '>;</span>
1255:             $inpat <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>:</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\\</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#0f69ff; '>\?</span><span style='color:#808030; '>$</span><span style='color:#800000; '>:</span><span style='color:#0000e6; '>$1</span><span style='color:#800000; '>:</span><span style='color:#800080; '>;</span>
1256:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$inpat <span style='color:#808030; '>ne</span> <span style='color:#0000e6; '>""</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1257:                 <span style='color:#696969; '># squelch the sigmangler</span>
1258:                 <span style='color:#800000; font-weight:bold; '>local</span> $SIG<span style='color:#800080; '>{</span>__DIE__<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1259:                 <span style='color:#800000; font-weight:bold; '>local</span> $SIG<span style='color:#800080; '>{</span>__WARN__<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1260:                 <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#0000e6; '>'$inpat =~ m'</span><span style='color:#808030; '>.</span><span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\a</span><span style='color:#0000e6; '>$inpat</span><span style='color:#0f69ff; '>\a</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>    
1261:                 <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$@ <span style='color:#808030; '>ne</span> <span style='color:#0000e6; '>""</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1262:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT $@<span style='color:#800080; '>;</span>
1263:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span>
1264:                 <span style='color:#800080; '>}</span>
1265:                 $pat <span style='color:#808030; '>=</span> $inpat<span style='color:#800080; '>;</span>
1266:             <span style='color:#800080; '>}</span>
1267:             $end <span style='color:#808030; '>=</span> $start<span style='color:#800080; '>;</span>
1268:             $incr <span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1269:             <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#0000e6; '>'</span>
1270: <span style='color:#0000e6; '>                for (;;) {</span>
1271: <span style='color:#0000e6; '>                --$start;</span>
1272: <span style='color:#0000e6; '>                $start = $max if ($start &lt;= 0);</span>
1273: <span style='color:#0000e6; '>                last if ($start == $end);</span>
1274: <span style='color:#0000e6; '>                if ($dbline[$start] =~ m'</span> <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\a</span><span style='color:#0000e6; '>$pat</span><span style='color:#0f69ff; '>\a</span><span style='color:#0000e6; '>"</span> <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>'i) {</span>
1275: <span style='color:#0000e6; '>                    if ($slave_editor) {</span>
1276: <span style='color:#0000e6; '>                    print $OUT "\032\032$filename:$start:0\n";</span>
1277: <span style='color:#0000e6; '>                    } else {</span>
1278: <span style='color:#0000e6; '>                    print $OUT "$start:\t", $dbline[$start], "\n";</span>
1279: <span style='color:#0000e6; '>                    }</span>
1280: <span style='color:#0000e6; '>                    last;</span>
1281: <span style='color:#0000e6; '>                }</span>
1282: <span style='color:#0000e6; '>                } '</span><span style='color:#800080; '>;</span>
1283:             <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"?</span><span style='color:#0000e6; '>$pat</span><span style='color:#0000e6; '>?: not found</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$start <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> $end<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1284:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1285:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>$rc</span><span style='color:#808030; '>+</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>-</span><span style='color:#808030; '>)</span><span style='color:#808030; '>?</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\d</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#808030; '>?</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1286:             <span style='color:#800000; font-weight:bold; '>pop</span><span style='color:#808030; '>(</span>@hist<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>length</span><span style='color:#808030; '>(</span>$cmd<span style='color:#808030; '>)</span> <span style='color:#808030; '>></span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1287:             $i <span style='color:#808030; '>=</span> $1 <span style='color:#808030; '>?</span> <span style='color:#808030; '>(</span>$#hist<span style='color:#808030; '>-</span><span style='color:#808030; '>(</span>$2<span style='color:#808030; '>|</span><span style='color:#808030; '>|</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>:</span> <span style='color:#808030; '>(</span>$2<span style='color:#808030; '>|</span><span style='color:#808030; '>|</span>$#hist<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1288:             $cmd <span style='color:#808030; '>=</span> $hist<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
1289:             <span style='color:#800000; font-weight:bold; '>print</span> $OUT $cmd<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1290:             <span style='color:#800000; font-weight:bold; '>redo</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1291:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>$sh</span><span style='color:#0000e6; '>$sh</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#0f69ff; '>\x00</span><span style='color:#808030; '>-</span><span style='color:#0f69ff; '>\xff</span><span style='color:#808030; '>]</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1292:             <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>system</span><span style='color:#808030; '>(</span>$1<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1293:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1294:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>$rc</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>$rc</span><span style='color:#808030; '>]</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1295:             $pat <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"^</span><span style='color:#0000e6; '>$1</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1296:             <span style='color:#800000; font-weight:bold; '>pop</span><span style='color:#808030; '>(</span>@hist<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>length</span><span style='color:#808030; '>(</span>$cmd<span style='color:#808030; '>)</span> <span style='color:#808030; '>></span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1297:             <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span>$i <span style='color:#808030; '>=</span> $#hist<span style='color:#800080; '>;</span> $i<span style='color:#800080; '>;</span> <span style='color:#808030; '>-</span><span style='color:#808030; '>-</span>$i<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1298:                 <span style='color:#800000; font-weight:bold; '>last</span> <span style='color:#800000; font-weight:bold; '>if</span> $hist<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>$pat</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
1299:             <span style='color:#800080; '>}</span>
1300:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>$i<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1301:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"No such command!</span><span style='color:#0f69ff; '>\n</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1302:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span>
1303:             <span style='color:#800080; '>}</span>
1304:             $cmd <span style='color:#808030; '>=</span> $hist<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
1305:             <span style='color:#800000; font-weight:bold; '>print</span> $OUT $cmd<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1306:             <span style='color:#800000; font-weight:bold; '>redo</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1307:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>$sh</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1308:             <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>system</span><span style='color:#808030; '>(</span>$ENV<span style='color:#800080; '>{</span>SHELL<span style='color:#800080; '>}</span><span style='color:#808030; '>|</span><span style='color:#808030; '>|</span><span style='color:#0000e6; '>"/bin/sh"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1309:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1310:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>$sh</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#0f69ff; '>\x00</span><span style='color:#808030; '>-</span><span style='color:#0f69ff; '>\xff</span><span style='color:#808030; '>]</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1311:             <span style='color:#696969; '># XXX: using csh or tcsh destroys sigint retvals!</span>
1312:             <span style='color:#696969; '>#&amp;system($1);  # use this instead</span>
1313:             <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>system</span><span style='color:#808030; '>(</span>$ENV<span style='color:#800080; '>{</span>SHELL<span style='color:#800080; '>}</span><span style='color:#808030; '>|</span><span style='color:#808030; '>|</span><span style='color:#0000e6; '>"/bin/sh"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"-c"</span><span style='color:#808030; '>,</span>$1<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1314:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1315:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>H</span><span style='color:#0f69ff; '>\b</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>-</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\d</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>?</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1316:             $end <span style='color:#808030; '>=</span> $2 <span style='color:#808030; '>?</span> <span style='color:#808030; '>(</span>$#hist<span style='color:#808030; '>-</span>$2<span style='color:#808030; '>)</span> <span style='color:#808030; '>:</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1317:             $hist <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>if</span> $hist <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1318:             <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span>$i<span style='color:#808030; '>=</span>$#hist<span style='color:#800080; '>;</span> $i<span style='color:#808030; '>></span>$end<span style='color:#800080; '>;</span> $i<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1319:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$i</span><span style='color:#0000e6; '>: "</span><span style='color:#808030; '>,</span>$hist<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
1320:                   <span style='color:#800000; font-weight:bold; '>unless</span> $hist<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>.</span><span style='color:#808030; '>?</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
1321:             <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1322:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1323:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>?</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#0000e6; '>man</span><span style='color:#800080; '>|</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>?</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#0000e6; '>perl</span><span style='color:#808030; '>)</span><span style='color:#808030; '>?</span><span style='color:#0000e6; '>doc</span><span style='color:#808030; '>)</span><span style='color:#0f69ff; '>\b</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>?</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>(</span><span style='color:#808030; '>]</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>?</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1324:             runman<span style='color:#808030; '>(</span>$1<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1325:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1326:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>p</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>print {</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>DB::OUT} </span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>_</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
1327:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>p</span><span style='color:#0f69ff; '>\b</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>print {</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>DB::OUT} </span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
1328:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>=</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1329:             <span style='color:#800000; font-weight:bold; '>my</span> @keys<span style='color:#800080; '>;</span>
1330:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>length</span> $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1331:                 @keys <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>sort</span> <span style='color:#800000; font-weight:bold; '>keys</span> %alias<span style='color:#800080; '>;</span>
1332:             <span style='color:#800080; '>}</span> 
1333:                         <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>my</span><span style='color:#808030; '>(</span>$k<span style='color:#808030; '>,</span>$v<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\S</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\S</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1334:                 <span style='color:#696969; '># can't use $_ or kill //g state</span>
1335:                 <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#800000; font-weight:bold; '>my</span> $x <span style='color:#808030; '>(</span>$k<span style='color:#808030; '>,</span> $v<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> $x <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\a</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\\</span><span style='color:#0000e6; '>a</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>g</span> <span style='color:#800080; '>}</span>
1336:                 $alias<span style='color:#800080; '>{</span>$k<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"s</span><span style='color:#0f69ff; '>\a</span><span style='color:#0000e6; '>$k</span><span style='color:#0f69ff; '>\a</span><span style='color:#0000e6; '>$v</span><span style='color:#0f69ff; '>\a</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1337:                 <span style='color:#696969; '># squelch the sigmangler</span>
1338:                 <span style='color:#800000; font-weight:bold; '>local</span> $SIG<span style='color:#800080; '>{</span>__DIE__<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1339:                 <span style='color:#800000; font-weight:bold; '>local</span> $SIG<span style='color:#800080; '>{</span>__WARN__<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1340:                 <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#0000e6; '>"sub { s</span><span style='color:#0f69ff; '>\a</span><span style='color:#0000e6; '>$k</span><span style='color:#0f69ff; '>\a</span><span style='color:#0000e6; '>$v</span><span style='color:#0f69ff; '>\a</span><span style='color:#0000e6; '> }; </span><span style='color:#008c00; '>1</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1341:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Can't alias </span><span style='color:#0000e6; '>$k</span><span style='color:#0000e6; '> to </span><span style='color:#0000e6; '>$v</span><span style='color:#0000e6; '>: $@</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span> 
1342:                 <span style='color:#800000; font-weight:bold; '>delete</span> $alias<span style='color:#800080; '>{</span>$k<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1343:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span>
1344:                 <span style='color:#800080; '>}</span> 
1345:                 @keys <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$k<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1346:             <span style='color:#800080; '>}</span> 
1347:             <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1348:                 @keys <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$cmd<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1349:             <span style='color:#800080; '>}</span> 
1350:             <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#800000; font-weight:bold; '>my</span> $k <span style='color:#808030; '>(</span>@keys<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1351:                 <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>my</span> $v <span style='color:#808030; '>=</span> $alias<span style='color:#800080; '>{</span>$k<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '></span><span style='color:#0000e6; '>s</span><span style='color:#0f69ff; '>\a</span><span style='color:#0000e6; '>$k</span><span style='color:#0f69ff; '>\a</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#0f69ff; '>\a</span><span style='color:#808030; '>$</span><span style='color:#800000; '></span><span style='color:#008c00; '>1</span><span style='color:#800000; '></span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1352:                 <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$k</span><span style='color:#0f69ff; '>\t</span><span style='color:#0000e6; '>= </span><span style='color:#0000e6; '>$1</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1353:                 <span style='color:#800080; '>}</span> 
1354:                 <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $alias<span style='color:#800080; '>{</span>$k<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1355:                     <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$k</span><span style='color:#0f69ff; '>\t</span><span style='color:#0000e6; '>$alias</span><span style='color:#0000e6; '>{</span><span style='color:#0000e6; '>$k</span><span style='color:#0000e6; '>}</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1356:                 <span style='color:#800080; '>}</span> 
1357:                 <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1358:                 <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"No alias for </span><span style='color:#0000e6; '>$k</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1359:                 <span style='color:#800080; '>}</span> 
1360:             <span style='color:#800080; '>}</span>
1361:             <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1362:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\|</span><span style='color:#0f69ff; '>\|</span><span style='color:#808030; '>?</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>|</span><span style='color:#808030; '>]</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
1363:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$pager <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\|</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1364:                 <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>SAVEOUT<span style='color:#808030; '>,</span><span style='color:#0000e6; '>">&amp;STDOUT"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Can't save STDOUT"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1365:                 <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>STDOUT<span style='color:#808030; '>,</span><span style='color:#0000e6; '>">&amp;OUT"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Can't redirect STDOUT"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1366:             <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1367:                 <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>SAVEOUT<span style='color:#808030; '>,</span><span style='color:#0000e6; '>">&amp;OUT"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Can't save DB::OUT"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1368:             <span style='color:#800080; '>}</span>
1369:             fix_less<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1370:             <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#808030; '>(</span>$piped<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>OUT<span style='color:#808030; '>,</span>$pager<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1371:                 <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Can't pipe output to `</span><span style='color:#0000e6; '>$pager</span><span style='color:#0000e6; '>'"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1372:                 <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$pager <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\|</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1373:                 <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>OUT<span style='color:#808030; '>,</span><span style='color:#0000e6; '>">&amp;STDOUT"</span><span style='color:#808030; '>)</span> <span style='color:#696969; '># XXX: lost message</span>
1374:                     <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Can't restore DB::OUT"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1375:                 <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>STDOUT<span style='color:#808030; '>,</span><span style='color:#0000e6; '>">&amp;SAVEOUT"</span><span style='color:#808030; '>)</span>
1376:                   <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Can't restore STDOUT"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1377:                 <span style='color:#800000; font-weight:bold; '>close</span><span style='color:#808030; '>(</span>SAVEOUT<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1378:                 <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1379:                 <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>OUT<span style='color:#808030; '>,</span><span style='color:#0000e6; '>">&amp;STDOUT"</span><span style='color:#808030; '>)</span> <span style='color:#696969; '># XXX: lost message</span>
1380:                     <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Can't restore DB::OUT"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1381:                 <span style='color:#800080; '>}</span>
1382:                 <span style='color:#800000; font-weight:bold; '>next</span> CMD<span style='color:#800080; '>;</span>
1383:             <span style='color:#800080; '>}</span>
1384:             $SIG<span style='color:#800080; '>{</span>PIPE<span style='color:#800080; '>}</span><span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span><span style='color:#bb7977; font-weight:bold; '>DB</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>catch</span> <span style='color:#800000; font-weight:bold; '>if</span> $pager <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\|</span><span style='color:#800000; '>/</span>
1385:                 <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span><span style='color:#0000e6; '>""</span> <span style='color:#808030; '>eq</span> $SIG<span style='color:#800080; '>{</span>PIPE<span style='color:#800080; '>}</span>  <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span>  <span style='color:#0000e6; '>"DEFAULT"</span> <span style='color:#808030; '>eq</span> $SIG<span style='color:#800080; '>{</span>PIPE<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1386:             $selected<span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>select</span><span style='color:#808030; '>(</span>OUT<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1387:             $|<span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1388:             <span style='color:#800000; font-weight:bold; '>select</span><span style='color:#808030; '>(</span> $selected <span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> $selected<span style='color:#808030; '>=</span> <span style='color:#0000e6; '>""</span> <span style='color:#800000; font-weight:bold; '>unless</span> $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\|</span><span style='color:#0f69ff; '>\|</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
1389:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\|</span><span style='color:#808030; '>+</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
1390:             <span style='color:#800000; font-weight:bold; '>redo</span> PIPE<span style='color:#800080; '>;</span> 
1391:             <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1392:             <span style='color:#696969; '># XXX Local variants do not work!</span>
1393:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>t</span><span style='color:#0000e6; '>\s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>DB::trace |= </span><span style='color:#008c00; '>1</span><span style='color:#0000e6; '>;</span><span style='color:#0f69ff; '>\n</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
1394:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>s</span><span style='color:#0000e6; '>\s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>DB::single = </span><span style='color:#008c00; '>1</span><span style='color:#0000e6; '>;</span><span style='color:#0f69ff; '>\n</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>$laststep <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'s'</span><span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1395:             $cmd <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>n</span><span style='color:#0000e6; '>\s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>DB::single = </span><span style='color:#008c00; '>2</span><span style='color:#0000e6; '>;</span><span style='color:#0f69ff; '>\n</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>$laststep <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'n'</span><span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1396:         <span style='color:#800080; '>}</span>        <span style='color:#696969; '># PIPE:</span>
1397:         $evalarg <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>^D = </span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>^D | </span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>DB::db_stop;</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>$cmd</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>eval</span><span style='color:#800080; '>;</span>
1398:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$onetimeDump<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1399:         $onetimeDump <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>undef</span><span style='color:#800080; '>;</span>
1400:         <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span>$term_pid <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> $$<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1401:         <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1402:         <span style='color:#800080; '>}</span>
1403:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>continue</span> <span style='color:#800080; '>{</span>        <span style='color:#696969; '># CMD:</span>
1404:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$piped<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1405:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$pager <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\|</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1406:             $? <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>  
1407:             <span style='color:#696969; '># we cannot warn here: the handle is missing --tchrist</span>
1408:             <span style='color:#800000; font-weight:bold; '>close</span><span style='color:#808030; '>(</span>OUT<span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#800000; font-weight:bold; '>print</span> SAVEOUT <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>Can't close DB::OUT</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1409: 
1410:             <span style='color:#696969; '># most of the $? crud was coping with broken cshisms</span>
1411:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$?<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1412:             <span style='color:#800000; font-weight:bold; '>print</span> SAVEOUT <span style='color:#0000e6; '>"Pager `</span><span style='color:#0000e6; '>$pager</span><span style='color:#0000e6; '>' failed: "</span><span style='color:#800080; '>;</span>
1413:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$? <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1414:                 <span style='color:#800000; font-weight:bold; '>print</span> SAVEOUT <span style='color:#0000e6; '>"shell returned -</span><span style='color:#008c00; '>1</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1415:             <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span>$? <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1416:                 <span style='color:#800000; font-weight:bold; '>print</span> SAVEOUT 
1417:                   <span style='color:#808030; '>(</span> $? <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>127</span> <span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>" (SIG#"</span><span style='color:#808030; '>.</span><span style='color:#808030; '>(</span>$?<span style='color:#808030; '>&amp;</span><span style='color:#008c00; '>127</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span><span style='color:#0000e6; '>")"</span> <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span> 
1418:                   <span style='color:#808030; '>(</span> $? <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>128</span> <span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>" -- core dumped"</span> <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1419:             <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1420:                 <span style='color:#800000; font-weight:bold; '>print</span> SAVEOUT <span style='color:#0000e6; '>"status "</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>(</span>$? <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1421:             <span style='color:#800080; '>}</span> 
1422:             <span style='color:#800080; '>}</span> 
1423: 
1424:             <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>OUT<span style='color:#808030; '>,</span><span style='color:#0000e6; '>">&amp;STDOUT"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Can't restore DB::OUT"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1425:             <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>STDOUT<span style='color:#808030; '>,</span><span style='color:#0000e6; '>">&amp;SAVEOUT"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Can't restore STDOUT"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1426:             $SIG<span style='color:#800080; '>{</span>PIPE<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"DEFAULT"</span> <span style='color:#800000; font-weight:bold; '>if</span> $SIG<span style='color:#800080; '>{</span>PIPE<span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span><span style='color:#bb7977; font-weight:bold; '>DB</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>catch</span><span style='color:#800080; '>;</span>
1427:             <span style='color:#696969; '># Will stop ignoring SIGPIPE if done like nohup(1)</span>
1428:             <span style='color:#696969; '># does SIGINT but Perl doesn't give us a choice.</span>
1429:         <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1430:             <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>OUT<span style='color:#808030; '>,</span><span style='color:#0000e6; '>">&amp;SAVEOUT"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Can't restore DB::OUT"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1431:         <span style='color:#800080; '>}</span>
1432:         <span style='color:#800000; font-weight:bold; '>close</span><span style='color:#808030; '>(</span>SAVEOUT<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1433:         <span style='color:#800000; font-weight:bold; '>select</span><span style='color:#808030; '>(</span>$selected<span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> $selected<span style='color:#808030; '>=</span> <span style='color:#0000e6; '>""</span> <span style='color:#800000; font-weight:bold; '>unless</span> $selected <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>""</span><span style='color:#800080; '>;</span>
1434:         $piped<span style='color:#808030; '>=</span> <span style='color:#0000e6; '>""</span><span style='color:#800080; '>;</span>
1435:         <span style='color:#800080; '>}</span>
1436:     <span style='color:#800080; '>}</span>            <span style='color:#696969; '># CMD:</span>
1437:        $fall_off_end <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>defined</span> $cmd<span style='color:#800080; '>;</span> <span style='color:#696969; '># Emulate `q' on EOF</span>
1438:     <span style='color:#800000; font-weight:bold; '>foreach</span> $evalarg <span style='color:#808030; '>(</span>@$post<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1439:       <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>eval</span><span style='color:#800080; '>;</span>
1440:     <span style='color:#800080; '>}</span>
1441:     <span style='color:#800080; '>}</span>                <span style='color:#696969; '># if ($single || $signal)</span>
1442:     <span style='color:#808030; '>(</span>$@<span style='color:#808030; '>,</span> $!<span style='color:#808030; '>,</span> $^E<span style='color:#808030; '>,</span> $,<span style='color:#808030; '>,</span> $/<span style='color:#808030; '>,</span> $\<span style='color:#808030; '>,</span> $^W<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> @saved<span style='color:#800080; '>;</span>
1443:     <span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1444: <span style='color:#800080; '>}</span>
1445: 
1446: <span style='color:#696969; '># The following code may be executed now:</span>
1447: <span style='color:#696969; '># BEGIN {warn 4}</span>
1448: 
1449: <span style='color:#800000; font-weight:bold; '>sub </span><span style='color:#800000; font-weight:bold; '>sub</span> <span style='color:#800080; '>{</span>
1450:     <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$al<span style='color:#808030; '>,</span> $ret<span style='color:#808030; '>,</span> @ret<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>""</span><span style='color:#800080; '>;</span>
1451:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>length</span><span style='color:#808030; '>(</span>$sub<span style='color:#808030; '>)</span> <span style='color:#808030; '>></span> <span style='color:#008c00; '>10</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>substr</span><span style='color:#808030; '>(</span>$sub<span style='color:#808030; '>,</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>10</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>10</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'::AUTOLOAD'</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1452:     $al <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>" for </span><span style='color:#0000e6; '>$$sub</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1453:     <span style='color:#800080; '>}</span>
1454:     <span style='color:#800000; font-weight:bold; '>local</span> $stack_depth <span style='color:#808030; '>=</span> $stack_depth <span style='color:#808030; '>+</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span> <span style='color:#696969; '># Protect from non-local exits</span>
1455:     $#stack <span style='color:#808030; '>=</span> $stack_depth<span style='color:#800080; '>;</span>
1456:     $stack<span style='color:#808030; '>[</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> $single<span style='color:#800080; '>;</span>
1457:     $single <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1458:     $single <span style='color:#808030; '>|</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>4</span> <span style='color:#800000; font-weight:bold; '>if</span> $stack_depth <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> $deep<span style='color:#800080; '>;</span>
1459:     <span style='color:#808030; '>(</span>$frame <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>4</span> 
1460:      <span style='color:#808030; '>?</span> <span style='color:#808030; '>(</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>print</span> $LINEINFO <span style='color:#0000e6; '>' '</span> <span style='color:#800000; font-weight:bold; '>x</span> <span style='color:#808030; '>(</span>$stack_depth <span style='color:#808030; '>-</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"in  "</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> 
1461:      <span style='color:#696969; '># Why -1? But it works! :-(</span>
1462:      print_trace<span style='color:#808030; '>(</span>$LINEINFO<span style='color:#808030; '>,</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$sub</span><span style='color:#0000e6; '>$al</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span>
1463:      <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>print</span> $LINEINFO <span style='color:#0000e6; '>' '</span> <span style='color:#800000; font-weight:bold; '>x</span> <span style='color:#808030; '>(</span>$stack_depth <span style='color:#808030; '>-</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"entering </span><span style='color:#0000e6; '>$sub</span><span style='color:#0000e6; '>$al</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>if</span> $frame<span style='color:#800080; '>;</span>
1464:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>wantarray</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1465:     @ret <span style='color:#808030; '>=</span> <span style='color:#808030; '>&amp;</span>$sub<span style='color:#800080; '>;</span>
1466:     $single <span style='color:#808030; '>|</span><span style='color:#808030; '>=</span> $stack<span style='color:#808030; '>[</span>$stack_depth<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
1467:     <span style='color:#808030; '>(</span>$frame <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>4</span> 
1468:      <span style='color:#808030; '>?</span> <span style='color:#808030; '>(</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>print</span> $LINEINFO <span style='color:#0000e6; '>' '</span> <span style='color:#800000; font-weight:bold; '>x</span> $stack_depth<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"out "</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> 
1469:          print_trace<span style='color:#808030; '>(</span>$LINEINFO<span style='color:#808030; '>,</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$sub</span><span style='color:#0000e6; '>$al</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span>
1470:      <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>print</span> $LINEINFO <span style='color:#0000e6; '>' '</span> <span style='color:#800000; font-weight:bold; '>x</span> $stack_depth<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"exited </span><span style='color:#0000e6; '>$sub</span><span style='color:#0000e6; '>$al</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>if</span> $frame <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>2</span><span style='color:#800080; '>;</span>
1471:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$doret <span style='color:#808030; '>eq</span> $stack_depth <span style='color:#808030; '>or</span> $frame <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>16</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1472:             <span style='color:#800000; font-weight:bold; '>my</span> $fh <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$doret <span style='color:#808030; '>eq</span> $stack_depth <span style='color:#808030; '>?</span> $OUT <span style='color:#808030; '>:</span> $LINEINFO<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1473:         <span style='color:#800000; font-weight:bold; '>print</span> $fh <span style='color:#0000e6; '>' '</span> <span style='color:#800000; font-weight:bold; '>x</span> $stack_depth <span style='color:#800000; font-weight:bold; '>if</span> $frame <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>16</span><span style='color:#800080; '>;</span>
1474:         <span style='color:#800000; font-weight:bold; '>print</span> $fh <span style='color:#0000e6; '>"list context return from </span><span style='color:#0000e6; '>$sub</span><span style='color:#0000e6; '>:</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span> 
1475:         dumpit<span style='color:#808030; '>(</span>$fh<span style='color:#808030; '>,</span> <span style='color:#808030; '>\</span>@ret <span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1476:         $doret <span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>2</span><span style='color:#800080; '>;</span>
1477:     <span style='color:#800080; '>}</span>
1478:     @ret<span style='color:#800080; '>;</span>
1479:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1480:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> <span style='color:#800000; font-weight:bold; '>wantarray</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1481:         $ret <span style='color:#808030; '>=</span> <span style='color:#808030; '>&amp;</span>$sub<span style='color:#800080; '>;</span>
1482:         <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1483:             <span style='color:#808030; '>&amp;</span>$sub<span style='color:#800080; '>;</span> <span style='color:#800000; font-weight:bold; '>undef</span> $ret<span style='color:#800080; '>;</span>
1484:         <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1485:     $single <span style='color:#808030; '>|</span><span style='color:#808030; '>=</span> $stack<span style='color:#808030; '>[</span>$stack_depth<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
1486:     <span style='color:#808030; '>(</span>$frame <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>4</span> 
1487:      <span style='color:#808030; '>?</span> <span style='color:#808030; '>(</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>print</span> $LINEINFO <span style='color:#0000e6; '>' '</span> <span style='color:#800000; font-weight:bold; '>x</span> $stack_depth<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"out "</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> 
1488:           print_trace<span style='color:#808030; '>(</span>$LINEINFO<span style='color:#808030; '>,</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$sub</span><span style='color:#0000e6; '>$al</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span>
1489:      <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>print</span> $LINEINFO <span style='color:#0000e6; '>' '</span> <span style='color:#800000; font-weight:bold; '>x</span> $stack_depth<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"exited </span><span style='color:#0000e6; '>$sub</span><span style='color:#0000e6; '>$al</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>if</span> $frame <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>2</span><span style='color:#800080; '>;</span>
1490:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$doret <span style='color:#808030; '>eq</span> $stack_depth <span style='color:#808030; '>or</span> $frame <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>16</span> <span style='color:#808030; '>and</span> <span style='color:#800000; font-weight:bold; '>defined</span> <span style='color:#800000; font-weight:bold; '>wantarray</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1491:             <span style='color:#800000; font-weight:bold; '>my</span> $fh <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$doret <span style='color:#808030; '>eq</span> $stack_depth <span style='color:#808030; '>?</span> $OUT <span style='color:#808030; '>:</span> $LINEINFO<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1492:         <span style='color:#800000; font-weight:bold; '>print</span> $fh <span style='color:#808030; '>(</span><span style='color:#0000e6; '>' '</span> <span style='color:#800000; font-weight:bold; '>x</span> $stack_depth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>if</span> $frame <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>16</span><span style='color:#800080; '>;</span>
1493:         <span style='color:#800000; font-weight:bold; '>print</span> $fh <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> <span style='color:#800000; font-weight:bold; '>wantarray</span> 
1494:              <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>"scalar context return from </span><span style='color:#0000e6; '>$sub</span><span style='color:#0000e6; '>: "</span> 
1495:              <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>"void context return from </span><span style='color:#0000e6; '>$sub</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1496:         dumpit<span style='color:#808030; '>(</span> $fh<span style='color:#808030; '>,</span> $ret <span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>defined</span> <span style='color:#800000; font-weight:bold; '>wantarray</span><span style='color:#800080; '>;</span>
1497:         $doret <span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>2</span><span style='color:#800080; '>;</span>
1498:     <span style='color:#800080; '>}</span>
1499:     $ret<span style='color:#800080; '>;</span>
1500:     <span style='color:#800080; '>}</span>
1501: <span style='color:#800080; '>}</span>
1502: 
1503: <span style='color:#800000; font-weight:bold; '>sub </span>save <span style='color:#800080; '>{</span>
1504:     @saved <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$@<span style='color:#808030; '>,</span> $!<span style='color:#808030; '>,</span> $^E<span style='color:#808030; '>,</span> $,<span style='color:#808030; '>,</span> $/<span style='color:#808030; '>,</span> $\<span style='color:#808030; '>,</span> $^W<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1505:     $, <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>""</span><span style='color:#800080; '>;</span> $/ <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span> $\ <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>""</span><span style='color:#800080; '>;</span> $^W <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1506: <span style='color:#800080; '>}</span>
1507: 
1508: <span style='color:#696969; '># The following takes its argument via $evalarg to preserve current @_</span>
1509: 
1510: <span style='color:#800000; font-weight:bold; '>sub </span><span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span>
1511:     <span style='color:#696969; '># 'my' would make it visible from user code</span>
1512:     <span style='color:#696969; '>#    but so does local! --tchrist  </span>
1513:     <span style='color:#800000; font-weight:bold; '>local</span> @res<span style='color:#800080; '>;</span>            
1514:     <span style='color:#800080; '>{</span>
1515:     <span style='color:#800000; font-weight:bold; '>local</span> $otrace <span style='color:#808030; '>=</span> $trace<span style='color:#800080; '>;</span>
1516:     <span style='color:#800000; font-weight:bold; '>local</span> $osingle <span style='color:#808030; '>=</span> $single<span style='color:#800080; '>;</span>
1517:     <span style='color:#800000; font-weight:bold; '>local</span> $od <span style='color:#808030; '>=</span> $^D<span style='color:#800080; '>;</span>
1518:     <span style='color:#800080; '>{</span> <span style='color:#808030; '>(</span>$evalarg<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> $evalarg <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span>
1519:     @res <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$usercontext</span><span style='color:#0000e6; '> </span><span style='color:#0000e6; '>$evalarg</span><span style='color:#0000e6; '>;</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span> <span style='color:#696969; '># '\n' for nice recursive debug</span>
1520:     $trace <span style='color:#808030; '>=</span> $otrace<span style='color:#800080; '>;</span>
1521:     $single <span style='color:#808030; '>=</span> $osingle<span style='color:#800080; '>;</span>
1522:     $^D <span style='color:#808030; '>=</span> $od<span style='color:#800080; '>;</span>
1523:     <span style='color:#800080; '>}</span>
1524:     <span style='color:#800000; font-weight:bold; '>my</span> $at <span style='color:#808030; '>=</span> $@<span style='color:#800080; '>;</span>
1525:     <span style='color:#800000; font-weight:bold; '>local</span> $saved<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>        <span style='color:#696969; '># Preserve the old value of $@</span>
1526:     <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#808030; '>&amp;</span><span style='color:#bb7977; font-weight:bold; '>DB</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>save</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1527:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$at<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1528:     <span style='color:#800000; font-weight:bold; '>print</span> $OUT $at<span style='color:#800080; '>;</span>
1529:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span>$onetimeDump <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'dump'</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1530:     dumpit<span style='color:#808030; '>(</span>$OUT<span style='color:#808030; '>,</span> <span style='color:#808030; '>\</span>@res<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1531:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span>$onetimeDump <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'methods'</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1532:     methods<span style='color:#808030; '>(</span>$res<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1533:     <span style='color:#800080; '>}</span>
1534:     @res<span style='color:#800080; '>;</span>
1535: <span style='color:#800080; '>}</span>
1536: 
1537: <span style='color:#800000; font-weight:bold; '>sub </span>postponed_sub <span style='color:#800080; '>{</span>
1538:   <span style='color:#800000; font-weight:bold; '>my</span> $subname <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
1539:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$postponed<span style='color:#800080; '>{</span>$subname<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>break</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>+-</span><span style='color:#808030; '>]</span><span style='color:#808030; '>?</span><span style='color:#0000e6; '>\d</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#0000e6; '>if</span><span style='color:#0000e6; '>\s</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1540:     <span style='color:#800000; font-weight:bold; '>my</span> $offset <span style='color:#808030; '>=</span> $1 <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1541:     <span style='color:#696969; '># Filename below can contain ':'</span>
1542:     <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$file<span style='color:#808030; '>,</span>$i<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>find_sub<span style='color:#808030; '>(</span>$subname<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>:</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\d</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>-</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1543:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$i<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1544:       $i <span style='color:#808030; '>+</span><span style='color:#808030; '>=</span> $offset<span style='color:#800080; '>;</span>
1545:       <span style='color:#800000; font-weight:bold; '>local</span> *dbline <span style='color:#808030; '>=</span> $main<span style='color:#808030; '>:</span><span style='color:#808030; '>:</span><span style='color:#800080; '>{</span><span style='color:#0000e6; '>'_&lt;'</span> <span style='color:#808030; '>.</span> $file<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1546:       <span style='color:#800000; font-weight:bold; '>local</span> $^W <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>        <span style='color:#696969; '># != 0 is magical below</span>
1547:       $had_breakpoints<span style='color:#800080; '>{</span>$file<span style='color:#800080; '>}</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1548:       <span style='color:#800000; font-weight:bold; '>my</span> $max <span style='color:#808030; '>=</span> $#dbline<span style='color:#800080; '>;</span>
1549:       <span style='color:#808030; '>+</span><span style='color:#808030; '>+</span>$i <span style='color:#800000; font-weight:bold; '>until</span> $dbline<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span> <span style='color:#808030; '>!</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>or</span> $i <span style='color:#808030; '>></span><span style='color:#808030; '>=</span> $max<span style='color:#800080; '>;</span>
1550:       $dbline<span style='color:#800080; '>{</span>$i<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>delete</span> $postponed<span style='color:#800080; '>{</span>$subname<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1551:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1552:       <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Subroutine </span><span style='color:#0000e6; '>$subname</span><span style='color:#0000e6; '> not found.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1553:     <span style='color:#800080; '>}</span>
1554:     <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
1555:   <span style='color:#800080; '>}</span>
1556:   <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span>$postponed<span style='color:#800080; '>{</span>$subname<span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'compile'</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> $signal <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#800080; '>}</span>
1557:   <span style='color:#696969; '>#print $OUT "In postponed_sub for `$subname'.\n";</span>
1558: <span style='color:#800080; '>}</span>
1559: 
1560: <span style='color:#800000; font-weight:bold; '>sub </span>postponed <span style='color:#800080; '>{</span>
1561:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$ImmediateStop<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1562:     $ImmediateStop <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1563:     $signal <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1564:   <span style='color:#800080; '>}</span>
1565:   <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#808030; '>&amp;</span>postponed_sub
1566:     <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>ref</span> <span style='color:#808030; '>\</span>$_<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'GLOB'</span><span style='color:#800080; '>;</span> <span style='color:#696969; '># A subroutine is compiled.</span>
1567:   <span style='color:#696969; '># Cannot be done before the file is compiled</span>
1568:   <span style='color:#800000; font-weight:bold; '>local</span> *dbline <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
1569:   <span style='color:#800000; font-weight:bold; '>my</span> $filename <span style='color:#808030; '>=</span> $dbline<span style='color:#800080; '>;</span>
1570:   $filename <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>_&lt;</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
1571:   $signal <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"'</span><span style='color:#0000e6; '>$filename</span><span style='color:#0000e6; '>' loaded...</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
1572:     <span style='color:#800000; font-weight:bold; '>if</span> $break_on_load<span style='color:#800080; '>{</span>$filename<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1573:   <span style='color:#800000; font-weight:bold; '>print</span> $LINEINFO <span style='color:#0000e6; '>' '</span> <span style='color:#800000; font-weight:bold; '>x</span> $stack_depth<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"Package </span><span style='color:#0000e6; '>$filename</span><span style='color:#0000e6; '>.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800000; font-weight:bold; '>if</span> $frame<span style='color:#800080; '>;</span>
1574:   <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#800000; font-weight:bold; '>unless</span> $postponed_file<span style='color:#800080; '>{</span>$filename<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1575:   $had_breakpoints<span style='color:#800080; '>{</span>$filename<span style='color:#800080; '>}</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1576:   <span style='color:#696969; '>#%dbline = %{$postponed_file{$filename}}; # Cannot be done: unsufficient magic</span>
1577:   <span style='color:#800000; font-weight:bold; '>my</span> $key<span style='color:#800080; '>;</span>
1578:   <span style='color:#800000; font-weight:bold; '>for</span> $key <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>keys</span> %{$postponed_file<span style='color:#800080; '>{</span>$filename<span style='color:#800080; '>}</span>}<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1579:     $dbline<span style='color:#800080; '>{</span>$key<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> ${$postponed_file<span style='color:#800080; '>{</span>$filename<span style='color:#800080; '>}</span>}<span style='color:#800080; '>{</span>$key<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1580:   <span style='color:#800080; '>}</span>
1581:   <span style='color:#800000; font-weight:bold; '>delete</span> $postponed_file<span style='color:#800080; '>{</span>$filename<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1582: <span style='color:#800080; '>}</span>
1583: 
1584: <span style='color:#800000; font-weight:bold; '>sub </span>dumpit <span style='color:#800080; '>{</span>
1585:     <span style='color:#800000; font-weight:bold; '>local</span> <span style='color:#808030; '>(</span>$savout<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>select</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1586:     <span style='color:#800000; font-weight:bold; '>my</span> $osingle <span style='color:#808030; '>=</span> $single<span style='color:#800080; '>;</span>
1587:     <span style='color:#800000; font-weight:bold; '>my</span> $otrace <span style='color:#808030; '>=</span> $trace<span style='color:#800080; '>;</span>
1588:     $single <span style='color:#808030; '>=</span> $trace <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1589:     <span style='color:#800000; font-weight:bold; '>local</span> $frame <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1590:     <span style='color:#800000; font-weight:bold; '>local</span> $doret <span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>2</span><span style='color:#800080; '>;</span>
1591:     <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> <span style='color:#808030; '>&amp;</span><span style='color:#bb7977; font-weight:bold; '>main</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>dumpValue</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1592:     <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#0000e6; '>'dumpvar.pl'</span><span style='color:#800080; '>;</span>
1593:     <span style='color:#800080; '>}</span>
1594:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> <span style='color:#808030; '>&amp;</span><span style='color:#bb7977; font-weight:bold; '>main</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>dumpValue</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1595:     <span style='color:#808030; '>&amp;</span><span style='color:#bb7977; font-weight:bold; '>main</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>dumpValue</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1596:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1597:     <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"dumpvar.pl not available.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1598:     <span style='color:#800080; '>}</span>
1599:     $single <span style='color:#808030; '>=</span> $osingle<span style='color:#800080; '>;</span>
1600:     $trace <span style='color:#808030; '>=</span> $otrace<span style='color:#800080; '>;</span>
1601:     <span style='color:#800000; font-weight:bold; '>select</span> <span style='color:#808030; '>(</span>$savout<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>    
1602: <span style='color:#800080; '>}</span>
1603: 
1604: <span style='color:#696969; '># Tied method do not create a context, so may get wrong message:</span>
1605: 
1606: <span style='color:#800000; font-weight:bold; '>sub </span>print_trace <span style='color:#800080; '>{</span>
1607:   <span style='color:#800000; font-weight:bold; '>my</span> $fh <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
1608:   <span style='color:#800000; font-weight:bold; '>my</span> @sub <span style='color:#808030; '>=</span> dump_trace<span style='color:#808030; '>(</span>$_<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>+</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> $_<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1609:   <span style='color:#800000; font-weight:bold; '>my</span> $short <span style='color:#808030; '>=</span> $_<span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>        <span style='color:#696969; '># Print short report, next one for sub name</span>
1610:   <span style='color:#800000; font-weight:bold; '>my</span> $s<span style='color:#800080; '>;</span>
1611:   <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span>$i<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> $i <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> $#sub<span style='color:#800080; '>;</span> $i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1612:     <span style='color:#800000; font-weight:bold; '>last</span> <span style='color:#800000; font-weight:bold; '>if</span> $signal<span style='color:#800080; '>;</span>
1613:     <span style='color:#800000; font-weight:bold; '>local</span> $" <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>', '</span><span style='color:#800080; '>;</span>
1614:     <span style='color:#800000; font-weight:bold; '>my</span> $args <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>defined</span> $sub<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span><span style='color:#800080; '>{</span>args<span style='color:#800080; '>}</span> 
1615:     <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>"(</span><span style='color:#0000e6; '>@{ $sub[$i]{args}</span><span style='color:#0000e6; '> })"</span>
1616:       <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>''</span> <span style='color:#800080; '>;</span>
1617:     $args <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>substr</span> $args<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> $maxtrace <span style='color:#808030; '>-</span> <span style='color:#008c00; '>3</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>'...'</span> 
1618:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>length</span> $args <span style='color:#808030; '>></span> $maxtrace<span style='color:#800080; '>;</span>
1619:     <span style='color:#800000; font-weight:bold; '>my</span> $file <span style='color:#808030; '>=</span> $sub<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span><span style='color:#800080; '>{</span>file<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1620:     $file <span style='color:#808030; '>=</span> $file <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'-e'</span> <span style='color:#808030; '>?</span> $file <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>"file `</span><span style='color:#0000e6; '>$file</span><span style='color:#0000e6; '>'"</span> <span style='color:#800000; font-weight:bold; '>unless</span> $short<span style='color:#800080; '>;</span>
1621:     $s <span style='color:#808030; '>=</span> $sub<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span><span style='color:#800080; '>{</span><span style='color:#800000; font-weight:bold; '>sub</span><span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1622:     $s <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>substr</span> $s<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> $maxtrace <span style='color:#808030; '>-</span> <span style='color:#008c00; '>3</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>'...'</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>length</span> $s <span style='color:#808030; '>></span> $maxtrace<span style='color:#800080; '>;</span>    
1623:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$short<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1624:       <span style='color:#800000; font-weight:bold; '>my</span> $sub <span style='color:#808030; '>=</span> @_ <span style='color:#808030; '>></span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>4</span> <span style='color:#808030; '>?</span> $_<span style='color:#808030; '>[</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>:</span> $s<span style='color:#800080; '>;</span>
1625:       <span style='color:#800000; font-weight:bold; '>print</span> $fh <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$sub</span><span style='color:#0000e6; '>[</span><span style='color:#0000e6; '>$i</span><span style='color:#0000e6; '>]{context}=</span><span style='color:#0000e6; '>$sub</span><span style='color:#0000e6; '>$args</span><span style='color:#0000e6; '> from </span><span style='color:#0000e6; '>$file</span><span style='color:#0000e6; '>:</span><span style='color:#0000e6; '>$sub</span><span style='color:#0000e6; '>[</span><span style='color:#0000e6; '>$i</span><span style='color:#0000e6; '>]{line}</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1626:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1627:       <span style='color:#800000; font-weight:bold; '>print</span> $fh <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$sub</span><span style='color:#0000e6; '>[</span><span style='color:#0000e6; '>$i</span><span style='color:#0000e6; '>]{context} = </span><span style='color:#0000e6; '>$s</span><span style='color:#0000e6; '>$args</span><span style='color:#0000e6; '>"</span> <span style='color:#808030; '>.</span>
1628:     <span style='color:#0000e6; '>" called from </span><span style='color:#0000e6; '>$file</span><span style='color:#0000e6; '>"</span> <span style='color:#808030; '>.</span> 
1629:       <span style='color:#0000e6; '>" line </span><span style='color:#0000e6; '>$sub</span><span style='color:#0000e6; '>[</span><span style='color:#0000e6; '>$i</span><span style='color:#0000e6; '>]{line}</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1630:     <span style='color:#800080; '>}</span>
1631:   <span style='color:#800080; '>}</span>
1632: <span style='color:#800080; '>}</span>
1633: 
1634: <span style='color:#800000; font-weight:bold; '>sub </span>dump_trace <span style='color:#800080; '>{</span>
1635:   <span style='color:#800000; font-weight:bold; '>my</span> $skip <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
1636:   <span style='color:#800000; font-weight:bold; '>my</span> $count <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#008c00; '>1e9</span><span style='color:#800080; '>;</span>
1637:   $skip<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
1638:   $count <span style='color:#808030; '>+</span><span style='color:#808030; '>=</span> $skip<span style='color:#800080; '>;</span>
1639:   <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$p<span style='color:#808030; '>,</span>$file<span style='color:#808030; '>,</span>$line<span style='color:#808030; '>,</span>$sub<span style='color:#808030; '>,</span>$h<span style='color:#808030; '>,</span>$args<span style='color:#808030; '>,</span>$e<span style='color:#808030; '>,</span>$r<span style='color:#808030; '>,</span>@a<span style='color:#808030; '>,</span>@sub<span style='color:#808030; '>,</span>$context<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1640:   <span style='color:#800000; font-weight:bold; '>my</span> $nothard <span style='color:#808030; '>=</span> <span style='color:#808030; '>not</span> $frame <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>8</span><span style='color:#800080; '>;</span>
1641:   <span style='color:#800000; font-weight:bold; '>local</span> $frame <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>        <span style='color:#696969; '># Do not want to trace this.</span>
1642:   <span style='color:#800000; font-weight:bold; '>my</span> $otrace <span style='color:#808030; '>=</span> $trace<span style='color:#800080; '>;</span>
1643:   $trace <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1644:   <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span>$i <span style='color:#808030; '>=</span> $skip<span style='color:#800080; '>;</span> 
1645:        $i <span style='color:#808030; '>&lt;</span> $count <span style='color:#808030; '>and</span> <span style='color:#808030; '>(</span>$p<span style='color:#808030; '>,</span>$file<span style='color:#808030; '>,</span>$line<span style='color:#808030; '>,</span>$sub<span style='color:#808030; '>,</span>$h<span style='color:#808030; '>,</span>$context<span style='color:#808030; '>,</span>$e<span style='color:#808030; '>,</span>$r<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>caller</span><span style='color:#808030; '>(</span>$i<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span> 
1646:        $i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1647:     @a <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1648:     <span style='color:#800000; font-weight:bold; '>for</span> $arg <span style='color:#808030; '>(</span>@args<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1649:       <span style='color:#800000; font-weight:bold; '>my</span> $type<span style='color:#800080; '>;</span>
1650:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>not</span> <span style='color:#800000; font-weight:bold; '>defined</span> $arg<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1651:     <span style='color:#800000; font-weight:bold; '>push</span> @a<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"undef"</span><span style='color:#800080; '>;</span>
1652:       <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span>$nothard <span style='color:#808030; '>and</span> <span style='color:#800000; font-weight:bold; '>tied</span> $arg<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1653:     <span style='color:#800000; font-weight:bold; '>push</span> @a<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"tied"</span><span style='color:#800080; '>;</span>
1654:       <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span>$nothard <span style='color:#808030; '>and</span> $type <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>ref</span> $arg<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1655:     <span style='color:#800000; font-weight:bold; '>push</span> @a<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"ref(</span><span style='color:#0000e6; '>$type</span><span style='color:#0000e6; '>)"</span><span style='color:#800080; '>;</span>
1656:       <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1657:     <span style='color:#800000; font-weight:bold; '>local</span> $_ <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$arg</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>    <span style='color:#696969; '># Safe to stringify now - should not call f().</span>
1658:     <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#0f69ff; '>\'</span><span style='color:#0f69ff; '>\\</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\\</span><span style='color:#0000e6; '>$1</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>g</span><span style='color:#800080; '>;</span>
1659:     <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>'</span><span style='color:#0000e6; '>$1</span><span style='color:#0000e6; '>'</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>s</span>
1660:       <span style='color:#808030; '>unless</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>?</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#0000e6; '> -</span><span style='color:#808030; '>?</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>\d</span><span style='color:#0000e6; '>.</span><span style='color:#808030; '>]</span><span style='color:#808030; '>+</span><span style='color:#0000e6; '> </span><span style='color:#800080; '>|</span><span style='color:#0000e6; '> </span><span style='color:#0f69ff; '>\*</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>\w</span><span style='color:#0000e6; '>:</span><span style='color:#808030; '>]</span><span style='color:#808030; '>*</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>)</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>x</span><span style='color:#800080; '>;</span>
1661:     <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#0f69ff; '>\200</span><span style='color:#808030; '>-</span><span style='color:#0f69ff; '>\377</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>sprintf("M-%c",ord(</span><span style='color:#0000e6; '>$1</span><span style='color:#0000e6; '>)&amp;</span><span style='color:#008c00; '>0177</span><span style='color:#0000e6; '>)</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>eg</span><span style='color:#800080; '>;</span>
1662:     <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#0f69ff; '>\0</span><span style='color:#808030; '>-</span><span style='color:#bb7977; font-weight:bold; '>\37</span><span style='color:#0f69ff; '>\177</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>sprintf("^%c",ord(</span><span style='color:#0000e6; '>$1</span><span style='color:#0000e6; '>)^</span><span style='color:#008c00; '>64</span><span style='color:#0000e6; '>)</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>eg</span><span style='color:#800080; '>;</span>
1663:     <span style='color:#800000; font-weight:bold; '>push</span><span style='color:#808030; '>(</span>@a<span style='color:#808030; '>,</span> $_<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1664:       <span style='color:#800080; '>}</span>
1665:     <span style='color:#800080; '>}</span>
1666:     $context <span style='color:#808030; '>=</span> $context <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>'@'</span> <span style='color:#808030; '>:</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $context <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>"</span> <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>'.'</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1667:     $args <span style='color:#808030; '>=</span> $h <span style='color:#808030; '>?</span> <span style='color:#808030; '>[</span>@a<span style='color:#808030; '>]</span> <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>undef</span><span style='color:#800080; '>;</span>
1668:     $e <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#0f69ff; '>\;</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>*</span><span style='color:#0f69ff; '>\Z</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span> <span style='color:#800000; font-weight:bold; '>if</span> $e<span style='color:#800080; '>;</span>
1669:     $e <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#0f69ff; '>\\</span><span style='color:#0f69ff; '>\'</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\\</span><span style='color:#0000e6; '>$1</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>g</span> <span style='color:#800000; font-weight:bold; '>if</span> $e<span style='color:#800080; '>;</span>
1670:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$r<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1671:       $sub <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"require '</span><span style='color:#0000e6; '>$e</span><span style='color:#0000e6; '>'"</span><span style='color:#800080; '>;</span>
1672:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $r<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1673:       $sub <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"eval '</span><span style='color:#0000e6; '>$e</span><span style='color:#0000e6; '>'"</span><span style='color:#800080; '>;</span>
1674:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span>$sub <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'(eval)'</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1675:       $sub <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"eval {...}"</span><span style='color:#800080; '>;</span>
1676:     <span style='color:#800080; '>}</span>
1677:     <span style='color:#800000; font-weight:bold; '>push</span><span style='color:#808030; '>(</span>@sub<span style='color:#808030; '>,</span> <span style='color:#800080; '>{</span>context <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> $context<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>sub</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> $sub<span style='color:#808030; '>,</span> args <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> $args<span style='color:#808030; '>,</span>
1678:         file <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> $file<span style='color:#808030; '>,</span> line <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> $line<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1679:     <span style='color:#800000; font-weight:bold; '>last</span> <span style='color:#800000; font-weight:bold; '>if</span> $signal<span style='color:#800080; '>;</span>
1680:   <span style='color:#800080; '>}</span>
1681:   $trace <span style='color:#808030; '>=</span> $otrace<span style='color:#800080; '>;</span>
1682:   @sub<span style='color:#800080; '>;</span>
1683: <span style='color:#800080; '>}</span>
1684: 
1685: <span style='color:#800000; font-weight:bold; '>sub </span>action <span style='color:#800080; '>{</span>
1686:     <span style='color:#800000; font-weight:bold; '>my</span> $action <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
1687:     <span style='color:#800000; font-weight:bold; '>while</span> <span style='color:#808030; '>(</span>$action <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\\</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1688:     <span style='color:#696969; '>#print $OUT "+ ";</span>
1689:     <span style='color:#696969; '>#$action .= "\n";</span>
1690:     $action <span style='color:#808030; '>.</span><span style='color:#808030; '>=</span> <span style='color:#808030; '>&amp;</span>gets<span style='color:#800080; '>;</span>
1691:     <span style='color:#800080; '>}</span>
1692:     $action<span style='color:#800080; '>;</span>
1693: <span style='color:#800080; '>}</span>
1694: 
1695: <span style='color:#800000; font-weight:bold; '>sub </span>unbalanced <span style='color:#800080; '>{</span> 
1696:     <span style='color:#696969; '># i hate using globals!</span>
1697:     $balanced_brace_re <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span><span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>qr</span><span style='color:#800000; '>{</span><span style='color:#0000e6; '> </span>
1698: <span style='color:#0000e6; '>    </span><span style='color:#808030; '>^</span><span style='color:#0000e6; '> </span><span style='color:#0f69ff; '>\{</span><span style='color:#0000e6; '></span>
1699: <span style='color:#0000e6; '>          </span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>?</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#0000e6; '></span>
1700: <span style='color:#0000e6; '>         </span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>?></span><span style='color:#0000e6; '> </span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>{}</span><span style='color:#808030; '>]</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>+</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>)</span><span style='color:#696969; '>            # Non-parens without backtracking</span><span style='color:#0000e6; '></span>
1701: <span style='color:#0000e6; '>           </span><span style='color:#800080; '>|</span><span style='color:#0000e6; '></span>
1702: <span style='color:#0000e6; '>         </span><span style='color:#808030; '>(</span><span style='color:#800000; background:#ffffe8; '>??{</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$balanced_brace_re</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#800000; background:#ffffe8; '>}</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '> # Group with matching parens</span>
1703: <span style='color:#0000e6; '>          </span><span style='color:#808030; '>)</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>*</span><span style='color:#0000e6; '></span>
1704: <span style='color:#0000e6; '>      </span><span style='color:#0f69ff; '>\}</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>$</span><span style='color:#0000e6; '></span>
1705: <span style='color:#0000e6; '>   </span><span style='color:#800000; '>}</span><span style='color:#800000; font-weight:bold; '>x</span><span style='color:#800080; '>;</span>
1706:    <span style='color:#800000; font-weight:bold; '>return</span> $_<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>!</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>m</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>$balanced_brace_re</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
1707: <span style='color:#800080; '>}</span>
1708: 
1709: <span style='color:#800000; font-weight:bold; '>sub </span>gets <span style='color:#800080; '>{</span>
1710:     <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>readline</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"cont: "</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1711: <span style='color:#800080; '>}</span>
1712: 
1713: <span style='color:#800000; font-weight:bold; '>sub </span><span style='color:#800000; font-weight:bold; '>system</span> <span style='color:#800080; '>{</span>
1714:     <span style='color:#696969; '># We save, change, then restore STDIN and STDOUT to avoid fork() since</span>
1715:     <span style='color:#696969; '># some non-Unix systems can do system() but have problems with fork().</span>
1716:     <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>SAVEIN<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"&lt;&amp;STDIN"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Can't save STDIN"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1717:     <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>SAVEOUT<span style='color:#808030; '>,</span><span style='color:#0000e6; '>">&amp;STDOUT"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Can't save STDOUT"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1718:     <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>STDIN<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"&lt;&amp;IN"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Can't redirect STDIN"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1719:     <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>STDOUT<span style='color:#808030; '>,</span><span style='color:#0000e6; '>">&amp;OUT"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Can't redirect STDOUT"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1720: 
1721:     <span style='color:#696969; '># XXX: using csh or tcsh destroys sigint retvals!</span>
1722:     <span style='color:#800000; font-weight:bold; '>system</span><span style='color:#808030; '>(</span>@_<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1723:     <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>STDIN<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"&lt;&amp;SAVEIN"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Can't restore STDIN"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1724:     <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>STDOUT<span style='color:#808030; '>,</span><span style='color:#0000e6; '>">&amp;SAVEOUT"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Can't restore STDOUT"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1725:     <span style='color:#800000; font-weight:bold; '>close</span><span style='color:#808030; '>(</span>SAVEIN<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span> 
1726:     <span style='color:#800000; font-weight:bold; '>close</span><span style='color:#808030; '>(</span>SAVEOUT<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1727: 
1728: 
1729:     <span style='color:#696969; '># most of the $? crud was coping with broken cshisms</span>
1730:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$? <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1731:     <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"(Command exited "</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>(</span>$? <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>")</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1732:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span>$?<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> 
1733:     <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span> <span style='color:#0000e6; '>"(Command died of SIG#"</span><span style='color:#808030; '>,</span>  <span style='color:#808030; '>(</span>$? <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>127</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>
1734:         <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>$? <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>128</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>" -- core dumped"</span> <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>""</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>,</span> <span style='color:#0000e6; '>")"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1735:     <span style='color:#800080; '>}</span> 
1736: 
1737:     <span style='color:#800000; font-weight:bold; '>return</span> $?<span style='color:#800080; '>;</span>
1738: 
1739: <span style='color:#800080; '>}</span>
1740: 
1741: <span style='color:#800000; font-weight:bold; '>sub </span>setterm <span style='color:#800080; '>{</span>
1742:     <span style='color:#800000; font-weight:bold; '>local</span> $frame <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1743:     <span style='color:#800000; font-weight:bold; '>local</span> $doret <span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>2</span><span style='color:#800080; '>;</span>
1744:     <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>require</span> <span style='color:#bb7977; font-weight:bold; '>Term::ReadLine</span> <span style='color:#800080; '>}</span> <span style='color:#808030; '>or</span> <span style='color:#800000; font-weight:bold; '>die</span> $@<span style='color:#800080; '>;</span>
1745:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$notty<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1746:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$tty<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1747:         <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>IN<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"&lt;</span><span style='color:#0000e6; '>$tty</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>or</span> <span style='color:#800000; font-weight:bold; '>die</span> <span style='color:#0000e6; '>"Cannot open TTY `</span><span style='color:#0000e6; '>$TTY</span><span style='color:#0000e6; '>' for read: $!"</span><span style='color:#800080; '>;</span>
1748:         <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>OUT<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"></span><span style='color:#0000e6; '>$tty</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>or</span> <span style='color:#800000; font-weight:bold; '>die</span> <span style='color:#0000e6; '>"Cannot open TTY `</span><span style='color:#0000e6; '>$TTY</span><span style='color:#0000e6; '>' for write: $!"</span><span style='color:#800080; '>;</span>
1749:         $IN <span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span>*IN<span style='color:#800080; '>;</span>
1750:         $OUT <span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span>*OUT<span style='color:#800080; '>;</span>
1751:         <span style='color:#800000; font-weight:bold; '>my</span> $sel <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>select</span><span style='color:#808030; '>(</span>$OUT<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1752:         $| <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1753:         <span style='color:#800000; font-weight:bold; '>select</span><span style='color:#808030; '>(</span>$sel<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1754:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1755:         <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#0000e6; '>"require Term::Rendezvous;"</span> <span style='color:#808030; '>or</span> <span style='color:#800000; font-weight:bold; '>die</span><span style='color:#800080; '>;</span>
1756:         <span style='color:#800000; font-weight:bold; '>my</span> $rv <span style='color:#808030; '>=</span> $ENV<span style='color:#800080; '>{</span>PERLDB_NOTTY<span style='color:#800080; '>}</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#0000e6; '>"/tmp/perldbtty$$"</span><span style='color:#800080; '>;</span>
1757:         <span style='color:#800000; font-weight:bold; '>my</span> $term_rv <span style='color:#808030; '>=</span> new <span style='color:#bb7977; font-weight:bold; '>Term</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>Rendezvous</span> $rv<span style='color:#800080; '>;</span>
1758:         $IN <span style='color:#808030; '>=</span> $term_rv<span style='color:#808030; '>-></span>IN<span style='color:#800080; '>;</span>
1759:         $OUT <span style='color:#808030; '>=</span> $term_rv<span style='color:#808030; '>-></span>OUT<span style='color:#800080; '>;</span>
1760:     <span style='color:#800080; '>}</span>
1761:     <span style='color:#800080; '>}</span>
1762:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>$rl<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1763:     $term <span style='color:#808030; '>=</span> new <span style='color:#bb7977; font-weight:bold; '>Term::ReadLine</span><span style='color:#808030; '>:</span><span style='color:#808030; '>:</span>Stub <span style='color:#0000e6; '>'perldb'</span><span style='color:#808030; '>,</span> $IN<span style='color:#808030; '>,</span> $OUT<span style='color:#800080; '>;</span>
1764:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1765:     $term <span style='color:#808030; '>=</span> new <span style='color:#bb7977; font-weight:bold; '>Term::ReadLine</span> <span style='color:#0000e6; '>'perldb'</span><span style='color:#808030; '>,</span> $IN<span style='color:#808030; '>,</span> $OUT<span style='color:#800080; '>;</span>
1766: 
1767:     $rl_attribs <span style='color:#808030; '>=</span> $term<span style='color:#808030; '>-></span>Attribs<span style='color:#800080; '>;</span>
1768:     $rl_attribs<span style='color:#808030; '>-></span><span style='color:#800080; '>{</span>basic_word_break_characters<span style='color:#800080; '>}</span> <span style='color:#808030; '>.</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'-:+/*,[])}'</span> 
1769:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>defined</span> $rl_attribs<span style='color:#808030; '>-></span><span style='color:#800080; '>{</span>basic_word_break_characters<span style='color:#800080; '>}</span> 
1770:         <span style='color:#808030; '>and</span> <span style='color:#800000; font-weight:bold; '>index</span><span style='color:#808030; '>(</span>$rl_attribs<span style='color:#808030; '>-></span><span style='color:#800080; '>{</span>basic_word_break_characters<span style='color:#800080; '>}</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>":"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1771:     $rl_attribs<span style='color:#808030; '>-></span><span style='color:#800080; '>{</span>special_prefixes<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'$@&amp;%'</span><span style='color:#800080; '>;</span>
1772:     $rl_attribs<span style='color:#808030; '>-></span><span style='color:#800080; '>{</span>completer_word_break_characters<span style='color:#800080; '>}</span> <span style='color:#808030; '>.</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'$@&amp;%'</span><span style='color:#800080; '>;</span>
1773:     $rl_attribs<span style='color:#808030; '>-></span><span style='color:#800080; '>{</span>completion_function<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span>db_complete<span style='color:#800080; '>;</span> 
1774:     <span style='color:#800080; '>}</span>
1775:     $LINEINFO <span style='color:#808030; '>=</span> $OUT <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>defined</span> $LINEINFO<span style='color:#800080; '>;</span>
1776:     $lineinfo <span style='color:#808030; '>=</span> $console <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>defined</span> $lineinfo<span style='color:#800080; '>;</span>
1777:     $term<span style='color:#808030; '>-></span>MinLine<span style='color:#808030; '>(</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1778:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$term<span style='color:#808030; '>-></span>Features<span style='color:#808030; '>-></span><span style='color:#800080; '>{</span>setHistory<span style='color:#800080; '>}</span> <span style='color:#808030; '>and</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>@hist</span><span style='color:#0000e6; '>"</span> <span style='color:#808030; '>ne</span> <span style='color:#0000e6; '>"?"</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1779:       $term<span style='color:#808030; '>-></span>SetHistory<span style='color:#808030; '>(</span>@hist<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1780:     <span style='color:#800080; '>}</span>
1781:     ornaments<span style='color:#808030; '>(</span>$ornaments<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>defined</span> $ornaments<span style='color:#800080; '>;</span>
1782:     $term_pid <span style='color:#808030; '>=</span> $$;
1783: <span style='color:#800080; '>}</span>
1784: 
1785: <span style='color:#800000; font-weight:bold; '>sub </span>resetterm <span style='color:#800080; '>{</span>            <span style='color:#696969; '># We forked, so we need a different TTY</span>
1786:     $term_pid <span style='color:#808030; '>=</span> $$;
1787:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> <span style='color:#808030; '>&amp;</span>get_fork_TTY<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1788:       <span style='color:#808030; '>&amp;</span>get_fork_TTY<span style='color:#800080; '>;</span>
1789:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>not</span> <span style='color:#800000; font-weight:bold; '>defined</span> $fork_TTY 
1790:          <span style='color:#808030; '>and</span> <span style='color:#800000; font-weight:bold; '>defined</span> $ENV<span style='color:#800080; '>{</span>TERM<span style='color:#800080; '>}</span> <span style='color:#808030; '>and</span> $ENV<span style='color:#800080; '>{</span>TERM<span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'xterm'</span> 
1791:          <span style='color:#808030; '>and</span> <span style='color:#800000; font-weight:bold; '>defined</span> $ENV<span style='color:#800080; '>{</span>WINDOWID<span style='color:#800080; '>}</span> <span style='color:#808030; '>and</span> <span style='color:#800000; font-weight:bold; '>defined</span> $ENV<span style='color:#800080; '>{</span>DISPLAY<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> 
1792:         <span style='color:#696969; '># Possibly _inside_ XTERM</span>
1793:         <span style='color:#800000; font-weight:bold; '>open</span> XT<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>q</span><span style='color:#800000; '>[</span><span style='color:#0000e6; '>3>&amp;1 xterm -title 'Forked Perl debugger' -e sh -c 'tty 1>&amp;3;\</span>
1794: <span style='color:#0000e6; '> sleep 10000000' |</span><span style='color:#800000; '>]</span><span style='color:#800080; '>;</span>
1795:         $fork_TTY <span style='color:#808030; '>=</span> <span style='color:#40015a; '>&lt;XT></span><span style='color:#800080; '>;</span>
1796:         <span style='color:#800000; font-weight:bold; '>chomp</span> $fork_TTY<span style='color:#800080; '>;</span>
1797:     <span style='color:#800080; '>}</span>
1798:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $fork_TTY<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1799:       TTY<span style='color:#808030; '>(</span>$fork_TTY<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1800:       <span style='color:#800000; font-weight:bold; '>undef</span> $fork_TTY<span style='color:#800080; '>;</span>
1801:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1802:       print_help<span style='color:#808030; '>(</span><span style='color:#800000; '>&lt;&lt;</span><span style='color:#e34adc; '>EOP</span><span style='color:#0000e6; '>);</span>
1803: <span style='color:#0000e6; '>I&lt;#########> Forked, but do not know how to change a B&lt;TTY>. I&lt;#########></span>
1804: <span style='color:#0000e6; '>  Define B&lt;</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>DB::fork_TTY> </span>
1805: <span style='color:#0000e6; '>       - or a function B&lt;DB::get_fork_TTY()> which will set B&lt;</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>DB::fork_TTY>.</span>
1806: <span style='color:#0000e6; '>  The value of B&lt;</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>DB::fork_TTY> should be the name of I&lt;TTY> to use.</span>
1807: <span style='color:#0000e6; '>  On I&lt;UNIX>-like systems one can get the name of a I&lt;TTY> for the given window</span>
1808: <span style='color:#0000e6; '>  by typing B&lt;tty>, and disconnect the I&lt;shell> from I&lt;TTY> by B&lt;sleep </span><span style='color:#008c00; '>1000000</span><span style='color:#0000e6; '>>.</span>
1809: <span style='color:#e34adc; '>EOP</span>
1810:     <span style='color:#800080; '>}</span>
1811: <span style='color:#800080; '>}</span>
1812: 
1813: <span style='color:#800000; font-weight:bold; '>sub </span><span style='color:#800000; font-weight:bold; '>readline</span> <span style='color:#800080; '>{</span>
1814:   <span style='color:#800000; font-weight:bold; '>local</span> $.<span style='color:#800080; '>;</span>
1815:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>@typeahead<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1816:     <span style='color:#800000; font-weight:bold; '>my</span> $left <span style='color:#808030; '>=</span> @typeahead<span style='color:#800080; '>;</span>
1817:     <span style='color:#800000; font-weight:bold; '>my</span> $got <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span> @typeahead<span style='color:#800080; '>;</span>
1818:     <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"auto(-</span><span style='color:#0000e6; '>$left</span><span style='color:#0000e6; '>)"</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#808030; '>,</span> $got<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1819:     $term<span style='color:#808030; '>-></span>AddHistory<span style='color:#808030; '>(</span>$got<span style='color:#808030; '>)</span> 
1820:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>length</span><span style='color:#808030; '>(</span>$got<span style='color:#808030; '>)</span> <span style='color:#808030; '>></span> <span style='color:#008c00; '>1</span> <span style='color:#808030; '>and</span> <span style='color:#800000; font-weight:bold; '>defined</span> $term<span style='color:#808030; '>-></span>Features<span style='color:#808030; '>-></span><span style='color:#800080; '>{</span>addHistory<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1821:     <span style='color:#800000; font-weight:bold; '>return</span> $got<span style='color:#800080; '>;</span>
1822:   <span style='color:#800080; '>}</span>
1823:   <span style='color:#800000; font-weight:bold; '>local</span> $frame <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1824:   <span style='color:#800000; font-weight:bold; '>local</span> $doret <span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>2</span><span style='color:#800080; '>;</span>
1825:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>ref</span> $OUT <span style='color:#808030; '>and</span> <span style='color:#800000; font-weight:bold; '>UNIVERSAL</span><span style='color:#808030; '>:</span><span style='color:#808030; '>:</span>isa<span style='color:#808030; '>(</span>$OUT<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'IO::Socket::INET'</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1826:     $OUT<span style='color:#808030; '>-></span><span style='color:#800000; font-weight:bold; '>write</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>join</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> @_<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1827:     <span style='color:#800000; font-weight:bold; '>my</span> $stuff<span style='color:#800080; '>;</span>
1828:     $IN<span style='color:#808030; '>-></span><span style='color:#800000; font-weight:bold; '>recv</span><span style='color:#808030; '>(</span> $stuff<span style='color:#808030; '>,</span> <span style='color:#008c00; '>2048</span> <span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>  <span style='color:#696969; '># XXX: what's wrong with sysread?</span>
1829:     $stuff<span style='color:#800080; '>;</span>
1830:   <span style='color:#800080; '>}</span>
1831:   <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1832:     $term<span style='color:#808030; '>-></span><span style='color:#800000; font-weight:bold; '>readline</span><span style='color:#808030; '>(</span>@_<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1833:   <span style='color:#800080; '>}</span>
1834: <span style='color:#800080; '>}</span>
1835: 
1836: <span style='color:#800000; font-weight:bold; '>sub </span>dump_option <span style='color:#800080; '>{</span>
1837:     <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$opt<span style='color:#808030; '>,</span> $val<span style='color:#808030; '>)</span><span style='color:#808030; '>=</span> @_<span style='color:#800080; '>;</span>
1838:     $val <span style='color:#808030; '>=</span> option_val<span style='color:#808030; '>(</span>$opt<span style='color:#808030; '>,</span><span style='color:#0000e6; '>'N/A'</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1839:     $val <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#0f69ff; '>\\</span><span style='color:#0f69ff; '>\'</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\\</span><span style='color:#0000e6; '>$1</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>g</span><span style='color:#800080; '>;</span>
1840:     <span style='color:#800000; font-weight:bold; '>printf</span> $OUT <span style='color:#0000e6; '>"</span><span style='color:#007997; '>%20s</span><span style='color:#0000e6; '> = '</span><span style='color:#007997; '>%s</span><span style='color:#0000e6; '>'</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>,</span> $opt<span style='color:#808030; '>,</span> $val<span style='color:#800080; '>;</span>
1841: <span style='color:#800080; '>}</span>
1842: 
1843: <span style='color:#800000; font-weight:bold; '>sub </span>option_val <span style='color:#800080; '>{</span>
1844:     <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$opt<span style='color:#808030; '>,</span> $default<span style='color:#808030; '>)</span><span style='color:#808030; '>=</span> @_<span style='color:#800080; '>;</span>
1845:     <span style='color:#800000; font-weight:bold; '>my</span> $val<span style='color:#800080; '>;</span>
1846:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $optionVars<span style='color:#800080; '>{</span>$opt<span style='color:#800080; '>}</span>
1847:     <span style='color:#808030; '>and</span> <span style='color:#800000; font-weight:bold; '>defined</span> ${$optionVars<span style='color:#800080; '>{</span>$opt<span style='color:#800080; '>}</span>}<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1848:     $val <span style='color:#808030; '>=</span> ${$optionVars<span style='color:#800080; '>{</span>$opt<span style='color:#800080; '>}</span>}<span style='color:#800080; '>;</span>
1849:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $optionAction<span style='color:#800080; '>{</span>$opt<span style='color:#800080; '>}</span>
1850:     <span style='color:#808030; '>and</span> <span style='color:#800000; font-weight:bold; '>defined</span> <span style='color:#808030; '>&amp;</span><span style='color:#800080; '>{</span>$optionAction<span style='color:#800080; '>{</span>$opt<span style='color:#800080; '>}</span><span style='color:#800080; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1851:     $val <span style='color:#808030; '>=</span> <span style='color:#808030; '>&amp;</span><span style='color:#800080; '>{</span>$optionAction<span style='color:#800080; '>{</span>$opt<span style='color:#800080; '>}</span><span style='color:#800080; '>}</span><span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1852:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $optionAction<span style='color:#800080; '>{</span>$opt<span style='color:#800080; '>}</span>
1853:          <span style='color:#808030; '>and</span> <span style='color:#808030; '>not</span> <span style='color:#800000; font-weight:bold; '>defined</span> $option<span style='color:#800080; '>{</span>$opt<span style='color:#800080; '>}</span>
1854:          <span style='color:#808030; '>or</span> <span style='color:#800000; font-weight:bold; '>defined</span> $optionVars<span style='color:#800080; '>{</span>$opt<span style='color:#800080; '>}</span>
1855:          <span style='color:#808030; '>and</span> <span style='color:#808030; '>not</span> <span style='color:#800000; font-weight:bold; '>defined</span> ${$optionVars<span style='color:#800080; '>{</span>$opt<span style='color:#800080; '>}</span>}<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1856:     $val <span style='color:#808030; '>=</span> $default<span style='color:#800080; '>;</span>
1857:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1858:     $val <span style='color:#808030; '>=</span> $option<span style='color:#800080; '>{</span>$opt<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1859:     <span style='color:#800080; '>}</span>
1860:     $val
1861: <span style='color:#800080; '>}</span>
1862: 
1863: <span style='color:#800000; font-weight:bold; '>sub </span>parse_options <span style='color:#800080; '>{</span>
1864:     <span style='color:#800000; font-weight:bold; '>local</span><span style='color:#808030; '>(</span>$_<span style='color:#808030; '>)</span><span style='color:#808030; '>=</span> @_<span style='color:#800080; '>;</span>
1865:     <span style='color:#696969; '># too dangerous to let intuitive usage overwrite important things</span>
1866:     <span style='color:#696969; '># defaultion should never be the default</span>
1867:     <span style='color:#800000; font-weight:bold; '>my</span> %opt_needs_val <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>map</span> <span style='color:#800080; '>{</span> <span style='color:#808030; '>(</span> $_ <span style='color:#808030; '>=</span><span style='color:#808030; '>></span> <span style='color:#008c00; '>1</span> <span style='color:#808030; '>)</span> <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>qw</span><span style='color:#800000; '>{</span><span style='color:#0000e6; '></span>
1868: <span style='color:#0000e6; '>        arrayDepth hashDepth LineInfo maxTraceLen ornaments</span>
1869: <span style='color:#0000e6; '>        pager quote ReadLine recallCommand RemotePort ShellBang TTY</span>
1870: <span style='color:#0000e6; '>    </span><span style='color:#800000; '>}</span><span style='color:#800080; '>;</span>
1871:     <span style='color:#800000; font-weight:bold; '>while</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>length</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1872:     <span style='color:#800000; font-weight:bold; '>my</span> $val_defaulted<span style='color:#800080; '>;</span>
1873:     <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#800000; font-weight:bold; '>next</span><span style='color:#800080; '>;</span>
1874:     <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\w</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\W</span><span style='color:#808030; '>?</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>or</span> <span style='color:#800000; font-weight:bold; '>print</span><span style='color:#808030; '>(</span>$OUT <span style='color:#0000e6; '>"Invalid option `</span><span style='color:#0000e6; '>$_</span><span style='color:#0000e6; '>'</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>last</span><span style='color:#800080; '>;</span>
1875:     <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$opt<span style='color:#808030; '>,</span>$sep<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$1<span style='color:#808030; '>,</span>$2<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1876:     <span style='color:#800000; font-weight:bold; '>my</span> $val<span style='color:#800080; '>;</span>
1877:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#0000e6; '>"?"</span> <span style='color:#808030; '>eq</span> $sep<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1878:         <span style='color:#800000; font-weight:bold; '>print</span><span style='color:#808030; '>(</span>$OUT <span style='color:#0000e6; '>"Option query `</span><span style='color:#0000e6; '>$opt</span><span style='color:#0000e6; '>?' followed by non-space `</span><span style='color:#0000e6; '>$_</span><span style='color:#0000e6; '>'</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>last</span>
1879:           <span style='color:#808030; '>if</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>\S</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
1880:         <span style='color:#696969; '>#&amp;dump_option($opt);</span>
1881:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span>$sep <span style='color:#808030; '>!~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>\S</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1882:         $val_defaulted <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1883:         $val <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#008c00; '>1</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>  <span style='color:#696969; '>#  this is an evil default; make 'em set it!</span>
1884:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span>$sep <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>"="</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1885: 
1886:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>"'</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>(</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>?</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#0000e6; '> </span><span style='color:#0f69ff; '>\\</span><span style='color:#808030; '>.</span><span style='color:#0000e6; '> </span><span style='color:#800080; '>|</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>?!</span><span style='color:#0000e6; '> </span><span style='color:#bb7977; font-weight:bold; '>\1</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>)</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\\</span><span style='color:#808030; '>]</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>)</span><span style='color:#808030; '>*</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>)</span><span style='color:#0000e6; '> </span><span style='color:#bb7977; font-weight:bold; '>\1</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>x</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> 
1887:                 <span style='color:#800000; font-weight:bold; '>my</span> $quote <span style='color:#808030; '>=</span> $1<span style='color:#800080; '>;</span>
1888:                 <span style='color:#808030; '>(</span>$val <span style='color:#808030; '>=</span> $2<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\\</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>$quote</span><span style='color:#0f69ff; '>\\</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>$1</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>g</span><span style='color:#800080; '>;</span>
1889:         <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span> 
1890:         <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\S</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
1891:         $val <span style='color:#808030; '>=</span> $1<span style='color:#800080; '>;</span>
1892:         <span style='color:#800000; font-weight:bold; '>print</span> OUT <span style='color:#800000; font-weight:bold; '>qq</span><span style='color:#800000; '>(</span><span style='color:#0000e6; '>Option better cleared using </span><span style='color:#0000e6; '>$opt</span><span style='color:#0000e6; '>=""</span><span style='color:#0f69ff; '>\n</span><span style='color:#800000; '>)</span>
1893:             <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>length</span> $val<span style='color:#800080; '>;</span>
1894:         <span style='color:#800080; '>}</span>
1895: 
1896:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span> <span style='color:#696969; '>#{ to "let some poor schmuck bounce on the % key in B&lt;vi>."</span>
1897:         <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$end<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\\</span><span style='color:#0000e6; '>"</span> <span style='color:#808030; '>.</span> <span style='color:#800000; font-weight:bold; '>substr</span><span style='color:#808030; '>(</span> <span style='color:#0000e6; '>")]>}</span><span style='color:#0000e6; '>$sep</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>index</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"([&lt;{"</span><span style='color:#808030; '>,</span>$sep<span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span> <span style='color:#808030; '>)</span><span style='color:#800080; '>;</span> <span style='color:#696969; '>#}</span>
1898:         <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\\</span><span style='color:#0000e6; '>$end</span><span style='color:#808030; '>]</span><span style='color:#800080; '>|</span><span style='color:#0f69ff; '>\\</span><span style='color:#808030; '>[</span><span style='color:#0f69ff; '>\\</span><span style='color:#0000e6; '>$end</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>$end</span><span style='color:#808030; '>(</span><span style='color:#808030; '>$</span><span style='color:#800080; '>|</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>or</span>
1899:           <span style='color:#800000; font-weight:bold; '>print</span><span style='color:#808030; '>(</span>$OUT <span style='color:#0000e6; '>"Unclosed option value `</span><span style='color:#0000e6; '>$opt</span><span style='color:#0000e6; '>$sep</span><span style='color:#0000e6; '>$_</span><span style='color:#0000e6; '>'</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>last</span><span style='color:#800080; '>;</span>
1900:         <span style='color:#808030; '>(</span>$val <span style='color:#808030; '>=</span> $1<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\\</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#0f69ff; '>\\</span><span style='color:#0000e6; '>$end</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>$1</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>g</span><span style='color:#800080; '>;</span>
1901:     <span style='color:#800080; '>}</span>
1902: 
1903:     <span style='color:#800000; font-weight:bold; '>my</span> $option<span style='color:#800080; '>;</span>
1904:     <span style='color:#800000; font-weight:bold; '>my</span> $matches <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>grep</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\Q</span><span style='color:#0000e6; '>$opt</span><span style='color:#800000; '>/</span>  <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>$option <span style='color:#808030; '>=</span> $_<span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>  @options  <span style='color:#808030; '>)</span>
1905:            <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#800000; font-weight:bold; '>grep</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\Q</span><span style='color:#0000e6; '>$opt</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>i</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>$option <span style='color:#808030; '>=</span> $_<span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>  @options  <span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1906: 
1907:     <span style='color:#800000; font-weight:bold; '>print</span><span style='color:#808030; '>(</span>$OUT <span style='color:#0000e6; '>"Unknown option `</span><span style='color:#0000e6; '>$opt</span><span style='color:#0000e6; '>'</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>next</span>     <span style='color:#800000; font-weight:bold; '>unless</span> $matches<span style='color:#800080; '>;</span>
1908:     <span style='color:#800000; font-weight:bold; '>print</span><span style='color:#808030; '>(</span>$OUT <span style='color:#0000e6; '>"Ambiguous option `</span><span style='color:#0000e6; '>$opt</span><span style='color:#0000e6; '>'</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>next</span>     <span style='color:#800000; font-weight:bold; '>if</span> $matches <span style='color:#808030; '>></span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1909: 
1910:        <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$opt_needs_val<span style='color:#800080; '>{</span>$option<span style='color:#800080; '>}</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> $val_defaulted<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1911:         <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Option `</span><span style='color:#0000e6; '>$opt</span><span style='color:#0000e6; '>' is non-boolean.  Use `O </span><span style='color:#0000e6; '>$option</span><span style='color:#0000e6; '>=VAL' to set, `O </span><span style='color:#0000e6; '>$option</span><span style='color:#0000e6; '>?' to query</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
1912:         <span style='color:#800000; font-weight:bold; '>next</span><span style='color:#800080; '>;</span>
1913:     <span style='color:#800080; '>}</span> 
1914: 
1915:     $option<span style='color:#800080; '>{</span>$option<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> $val <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>defined</span> $val<span style='color:#800080; '>;</span>
1916: 
1917:     <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800000; font-weight:bold; '>qq</span><span style='color:#800000; '>{</span><span style='color:#0000e6; '></span>
1918: <span style='color:#0000e6; '>        local </span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>frame = </span><span style='color:#008c00; '>0</span><span style='color:#0000e6; '>; </span>
1919: <span style='color:#0000e6; '>        local </span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>doret = -</span><span style='color:#008c00; '>2</span><span style='color:#0000e6; '>; </span>
1920: <span style='color:#0000e6; '>            require '</span><span style='color:#0000e6; '>$optionRequire</span><span style='color:#0000e6; '>{</span><span style='color:#0000e6; '>$option</span><span style='color:#0000e6; '>}';</span>
1921: <span style='color:#0000e6; '>        </span><span style='color:#008c00; '>1</span><span style='color:#0000e6; '>;</span>
1922: <span style='color:#0000e6; '>     </span><span style='color:#800000; '>}</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#800000; font-weight:bold; '>die</span>  <span style='color:#696969; '># XXX: shouldn't happen</span>
1923:         <span style='color:#800000; font-weight:bold; '>if</span>  <span style='color:#800000; font-weight:bold; '>defined</span> $optionRequire<span style='color:#800080; '>{</span>$option<span style='color:#800080; '>}</span>        <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span>
1924:             <span style='color:#800000; font-weight:bold; '>defined</span> $val<span style='color:#800080; '>;</span>
1925: 
1926:     ${$optionVars<span style='color:#800080; '>{</span>$option<span style='color:#800080; '>}</span>} <span style='color:#808030; '>=</span> $val         
1927:         <span style='color:#800000; font-weight:bold; '>if</span>  <span style='color:#800000; font-weight:bold; '>defined</span> $optionVars<span style='color:#800080; '>{</span>$option<span style='color:#800080; '>}</span>        <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span>
1928:         <span style='color:#800000; font-weight:bold; '>defined</span> $val<span style='color:#800080; '>;</span>
1929: 
1930:     <span style='color:#808030; '>&amp;</span><span style='color:#800080; '>{</span>$optionAction<span style='color:#800080; '>{</span>$option<span style='color:#800080; '>}</span><span style='color:#800080; '>}</span> <span style='color:#808030; '>(</span>$val<span style='color:#808030; '>)</span>    
1931:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>defined</span> $optionAction<span style='color:#800080; '>{</span>$option<span style='color:#800080; '>}</span>        <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span>
1932:                <span style='color:#800000; font-weight:bold; '>defined</span> <span style='color:#808030; '>&amp;</span><span style='color:#800080; '>{</span>$optionAction<span style='color:#800080; '>{</span>$option<span style='color:#800080; '>}</span><span style='color:#800080; '>}</span>    <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span>
1933:                <span style='color:#800000; font-weight:bold; '>defined</span> $val<span style='color:#800080; '>;</span>
1934: 
1935:     <span style='color:#696969; '># Not $rcfile</span>
1936:     dump_option<span style='color:#808030; '>(</span>$option<span style='color:#808030; '>)</span>     <span style='color:#800000; font-weight:bold; '>unless</span> $OUT <span style='color:#808030; '>eq</span> <span style='color:#808030; '>\</span>*STDERR<span style='color:#800080; '>;</span> 
1937:     <span style='color:#800080; '>}</span>
1938: <span style='color:#800080; '>}</span>
1939: 
1940: <span style='color:#800000; font-weight:bold; '>sub </span>set_list <span style='color:#800080; '>{</span>
1941:   <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$stem<span style='color:#808030; '>,</span>@list<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> @_<span style='color:#800080; '>;</span>
1942:   <span style='color:#800000; font-weight:bold; '>my</span> $val<span style='color:#800080; '>;</span>
1943:   $ENV<span style='color:#800080; '>{</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>${stem}</span><span style='color:#0000e6; '>_n"</span><span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> @list<span style='color:#800080; '>;</span>
1944:   <span style='color:#800000; font-weight:bold; '>for</span> $i <span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span> <span style='color:#808030; '>..</span> $#list<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1945:     $val <span style='color:#808030; '>=</span> $list<span style='color:#808030; '>[</span>$i<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
1946:     $val <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\\</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\\</span><span style='color:#0f69ff; '>\\</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>g</span><span style='color:#800080; '>;</span>
1947:     $val <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#0f69ff; '>\0</span><span style='color:#808030; '>-</span><span style='color:#bb7977; font-weight:bold; '>\37</span><span style='color:#0f69ff; '>\177</span><span style='color:#0f69ff; '>\200</span><span style='color:#808030; '>-</span><span style='color:#0f69ff; '>\377</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\\</span><span style='color:#0000e6; '>0x" . unpack('H2',</span><span style='color:#0000e6; '>$1</span><span style='color:#0000e6; '>)</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>eg</span><span style='color:#800080; '>;</span>
1948:     $ENV<span style='color:#800080; '>{</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>${stem}</span><span style='color:#0000e6; '>_</span><span style='color:#0000e6; '>$i</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> $val<span style='color:#800080; '>;</span>
1949:   <span style='color:#800080; '>}</span>
1950: <span style='color:#800080; '>}</span>
1951: 
1952: <span style='color:#800000; font-weight:bold; '>sub </span>get_list <span style='color:#800080; '>{</span>
1953:   <span style='color:#800000; font-weight:bold; '>my</span> $stem <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
1954:   <span style='color:#800000; font-weight:bold; '>my</span> @list<span style='color:#800080; '>;</span>
1955:   <span style='color:#800000; font-weight:bold; '>my</span> $n <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>delete</span> $ENV<span style='color:#800080; '>{</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>${stem}</span><span style='color:#0000e6; '>_n"</span><span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1956:   <span style='color:#800000; font-weight:bold; '>my</span> $val<span style='color:#800080; '>;</span>
1957:   <span style='color:#800000; font-weight:bold; '>for</span> $i <span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span> <span style='color:#808030; '>..</span> $n <span style='color:#808030; '>-</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1958:     $val <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>delete</span> $ENV<span style='color:#800080; '>{</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>${stem}</span><span style='color:#0000e6; '>_</span><span style='color:#0000e6; '>$i</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1959:     $val <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\\</span><span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#0f69ff; '>\\</span><span style='color:#808030; '>)</span><span style='color:#800080; '>|</span><span style='color:#0000e6; '>0x</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>.</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '> </span><span style='color:#0000e6; '>$2</span><span style='color:#0000e6; '> ? </span><span style='color:#0000e6; '>$2</span><span style='color:#0000e6; '> : pack('H2', </span><span style='color:#0000e6; '>$3</span><span style='color:#0000e6; '>) </span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>ge</span><span style='color:#800080; '>;</span>
1960:     <span style='color:#800000; font-weight:bold; '>push</span> @list<span style='color:#808030; '>,</span> $val<span style='color:#800080; '>;</span>
1961:   <span style='color:#800080; '>}</span>
1962:   @list<span style='color:#800080; '>;</span>
1963: <span style='color:#800080; '>}</span>
1964: 
1965: <span style='color:#800000; font-weight:bold; '>sub </span>catch <span style='color:#800080; '>{</span>
1966:     $signal <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1967:     <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>            <span style='color:#696969; '># Put nothing on the stack - malloc/free land!</span>
1968: <span style='color:#800080; '>}</span>
1969: 
1970: <span style='color:#800000; font-weight:bold; '>sub </span><span style='color:#800000; font-weight:bold; '>warn</span> <span style='color:#800080; '>{</span>
1971:     <span style='color:#800000; font-weight:bold; '>my</span><span style='color:#808030; '>(</span>$msg<span style='color:#808030; '>)</span><span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>join</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span>@_<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1972:     $msg <span style='color:#808030; '>.</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>": $!</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800000; font-weight:bold; '>unless</span> $msg <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\n</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
1973:     <span style='color:#800000; font-weight:bold; '>print</span> $OUT $msg<span style='color:#800080; '>;</span>
1974: <span style='color:#800080; '>}</span>
1975: 
1976: <span style='color:#800000; font-weight:bold; '>sub </span>TTY <span style='color:#800080; '>{</span>
1977:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>@_ <span style='color:#808030; '>and</span> $term <span style='color:#808030; '>and</span> $term<span style='color:#808030; '>-></span>Features<span style='color:#808030; '>-></span><span style='color:#800080; '>{</span>newTTY<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1978:       <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$in<span style='color:#808030; '>,</span> $out<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
1979:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$in <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>,</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1980:     <span style='color:#808030; '>(</span>$in<span style='color:#808030; '>,</span> $out<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>split</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>,</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $in<span style='color:#808030; '>,</span> <span style='color:#008c00; '>2</span><span style='color:#800080; '>;</span>
1981:       <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
1982:     $out <span style='color:#808030; '>=</span> $in<span style='color:#800080; '>;</span>
1983:       <span style='color:#800080; '>}</span>
1984:       <span style='color:#800000; font-weight:bold; '>open</span> IN<span style='color:#808030; '>,</span> $in <span style='color:#808030; '>or</span> <span style='color:#800000; font-weight:bold; '>die</span> <span style='color:#0000e6; '>"cannot open `</span><span style='color:#0000e6; '>$in</span><span style='color:#0000e6; '>' for read: $!"</span><span style='color:#800080; '>;</span>
1985:       <span style='color:#800000; font-weight:bold; '>open</span> OUT<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"></span><span style='color:#0000e6; '>$out</span><span style='color:#0000e6; '>"</span> <span style='color:#808030; '>or</span> <span style='color:#800000; font-weight:bold; '>die</span> <span style='color:#0000e6; '>"cannot open `</span><span style='color:#0000e6; '>$out</span><span style='color:#0000e6; '>' for write: $!"</span><span style='color:#800080; '>;</span>
1986:       $term<span style='color:#808030; '>-></span>newTTY<span style='color:#808030; '>(</span><span style='color:#808030; '>\</span>*IN<span style='color:#808030; '>,</span> <span style='color:#808030; '>\</span>*OUT<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1987:       $IN    <span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span>*IN<span style='color:#800080; '>;</span>
1988:       $OUT    <span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span>*OUT<span style='color:#800080; '>;</span>
1989:       <span style='color:#800000; font-weight:bold; '>return</span> $tty <span style='color:#808030; '>=</span> $in<span style='color:#800080; '>;</span>
1990:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span>$term <span style='color:#808030; '>and</span> @_<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1991:     <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Too late to set TTY, enabled on next `R'!</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1992:     <span style='color:#800080; '>}</span> 
1993:     $tty <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span> <span style='color:#800000; font-weight:bold; '>if</span> @_<span style='color:#800080; '>;</span>
1994:     $tty <span style='color:#808030; '>or</span> $console<span style='color:#800080; '>;</span>
1995: <span style='color:#800080; '>}</span>
1996: 
1997: <span style='color:#800000; font-weight:bold; '>sub </span>noTTY <span style='color:#800080; '>{</span>
1998:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$term<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
1999:     <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Too late to set noTTY, enabled on next `R'!</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>if</span> @_<span style='color:#800080; '>;</span>
2000:     <span style='color:#800080; '>}</span>
2001:     $notty <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span> <span style='color:#800000; font-weight:bold; '>if</span> @_<span style='color:#800080; '>;</span>
2002:     $notty<span style='color:#800080; '>;</span>
2003: <span style='color:#800080; '>}</span>
2004: 
2005: <span style='color:#800000; font-weight:bold; '>sub </span>ReadLine <span style='color:#800080; '>{</span>
2006:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$term<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2007:     <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Too late to set ReadLine, enabled on next `R'!</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>if</span> @_<span style='color:#800080; '>;</span>
2008:     <span style='color:#800080; '>}</span>
2009:     $rl <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span> <span style='color:#800000; font-weight:bold; '>if</span> @_<span style='color:#800080; '>;</span>
2010:     $rl<span style='color:#800080; '>;</span>
2011: <span style='color:#800080; '>}</span>
2012: 
2013: <span style='color:#800000; font-weight:bold; '>sub </span>RemotePort <span style='color:#800080; '>{</span>
2014:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$term<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2015:         <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Too late to set RemotePort, enabled on next 'R'!</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>if</span> @_<span style='color:#800080; '>;</span>
2016:     <span style='color:#800080; '>}</span>
2017:     $remoteport <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span> <span style='color:#800000; font-weight:bold; '>if</span> @_<span style='color:#800080; '>;</span>
2018:     $remoteport<span style='color:#800080; '>;</span>
2019: <span style='color:#800080; '>}</span>
2020: 
2021: <span style='color:#800000; font-weight:bold; '>sub </span>tkRunning <span style='color:#800080; '>{</span>
2022:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>${$term<span style='color:#808030; '>-></span>Features}<span style='color:#800080; '>{</span>tkRunning<span style='color:#800080; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2023:         <span style='color:#800000; font-weight:bold; '>return</span> $term<span style='color:#808030; '>-></span>tkRunning<span style='color:#808030; '>(</span>@_<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2024:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
2025:     <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"tkRunning not supported by current ReadLine package.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
2026:     <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
2027:     <span style='color:#800080; '>}</span>
2028: <span style='color:#800080; '>}</span>
2029: 
2030: <span style='color:#800000; font-weight:bold; '>sub </span>NonStop <span style='color:#800080; '>{</span>
2031:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$term<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2032:     <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Too late to set up NonStop mode, enabled on next `R'!</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>if</span> @_<span style='color:#800080; '>;</span>
2033:     <span style='color:#800080; '>}</span>
2034:     $runnonstop <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span> <span style='color:#800000; font-weight:bold; '>if</span> @_<span style='color:#800080; '>;</span>
2035:     $runnonstop<span style='color:#800080; '>;</span>
2036: <span style='color:#800080; '>}</span>
2037: 
2038: <span style='color:#800000; font-weight:bold; '>sub </span>pager <span style='color:#800080; '>{</span>
2039:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>@_<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2040:     $pager <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
2041:     $pager<span style='color:#808030; '>=</span><span style='color:#0000e6; '>"|"</span><span style='color:#808030; '>.</span>$pager <span style='color:#800000; font-weight:bold; '>unless</span> $pager <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#0f69ff; '>\+</span><span style='color:#808030; '>?</span><span style='color:#0f69ff; '>\></span><span style='color:#800080; '>|</span><span style='color:#0f69ff; '>\|</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
2042:     <span style='color:#800080; '>}</span>
2043:     $pager<span style='color:#800080; '>;</span>
2044: <span style='color:#800080; '>}</span>
2045: 
2046: <span style='color:#800000; font-weight:bold; '>sub </span>shellBang <span style='color:#800080; '>{</span>
2047:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>@_<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2048:     $sh <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>quotemeta</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
2049:     $sh <span style='color:#808030; '>.</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\\</span><span style='color:#0000e6; '>b"</span> <span style='color:#800000; font-weight:bold; '>if</span> $sh <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>\w</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
2050:     <span style='color:#800080; '>}</span>
2051:     $psh <span style='color:#808030; '>=</span> $sh<span style='color:#800080; '>;</span>
2052:     $psh <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\\</span><span style='color:#0000e6; '>b</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
2053:     $psh <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\\</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>$1</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>g</span><span style='color:#800080; '>;</span>
2054:     <span style='color:#808030; '>&amp;</span>sethelp<span style='color:#800080; '>;</span>
2055:     $psh<span style='color:#800080; '>;</span>
2056: <span style='color:#800080; '>}</span>
2057: 
2058: <span style='color:#800000; font-weight:bold; '>sub </span>ornaments <span style='color:#800080; '>{</span>
2059:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $term<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2060:     <span style='color:#800000; font-weight:bold; '>local</span> <span style='color:#808030; '>(</span>$warnLevel<span style='color:#808030; '>,</span>$dieLevel<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2061:     <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#0000e6; '>''</span> <span style='color:#800000; font-weight:bold; '>unless</span> $term<span style='color:#808030; '>-></span>Features<span style='color:#808030; '>-></span><span style='color:#800080; '>{</span>ornaments<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
2062:     <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> $term<span style='color:#808030; '>-></span>ornaments<span style='color:#808030; '>(</span>@_<span style='color:#808030; '>)</span> <span style='color:#800080; '>}</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#0000e6; '>''</span><span style='color:#800080; '>;</span>
2063:   <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
2064:     $ornaments <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
2065:   <span style='color:#800080; '>}</span>
2066: <span style='color:#800080; '>}</span>
2067: 
2068: <span style='color:#800000; font-weight:bold; '>sub </span>recallCommand <span style='color:#800080; '>{</span>
2069:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>@_<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2070:     $rc <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>quotemeta</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
2071:     $rc <span style='color:#808030; '>.</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\\</span><span style='color:#0000e6; '>b"</span> <span style='color:#800000; font-weight:bold; '>if</span> $rc <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>\w</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
2072:     <span style='color:#800080; '>}</span>
2073:     $prc <span style='color:#808030; '>=</span> $rc<span style='color:#800080; '>;</span>
2074:     $prc <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\\</span><span style='color:#0000e6; '>b</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
2075:     $prc <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\\</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>$1</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>g</span><span style='color:#800080; '>;</span>
2076:     <span style='color:#808030; '>&amp;</span>sethelp<span style='color:#800080; '>;</span>
2077:     $prc<span style='color:#800080; '>;</span>
2078: <span style='color:#800080; '>}</span>
2079: 
2080: <span style='color:#800000; font-weight:bold; '>sub </span>LineInfo <span style='color:#800080; '>{</span>
2081:     <span style='color:#800000; font-weight:bold; '>return</span> $lineinfo <span style='color:#800000; font-weight:bold; '>unless</span> @_<span style='color:#800080; '>;</span>
2082:     $lineinfo <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
2083:     <span style='color:#800000; font-weight:bold; '>my</span> $stream <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$lineinfo <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#0f69ff; '>\+</span><span style='color:#808030; '>?</span><span style='color:#0f69ff; '>\></span><span style='color:#800080; '>|</span><span style='color:#0f69ff; '>\|</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> $lineinfo <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>"></span><span style='color:#0000e6; '>$lineinfo</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
2084:     $slave_editor <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$stream <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\|</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2085:     <span style='color:#800000; font-weight:bold; '>open</span><span style='color:#808030; '>(</span>LINEINFO<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$stream</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Cannot open `</span><span style='color:#0000e6; '>$stream</span><span style='color:#0000e6; '>' for write"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2086:     $LINEINFO <span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span>*LINEINFO<span style='color:#800080; '>;</span>
2087:     <span style='color:#800000; font-weight:bold; '>my</span> $save <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>select</span><span style='color:#808030; '>(</span>$LINEINFO<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2088:     $| <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
2089:     <span style='color:#800000; font-weight:bold; '>select</span><span style='color:#808030; '>(</span>$save<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2090:     $lineinfo<span style='color:#800080; '>;</span>
2091: <span style='color:#800080; '>}</span>
2092: 
2093: <span style='color:#800000; font-weight:bold; '>sub </span>list_versions <span style='color:#800080; '>{</span>
2094:   <span style='color:#800000; font-weight:bold; '>my</span> %version<span style='color:#800080; '>;</span>
2095:   <span style='color:#800000; font-weight:bold; '>my</span> $file<span style='color:#800080; '>;</span>
2096:   <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>keys</span> %INC<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2097:     $file <span style='color:#808030; '>=</span> $_<span style='color:#800080; '>;</span>
2098:     <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>,</span><span style='color:#0f69ff; '>\.</span><span style='color:#0000e6; '>p</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>lm</span><span style='color:#808030; '>]</span><span style='color:#808030; '>$</span><span style='color:#800000; '>,</span><span style='color:#800000; '>,</span><span style='color:#800000; font-weight:bold; '>i</span> <span style='color:#800080; '>;</span>
2099:     <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>,</span><span style='color:#0000e6; '>/</span><span style='color:#800000; '>,</span><span style='color:#0000e6; '>::</span><span style='color:#800000; '>,</span><span style='color:#800000; font-weight:bold; '>g</span> <span style='color:#800080; '>;</span>
2100:     <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>perl5db</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>DB</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
2101:     <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Term::ReadLine::readline</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>readline</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
2102:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> ${ $_ <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>'::VERSION'</span> }<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2103:       $version<span style='color:#800080; '>{</span>$file<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>${ $_ . '</span><span style='color:#808030; '>::</span><span style='color:#0000e6; '>VERSION' }</span><span style='color:#0000e6; '> from "</span><span style='color:#800080; '>;</span>
2104:     <span style='color:#800080; '>}</span> 
2105:     $version<span style='color:#800080; '>{</span>$file<span style='color:#800080; '>}</span> <span style='color:#808030; '>.</span><span style='color:#808030; '>=</span> $INC<span style='color:#800080; '>{</span>$file<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
2106:   <span style='color:#800080; '>}</span>
2107:   dumpit<span style='color:#808030; '>(</span>$OUT<span style='color:#808030; '>,</span><span style='color:#808030; '>\</span>%version<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2108: <span style='color:#800080; '>}</span>
2109: 
2110: <span style='color:#800000; font-weight:bold; '>sub </span>sethelp <span style='color:#800080; '>{</span>
2111:     <span style='color:#696969; '># XXX: make sure these are tabs between the command and explantion,</span>
2112:     <span style='color:#696969; '>#      or print_help will screw up your formatting if you have</span>
2113:     <span style='color:#696969; '>#      eeevil ornaments enabled.  This is an insane mess.</span>
2114: 
2115:     $help <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span>
2116: <span style='color:#0000e6; '>B&lt;T>        Stack trace.</span>
2117: <span style='color:#0000e6; '>B&lt;s> [I&lt;expr>]    Single step [in I&lt;expr>].</span>
2118: <span style='color:#0000e6; '>B&lt;n> [I&lt;expr>]    Next, steps over subroutine calls [in I&lt;expr>].</span>
2119: <span style='color:#0000e6; '>&lt;B&lt;CR>>        Repeat last B&lt;n> or B&lt;s> command.</span>
2120: <span style='color:#0000e6; '>B&lt;r>        Return from current subroutine.</span>
2121: <span style='color:#0000e6; '>B&lt;c> [I&lt;line>|I&lt;sub>]    Continue; optionally inserts a one-time-only breakpoint</span>
2122: <span style='color:#0000e6; '>        at the specified position.</span>
2123: <span style='color:#0000e6; '>B&lt;l> I&lt;min>B&lt;+>I&lt;incr>    List I&lt;incr>+</span><span style='color:#008c00; '>1</span><span style='color:#0000e6; '> lines starting at I&lt;min>.</span>
2124: <span style='color:#0000e6; '>B&lt;l> I&lt;min>B&lt;->I&lt;max>    List lines I&lt;min> through I&lt;max>.</span>
2125: <span style='color:#0000e6; '>B&lt;l> I&lt;line>        List single I&lt;line>.</span>
2126: <span style='color:#0000e6; '>B&lt;l> I&lt;subname>    List first window of lines from subroutine.</span>
2127: <span style='color:#0000e6; '>B&lt;l> I&lt;</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>var>        List first window of lines from subroutine referenced by I&lt;</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>var>.</span>
2128: <span style='color:#0000e6; '>B&lt;l>        List next window of lines.</span>
2129: <span style='color:#0000e6; '>B&lt;->        List previous window of lines.</span>
2130: <span style='color:#0000e6; '>B&lt;w> [I&lt;line>]    List window around I&lt;line>.</span>
2131: <span style='color:#0000e6; '>B&lt;.>        Return to the executed line.</span>
2132: <span style='color:#0000e6; '>B&lt;f> I&lt;filename>    Switch to viewing I&lt;filename>. File must be already loaded.</span>
2133: <span style='color:#0000e6; '>        I&lt;filename> may be either the full name of the file, or a regular</span>
2134: <span style='color:#0000e6; '>        expression matching the full file name:</span>
2135: <span style='color:#0000e6; '>        B&lt;f> I&lt;/home/me/foo.pl> and B&lt;f> I&lt;oo</span><span style='color:#0f69ff; '>\\</span><span style='color:#0000e6; '>.> may access the same file.</span>
2136: <span style='color:#0000e6; '>        Evals (with saved bodies) are considered to be filenames:</span>
2137: <span style='color:#0000e6; '>        B&lt;f> I&lt;(eval </span><span style='color:#008c00; '>7</span><span style='color:#0000e6; '>)> and B&lt;f> I&lt;eval </span><span style='color:#008c00; '>7</span><span style='color:#0f69ff; '>\\</span><span style='color:#0000e6; '>b> access the body of the 7th eval</span>
2138: <span style='color:#0000e6; '>        (in the order of execution).</span>
2139: <span style='color:#0000e6; '>B&lt;/>I&lt;pattern>B&lt;/>    Search forwards for I&lt;pattern>; final B&lt;/> is optional.</span>
2140: <span style='color:#0000e6; '>B&lt;?>I&lt;pattern>B&lt;?>    Search backwards for I&lt;pattern>; final B&lt;?> is optional.</span>
2141: <span style='color:#0000e6; '>B&lt;L>        List all breakpoints and actions.</span>
2142: <span style='color:#0000e6; '>B&lt;S> [[B&lt;!>]I&lt;pattern>]    List subroutine names [not] matching I&lt;pattern>.</span>
2143: <span style='color:#0000e6; '>B&lt;t>        Toggle trace mode.</span>
2144: <span style='color:#0000e6; '>B&lt;t> I&lt;expr>        Trace through execution of I&lt;expr>.</span>
2145: <span style='color:#0000e6; '>B&lt;b> [I&lt;line>] [I&lt;condition>]</span>
2146: <span style='color:#0000e6; '>        Set breakpoint; I&lt;line> defaults to the current execution line;</span>
2147: <span style='color:#0000e6; '>        I&lt;condition> breaks if it evaluates to true, defaults to '</span><span style='color:#008c00; '>1</span><span style='color:#0000e6; '>'.</span>
2148: <span style='color:#0000e6; '>B&lt;b> I&lt;subname> [I&lt;condition>]</span>
2149: <span style='color:#0000e6; '>        Set breakpoint at first line of subroutine.</span>
2150: <span style='color:#0000e6; '>B&lt;b> I&lt;</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>var>        Set breakpoint at first line of subroutine referenced by I&lt;</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>var>.</span>
2151: <span style='color:#0000e6; '>B&lt;b> B&lt;load> I&lt;filename> Set breakpoint on `require'ing the given file.</span>
2152: <span style='color:#0000e6; '>B&lt;b> B&lt;postpone> I&lt;subname> [I&lt;condition>]</span>
2153: <span style='color:#0000e6; '>        Set breakpoint at first line of subroutine after </span>
2154: <span style='color:#0000e6; '>        it is compiled.</span>
2155: <span style='color:#0000e6; '>B&lt;b> B&lt;compile> I&lt;subname></span>
2156: <span style='color:#0000e6; '>        Stop after the subroutine is compiled.</span>
2157: <span style='color:#0000e6; '>B&lt;d> [I&lt;line>]    Delete the breakpoint for I&lt;line>.</span>
2158: <span style='color:#0000e6; '>B&lt;D>        Delete all breakpoints.</span>
2159: <span style='color:#0000e6; '>B&lt;a> [I&lt;line>] I&lt;command></span>
2160: <span style='color:#0000e6; '>        Set an action to be done before the I&lt;line> is executed;</span>
2161: <span style='color:#0000e6; '>        I&lt;line> defaults to the current execution line.</span>
2162: <span style='color:#0000e6; '>        Sequence is: check for breakpoint/watchpoint, print line</span>
2163: <span style='color:#0000e6; '>        if necessary, do action, prompt user if necessary,</span>
2164: <span style='color:#0000e6; '>        execute line.</span>
2165: <span style='color:#0000e6; '>B&lt;a> [I&lt;line>]    Delete the action for I&lt;line>.</span>
2166: <span style='color:#0000e6; '>B&lt;A>        Delete all actions.</span>
2167: <span style='color:#0000e6; '>B&lt;W> I&lt;expr>        Add a global watch-expression.</span>
2168: <span style='color:#0000e6; '>B&lt;W>        Delete all watch-expressions.</span>
2169: <span style='color:#0000e6; '>B&lt;V> [I&lt;pkg> [I&lt;vars>]]    List some (default all) variables in package (default current).</span>
2170: <span style='color:#0000e6; '>        Use B&lt;~>I&lt;pattern> and B&lt;!>I&lt;pattern> for positive and negative regexps.</span>
2171: <span style='color:#0000e6; '>B&lt;X> [I&lt;vars>]    Same as </span><span style='color:#0f69ff; '>\"</span><span style='color:#0000e6; '>B&lt;V> I&lt;currentpackage> [I&lt;vars>]</span><span style='color:#0f69ff; '>\"</span><span style='color:#0000e6; '>.</span>
2172: <span style='color:#0000e6; '>B&lt;x> I&lt;expr>        Evals expression in list context, dumps the result.</span>
2173: <span style='color:#0000e6; '>B&lt;m> I&lt;expr>        Evals expression in list context, prints methods callable</span>
2174: <span style='color:#0000e6; '>        on the first element of the result.</span>
2175: <span style='color:#0000e6; '>B&lt;m> I&lt;class>        Prints methods callable via the given class.</span>
2176: <span style='color:#0000e6; '></span>
2177: <span style='color:#0000e6; '>B&lt;&lt;> ?            List Perl commands to run before each prompt.</span>
2178: <span style='color:#0000e6; '>B&lt;&lt;> I&lt;expr>        Define Perl command to run before each prompt.</span>
2179: <span style='color:#0000e6; '>B&lt;&lt;&lt;> I&lt;expr>        Add to the list of Perl commands to run before each prompt.</span>
2180: <span style='color:#0000e6; '>B&lt;>> ?            List Perl commands to run after each prompt.</span>
2181: <span style='color:#0000e6; '>B&lt;>> I&lt;expr>        Define Perl command to run after each prompt.</span>
2182: <span style='color:#0000e6; '>B&lt;>>B&lt;>> I&lt;expr>        Add to the list of Perl commands to run after each prompt.</span>
2183: <span style='color:#0000e6; '>B&lt;{> I&lt;db_command>    Define debugger command to run before each prompt.</span>
2184: <span style='color:#0000e6; '>B&lt;{> ?            List debugger commands to run before each prompt.</span>
2185: <span style='color:#0000e6; '>B&lt;&lt;> I&lt;expr>        Define Perl command to run before each prompt.</span>
2186: <span style='color:#0000e6; '>B&lt;{{> I&lt;db_command>    Add to the list of debugger commands to run before each prompt.</span>
2187: <span style='color:#0000e6; '>B&lt;</span><span style='color:#0000e6; '>$prc</span><span style='color:#0000e6; '>> I&lt;number>    Redo a previous command (default previous command).</span>
2188: <span style='color:#0000e6; '>B&lt;</span><span style='color:#0000e6; '>$prc</span><span style='color:#0000e6; '>> I&lt;-number>    Redo number'th-to-last command.</span>
2189: <span style='color:#0000e6; '>B&lt;</span><span style='color:#0000e6; '>$prc</span><span style='color:#0000e6; '>> I&lt;pattern>    Redo last command that started with I&lt;pattern>.</span>
2190: <span style='color:#0000e6; '>        See 'B&lt;O> I&lt;recallCommand>' too.</span>
2191: <span style='color:#0000e6; '>B&lt;</span><span style='color:#0000e6; '>$psh</span><span style='color:#0000e6; '>$psh</span><span style='color:#0000e6; '>> I&lt;cmd>      Run cmd in a subprocess (reads from DB::IN, writes to DB::OUT)"</span>
2192:   <span style='color:#808030; '>.</span> <span style='color:#808030; '>(</span> $rc <span style='color:#808030; '>eq</span> $sh <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>""</span> <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>"</span>
2193: <span style='color:#0000e6; '>B&lt;</span><span style='color:#0000e6; '>$psh</span><span style='color:#0000e6; '>> [I&lt;cmd>]     Run I&lt;cmd> in subshell (forces </span><span style='color:#0f69ff; '>\"</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>SHELL -c 'cmd'</span><span style='color:#0f69ff; '>\"</span><span style='color:#0000e6; '>)."</span> <span style='color:#808030; '>)</span> <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>"</span>
2194: <span style='color:#0000e6; '>        See 'B&lt;O> I&lt;shellBang>' too.</span>
2195: <span style='color:#0000e6; '>B&lt;H> I&lt;-number>    Display last number commands (default all).</span>
2196: <span style='color:#0000e6; '>B&lt;p> I&lt;expr>        Same as </span><span style='color:#0f69ff; '>\"</span><span style='color:#0000e6; '>I&lt;print {DB::OUT} expr></span><span style='color:#0f69ff; '>\"</span><span style='color:#0000e6; '> in current package.</span>
2197: <span style='color:#0000e6; '>B&lt;|>I&lt;dbcmd>        Run debugger command, piping DB::OUT to current pager.</span>
2198: <span style='color:#0000e6; '>B&lt;||>I&lt;dbcmd>        Same as B&lt;|>I&lt;dbcmd> but DB::OUT is temporarilly select()ed as well.</span>
2199: <span style='color:#0000e6; '>B&lt;</span><span style='color:#0f69ff; '>\=</span><span style='color:#0000e6; '>> [I&lt;alias> I&lt;value>]    Define a command alias, or list current aliases.</span>
2200: <span style='color:#0000e6; '>I&lt;command>        Execute as a perl statement in current package.</span>
2201: <span style='color:#0000e6; '>B&lt;v>        Show versions of loaded modules.</span>
2202: <span style='color:#0000e6; '>B&lt;R>        Pure-man-restart of debugger, some of debugger state</span>
2203: <span style='color:#0000e6; '>        and command-line options may be lost.</span>
2204: <span style='color:#0000e6; '>        Currently the following setting are preserved: </span>
2205: <span style='color:#0000e6; '>        history, breakpoints and actions, debugger B&lt;O>ptions </span>
2206: <span style='color:#0000e6; '>        and the following command-line options: I&lt;-w>, I&lt;-I>, I&lt;-e>.</span>
2207: <span style='color:#0000e6; '></span>
2208: <span style='color:#0000e6; '>B&lt;O> [I&lt;opt>] ...    Set boolean option to true</span>
2209: <span style='color:#0000e6; '>B&lt;O> [I&lt;opt>B&lt;?>]    Query options</span>
2210: <span style='color:#0000e6; '>B&lt;O> [I&lt;opt>B&lt;=>I&lt;val>] [I&lt;opt>=B&lt;</span><span style='color:#0f69ff; '>\"</span><span style='color:#0000e6; '>>I&lt;val>B&lt;</span><span style='color:#0f69ff; '>\"</span><span style='color:#0000e6; '>>] ... </span>
2211: <span style='color:#0000e6; '>        Set options.  Use quotes in spaces in value.</span>
2212: <span style='color:#0000e6; '>    I&lt;recallCommand>, I&lt;ShellBang>    chars used to recall command or spawn shell;</span>
2213: <span style='color:#0000e6; '>    I&lt;pager>            program for output of </span><span style='color:#0f69ff; '>\"</span><span style='color:#0000e6; '>|cmd</span><span style='color:#0f69ff; '>\"</span><span style='color:#0000e6; '>;</span>
2214: <span style='color:#0000e6; '>    I&lt;tkRunning>            run Tk while prompting (with ReadLine);</span>
2215: <span style='color:#0000e6; '>    I&lt;signalLevel> I&lt;warnLevel> I&lt;dieLevel>    level of verbosity;</span>
2216: <span style='color:#0000e6; '>    I&lt;inhibit_exit>        Allows stepping off the end of the script.</span>
2217: <span style='color:#0000e6; '>    I&lt;ImmediateStop>        Debugger should stop as early as possible.</span>
2218: <span style='color:#0000e6; '>    I&lt;RemotePort>            Remote hostname:port for remote debugging</span>
2219: <span style='color:#0000e6; '>  The following options affect what happens with B&lt;V>, B&lt;X>, and B&lt;x> commands:</span>
2220: <span style='color:#0000e6; '>    I&lt;arrayDepth>, I&lt;hashDepth>     print only first N elements ('' for all);</span>
2221: <span style='color:#0000e6; '>    I&lt;compactDump>, I&lt;veryCompact>     change style of array and hash dump;</span>
2222: <span style='color:#0000e6; '>    I&lt;globPrint>             whether to print contents of globs;</span>
2223: <span style='color:#0000e6; '>    I&lt;DumpDBFiles>         dump arrays holding debugged files;</span>
2224: <span style='color:#0000e6; '>    I&lt;DumpPackages>         dump symbol tables of packages;</span>
2225: <span style='color:#0000e6; '>    I&lt;DumpReused>             dump contents of </span><span style='color:#0f69ff; '>\"</span><span style='color:#0000e6; '>reused</span><span style='color:#0f69ff; '>\"</span><span style='color:#0000e6; '> addresses;</span>
2226: <span style='color:#0000e6; '>    I&lt;quote>, I&lt;HighBit>, I&lt;undefPrint>     change style of string dump;</span>
2227: <span style='color:#0000e6; '>    I&lt;bareStringify>         Do not print the overload-stringified value;</span>
2228: <span style='color:#0000e6; '>  Other options include:</span>
2229: <span style='color:#0000e6; '>    I&lt;PrintRet>        affects printing of return value after B&lt;r> command,</span>
2230: <span style='color:#0000e6; '>    I&lt;frame>        affects printing messages on entry and exit from subroutines.</span>
2231: <span style='color:#0000e6; '>    I&lt;AutoTrace>    affects printing messages on every possible breaking point.</span>
2232: <span style='color:#0000e6; '>    I&lt;maxTraceLen>    gives maximal length of evals/args listed in stack trace.</span>
2233: <span style='color:#0000e6; '>    I&lt;ornaments>     affects screen appearance of the command line.</span>
2234: <span style='color:#0000e6; '>    During startup options are initialized from </span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>ENV{PERLDB_OPTS}.</span>
2235: <span style='color:#0000e6; '>    You can put additional initialization options I&lt;TTY>, I&lt;noTTY>,</span>
2236: <span style='color:#0000e6; '>    I&lt;ReadLine>, I&lt;NonStop>, and I&lt;RemotePort> there (or use</span>
2237: <span style='color:#0000e6; '>    `B&lt;R>' after you set them).</span>
2238: <span style='color:#0000e6; '></span>
2239: <span style='color:#0000e6; '>B&lt;q> or B&lt;^D>        Quit. Set B&lt;</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>DB::finished = </span><span style='color:#008c00; '>0</span><span style='color:#0000e6; '>> to debug global destruction.</span>
2240: <span style='color:#0000e6; '>B&lt;h> [I&lt;db_command>]    Get help [on a specific debugger command], enter B&lt;|h> to page.</span>
2241: <span style='color:#0000e6; '>B&lt;h h>        Summary of debugger commands.</span>
2242: <span style='color:#0000e6; '>B&lt;</span><span style='color:#0000e6; '>$doccmd</span><span style='color:#0000e6; '>> I&lt;manpage>    Runs the external doc viewer B&lt;</span><span style='color:#0000e6; '>$doccmd</span><span style='color:#0000e6; '>> command on the </span>
2243: <span style='color:#0000e6; '>        named Perl I&lt;manpage>, or on B&lt;</span><span style='color:#0000e6; '>$doccmd</span><span style='color:#0000e6; '>> itself if omitted.</span>
2244: <span style='color:#0000e6; '>        Set B&lt;</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>DB::doccmd> to change viewer.</span>
2245: <span style='color:#0000e6; '></span>
2246: <span style='color:#0000e6; '>Type `|h' for a paged display if this was too hard to read.</span>
2247: <span style='color:#0000e6; '></span>
2248: <span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span> <span style='color:#696969; '># </span><span style='color:#ffffff; background:#808000; '>Fix balance of vi % matching: } }}</span>
2249: 
2250:     $summary <span style='color:#808030; '>=</span> <span style='color:#800000; '>&lt;&lt;</span><span style='color:#0000e6; '>"</span><span style='color:#e34adc; '>END_SUM</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>;</span>
2251: <span style='color:#0000e6; '>I&lt;List/search source lines:>               I&lt;Control script execution:></span>
2252: <span style='color:#0000e6; '>  B&lt;l> [I&lt;ln>|I&lt;sub>]  List source code            B&lt;T>           Stack trace</span>
2253: <span style='color:#0000e6; '>  B&lt;-> or B&lt;.>      List previous/current line  B&lt;s> [I&lt;expr>]    Single step [in expr]</span>
2254: <span style='color:#0000e6; '>  B&lt;w> [I&lt;line>]    List around line            B&lt;n> [I&lt;expr>]    Next, steps over subs</span>
2255: <span style='color:#0000e6; '>  B&lt;f> I&lt;filename>  View source in file         &lt;B&lt;CR>/B&lt;Enter>>  Repeat last B&lt;n> or B&lt;s></span>
2256: <span style='color:#0000e6; '>  B&lt;/>I&lt;pattern>B&lt;/> B&lt;?>I&lt;patt>B&lt;?>   Search forw/backw    B&lt;r>           Return from subroutine</span>
2257: <span style='color:#0000e6; '>  B&lt;v>          Show versions of modules    B&lt;c> [I&lt;ln>|I&lt;sub>]  Continue until position</span>
2258: <span style='color:#0000e6; '>I&lt;Debugger controls:>                        B&lt;L>           List break/watch/actions</span>
2259: <span style='color:#0000e6; '>  B&lt;O> [...]     Set debugger options        B&lt;t> [I&lt;expr>]    Toggle trace [trace expr]</span>
2260: <span style='color:#0000e6; '>  B&lt;&lt;>[B&lt;&lt;>]|B&lt;{>[B&lt;{>]|B&lt;>>[B&lt;>>] [I&lt;cmd>] Do pre/post-prompt B&lt;b> [I&lt;ln>|I&lt;event>|I&lt;sub>] [I&lt;cnd>] Set breakpoint</span>
2261: <span style='color:#0000e6; '>  B&lt;</span><span style='color:#0000e6; '>$prc</span><span style='color:#0000e6; '>> [I&lt;N>|I&lt;pat>]   Redo a previous command     B&lt;d> [I&lt;ln>] or B&lt;D> Delete a/all breakpoints</span>
2262: <span style='color:#0000e6; '>  B&lt;H> [I&lt;-num>]    Display last num commands   B&lt;a> [I&lt;ln>] I&lt;cmd>  Do cmd before line</span>
2263: <span style='color:#0000e6; '>  B&lt;=> [I&lt;a> I&lt;val>]   Define/list an alias        B&lt;W> I&lt;expr>      Add a watch expression</span>
2264: <span style='color:#0000e6; '>  B&lt;h> [I&lt;db_cmd>]  Get help on command         B&lt;A> or B&lt;W>      Delete all actions/watch</span>
2265: <span style='color:#0000e6; '>  B&lt;|>[B&lt;|>]I&lt;db_cmd>  Send output to pager        B&lt;</span><span style='color:#0000e6; '>$psh</span><span style='color:#0000e6; '>></span><span style='color:#0f69ff; '>\[</span><span style='color:#0000e6; '>B&lt;</span><span style='color:#0000e6; '>$psh</span><span style='color:#0000e6; '>></span><span style='color:#0f69ff; '>\]</span><span style='color:#0000e6; '> I&lt;syscmd> Run cmd in a subprocess</span>
2266: <span style='color:#0000e6; '>  B&lt;q> or B&lt;^D>     Quit              B&lt;R>          Attempt a restart</span>
2267: <span style='color:#0000e6; '>I&lt;Data Examination:>          B&lt;expr>     Execute perl code, also see: B&lt;s>,B&lt;n>,B&lt;t> I&lt;expr></span>
2268: <span style='color:#0000e6; '>  B&lt;x>|B&lt;m> I&lt;expr>    Evals expr in list context, dumps the result or lists methods.</span>
2269: <span style='color:#0000e6; '>  B&lt;p> I&lt;expr>    Print expression (uses script's current package).</span>
2270: <span style='color:#0000e6; '>  B&lt;S> [[B&lt;!>]I&lt;pat>]    List subroutine names [not] matching pattern</span>
2271: <span style='color:#0000e6; '>  B&lt;V> [I&lt;Pk> [I&lt;Vars>]]    List Variables in Package.  Vars can be ~pattern or !pattern.</span>
2272: <span style='color:#0000e6; '>  B&lt;X> [I&lt;Vars>]    Same as </span><span style='color:#0f69ff; '>\"</span><span style='color:#0000e6; '>B&lt;V> I&lt;current_package> [I&lt;Vars>]</span><span style='color:#0f69ff; '>\"</span><span style='color:#0000e6; '>.</span>
2273: <span style='color:#0000e6; '>For more help, type B&lt;h> I&lt;cmd_letter>, or run B&lt;</span><span style='color:#0000e6; '>$doccmd</span><span style='color:#0000e6; '> perldebug> for all docs.</span>
2274: <span style='color:#e34adc; '>END_SUM</span>
2275:                 <span style='color:#696969; '># ')}}; # </span><span style='color:#ffffff; background:#808000; '>Fix balance of vi % matching</span>
2276: <span style='color:#800080; '>}</span>
2277: 
2278: <span style='color:#800000; font-weight:bold; '>sub </span>print_help <span style='color:#800080; '>{</span>
2279:     <span style='color:#800000; font-weight:bold; '>local</span> $_ <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
2280: 
2281:     <span style='color:#696969; '># Restore proper alignment destroyed by eeevil I&lt;> and B&lt;></span>
2282:     <span style='color:#696969; '># ornaments: A pox on both their houses!</span>
2283:     <span style='color:#696969; '>#</span>
2284:     <span style='color:#696969; '># A help command will have everything up to and including</span>
2285:     <span style='color:#696969; '># the first tab sequence paddeed into a field 16 (or if indented 20)</span>
2286:     <span style='color:#696969; '># wide.  If it's wide than that, an extra space will be added.</span>
2287:     <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>{</span><span style='color:#0000e6; '></span>
2288: <span style='color:#0000e6; '>    </span><span style='color:#808030; '>^</span><span style='color:#696969; '>                 # only matters at start of line</span><span style='color:#0000e6; '></span>
2289: <span style='color:#0000e6; '>      </span><span style='color:#808030; '>(</span><span style='color:#0000e6; '> </span><span style='color:#0f69ff; '>\040</span><span style='color:#0000e6; '>{4} </span><span style='color:#800080; '>|</span><span style='color:#0000e6; '> </span><span style='color:#0f69ff; '>\t</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>)</span><span style='color:#808030; '>*</span><span style='color:#696969; '>    # some subcommands are indented</span><span style='color:#0000e6; '></span>
2290: <span style='color:#0000e6; '>      </span><span style='color:#808030; '>(</span><span style='color:#0000e6; '> &lt; </span><span style='color:#808030; '>?</span><span style='color:#696969; '>         # so &lt;CR> works</span><span style='color:#0000e6; '></span>
2291: <span style='color:#0000e6; '>        </span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>BI</span><span style='color:#808030; '>]</span><span style='color:#0000e6; '> &lt; </span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\t</span><span style='color:#0f69ff; '>\n</span><span style='color:#808030; '>]</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>+</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>)</span><span style='color:#696969; '>  # find an eeevil ornament</span><span style='color:#0000e6; '></span>
2292: <span style='color:#0000e6; '>      </span><span style='color:#808030; '>(</span><span style='color:#0000e6; '> </span><span style='color:#0f69ff; '>\t</span><span style='color:#808030; '>+</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>)</span><span style='color:#696969; '>        # original separation, discarded</span><span style='color:#0000e6; '></span>
2293: <span style='color:#0000e6; '>      </span><span style='color:#808030; '>(</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>)</span><span style='color:#696969; '>        # this will now start (no earlier) than </span><span style='color:#0000e6; '></span>
2294: <span style='color:#696969; '>                # column 16</span><span style='color:#0000e6; '></span>
2295: <span style='color:#0000e6; '>    </span><span style='color:#800000; '>}</span> <span style='color:#800000; '>{</span>
2296:     <span style='color:#800000; font-weight:bold; '>my</span><span style='color:#808030; '>(</span>$leadwhite<span style='color:#808030; '>,</span> $command<span style='color:#808030; '>,</span> $midwhite<span style='color:#808030; '>,</span> $text<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$1<span style='color:#808030; '>,</span> $2<span style='color:#808030; '>,</span> $3<span style='color:#808030; '>,</span> $4<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2297:     <span style='color:#800000; font-weight:bold; '>my</span> $clean <span style='color:#808030; '>=</span> $command<span style='color:#800080; '>;</span>
2298:     $clean <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>BI</span><span style='color:#808030; '>]</span><span style='color:#0000e6; '>&lt;</span><span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>></span><span style='color:#808030; '>]</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>></span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>$1</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>g</span><span style='color:#800080; '>;</span>  
2299:     <span style='color:#696969; '># replace with this whole string:</span>
2300:     <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>length</span><span style='color:#808030; '>(</span>$leadwhite<span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>" "</span> <span style='color:#800000; font-weight:bold; '>x</span> <span style='color:#008c00; '>4</span> <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>""</span><span style='color:#808030; '>)</span>
2301:       <span style='color:#808030; '>.</span> $command
2302:       <span style='color:#808030; '>.</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>" "</span> <span style='color:#800000; font-weight:bold; '>x</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>16</span> <span style='color:#808030; '>+</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>length</span><span style='color:#808030; '>(</span>$leadwhite<span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> <span style='color:#008c00; '>4</span> <span style='color:#808030; '>:</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>-</span> <span style='color:#800000; font-weight:bold; '>length</span><span style='color:#808030; '>(</span>$clean<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#0000e6; '>" "</span><span style='color:#808030; '>)</span>
2303:       <span style='color:#808030; '>.</span> $text<span style='color:#800080; '>;</span>
2304: 
2305:     <span style='color:#800000; '>}</span><span style='color:#800000; font-weight:bold; '>mgex</span><span style='color:#800080; '>;</span>
2306: 
2307:     <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>{</span><span style='color:#696969; '>                # handle bold ornaments</span><span style='color:#0000e6; '></span>
2308: <span style='color:#0000e6; '>    B &lt; </span><span style='color:#808030; '>(</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>></span><span style='color:#808030; '>]</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>+</span><span style='color:#0000e6; '> </span><span style='color:#800080; '>|</span><span style='color:#0000e6; '> > </span><span style='color:#808030; '>)</span><span style='color:#0000e6; '> ></span>
2309: <span style='color:#0000e6; '>    </span><span style='color:#800000; '>}</span> <span style='color:#800000; '>{</span>
2310:       $Term<span style='color:#808030; '>::</span>ReadLine<span style='color:#808030; '>::</span>TermCap<span style='color:#808030; '>::</span>rl_term_set<span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span> 
2311:     <span style='color:#808030; '>.</span> $1
2312:     <span style='color:#808030; '>.</span> $Term<span style='color:#808030; '>::</span>ReadLine<span style='color:#808030; '>::</span>TermCap<span style='color:#808030; '>::</span>rl_term_set<span style='color:#808030; '>[</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>]</span>
2313:     <span style='color:#800000; '>}</span><span style='color:#800000; font-weight:bold; '>gex</span><span style='color:#800080; '>;</span>
2314: 
2315:     <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>{</span><span style='color:#696969; '>                # handle italic ornaments</span><span style='color:#0000e6; '></span>
2316: <span style='color:#0000e6; '>    I &lt; </span><span style='color:#808030; '>(</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>></span><span style='color:#808030; '>]</span><span style='color:#0000e6; '> </span><span style='color:#808030; '>+</span><span style='color:#0000e6; '> </span><span style='color:#800080; '>|</span><span style='color:#0000e6; '> > </span><span style='color:#808030; '>)</span><span style='color:#0000e6; '> ></span>
2317: <span style='color:#0000e6; '>    </span><span style='color:#800000; '>}</span> <span style='color:#800000; '>{</span>
2318:       $Term<span style='color:#808030; '>::</span>ReadLine<span style='color:#808030; '>::</span>TermCap<span style='color:#808030; '>::</span>rl_term_set<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> 
2319:     <span style='color:#808030; '>.</span> $1
2320:     <span style='color:#808030; '>.</span> $Term<span style='color:#808030; '>::</span>ReadLine<span style='color:#808030; '>::</span>TermCap<span style='color:#808030; '>::</span>rl_term_set<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span>
2321:     <span style='color:#800000; '>}</span><span style='color:#800000; font-weight:bold; '>gex</span><span style='color:#800080; '>;</span>
2322: 
2323:     <span style='color:#800000; font-weight:bold; '>print</span> $OUT $_<span style='color:#800080; '>;</span>
2324: <span style='color:#800080; '>}</span>
2325: 
2326: <span style='color:#800000; font-weight:bold; '>sub </span>fix_less <span style='color:#800080; '>{</span>
2327:     <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>defined</span> $ENV<span style='color:#800080; '>{</span>LESS<span style='color:#800080; '>}</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> $ENV<span style='color:#800080; '>{</span>LESS<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>r</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
2328:     <span style='color:#800000; font-weight:bold; '>my</span> $is_less <span style='color:#808030; '>=</span> $pager <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\b</span><span style='color:#0000e6; '>less</span><span style='color:#0f69ff; '>\b</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
2329:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$pager <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\b</span><span style='color:#0000e6; '>more</span><span style='color:#0f69ff; '>\b</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> 
2330:     <span style='color:#800000; font-weight:bold; '>my</span> @st_more <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>stat</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>'/usr/bin/more'</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2331:     <span style='color:#800000; font-weight:bold; '>my</span> @st_less <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>stat</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>'/usr/bin/less'</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2332:     $is_less <span style='color:#808030; '>=</span> @st_more    <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> @st_less 
2333:         <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> $st_more<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> $st_less<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> 
2334:         <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> $st_more<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> $st_less<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
2335:     <span style='color:#800080; '>}</span>
2336:     <span style='color:#696969; '># changes environment!</span>
2337:     $ENV<span style='color:#800080; '>{</span>LESS<span style='color:#800080; '>}</span> <span style='color:#808030; '>.</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'r'</span>     <span style='color:#800000; font-weight:bold; '>if</span> $is_less<span style='color:#800080; '>;</span>
2338: <span style='color:#800080; '>}</span>
2339: 
2340: <span style='color:#800000; font-weight:bold; '>sub </span>diesignal <span style='color:#800080; '>{</span>
2341:     <span style='color:#800000; font-weight:bold; '>local</span> $frame <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
2342:     <span style='color:#800000; font-weight:bold; '>local</span> $doret <span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>2</span><span style='color:#800080; '>;</span>
2343:     $SIG<span style='color:#800080; '>{</span><span style='color:#0000e6; '>'ABRT'</span><span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'DEFAULT'</span><span style='color:#800080; '>;</span>
2344:     <span style='color:#800000; font-weight:bold; '>kill</span> <span style='color:#0000e6; '>'ABRT'</span><span style='color:#808030; '>,</span> $$ <span style='color:#800000; font-weight:bold; '>if</span> $panic<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
2345:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> <span style='color:#808030; '>&amp;</span><span style='color:#bb7977; font-weight:bold; '>Carp</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>longmess</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2346:     <span style='color:#800000; font-weight:bold; '>local</span> $SIG<span style='color:#800080; '>{</span>__WARN__<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>''</span><span style='color:#800080; '>;</span>
2347:     <span style='color:#800000; font-weight:bold; '>local</span> $Carp<span style='color:#808030; '>::</span>CarpLevel <span style='color:#808030; '>=</span> <span style='color:#008c00; '>2</span><span style='color:#800080; '>;</span>        <span style='color:#696969; '># mydie + confess</span>
2348:     <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span><span style='color:#bb7977; font-weight:bold; '>Carp</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>longmess</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Signal </span><span style='color:#0000e6; '>@_</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2349:     <span style='color:#800080; '>}</span>
2350:     <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
2351:     <span style='color:#800000; font-weight:bold; '>print</span> $DB<span style='color:#808030; '>::</span>OUT <span style='color:#0000e6; '>"Got signal </span><span style='color:#0000e6; '>@_</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
2352:     <span style='color:#800080; '>}</span>
2353:     <span style='color:#800000; font-weight:bold; '>kill</span> <span style='color:#0000e6; '>'ABRT'</span><span style='color:#808030; '>,</span> $$;
2354: <span style='color:#800080; '>}</span>
2355: 
2356: <span style='color:#800000; font-weight:bold; '>sub </span>dbwarn <span style='color:#800080; '>{</span> 
2357:   <span style='color:#800000; font-weight:bold; '>local</span> $frame <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
2358:   <span style='color:#800000; font-weight:bold; '>local</span> $doret <span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>2</span><span style='color:#800080; '>;</span>
2359:   <span style='color:#800000; font-weight:bold; '>local</span> $SIG<span style='color:#800080; '>{</span>__WARN__<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>''</span><span style='color:#800080; '>;</span>
2360:   <span style='color:#800000; font-weight:bold; '>local</span> $SIG<span style='color:#800080; '>{</span>__DIE__<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>''</span><span style='color:#800080; '>;</span>
2361:   <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>require</span> <span style='color:#bb7977; font-weight:bold; '>Carp</span> <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>defined</span> $^S<span style='color:#800080; '>;</span>    <span style='color:#696969; '># If error/warning during compilation,</span>
2362:                                         <span style='color:#696969; '># require may be broken.</span>
2363:   <span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span>@_<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>Cannot print stack trace, load with -MCarp option to see stack"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>
2364:     <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>defined</span> <span style='color:#808030; '>&amp;</span><span style='color:#bb7977; font-weight:bold; '>Carp</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>longmess</span><span style='color:#800080; '>;</span>
2365:   <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$mysingle<span style='color:#808030; '>,</span>$mytrace<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$single<span style='color:#808030; '>,</span>$trace<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2366:   $single <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> $trace <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
2367:   <span style='color:#800000; font-weight:bold; '>my</span> $mess <span style='color:#808030; '>=</span> <span style='color:#bb7977; font-weight:bold; '>Carp</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>longmess</span><span style='color:#808030; '>(</span>@_<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2368:   <span style='color:#808030; '>(</span>$single<span style='color:#808030; '>,</span>$trace<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$mysingle<span style='color:#808030; '>,</span>$mytrace<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2369:   <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span>$mess<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span> 
2370: <span style='color:#800080; '>}</span>
2371: 
2372: <span style='color:#800000; font-weight:bold; '>sub </span>dbdie <span style='color:#800080; '>{</span>
2373:   <span style='color:#800000; font-weight:bold; '>local</span> $frame <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
2374:   <span style='color:#800000; font-weight:bold; '>local</span> $doret <span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>2</span><span style='color:#800080; '>;</span>
2375:   <span style='color:#800000; font-weight:bold; '>local</span> $SIG<span style='color:#800080; '>{</span>__DIE__<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>''</span><span style='color:#800080; '>;</span>
2376:   <span style='color:#800000; font-weight:bold; '>local</span> $SIG<span style='color:#800080; '>{</span>__WARN__<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>''</span><span style='color:#800080; '>;</span>
2377:   <span style='color:#800000; font-weight:bold; '>my</span> $i <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> <span style='color:#800000; font-weight:bold; '>my</span> $ineval <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> <span style='color:#800000; font-weight:bold; '>my</span> $sub<span style='color:#800080; '>;</span>
2378:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$dieLevel <span style='color:#808030; '>></span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2379:       <span style='color:#800000; font-weight:bold; '>local</span> $SIG<span style='color:#800080; '>{</span>__WARN__<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span>dbwarn<span style='color:#800080; '>;</span>
2380:       <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>warn</span><span style='color:#808030; '>(</span>@_<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>        <span style='color:#696969; '># Yell no matter what</span>
2381:       <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
2382:   <span style='color:#800080; '>}</span>
2383:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$dieLevel <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2384:     <span style='color:#800000; font-weight:bold; '>die</span> @_ <span style='color:#800000; font-weight:bold; '>if</span> $^S<span style='color:#800080; '>;</span>        <span style='color:#696969; '># in eval propagate</span>
2385:   <span style='color:#800080; '>}</span>
2386:   <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>require</span> <span style='color:#bb7977; font-weight:bold; '>Carp</span> <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>defined</span> $^S<span style='color:#800080; '>;</span>    <span style='color:#696969; '># If error/warning during compilation,</span>
2387:                                     <span style='color:#696969; '># require may be broken.</span>
2388: 
2389:   <span style='color:#800000; font-weight:bold; '>die</span><span style='color:#808030; '>(</span>@_<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>Cannot print stack trace, load with -MCarp option to see stack"</span><span style='color:#808030; '>)</span>
2390:     <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>defined</span> <span style='color:#808030; '>&amp;</span><span style='color:#bb7977; font-weight:bold; '>Carp</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>longmess</span><span style='color:#800080; '>;</span>
2391: 
2392:   <span style='color:#696969; '># We do not want to debug this chunk (automatic disabling works</span>
2393:   <span style='color:#696969; '># inside DB::DB, but not in Carp).</span>
2394:   <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$mysingle<span style='color:#808030; '>,</span>$mytrace<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$single<span style='color:#808030; '>,</span>$trace<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2395:   $single <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> $trace <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
2396:   <span style='color:#800000; font-weight:bold; '>my</span> $mess <span style='color:#808030; '>=</span> <span style='color:#bb7977; font-weight:bold; '>Carp</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>longmess</span><span style='color:#808030; '>(</span>@_<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2397:   <span style='color:#808030; '>(</span>$single<span style='color:#808030; '>,</span>$trace<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$mysingle<span style='color:#808030; '>,</span>$mytrace<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2398:   <span style='color:#800000; font-weight:bold; '>die</span> $mess<span style='color:#800080; '>;</span>
2399: <span style='color:#800080; '>}</span>
2400: 
2401: <span style='color:#800000; font-weight:bold; '>sub </span>warnLevel <span style='color:#800080; '>{</span>
2402:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>@_<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2403:     $prevwarn <span style='color:#808030; '>=</span> $SIG<span style='color:#800080; '>{</span>__WARN__<span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>unless</span> $warnLevel<span style='color:#800080; '>;</span>
2404:     $warnLevel <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
2405:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$warnLevel<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2406:       $SIG<span style='color:#800080; '>{</span>__WARN__<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span><span style='color:#bb7977; font-weight:bold; '>DB</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>dbwarn</span><span style='color:#800080; '>;</span>
2407:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
2408:       $SIG<span style='color:#800080; '>{</span>__WARN__<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> $prevwarn<span style='color:#800080; '>;</span>
2409:     <span style='color:#800080; '>}</span>
2410:   <span style='color:#800080; '>}</span>
2411:   $warnLevel<span style='color:#800080; '>;</span>
2412: <span style='color:#800080; '>}</span>
2413: 
2414: <span style='color:#800000; font-weight:bold; '>sub </span>dieLevel <span style='color:#800080; '>{</span>
2415:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>@_<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2416:     $prevdie <span style='color:#808030; '>=</span> $SIG<span style='color:#800080; '>{</span>__DIE__<span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>unless</span> $dieLevel<span style='color:#800080; '>;</span>
2417:     $dieLevel <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
2418:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$dieLevel<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2419:       $SIG<span style='color:#800080; '>{</span>__DIE__<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span><span style='color:#bb7977; font-weight:bold; '>DB</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>dbdie</span><span style='color:#800080; '>;</span> <span style='color:#696969; '># if $dieLevel &lt; 2;</span>
2420:       <span style='color:#696969; '>#$SIG{__DIE__} = \&amp;DB::diehard if $dieLevel >= 2;</span>
2421:       <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Stack dump during die enabled"</span><span style='color:#808030; '>,</span> 
2422:         <span style='color:#808030; '>(</span> $dieLevel <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>" outside of evals"</span> <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>""</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>".</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
2423:       <span style='color:#800000; font-weight:bold; '>if</span> $I_m_init<span style='color:#800080; '>;</span>
2424:       <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Dump printed too.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800000; font-weight:bold; '>if</span> $dieLevel <span style='color:#808030; '>></span> <span style='color:#008c00; '>2</span><span style='color:#800080; '>;</span>
2425:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
2426:       $SIG<span style='color:#800080; '>{</span>__DIE__<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> $prevdie<span style='color:#800080; '>;</span>
2427:       <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Default die handler restored.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
2428:     <span style='color:#800080; '>}</span>
2429:   <span style='color:#800080; '>}</span>
2430:   $dieLevel<span style='color:#800080; '>;</span>
2431: <span style='color:#800080; '>}</span>
2432: 
2433: <span style='color:#800000; font-weight:bold; '>sub </span>signalLevel <span style='color:#800080; '>{</span>
2434:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>@_<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2435:     $prevsegv <span style='color:#808030; '>=</span> $SIG<span style='color:#800080; '>{</span>SEGV<span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>unless</span> $signalLevel<span style='color:#800080; '>;</span>
2436:     $prevbus <span style='color:#808030; '>=</span> $SIG<span style='color:#800080; '>{</span>BUS<span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>unless</span> $signalLevel<span style='color:#800080; '>;</span>
2437:     $signalLevel <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
2438:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$signalLevel<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2439:       $SIG<span style='color:#800080; '>{</span>SEGV<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span><span style='color:#bb7977; font-weight:bold; '>DB</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>diesignal</span><span style='color:#800080; '>;</span>
2440:       $SIG<span style='color:#800080; '>{</span>BUS<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span><span style='color:#bb7977; font-weight:bold; '>DB</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>diesignal</span><span style='color:#800080; '>;</span>
2441:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
2442:       $SIG<span style='color:#800080; '>{</span>SEGV<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> $prevsegv<span style='color:#800080; '>;</span>
2443:       $SIG<span style='color:#800080; '>{</span>BUS<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> $prevbus<span style='color:#800080; '>;</span>
2444:     <span style='color:#800080; '>}</span>
2445:   <span style='color:#800080; '>}</span>
2446:   $signalLevel<span style='color:#800080; '>;</span>
2447: <span style='color:#800080; '>}</span>
2448: 
2449: <span style='color:#800000; font-weight:bold; '>sub </span>CvGV_name <span style='color:#800080; '>{</span>
2450:   <span style='color:#800000; font-weight:bold; '>my</span> $in <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
2451:   <span style='color:#800000; font-weight:bold; '>my</span> $name <span style='color:#808030; '>=</span> CvGV_name_or_bust<span style='color:#808030; '>(</span>$in<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2452:   <span style='color:#800000; font-weight:bold; '>defined</span> $name <span style='color:#808030; '>?</span> $name <span style='color:#808030; '>:</span> $in<span style='color:#800080; '>;</span>
2453: <span style='color:#800080; '>}</span>
2454: 
2455: <span style='color:#800000; font-weight:bold; '>sub </span>CvGV_name_or_bust <span style='color:#800080; '>{</span>
2456:   <span style='color:#800000; font-weight:bold; '>my</span> $in <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
2457:   <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#800000; font-weight:bold; '>if</span> $skipCvGV<span style='color:#800080; '>;</span>        <span style='color:#696969; '># Backdoor to avoid problems if XS broken...</span>
2458:   $in <span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span>$in<span style='color:#800080; '>;</span>            <span style='color:#696969; '># Hard reference...</span>
2459:   <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span><span style='color:#800000; font-weight:bold; '>require</span> <span style='color:#bb7977; font-weight:bold; '>Devel::Peek</span><span style='color:#800080; '>;</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>}</span> <span style='color:#808030; '>or</span> <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
2460:   <span style='color:#800000; font-weight:bold; '>my</span> $gv <span style='color:#808030; '>=</span> <span style='color:#bb7977; font-weight:bold; '>Devel::Peek</span><span style='color:#808030; '>:</span><span style='color:#808030; '>:</span>CvGV<span style='color:#808030; '>(</span>$in<span style='color:#808030; '>)</span> <span style='color:#808030; '>or</span> <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
2461:   <span style='color:#808030; '>*</span>$gv<span style='color:#800080; '>{</span>PACKAGE<span style='color:#800080; '>}</span> <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>'::'</span> <span style='color:#808030; '>.</span> <span style='color:#808030; '>*</span>$gv<span style='color:#800080; '>{</span>NAME<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
2462: <span style='color:#800080; '>}</span>
2463: 
2464: <span style='color:#800000; font-weight:bold; '>sub </span>find_sub <span style='color:#800080; '>{</span>
2465:   <span style='color:#800000; font-weight:bold; '>my</span> $subr <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
2466:   $sub<span style='color:#800080; '>{</span>$subr<span style='color:#800080; '>}</span> <span style='color:#808030; '>or</span> <span style='color:#800000; font-weight:bold; '>do</span> <span style='color:#800080; '>{</span>
2467:     <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>defined</span> <span style='color:#808030; '>&amp;</span>$subr<span style='color:#800080; '>;</span>
2468:     <span style='color:#800000; font-weight:bold; '>my</span> $name <span style='color:#808030; '>=</span> CvGV_name_or_bust<span style='color:#808030; '>(</span>$subr<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2469:     <span style='color:#800000; font-weight:bold; '>my</span> $data<span style='color:#800080; '>;</span>
2470:     $data <span style='color:#808030; '>=</span> $sub<span style='color:#800080; '>{</span>$name<span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>defined</span> $name<span style='color:#800080; '>;</span>
2471:     <span style='color:#800000; font-weight:bold; '>return</span> $data <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>defined</span> $data<span style='color:#800080; '>;</span>
2472: 
2473:     <span style='color:#696969; '># Old stupid way...</span>
2474:     $subr <span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span>$subr<span style='color:#800080; '>;</span>        <span style='color:#696969; '># Hard reference</span>
2475:     <span style='color:#800000; font-weight:bold; '>my</span> $s<span style='color:#800080; '>;</span>
2476:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>keys</span> %sub<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2477:       $s <span style='color:#808030; '>=</span> $_<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>last</span> <span style='color:#800000; font-weight:bold; '>if</span> $subr <span style='color:#808030; '>eq</span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span>$_<span style='color:#800080; '>;</span>
2478:     <span style='color:#800080; '>}</span>
2479:     $sub<span style='color:#800080; '>{</span>$s<span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>if</span> $s<span style='color:#800080; '>;</span>
2480:   <span style='color:#800080; '>}</span>
2481: <span style='color:#800080; '>}</span>
2482: 
2483: <span style='color:#800000; font-weight:bold; '>sub </span>methods <span style='color:#800080; '>{</span>
2484:   <span style='color:#800000; font-weight:bold; '>my</span> $class <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
2485:   $class <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>ref</span> $class <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>ref</span> $class<span style='color:#800080; '>;</span>
2486:   <span style='color:#800000; font-weight:bold; '>local</span> %seen<span style='color:#800080; '>;</span>
2487:   <span style='color:#800000; font-weight:bold; '>local</span> %packs<span style='color:#800080; '>;</span>
2488:   methods_via<span style='color:#808030; '>(</span>$class<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2489:   methods_via<span style='color:#808030; '>(</span><span style='color:#0000e6; '>'UNIVERSAL'</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'UNIVERSAL'</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2490: <span style='color:#800080; '>}</span>
2491: 
2492: <span style='color:#800000; font-weight:bold; '>sub </span>methods_via <span style='color:#800080; '>{</span>
2493:   <span style='color:#800000; font-weight:bold; '>my</span> $class <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
2494:   <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#800000; font-weight:bold; '>if</span> $packs<span style='color:#800080; '>{</span>$class<span style='color:#800080; '>}</span><span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
2495:   <span style='color:#800000; font-weight:bold; '>my</span> $prefix <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
2496:   <span style='color:#800000; font-weight:bold; '>my</span> $prepend <span style='color:#808030; '>=</span> $prefix <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>"via </span><span style='color:#0000e6; '>$prefix</span><span style='color:#0000e6; '>: "</span> <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>''</span><span style='color:#800080; '>;</span>
2497:   <span style='color:#800000; font-weight:bold; '>my</span> $name<span style='color:#800080; '>;</span>
2498:   <span style='color:#800000; font-weight:bold; '>for</span> $name <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>grep</span> <span style='color:#800080; '>{</span><span style='color:#800000; font-weight:bold; '>defined</span> <span style='color:#808030; '>&amp;</span><span style='color:#800080; '>{</span>${<span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>${class}</span><span style='color:#0000e6; '>::"</span>}<span style='color:#800080; '>{</span>$_<span style='color:#800080; '>}</span><span style='color:#800080; '>}</span><span style='color:#800080; '>}</span> 
2499:          <span style='color:#800000; font-weight:bold; '>sort</span> <span style='color:#800000; font-weight:bold; '>keys</span> %{<span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>${class}</span><span style='color:#0000e6; '>::"</span>}<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2500:     <span style='color:#800000; font-weight:bold; '>next</span> <span style='color:#800000; font-weight:bold; '>if</span> $seen<span style='color:#800080; '>{</span> $name <span style='color:#800080; '>}</span><span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
2501:     <span style='color:#800000; font-weight:bold; '>print</span> $DB<span style='color:#808030; '>::</span>OUT <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$prepend</span><span style='color:#0000e6; '>$name</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
2502:   <span style='color:#800080; '>}</span>
2503:   <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>        <span style='color:#696969; '># Recurse?</span>
2504:   <span style='color:#800000; font-weight:bold; '>for</span> $name <span style='color:#808030; '>(</span>@{<span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>${class}</span><span style='color:#0000e6; '>::ISA"</span>}<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2505:     $prepend <span style='color:#808030; '>=</span> $prefix <span style='color:#808030; '>?</span> $prefix <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>" -> </span><span style='color:#0000e6; '>$name</span><span style='color:#0000e6; '>"</span> <span style='color:#808030; '>:</span> $name<span style='color:#800080; '>;</span>
2506:     methods_via<span style='color:#808030; '>(</span>$name<span style='color:#808030; '>,</span> $prepend<span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2507:   <span style='color:#800080; '>}</span>
2508: <span style='color:#800080; '>}</span>
2509: 
2510: <span style='color:#800000; font-weight:bold; '>sub </span>setman <span style='color:#800080; '>{</span> 
2511:     $doccmd <span style='color:#808030; '>=</span> $^O <span style='color:#808030; '>!~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>?</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#0000e6; '>MSWin32</span><span style='color:#800080; '>|</span><span style='color:#0000e6; '>VMS</span><span style='color:#800080; '>|</span><span style='color:#0000e6; '>os2</span><span style='color:#800080; '>|</span><span style='color:#0000e6; '>dos</span><span style='color:#800080; '>|</span><span style='color:#0000e6; '>amigaos</span><span style='color:#800080; '>|</span><span style='color:#0000e6; '>riscos</span><span style='color:#800080; '>|</span><span style='color:#0000e6; '>MacOS</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>\z</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>s</span>
2512:         <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>"man"</span>             <span style='color:#696969; '># O Happy Day!</span>
2513:         <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>"perldoc"</span><span style='color:#800080; '>;</span>        <span style='color:#696969; '># Alas, poor unfortunates</span>
2514: <span style='color:#800080; '>}</span>
2515: 
2516: <span style='color:#800000; font-weight:bold; '>sub </span>runman <span style='color:#800080; '>{</span>
2517:     <span style='color:#800000; font-weight:bold; '>my</span> $page <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>shift</span><span style='color:#800080; '>;</span>
2518:     <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#808030; '>(</span>$page<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2519:     <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>system</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$doccmd</span><span style='color:#0000e6; '> </span><span style='color:#0000e6; '>$doccmd</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2520:     <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
2521:     <span style='color:#800080; '>}</span> 
2522:     <span style='color:#696969; '># this way user can override, like with $doccmd="man -Mwhatever"</span>
2523:     <span style='color:#696969; '># or even just "man " to disable the path check.</span>
2524:     <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#808030; '>(</span>$doccmd <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'man'</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2525:     <span style='color:#808030; '>&amp;</span><span style='color:#800000; font-weight:bold; '>system</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$doccmd</span><span style='color:#0000e6; '> </span><span style='color:#0000e6; '>$page</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2526:     <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
2527:     <span style='color:#800080; '>}</span> 
2528: 
2529:     $page <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'perl'</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>lc</span><span style='color:#808030; '>(</span>$page<span style='color:#808030; '>)</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'help'</span><span style='color:#800080; '>;</span>
2530: 
2531:     <span style='color:#800000; font-weight:bold; '>require</span> Config<span style='color:#800080; '>;</span>
2532:     <span style='color:#800000; font-weight:bold; '>my</span> $man1dir <span style='color:#808030; '>=</span> $Config<span style='color:#808030; '>::</span>Config<span style='color:#800080; '>{</span><span style='color:#0000e6; '>'man1dir'</span><span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
2533:     <span style='color:#800000; font-weight:bold; '>my</span> $man3dir <span style='color:#808030; '>=</span> $Config<span style='color:#808030; '>::</span>Config<span style='color:#800080; '>{</span><span style='color:#0000e6; '>'man3dir'</span><span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
2534:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span>$man1dir<span style='color:#808030; '>,</span> $man3dir<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>#</span><span style='color:#0000e6; '>/</span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>/</span><span style='color:#808030; '>]</span><span style='color:#808030; '>*</span><span style='color:#800000; font-weight:bold; '>\z</span><span style='color:#800000; '>#</span><span style='color:#800000; '>#</span> <span style='color:#808030; '>if</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>\S</span><span style='color:#800000; '>/</span> <span style='color:#800080; '>}</span> 
2535:     <span style='color:#800000; font-weight:bold; '>my</span> $manpath <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>''</span><span style='color:#800080; '>;</span>
2536:     $manpath <span style='color:#808030; '>.</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$man1dir</span><span style='color:#0000e6; '>:"</span> <span style='color:#800000; font-weight:bold; '>if</span> $man1dir <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>\S</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
2537:     $manpath <span style='color:#808030; '>.</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$man3dir</span><span style='color:#0000e6; '>:"</span> <span style='color:#800000; font-weight:bold; '>if</span> $man3dir <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>\S</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> $man1dir <span style='color:#808030; '>ne</span> $man3dir<span style='color:#800080; '>;</span>
2538:     <span style='color:#800000; font-weight:bold; '>chop</span> $manpath <span style='color:#800000; font-weight:bold; '>if</span> $manpath<span style='color:#800080; '>;</span>
2539:     <span style='color:#696969; '># harmless if missing, I figure</span>
2540:     <span style='color:#800000; font-weight:bold; '>my</span> $oldpath <span style='color:#808030; '>=</span> $ENV<span style='color:#800080; '>{</span>MANPATH<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
2541:     $ENV<span style='color:#800080; '>{</span>MANPATH<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> $manpath <span style='color:#800000; font-weight:bold; '>if</span> $manpath<span style='color:#800080; '>;</span>
2542:     <span style='color:#800000; font-weight:bold; '>my</span> $nopathopt <span style='color:#808030; '>=</span> $^O <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>dunno what goes here</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
2543:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>system</span><span style='color:#808030; '>(</span>$doccmd<span style='color:#808030; '>,</span> 
2544:         <span style='color:#696969; '># I just *know* there are men without -M</span>
2545:         <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>$manpath <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>!</span>$nopathopt<span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> <span style='color:#808030; '>(</span><span style='color:#0000e6; '>"-M"</span><span style='color:#808030; '>,</span> $manpath<span style='color:#808030; '>)</span> <span style='color:#808030; '>:</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>  
2546:         <span style='color:#800000; font-weight:bold; '>split</span> <span style='color:#0000e6; '>' '</span><span style='color:#808030; '>,</span> $page<span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span>
2547:     <span style='color:#800080; '>{</span>
2548:     <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#808030; '>(</span>$page <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>perl</span><span style='color:#0000e6; '>\w</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2549:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>grep</span> <span style='color:#800080; '>{</span> $page <span style='color:#808030; '>eq</span> $_ <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>qw</span><span style='color:#800000; '>{</span><span style='color:#0000e6; '> </span>
2550: <span style='color:#0000e6; '>        5004delta 5005delta amiga api apio book boot bot call compile</span>
2551: <span style='color:#0000e6; '>        cygwin data dbmfilter debug debguts delta diag doc dos dsc embed</span>
2552: <span style='color:#0000e6; '>        faq faq1 faq2 faq3 faq4 faq5 faq6 faq7 faq8 faq9 filter fork</span>
2553: <span style='color:#0000e6; '>        form func guts hack hist hpux intern ipc lexwarn locale lol mod</span>
2554: <span style='color:#0000e6; '>        modinstall modlib number obj op opentut os2 os390 pod port </span>
2555: <span style='color:#0000e6; '>        ref reftut run sec style sub syn thrtut tie toc todo toot tootc</span>
2556: <span style='color:#0000e6; '>        trap unicode var vms win32 xs xstut</span>
2557: <span style='color:#0000e6; '>          </span><span style='color:#800000; '>}</span><span style='color:#808030; '>)</span> 
2558:         <span style='color:#800080; '>{</span>
2559:         $page <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>perl</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
2560:         <span style='color:#800000; font-weight:bold; '>system</span><span style='color:#808030; '>(</span>$doccmd<span style='color:#808030; '>,</span> 
2561:             <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>$manpath <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>!</span>$nopathopt<span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> <span style='color:#808030; '>(</span><span style='color:#0000e6; '>"-M"</span><span style='color:#808030; '>,</span> $manpath<span style='color:#808030; '>)</span> <span style='color:#808030; '>:</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>  
2562:             $page<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2563:         <span style='color:#800080; '>}</span>
2564:     <span style='color:#800080; '>}</span>
2565:     <span style='color:#800080; '>}</span> 
2566:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $oldpath<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2567:     $ENV<span style='color:#800080; '>{</span>MANPATH<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> $manpath<span style='color:#800080; '>;</span>
2568:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
2569:     <span style='color:#800000; font-weight:bold; '>delete</span> $ENV<span style='color:#800080; '>{</span>MANPATH<span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
2570:     <span style='color:#800080; '>}</span> 
2571: <span style='color:#800080; '>}</span> 
2572: 
2573: <span style='color:#696969; '># The following BEGIN is very handy if debugger goes havoc, debugging debugger?</span>
2574: 
2575: <span style='color:#800000; font-weight:bold; '>BEGIN</span> <span style='color:#800080; '>{</span>            <span style='color:#696969; '># This does not compile, alas.</span>
2576:   $IN <span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span>*STDIN<span style='color:#800080; '>;</span>        <span style='color:#696969; '># For bugs before DB::OUT has been opened</span>
2577:   $OUT <span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span>*STDERR<span style='color:#800080; '>;</span>        <span style='color:#696969; '># For errors before DB::OUT has been opened</span>
2578:   $sh <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'!'</span><span style='color:#800080; '>;</span>
2579:   $rc <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>','</span><span style='color:#800080; '>;</span>
2580:   @hist <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span><span style='color:#0000e6; '>'?'</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2581:   $deep <span style='color:#808030; '>=</span> <span style='color:#008c00; '>100</span><span style='color:#800080; '>;</span>            <span style='color:#696969; '># warning if stack gets this deep</span>
2582:   $window <span style='color:#808030; '>=</span> <span style='color:#008c00; '>10</span><span style='color:#800080; '>;</span>
2583:   $preview <span style='color:#808030; '>=</span> <span style='color:#008c00; '>3</span><span style='color:#800080; '>;</span>
2584:   $sub <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>''</span><span style='color:#800080; '>;</span>
2585:   $SIG<span style='color:#800080; '>{</span>INT<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span><span style='color:#808030; '>&amp;</span><span style='color:#bb7977; font-weight:bold; '>DB</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>catch</span><span style='color:#800080; '>;</span>
2586:   <span style='color:#696969; '># This may be enabled to debug debugger:</span>
2587:   <span style='color:#696969; '>#$warnLevel = 1 unless defined $warnLevel;</span>
2588:   <span style='color:#696969; '>#$dieLevel = 1 unless defined $dieLevel;</span>
2589:   <span style='color:#696969; '>#$signalLevel = 1 unless defined $signalLevel;</span>
2590: 
2591:   $db_stop <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>            <span style='color:#696969; '># Compiler warning</span>
2592:   $db_stop <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>30</span><span style='color:#800080; '>;</span>
2593:   $level <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>            <span style='color:#696969; '># Level of recursive debugging</span>
2594:   <span style='color:#696969; '># @stack and $doret are needed in sub sub, which is called for DB::postponed.</span>
2595:   <span style='color:#696969; '># Triggers </span><span style='color:#ffffff; background:#808000; '>bug (?) in perl is we postpone this until runtime:</span>
2596:   @postponed <span style='color:#808030; '>=</span> @stack <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2597:   $stack_depth <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>        <span style='color:#696969; '># Localized $#stack</span>
2598:   $doret <span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>2</span><span style='color:#800080; '>;</span>
2599:   $frame <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
2600: <span style='color:#800080; '>}</span>
2601: 
2602: <span style='color:#800000; font-weight:bold; '>BEGIN</span> <span style='color:#800080; '>{</span>$^W <span style='color:#808030; '>=</span> $ini_warn<span style='color:#800080; '>;</span><span style='color:#800080; '>}</span>    <span style='color:#696969; '># Switch warnings back</span>
2603: 
2604: <span style='color:#696969; '>#use Carp;            # This did break, left for debuggin</span>
2605: 
2606: <span style='color:#800000; font-weight:bold; '>sub </span>db_complete <span style='color:#800080; '>{</span>
2607:   <span style='color:#696969; '># Specific code for b c l V m f O, &amp;blah, $blah, @blah, %blah</span>
2608:   <span style='color:#800000; font-weight:bold; '>my</span><span style='color:#808030; '>(</span>$text<span style='color:#808030; '>,</span> $line<span style='color:#808030; '>,</span> $start<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> @_<span style='color:#800080; '>;</span>
2609:   <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>$itext<span style='color:#808030; '>,</span> $search<span style='color:#808030; '>,</span> $prefix<span style='color:#808030; '>,</span> $pack<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span>
2610:     <span style='color:#808030; '>(</span>$text<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"^</span><span style='color:#800000; font-weight:bold; '>\Q</span><span style='color:#0000e6; '>${'package'}::</span><span style='color:#800000; font-weight:bold; '>\E</span><span style='color:#0000e6; '>([^:]+)</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2611:   
2612:   <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#800000; font-weight:bold; '>sort</span> <span style='color:#808030; '>grep</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\Q</span><span style='color:#0000e6; '>$text</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>keys</span> %sub<span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>qw</span><span style='color:#800000; '>(</span><span style='color:#0000e6; '>postpone load compile</span><span style='color:#800000; '>)</span><span style='color:#808030; '>,</span> <span style='color:#696969; '># subroutines</span>
2613:                                <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>map</span> <span style='color:#800080; '>{</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>$search</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>?</span> <span style='color:#808030; '>(</span>$1<span style='color:#808030; '>)</span> <span style='color:#808030; '>:</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>keys</span> %sub<span style='color:#808030; '>)</span>
2614:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>substr</span> $line<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> $start<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\|</span><span style='color:#808030; '>*</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>blc</span><span style='color:#808030; '>]</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>postpone</span><span style='color:#800080; '>|</span><span style='color:#0000e6; '>compile</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#808030; '>?</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
2615:   <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#800000; font-weight:bold; '>sort</span> <span style='color:#808030; '>grep</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\Q</span><span style='color:#0000e6; '>$text</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>values</span> %INC <span style='color:#696969; '># files</span>
2616:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>substr</span> $line<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> $start<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\|</span><span style='color:#808030; '>*</span><span style='color:#0000e6; '>b</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#0000e6; '>load</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
2617:   <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#800000; font-weight:bold; '>sort</span> <span style='color:#800000; font-weight:bold; '>map</span> <span style='color:#800080; '>{</span><span style='color:#808030; '>(</span>$_<span style='color:#808030; '>,</span> db_complete<span style='color:#808030; '>(</span>$_ <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>"::"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"V "</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>}</span>
2618:     <span style='color:#808030; '>grep</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\Q</span><span style='color:#0000e6; '>$text</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>map</span> <span style='color:#800080; '>{</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>::</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>?</span> <span style='color:#808030; '>(</span>$1<span style='color:#808030; '>)</span> <span style='color:#808030; '>:</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>keys</span> %<span style='color:#808030; '>:</span><span style='color:#808030; '>:</span> <span style='color:#696969; '># top-packages</span>
2619:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>substr</span> $line<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> $start<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\|</span><span style='color:#808030; '>*</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>Vm</span><span style='color:#808030; '>]</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>and</span> $text <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>\w</span><span style='color:#808030; '>*</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
2620:   <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#800000; font-weight:bold; '>sort</span> <span style='color:#800000; font-weight:bold; '>map</span> <span style='color:#800080; '>{</span><span style='color:#808030; '>(</span>$_<span style='color:#808030; '>,</span> db_complete<span style='color:#808030; '>(</span>$_ <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>"::"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"V "</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>}</span>
2621:     <span style='color:#800000; font-weight:bold; '>grep</span> <span style='color:#808030; '>!</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>main::</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span>
2622:       <span style='color:#808030; '>grep</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\Q</span><span style='color:#0000e6; '>$text</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>map</span> <span style='color:#800080; '>{</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>::</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>?</span> <span style='color:#808030; '>(</span>$prefix <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>"::</span><span style='color:#0000e6; '>$1</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>:</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>keys</span> %{$prefix <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>'::'</span>}
2623:                  <span style='color:#696969; '># packages</span>
2624:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>substr</span> $line<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> $start<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\|</span><span style='color:#808030; '>*</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>Vm</span><span style='color:#808030; '>]</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> 
2625:       <span style='color:#808030; '>and</span> $text <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>[</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>:</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>::</span><span style='color:#808030; '>?</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\w</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span>  <span style='color:#808030; '>and</span> $prefix <span style='color:#808030; '>=</span> $1<span style='color:#800080; '>;</span>
2626:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span> $line <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\|</span><span style='color:#808030; '>*</span><span style='color:#0000e6; '>f</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>+</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#696969; '># Loaded files</span>
2627:     <span style='color:#696969; '># We may want to complete to (eval 9), so $text may be wrong</span>
2628:     $prefix <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>length</span><span style='color:#808030; '>(</span>$1<span style='color:#808030; '>)</span> <span style='color:#808030; '>-</span> <span style='color:#800000; font-weight:bold; '>length</span><span style='color:#808030; '>(</span>$text<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2629:     $text <span style='color:#808030; '>=</span> $1<span style='color:#800080; '>;</span>
2630:     <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#800000; font-weight:bold; '>sort</span> 
2631:     <span style='color:#800000; font-weight:bold; '>map</span> <span style='color:#800080; '>{</span><span style='color:#800000; font-weight:bold; '>substr</span> $_<span style='color:#808030; '>,</span> <span style='color:#008c00; '>2</span> <span style='color:#808030; '>+</span> $prefix<span style='color:#800080; '>}</span> <span style='color:#808030; '>grep</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>_&lt;</span><span style='color:#0f69ff; '>\Q</span><span style='color:#0000e6; '>$text</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>keys</span> %main<span style='color:#808030; '>:</span><span style='color:#808030; '>:</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> $0
2632:   <span style='color:#800080; '>}</span>
2633:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>substr</span> $text<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'&amp;'</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#696969; '># subroutines</span>
2634:     $text <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>substr</span> $text<span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
2635:     $prefix <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"&amp;"</span><span style='color:#800080; '>;</span>
2636:     <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#800000; font-weight:bold; '>sort</span> <span style='color:#800000; font-weight:bold; '>map</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$prefix</span><span style='color:#0000e6; '>$_</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>,</span> 
2637:                <span style='color:#808030; '>grep</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\Q</span><span style='color:#0000e6; '>$text</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> 
2638:                  <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>keys</span> %sub<span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>
2639:                  <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>map</span> <span style='color:#800080; '>{</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>$search</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>?</span> <span style='color:#808030; '>(</span>$1<span style='color:#808030; '>)</span> <span style='color:#808030; '>:</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>}</span> 
2640:             <span style='color:#800000; font-weight:bold; '>keys</span> %sub<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2641:   <span style='color:#800080; '>}</span>
2642:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$text <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>@%</span><span style='color:#808030; '>]</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>::</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#696969; '># symbols in a package</span>
2643:     $pack <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$1 <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'main'</span> <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>''</span> <span style='color:#808030; '>:</span> $1<span style='color:#808030; '>)</span> <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>'::'</span><span style='color:#800080; '>;</span>
2644:     $prefix <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>substr</span> $text<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>.</span> $1 <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>'::'</span><span style='color:#800080; '>;</span>
2645:     $text <span style='color:#808030; '>=</span> $2<span style='color:#800080; '>;</span>
2646:     <span style='color:#800000; font-weight:bold; '>my</span> @out 
2647:       <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>map</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$prefix</span><span style='color:#0000e6; '>$_</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>grep</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\Q</span><span style='color:#0000e6; '>$text</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>grep</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>_</span><span style='color:#808030; '>?</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>a</span><span style='color:#808030; '>-</span><span style='color:#0000e6; '>zA</span><span style='color:#808030; '>-</span><span style='color:#0000e6; '>Z</span><span style='color:#808030; '>]</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>keys</span> <span style='color:#808030; '>%</span>$pack <span style='color:#800080; '>;</span>
2648:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>@out <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#808030; '>and</span> $out<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>::</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>and</span> $out<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>ne</span> $itext<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2649:       <span style='color:#800000; font-weight:bold; '>return</span> db_complete<span style='color:#808030; '>(</span>$out<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> $line<span style='color:#808030; '>,</span> $start<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2650:     <span style='color:#800080; '>}</span>
2651:     <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#800000; font-weight:bold; '>sort</span> @out<span style='color:#800080; '>;</span>
2652:   <span style='color:#800080; '>}</span>
2653:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$text <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>@%</span><span style='color:#808030; '>]</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#696969; '># symbols (in $package + packages in main)</span>
2654:     $pack <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$package <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'main'</span> <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>''</span> <span style='color:#808030; '>:</span> $package<span style='color:#808030; '>)</span> <span style='color:#808030; '>.</span> <span style='color:#0000e6; '>'::'</span><span style='color:#800080; '>;</span>
2655:     $prefix <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>substr</span> $text<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
2656:     $text <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>substr</span> $text<span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
2657:     <span style='color:#800000; font-weight:bold; '>my</span> @out <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>map</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$prefix</span><span style='color:#0000e6; '>$_</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>grep</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\Q</span><span style='color:#0000e6; '>$text</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> 
2658:        <span style='color:#808030; '>(</span><span style='color:#808030; '>grep</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>_</span><span style='color:#808030; '>?</span><span style='color:#808030; '>[</span><span style='color:#0000e6; '>a</span><span style='color:#808030; '>-</span><span style='color:#0000e6; '>zA</span><span style='color:#808030; '>-</span><span style='color:#0000e6; '>Z</span><span style='color:#808030; '>]</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>keys</span> <span style='color:#808030; '>%</span>$pack<span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> 
2659:        <span style='color:#808030; '>(</span> $pack <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'::'</span> <span style='color:#808030; '>?</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>:</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>grep</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>::</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>keys</span> %<span style='color:#808030; '>:</span><span style='color:#808030; '>:</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span> <span style='color:#800080; '>;</span>
2660:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>@out <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#808030; '>and</span> $out<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>::</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#808030; '>and</span> $out<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>ne</span> $itext<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2661:       <span style='color:#800000; font-weight:bold; '>return</span> db_complete<span style='color:#808030; '>(</span>$out<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> $line<span style='color:#808030; '>,</span> $start<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2662:     <span style='color:#800080; '>}</span>
2663:     <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#800000; font-weight:bold; '>sort</span> @out<span style='color:#800080; '>;</span>
2664:   <span style='color:#800080; '>}</span>
2665:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>substr</span> $line<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> $start<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\|</span><span style='color:#808030; '>*</span><span style='color:#0000e6; '>O</span><span style='color:#0f69ff; '>\b</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#0000e6; '>\s</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#696969; '># Options after a space</span>
2666:     <span style='color:#800000; font-weight:bold; '>my</span> @out <span style='color:#808030; '>=</span> <span style='color:#808030; '>grep</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0f69ff; '>\Q</span><span style='color:#0000e6; '>$text</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> @options<span style='color:#800080; '>;</span>
2667:     <span style='color:#800000; font-weight:bold; '>my</span> $val <span style='color:#808030; '>=</span> option_val<span style='color:#808030; '>(</span>$out<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>undef</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2668:     <span style='color:#800000; font-weight:bold; '>my</span> $out <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'? '</span><span style='color:#800080; '>;</span>
2669:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>not</span> <span style='color:#800000; font-weight:bold; '>defined</span> $val <span style='color:#808030; '>or</span> $val <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>[</span><span style='color:#0f69ff; '>\n</span><span style='color:#0f69ff; '>\r</span><span style='color:#808030; '>]</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2670:       <span style='color:#696969; '># Can do nothing better</span>
2671:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>elsif</span> <span style='color:#808030; '>(</span>$val <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>\s</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2672:       <span style='color:#800000; font-weight:bold; '>my</span> $found<span style='color:#800080; '>;</span>
2673:       <span style='color:#800000; font-weight:bold; '>foreach</span> $l <span style='color:#808030; '>(</span><span style='color:#808030; '>split</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>qq</span><span style='color:#800000; '>/</span><span style='color:#0f69ff; '>\"</span><span style='color:#0f69ff; '>\'</span><span style='color:#0f69ff; '>\#</span><span style='color:#0f69ff; '>\|</span><span style='color:#800000; '>/</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
2674:     $out <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>$l</span><span style='color:#0000e6; '>$val</span><span style='color:#0000e6; '>$l</span><span style='color:#0000e6; '> "</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>last</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>index</span> $val<span style='color:#808030; '>,</span> $l<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
2675:       <span style='color:#800080; '>}</span>
2676:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
2677:       $out <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"=</span><span style='color:#0000e6; '>$val</span><span style='color:#0000e6; '> "</span><span style='color:#800080; '>;</span>
2678:     <span style='color:#800080; '>}</span>
2679:     <span style='color:#696969; '># Default to value if one completion, to question if many</span>
2680:     $rl_attribs<span style='color:#808030; '>-></span><span style='color:#800080; '>{</span>completer_terminator_character<span style='color:#800080; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>@out <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#808030; '>?</span> $out <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>'? '</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
2681:     <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#800000; font-weight:bold; '>sort</span> @out<span style='color:#800080; '>;</span>
2682:   <span style='color:#800080; '>}</span>
2683:   <span style='color:#800000; font-weight:bold; '>return</span> $term<span style='color:#808030; '>-></span>filename_list<span style='color:#808030; '>(</span>$text<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span> <span style='color:#696969; '># filenames</span>
2684: <span style='color:#800080; '>}</span>
2685: 
2686: <span style='color:#800000; font-weight:bold; '>sub </span>end_report <span style='color:#800080; '>{</span>
2687:   <span style='color:#800000; font-weight:bold; '>print</span> $OUT <span style='color:#0000e6; '>"Use `q' to quit or `R' to restart.  `h q' for details.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
2688: <span style='color:#800080; '>}</span>
2689: 
2690: <span style='color:#800000; font-weight:bold; '>END</span> <span style='color:#800080; '>{</span>
2691:   $finished <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>if</span> $inhibit_exit<span style='color:#800080; '>;</span>      <span style='color:#696969; '># So that some keys may be disabled.</span>
2692:   $fall_off_end <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>unless</span> $inhibit_exit<span style='color:#800080; '>;</span>
2693:   <span style='color:#696969; '># Do not stop in at_exit() and destructors on exit:</span>
2694:   $DB<span style='color:#808030; '>::</span>single <span style='color:#808030; '>=</span> <span style='color:#808030; '>!</span>$fall_off_end <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>!</span>$runnonstop<span style='color:#800080; '>;</span>
2695:   <span style='color:#bb7977; font-weight:bold; '>DB</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>fake</span><span style='color:#808030; '>:</span><span style='color:#808030; '>:</span>at_exit<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>unless</span> $fall_off_end <span style='color:#808030; '>or</span> $runnonstop<span style='color:#800080; '>;</span>
2696: <span style='color:#800080; '>}</span>
2697: 
2698: <span style='color:#800000; font-weight:bold; '>package </span><span style='color:#bb7977; font-weight:bold; '>DB</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>fake</span><span style='color:#800080; '>;</span>
2699: 
2700: <span style='color:#800000; font-weight:bold; '>sub </span>at_exit <span style='color:#800080; '>{</span>
2701:   <span style='color:#0000e6; '>"Debugged program terminated.  Use `q' to quit or `R' to restart."</span><span style='color:#800080; '>;</span>
2702: <span style='color:#800080; '>}</span>
2703: 
2704: <span style='color:#800000; font-weight:bold; '>package </span>DB<span style='color:#800080; '>;</span>            <span style='color:#696969; '># Do not trace this 1; below!</span>
2705: 
2706: <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
2707: 
</pre></body></html>
