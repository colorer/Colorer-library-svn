  0: <span style='color:#696969; '>(* Copyright (C) 1987 Jensen &amp; Partners International *)</span>
  1: 
  2: <span style='color:#696969; '>(*$N,V-,I-,R-,A-,S-*)</span>
  3: <span style='color:#800000; font-weight:bold; '>IMPLEMENTATION</span> <span style='color:#800000; font-weight:bold; '>MODULE</span> Graph<span style='color:#808030; '>;</span>
  4: <span style='color:#800000; font-weight:bold; '>IMPORT</span> Lib<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#808030; '>;</span>
  5: 
  6: <span style='color:#800000; font-weight:bold; '>TYPE</span>
  7:   tinyint      <span style='color:#808030; '>=</span> <span style='color:#808030; '>[</span><span style='color:#008c00; '>0..7</span><span style='color:#808030; '>]</span><span style='color:#808030; '>;</span>
  8:   bs           <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>SET</span> <span style='color:#800000; font-weight:bold; '>OF</span> tinyint<span style='color:#808030; '>;</span>
  9:   bp           <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>POINTER</span> <span style='color:#800000; font-weight:bold; '>TO</span> bs<span style='color:#808030; '>;</span>
 10:   HercMapType  <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>ARRAY</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>.</span><span style='color:#808030; '>.</span><span style='color:#808030; '>(</span>HercDepth <span style='color:#800000; font-weight:bold; '>DIV</span> <span style='color:#008c00; '>4</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#800000; font-weight:bold; '>OF</span>
 11:                    <span style='color:#800000; font-weight:bold; '>ARRAY</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>.</span><span style='color:#808030; '>.</span><span style='color:#808030; '>(</span>HercWidth <span style='color:#800000; font-weight:bold; '>DIV</span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#800000; font-weight:bold; '>OF</span> bs<span style='color:#808030; '>;</span>
 12:   ATTMapType   <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>ARRAY</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>.</span><span style='color:#808030; '>.</span><span style='color:#808030; '>(</span>ATTDepth <span style='color:#800000; font-weight:bold; '>DIV</span> <span style='color:#008c00; '>4</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#800000; font-weight:bold; '>OF</span>
 13:                    <span style='color:#800000; font-weight:bold; '>ARRAY</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>.</span><span style='color:#808030; '>.</span><span style='color:#808030; '>(</span>ATTWidth <span style='color:#800000; font-weight:bold; '>DIV</span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#800000; font-weight:bold; '>OF</span> bs<span style='color:#808030; '>;</span>
 14: <span style='color:#800000; font-weight:bold; '>VAR</span>
 15:   HercBitMap   <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>ARRAY</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>0..3</span><span style='color:#808030; '>]</span> <span style='color:#800000; font-weight:bold; '>OF</span> <span style='color:#800000; font-weight:bold; '>POINTER</span> <span style='color:#800000; font-weight:bold; '>TO</span> HercMapType<span style='color:#808030; '>;</span>
 16:   ATTBitMap    <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>ARRAY</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>0..3</span><span style='color:#808030; '>]</span> <span style='color:#800000; font-weight:bold; '>OF</span> <span style='color:#800000; font-weight:bold; '>POINTER</span> <span style='color:#800000; font-weight:bold; '>TO</span> ATTMapType<span style='color:#808030; '>;</span>
 17:   EGAScreen <span style='color:#808030; '>[</span><span style='color:#008c00; '>0A000H</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>ARRAY</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>0..0</span><span style='color:#808030; '>]</span> <span style='color:#800000; font-weight:bold; '>OF</span> bs<span style='color:#808030; '>;</span>
 18: 
 19: 
 20: <span style='color:#696969; '>(* == CGA specific routines == *)</span>
 21: 
 22: 
 23: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> CGAGraphMode<span style='color:#808030; '>;</span>
 24: <span style='color:#800000; font-weight:bold; '>VAR</span> r <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Registers<span style='color:#808030; '>;</span>
 25: <span style='color:#808030; '>BEGIN</span>
 26:   r<span style='color:#008c00; '>.</span>AX <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>5</span><span style='color:#808030; '>;</span>
 27:   Lib<span style='color:#008c00; '>.</span>Intr<span style='color:#808030; '>(</span> r<span style='color:#808030; '>,</span><span style='color:#008c00; '>10H</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 28: <span style='color:#808030; '>END</span> CGAGraphMode<span style='color:#808030; '>;</span>
 29: 
 30: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> CGATextMode<span style='color:#808030; '>;</span>
 31: <span style='color:#800000; font-weight:bold; '>VAR</span> r <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Registers<span style='color:#808030; '>;</span>
 32: <span style='color:#808030; '>BEGIN</span>
 33:   r<span style='color:#008c00; '>.</span>AX <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>3</span><span style='color:#808030; '>;</span>
 34:   Lib<span style='color:#008c00; '>.</span>Intr<span style='color:#808030; '>(</span> r<span style='color:#808030; '>,</span><span style='color:#008c00; '>10H</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 35: <span style='color:#808030; '>END</span> CGATextMode<span style='color:#808030; '>;</span>
 36: 
 37: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> CGAPlot<span style='color:#808030; '>(</span>x<span style='color:#808030; '>,</span>y<span style='color:#808030; '>:</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>c<span style='color:#808030; '>:</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 38: <span style='color:#800000; font-weight:bold; '>VAR</span>
 39:   off <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
 40:   seg <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
 41:   tmp <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
 42: <span style='color:#808030; '>BEGIN</span>
 43:   <span style='color:#808030; '>IF</span> <span style='color:#808030; '>(</span>x <span style='color:#808030; '>>=</span> CGAWidth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>OR</span> <span style='color:#808030; '>(</span>y <span style='color:#808030; '>>=</span> CGADepth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#800000; font-weight:bold; '>RETURN</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
 44:   off <span style='color:#808030; '>:=</span> x <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>;</span>
 45:   <span style='color:#808030; '>IF</span> ODD<span style='color:#808030; '>(</span>y<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span> INC<span style='color:#808030; '>(</span> off<span style='color:#808030; '>,</span> <span style='color:#008c00; '>2000H</span> <span style='color:#808030; '>-</span> <span style='color:#008c00; '>40</span> <span style='color:#808030; '>)</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
 46:   INC<span style='color:#808030; '>(</span> y<span style='color:#808030; '>,</span> y <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>2</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 47:   INC<span style='color:#808030; '>(</span> off<span style='color:#808030; '>,</span> y <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>3</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 48:   x <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>3</span> <span style='color:#808030; '>-</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>(</span> BITSET<span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span> <span style='color:#808030; '>*</span> BITSET<span style='color:#808030; '>(</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 49:   x <span style='color:#808030; '>:=</span> x <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
 50:   tmp <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0B800H</span><span style='color:#808030; '>;</span> seg <span style='color:#808030; '>:=</span> tmp<span style='color:#808030; '>;</span>
 51:   <span style='color:#808030; '>[</span>seg<span style='color:#808030; '>:</span>off bp<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span> <span style='color:#808030; '>:=</span> <span style='color:#808030; '>(</span> <span style='color:#808030; '>[</span>seg<span style='color:#808030; '>:</span>off bp<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span> <span style='color:#808030; '>-</span> bs<span style='color:#808030; '>(</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span>x<span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span> <span style='color:#808030; '>+</span> bs<span style='color:#808030; '>(</span>c<span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span>x<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 52: <span style='color:#808030; '>END</span> CGAPlot<span style='color:#808030; '>;</span>
 53: 
 54: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> CGAPoint<span style='color:#808030; '>(</span>x<span style='color:#808030; '>,</span>y<span style='color:#808030; '>:</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
 55: <span style='color:#800000; font-weight:bold; '>VAR</span>
 56:   off <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
 57:   seg <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
 58:   tmp <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
 59: <span style='color:#808030; '>BEGIN</span>
 60:   <span style='color:#808030; '>IF</span> <span style='color:#808030; '>(</span>x <span style='color:#808030; '>>=</span> CGAWidth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>OR</span> <span style='color:#808030; '>(</span>y <span style='color:#808030; '>>=</span> CGADepth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#800000; font-weight:bold; '>RETURN</span> MAX<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
 61:   off <span style='color:#808030; '>:=</span> x <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>;</span>
 62:   <span style='color:#808030; '>IF</span> ODD<span style='color:#808030; '>(</span>y<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span> INC<span style='color:#808030; '>(</span> off<span style='color:#808030; '>,</span> <span style='color:#008c00; '>2000H</span> <span style='color:#808030; '>-</span> <span style='color:#008c00; '>40</span> <span style='color:#808030; '>)</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
 63:   INC<span style='color:#808030; '>(</span> y<span style='color:#808030; '>,</span> y <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>2</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 64:   INC<span style='color:#808030; '>(</span> off<span style='color:#808030; '>,</span> y <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>3</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 65:   x <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>3</span> <span style='color:#808030; '>-</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>(</span> BITSET<span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span> <span style='color:#808030; '>*</span> BITSET<span style='color:#808030; '>(</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 66:   x <span style='color:#808030; '>:=</span> x <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
 67:   tmp <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0B800H</span><span style='color:#808030; '>;</span> seg <span style='color:#808030; '>:=</span> tmp<span style='color:#808030; '>;</span>
 68:   <span style='color:#800000; font-weight:bold; '>RETURN</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>(</span> <span style='color:#808030; '>[</span>seg<span style='color:#808030; '>:</span>off bp<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span> <span style='color:#808030; '>*</span> bs<span style='color:#808030; '>(</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span>x<span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span> <span style='color:#808030; '>></span><span style='color:#808030; '>></span> x<span style='color:#808030; '>;</span>
 69: <span style='color:#808030; '>END</span> CGAPoint<span style='color:#808030; '>;</span>
 70: 
 71: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> CGAHLine <span style='color:#808030; '>(</span> x<span style='color:#808030; '>,</span>y<span style='color:#808030; '>,</span>x2 <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span> c<span style='color:#808030; '>:</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 72: <span style='color:#800000; font-weight:bold; '>VAR</span>
 73:   off  <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
 74:   seg  <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
 75:   tmp  <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
 76:   n    <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
 77:   w    <span style='color:#808030; '>:</span> bs<span style='color:#808030; '>;</span>
 78:   mask <span style='color:#808030; '>:</span> bs<span style='color:#808030; '>;</span>
 79:   fillc<span style='color:#808030; '>:</span> SHORTCARD<span style='color:#808030; '>;</span>
 80: <span style='color:#808030; '>BEGIN</span>
 81:   <span style='color:#808030; '>IF</span> y <span style='color:#808030; '>></span> CGADepth<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#800000; font-weight:bold; '>RETURN</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
 82:   <span style='color:#808030; '>IF</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span> <span style='color:#808030; '>>=</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>CGAWidth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#800000; font-weight:bold; '>RETURN</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
 83:   <span style='color:#808030; '>IF</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span> <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>THEN</span> x <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
 84:   <span style='color:#808030; '>IF</span> x2 <span style='color:#808030; '>>=</span> CGAWidth <span style='color:#800000; font-weight:bold; '>THEN</span> x2 <span style='color:#808030; '>:=</span> CGAWidth<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
 85: 
 86:   n <span style='color:#808030; '>:=</span> <span style='color:#808030; '>(</span> x2 <span style='color:#808030; '>-</span> x <span style='color:#808030; '>)</span> <span style='color:#808030; '>+</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
 87:   off <span style='color:#808030; '>:=</span> x <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>;</span>
 88:   <span style='color:#808030; '>IF</span> ODD<span style='color:#808030; '>(</span>y<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
 89:     INC<span style='color:#808030; '>(</span> off<span style='color:#808030; '>,</span> <span style='color:#008c00; '>2000H</span> <span style='color:#808030; '>-</span> <span style='color:#008c00; '>40</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 90:     c <span style='color:#808030; '>:=</span> <span style='color:#808030; '>(</span> c <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>2</span> <span style='color:#808030; '>+</span> c <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>2</span> <span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>16</span><span style='color:#808030; '>;</span>
 91:   <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
 92:   c <span style='color:#808030; '>:=</span> c <span style='color:#808030; '>+</span> c <span style='color:#808030; '>*</span> <span style='color:#008c00; '>16</span><span style='color:#808030; '>;</span>
 93:   INC<span style='color:#808030; '>(</span> y<span style='color:#808030; '>,</span> y <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>2</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 94:   INC<span style='color:#808030; '>(</span> off<span style='color:#808030; '>,</span> y <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>3</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 95:   x <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>3</span> <span style='color:#808030; '>-</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>(</span> BITSET<span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span> <span style='color:#808030; '>*</span> BITSET<span style='color:#808030; '>(</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 96:   x <span style='color:#808030; '>:=</span> x <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
 97:   tmp <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0B800H</span><span style='color:#808030; '>;</span> seg <span style='color:#808030; '>:=</span> tmp<span style='color:#808030; '>;</span>
 98: 
 99:   w <span style='color:#808030; '>:=</span> <span style='color:#808030; '>[</span>seg<span style='color:#808030; '>:</span>off bp<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>;</span>
100:   <span style='color:#808030; '>REPEAT</span>
101:     mask <span style='color:#808030; '>:=</span> bs<span style='color:#808030; '>(</span><span style='color:#008c00; '>3</span> <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span> x<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
102:     w <span style='color:#808030; '>:=</span> <span style='color:#808030; '>(</span> w <span style='color:#808030; '>-</span> mask <span style='color:#808030; '>)</span> <span style='color:#808030; '>+</span> bs<span style='color:#808030; '>(</span>c<span style='color:#808030; '>)</span><span style='color:#808030; '>*</span>mask<span style='color:#808030; '>;</span>
103:     DEC<span style='color:#808030; '>(</span>n<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
104:     DEC<span style='color:#808030; '>(</span>x<span style='color:#808030; '>,</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
105:   <span style='color:#808030; '>UNTIL</span> <span style='color:#808030; '>(</span>n<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>OR</span> <span style='color:#808030; '>(</span>x<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>(</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
106:   <span style='color:#808030; '>[</span>seg<span style='color:#808030; '>:</span>off bp<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span> <span style='color:#808030; '>:=</span> w<span style='color:#808030; '>;</span>
107: 
108:   INC<span style='color:#808030; '>(</span>off<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
109:   Lib<span style='color:#008c00; '>.</span>Fill<span style='color:#808030; '>(</span> <span style='color:#808030; '>[</span>seg<span style='color:#808030; '>:</span>off<span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> n <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>,</span> SHORTCARD<span style='color:#808030; '>(</span>c<span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
110:   INC<span style='color:#808030; '>(</span> off<span style='color:#808030; '>,</span> n <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>2</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
111:   n <span style='color:#808030; '>:=</span> n <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>4</span><span style='color:#808030; '>;</span>
112:   x <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>6</span><span style='color:#808030; '>;</span>
113:   w <span style='color:#808030; '>:=</span> <span style='color:#808030; '>[</span>seg<span style='color:#808030; '>:</span>off bp<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>;</span>
114:   <span style='color:#808030; '>WHILE</span> n <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>></span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>DO</span>
115:     mask <span style='color:#808030; '>:=</span> bs<span style='color:#808030; '>(</span><span style='color:#008c00; '>3</span> <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span> x<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
116:     w <span style='color:#808030; '>:=</span> <span style='color:#808030; '>(</span> w <span style='color:#808030; '>-</span> mask <span style='color:#808030; '>)</span> <span style='color:#808030; '>+</span> bs<span style='color:#808030; '>(</span>c<span style='color:#808030; '>)</span><span style='color:#808030; '>*</span>mask<span style='color:#808030; '>;</span>
117:     DEC<span style='color:#808030; '>(</span>n<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
118:     DEC<span style='color:#808030; '>(</span>x<span style='color:#808030; '>,</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
119:   <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
120:   <span style='color:#808030; '>[</span>seg<span style='color:#808030; '>:</span>off bp<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span> <span style='color:#808030; '>:=</span> w<span style='color:#808030; '>;</span>
121: <span style='color:#808030; '>END</span> CGAHLine<span style='color:#808030; '>;</span>
122: 
123: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> InitCGA <span style='color:#808030; '>;</span>
124: <span style='color:#808030; '>BEGIN</span>
125:   Width <span style='color:#808030; '>:=</span> CGAWidth <span style='color:#808030; '>;</span>
126:   Depth <span style='color:#808030; '>:=</span> CGADepth <span style='color:#808030; '>;</span>
127:   NumColor <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>4</span> <span style='color:#808030; '>;</span>
128:   TextMode <span style='color:#808030; '>:=</span> CGATextMode <span style='color:#808030; '>;</span>
129:   GraphMode <span style='color:#808030; '>:=</span> CGAGraphMode <span style='color:#808030; '>;</span>
130:   Plot <span style='color:#808030; '>:=</span> CGAPlot <span style='color:#808030; '>;</span>
131:   Point <span style='color:#808030; '>:=</span> CGAPoint <span style='color:#808030; '>;</span>
132:   HLine <span style='color:#808030; '>:=</span> CGAHLine <span style='color:#808030; '>;</span>
133: <span style='color:#808030; '>END</span> InitCGA <span style='color:#808030; '>;</span>
134: 
135: <span style='color:#696969; '>(* == EGA/VGA specific routines == *)</span>
136: 
137: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> EGAGraphMode<span style='color:#808030; '>;</span> <span style='color:#696969; '>(* Also VGA *)</span>
138: <span style='color:#800000; font-weight:bold; '>VAR</span> r <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Registers<span style='color:#808030; '>;</span>
139: <span style='color:#808030; '>BEGIN</span>
140:   <span style='color:#808030; '>IF</span> Depth<span style='color:#808030; '>=</span><span style='color:#008c00; '>480</span> <span style='color:#800000; font-weight:bold; '>THEN</span> r<span style='color:#008c00; '>.</span>AX <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>12H</span> <span style='color:#800000; font-weight:bold; '>ELSE</span> r<span style='color:#008c00; '>.</span>AX <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>10H</span> <span style='color:#808030; '>END</span> <span style='color:#808030; '>;</span>
141:   Lib<span style='color:#008c00; '>.</span>Intr<span style='color:#808030; '>(</span> r<span style='color:#808030; '>,</span><span style='color:#008c00; '>10H</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
142: <span style='color:#808030; '>END</span> EGAGraphMode<span style='color:#808030; '>;</span>
143: 
144: 
145: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> EGAPlot<span style='color:#808030; '>(</span> x<span style='color:#808030; '>,</span>y<span style='color:#808030; '>,</span>c <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#696969; '>(* Also VGA *)</span>
146: <span style='color:#800000; font-weight:bold; '>VAR</span>
147:   t<span style='color:#808030; '>:</span>bs<span style='color:#808030; '>;</span>
148:   p<span style='color:#808030; '>,</span>b<span style='color:#808030; '>,</span>s<span style='color:#808030; '>:</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
149: <span style='color:#808030; '>BEGIN</span>
150:    <span style='color:#808030; '>IF</span> <span style='color:#808030; '>(</span>x <span style='color:#808030; '>&lt;</span> EGAWidth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>AND</span> <span style='color:#808030; '>(</span>y <span style='color:#808030; '>&lt;</span> Depth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
151:       b <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>1</span> <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>7</span><span style='color:#808030; '>-</span><span style='color:#808030; '>(</span>x <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
152:       p <span style='color:#808030; '>:=</span> y<span style='color:#808030; '>*</span><span style='color:#008c00; '>80</span><span style='color:#808030; '>+</span><span style='color:#808030; '>(</span>x <span style='color:#800000; font-weight:bold; '>DIV</span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
153:       <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3CEH</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span><span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3CFH</span><span style='color:#808030; '>,</span>SHORTCARD<span style='color:#808030; '>(</span>b<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
154:       <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3C4H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span><span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3C5H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>0FH</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
155:       s <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0A000H</span><span style='color:#808030; '>;</span>
156:       t <span style='color:#808030; '>:=</span> <span style='color:#808030; '>[</span>s<span style='color:#808030; '>:</span>p bp<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>;</span>
157:       <span style='color:#808030; '>[</span>s<span style='color:#808030; '>:</span>p bp<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span> <span style='color:#808030; '>:=</span> bs<span style='color:#808030; '>{</span><span style='color:#808030; '>}</span><span style='color:#808030; '>;</span>
158:       <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3C4H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span><span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3C5H</span><span style='color:#808030; '>,</span>SHORTCARD<span style='color:#808030; '>(</span>c<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
159:       <span style='color:#808030; '>[</span>s<span style='color:#808030; '>:</span>p bp<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span> <span style='color:#808030; '>:=</span> bs<span style='color:#808030; '>{</span><span style='color:#008c00; '>0..7</span><span style='color:#808030; '>}</span><span style='color:#808030; '>;</span>
160:       <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3CEH</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span><span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3CFH</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>0FFH</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
161:       <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3C4H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span><span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3C5H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>0FH</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
162:    <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
163: <span style='color:#808030; '>END</span> EGAPlot<span style='color:#808030; '>;</span>
164: 
165: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> EGAPoint<span style='color:#808030; '>(</span>x<span style='color:#808030; '>,</span>y<span style='color:#808030; '>:</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span> <span style='color:#696969; '>(* Also VGA *)</span>
166: <span style='color:#800000; font-weight:bold; '>VAR</span>
167:   t<span style='color:#808030; '>:</span>bs<span style='color:#808030; '>;</span>
168:   p<span style='color:#808030; '>,</span>b<span style='color:#808030; '>,</span>s<span style='color:#808030; '>:</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
169:   c<span style='color:#808030; '>:</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
170: <span style='color:#808030; '>BEGIN</span>
171:   <span style='color:#808030; '>IF</span> <span style='color:#808030; '>(</span>x <span style='color:#808030; '>&lt;</span> EGAWidth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>AND</span> <span style='color:#808030; '>(</span>y <span style='color:#808030; '>&lt;</span> Depth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
172:     b <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>1</span> <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>7</span><span style='color:#808030; '>-</span><span style='color:#808030; '>(</span>x <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
173:     p <span style='color:#808030; '>:=</span> y<span style='color:#808030; '>*</span><span style='color:#008c00; '>80</span><span style='color:#808030; '>+</span><span style='color:#808030; '>(</span>x <span style='color:#800000; font-weight:bold; '>DIV</span> <span style='color:#008c00; '>8</span>  <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
174: 
175:     s <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0A000H</span><span style='color:#808030; '>;</span>
176: 
177:     <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3CEH</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>4</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#696969; '>(* read map sel *)</span>
178: 
179:     <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3CFH</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>3</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
180:     t <span style='color:#808030; '>:=</span> <span style='color:#808030; '>[</span>s<span style='color:#808030; '>:</span>p bp<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>;</span>
181:     t <span style='color:#808030; '>:=</span> t <span style='color:#808030; '>*</span> bs<span style='color:#808030; '>(</span>b<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
182:     c <span style='color:#808030; '>:=</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>(</span> SHORTCARD<span style='color:#808030; '>(</span>t<span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
183: 
184:     <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3CFH</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>2</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
185:     t <span style='color:#808030; '>:=</span> <span style='color:#808030; '>[</span>s<span style='color:#808030; '>:</span>p bp<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>;</span>
186:     t <span style='color:#808030; '>:=</span> t <span style='color:#808030; '>*</span> bs<span style='color:#808030; '>(</span>b<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
187:     c <span style='color:#808030; '>:=</span> c <span style='color:#808030; '>*</span> <span style='color:#008c00; '>2</span> <span style='color:#808030; '>+</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>(</span> SHORTCARD<span style='color:#808030; '>(</span>t<span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
188: 
189:     <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3CFH</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
190:     t <span style='color:#808030; '>:=</span> <span style='color:#808030; '>[</span>s<span style='color:#808030; '>:</span>p bp<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>;</span>
191:     t <span style='color:#808030; '>:=</span> t <span style='color:#808030; '>*</span> bs<span style='color:#808030; '>(</span>b<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
192:     c <span style='color:#808030; '>:=</span> c <span style='color:#808030; '>*</span> <span style='color:#008c00; '>2</span> <span style='color:#808030; '>+</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>(</span> SHORTCARD<span style='color:#808030; '>(</span>t<span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
193: 
194:     <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3CFH</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
195:     t <span style='color:#808030; '>:=</span> <span style='color:#808030; '>[</span>s<span style='color:#808030; '>:</span>p bp<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>;</span>
196:     t <span style='color:#808030; '>:=</span> t <span style='color:#808030; '>*</span> bs<span style='color:#808030; '>(</span>b<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
197:     c <span style='color:#808030; '>:=</span> c <span style='color:#808030; '>*</span> <span style='color:#008c00; '>2</span> <span style='color:#808030; '>+</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>(</span> SHORTCARD<span style='color:#808030; '>(</span>t<span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
198: 
199:     c <span style='color:#808030; '>:=</span> c <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#808030; '>(</span> <span style='color:#008c00; '>7</span> <span style='color:#808030; '>-</span> <span style='color:#808030; '>(</span> x <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>8</span> <span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
200: 
201:     <span style='color:#800000; font-weight:bold; '>RETURN</span> c<span style='color:#808030; '>;</span>
202:   <span style='color:#800000; font-weight:bold; '>ELSE</span>
203:     <span style='color:#800000; font-weight:bold; '>RETURN</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
204:   <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
205: <span style='color:#808030; '>END</span> EGAPoint<span style='color:#808030; '>;</span>
206: 
207: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> EGAHLine <span style='color:#808030; '>(</span> x<span style='color:#808030; '>,</span>y<span style='color:#808030; '>,</span>x2 <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span> c<span style='color:#808030; '>:</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#696969; '>(* Also VGA *)</span>
208: <span style='color:#800000; font-weight:bold; '>VAR</span> c1<span style='color:#808030; '>,</span>c2 <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
209: <span style='color:#808030; '>BEGIN</span>
210:   <span style='color:#808030; '>IF</span> y <span style='color:#808030; '>></span> Depth<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#800000; font-weight:bold; '>RETURN</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
211:   <span style='color:#808030; '>IF</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span> <span style='color:#808030; '>>=</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>EGAWidth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#800000; font-weight:bold; '>RETURN</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
212:   <span style='color:#808030; '>IF</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span> <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>THEN</span> x <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
213:   <span style='color:#808030; '>IF</span> x2 <span style='color:#808030; '>>=</span> EGAWidth <span style='color:#800000; font-weight:bold; '>THEN</span> x2 <span style='color:#808030; '>:=</span> EGAWidth<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
214:   <span style='color:#808030; '>WHILE</span> <span style='color:#808030; '>(</span>x <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>8</span> <span style='color:#808030; '>#</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span>  <span style='color:#800000; font-weight:bold; '>AND</span> <span style='color:#808030; '>(</span>x <span style='color:#808030; '>&lt;=</span> x2<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>DO</span>
215:     EGAPlot<span style='color:#808030; '>(</span> x  <span style='color:#808030; '>,</span> y <span style='color:#808030; '>,</span> c <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> INC<span style='color:#808030; '>(</span> x  <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
216:   <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
217:   <span style='color:#808030; '>WHILE</span> <span style='color:#808030; '>(</span>x2 <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>8</span> <span style='color:#808030; '>#</span> <span style='color:#008c00; '>7</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>AND</span> <span style='color:#808030; '>(</span>x <span style='color:#808030; '>&lt;=</span> x2<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>DO</span>
218:     EGAPlot<span style='color:#808030; '>(</span> x2 <span style='color:#808030; '>,</span> y <span style='color:#808030; '>,</span> c <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> DEC<span style='color:#808030; '>(</span> x2 <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
219:   <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
220:   <span style='color:#808030; '>IF</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span> <span style='color:#808030; '>></span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>x2<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#800000; font-weight:bold; '>RETURN</span><span style='color:#808030; '>;</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
221:   <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3CEH</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span><span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3CFH</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>0FFH</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
222:   <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3C4H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span><span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3C5H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>0FH</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
223:   <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3CEH</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>5</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span><span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3CFH</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
224:   y <span style='color:#808030; '>:=</span> y<span style='color:#808030; '>*</span><span style='color:#008c00; '>80</span><span style='color:#808030; '>;</span>
225:   x <span style='color:#808030; '>:=</span> x <span style='color:#800000; font-weight:bold; '>DIV</span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>;</span>
226:   x2 <span style='color:#808030; '>:=</span> x2 <span style='color:#800000; font-weight:bold; '>DIV</span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>;</span>
227:   <span style='color:#808030; '>WHILE</span> x <span style='color:#808030; '>&lt;=</span> x2 <span style='color:#800000; font-weight:bold; '>DO</span>
228:     EGAScreen<span style='color:#808030; '>[</span>y<span style='color:#808030; '>+</span>x<span style='color:#808030; '>]</span> <span style='color:#808030; '>:=</span> bs<span style='color:#808030; '>(</span>c<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
229:     INC<span style='color:#808030; '>(</span> x <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
230:   <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
231:   <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3CEH</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>5</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span><span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span> <span style='color:#008c00; '>3CFH</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
232: <span style='color:#808030; '>END</span> EGAHLine<span style='color:#808030; '>;</span>
233: 
234: 
235: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> InitEGA <span style='color:#808030; '>;</span>
236: <span style='color:#808030; '>BEGIN</span>
237:   Width     <span style='color:#808030; '>:=</span> EGAWidth <span style='color:#808030; '>;</span>
238:   Depth     <span style='color:#808030; '>:=</span> EGADepth <span style='color:#808030; '>;</span>
239:   NumColor  <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>16</span> <span style='color:#808030; '>;</span>
240:   TextMode  <span style='color:#808030; '>:=</span> CGATextMode <span style='color:#808030; '>;</span>
241:   GraphMode <span style='color:#808030; '>:=</span> EGAGraphMode <span style='color:#808030; '>;</span>
242:   Plot      <span style='color:#808030; '>:=</span> EGAPlot <span style='color:#808030; '>;</span>
243:   Point     <span style='color:#808030; '>:=</span> EGAPoint <span style='color:#808030; '>;</span>
244:   HLine     <span style='color:#808030; '>:=</span> EGAHLine <span style='color:#808030; '>;</span>
245: <span style='color:#808030; '>END</span> InitEGA <span style='color:#808030; '>;</span>
246: 
247: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> InitVGA <span style='color:#808030; '>;</span>
248: <span style='color:#808030; '>BEGIN</span>
249:   InitEGA <span style='color:#808030; '>;</span>
250:   Depth <span style='color:#808030; '>:=</span> VGADepth <span style='color:#808030; '>;</span> <span style='color:#696969; '>(* Width same as EGA *)</span>
251: <span style='color:#808030; '>END</span> InitVGA <span style='color:#808030; '>;</span>
252: 
253: 
254: <span style='color:#696969; '>(* == Hercules specific routines == *)</span>
255: 
256: 
257: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> HercGraphMode<span style='color:#808030; '>;</span>
258: <span style='color:#800000; font-weight:bold; '>TYPE</span>
259:   DataType <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>ARRAY</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>0..11</span><span style='color:#808030; '>]</span> <span style='color:#800000; font-weight:bold; '>OF</span> SHORTCARD <span style='color:#808030; '>;</span>
260: <span style='color:#800000; font-weight:bold; '>CONST</span>
261:   Data <span style='color:#808030; '>=</span> DataType<span style='color:#808030; '>(</span><span style='color:#008c00; '>35H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>2DH</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>2EH</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>07H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>5BH</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>02H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>57H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>57H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>02H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>03H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>00H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>00H</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
262: <span style='color:#800000; font-weight:bold; '>VAR</span>
263:   I<span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
264: <span style='color:#808030; '>BEGIN</span>
265:     <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span><span style='color:#008c00; '>3BFH</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>03H</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>    <span style='color:#696969; '>(* Remove this if do NOT want to override</span>
266: <span style='color:#696969; '>                                the hercules text mode lock *)</span>
267:     Lib<span style='color:#008c00; '>.</span>Delay<span style='color:#808030; '>(</span><span style='color:#008c00; '>10</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
268:     <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span><span style='color:#008c00; '>3B8H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>02H</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
269:     <span style='color:#808030; '>FOR</span> I<span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>TO</span> <span style='color:#008c00; '>11</span> <span style='color:#800000; font-weight:bold; '>DO</span>
270:         <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span><span style='color:#008c00; '>3B4H</span><span style='color:#808030; '>,</span>SHORTCARD<span style='color:#808030; '>(</span>I<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
271:         <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span><span style='color:#008c00; '>3B5H</span><span style='color:#808030; '>,</span>Data<span style='color:#808030; '>[</span>I<span style='color:#808030; '>]</span><span style='color:#808030; '>)</span>
272:     <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
273:     Lib<span style='color:#008c00; '>.</span>WordFill<span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>0B000H</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>4000H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
274:     Lib<span style='color:#008c00; '>.</span>Delay<span style='color:#808030; '>(</span><span style='color:#008c00; '>500</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
275:     <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span><span style='color:#008c00; '>3B8H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>0AH</span><span style='color:#808030; '>)</span>
276: <span style='color:#808030; '>END</span> HercGraphMode<span style='color:#808030; '>;</span>
277: 
278: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> HercTextMode<span style='color:#808030; '>;</span>
279: <span style='color:#800000; font-weight:bold; '>TYPE</span>
280:   DataType <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>ARRAY</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>0..11</span><span style='color:#808030; '>]</span> <span style='color:#800000; font-weight:bold; '>OF</span> SHORTCARD <span style='color:#808030; '>;</span>
281: <span style='color:#800000; font-weight:bold; '>CONST</span>
282:   Data <span style='color:#808030; '>=</span> DataType<span style='color:#808030; '>(</span><span style='color:#008c00; '>61H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>50H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>52H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>0FH</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>19H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>06H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>19H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>19H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>02H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>0DH</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>0BH</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>0CH</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
283: <span style='color:#800000; font-weight:bold; '>VAR</span>
284:   I<span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
285: <span style='color:#808030; '>BEGIN</span>
286:     <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span><span style='color:#008c00; '>3B8H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>20H</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
287:     <span style='color:#808030; '>FOR</span> I<span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>TO</span> <span style='color:#008c00; '>11</span> <span style='color:#800000; font-weight:bold; '>DO</span>
288:         <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span><span style='color:#008c00; '>3B4H</span><span style='color:#808030; '>,</span>SHORTCARD<span style='color:#808030; '>(</span>I<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
289:         <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span><span style='color:#008c00; '>3B5H</span><span style='color:#808030; '>,</span>Data<span style='color:#808030; '>[</span>I<span style='color:#808030; '>]</span><span style='color:#808030; '>)</span>
290:     <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
291:     Lib<span style='color:#008c00; '>.</span>WordFill<span style='color:#808030; '>(</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>0B000H</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>2000</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>720H</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
292:     Lib<span style='color:#008c00; '>.</span>Delay<span style='color:#808030; '>(</span><span style='color:#008c00; '>500</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
293:     <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Out<span style='color:#808030; '>(</span><span style='color:#008c00; '>3B8H</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>28H</span><span style='color:#808030; '>)</span>
294: <span style='color:#808030; '>END</span> HercTextMode<span style='color:#808030; '>;</span>
295: 
296: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> HercPlot<span style='color:#808030; '>(</span>x<span style='color:#808030; '>,</span>y<span style='color:#808030; '>:</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>c<span style='color:#808030; '>:</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
297: <span style='color:#808030; '>BEGIN</span>
298:   <span style='color:#808030; '>IF</span> <span style='color:#808030; '>(</span>x <span style='color:#808030; '>>=</span> HercWidth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>OR</span> <span style='color:#808030; '>(</span>y <span style='color:#808030; '>>=</span> HercDepth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#800000; font-weight:bold; '>RETURN</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
299:   <span style='color:#808030; '>IF</span> c <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
300:      EXCL<span style='color:#808030; '>(</span>HercBitMap<span style='color:#808030; '>[</span>y <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>4</span><span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>x <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>3</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>7</span><span style='color:#808030; '>-</span><span style='color:#808030; '>(</span>x <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
301:   <span style='color:#800000; font-weight:bold; '>ELSE</span>
302:      INCL<span style='color:#808030; '>(</span>HercBitMap<span style='color:#808030; '>[</span>y <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>4</span><span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>x <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>3</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>7</span><span style='color:#808030; '>-</span><span style='color:#808030; '>(</span>x <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
303:   <span style='color:#808030; '>END</span>
304: <span style='color:#808030; '>END</span> HercPlot<span style='color:#808030; '>;</span>
305: 
306: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> HercPoint<span style='color:#808030; '>(</span>x<span style='color:#808030; '>,</span>y<span style='color:#808030; '>:</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
307: <span style='color:#808030; '>BEGIN</span>
308:   <span style='color:#808030; '>IF</span> <span style='color:#808030; '>(</span>x <span style='color:#808030; '>>=</span> HercWidth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>OR</span> <span style='color:#808030; '>(</span>y <span style='color:#808030; '>>=</span> HercDepth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#800000; font-weight:bold; '>RETURN</span> MAX<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
309:   <span style='color:#800000; font-weight:bold; '>RETURN</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>7</span><span style='color:#808030; '>-</span><span style='color:#808030; '>(</span>x <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>IN</span> HercBitMap<span style='color:#808030; '>[</span>y <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>4</span><span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>x <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>3</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span>
310: <span style='color:#808030; '>END</span> HercPoint<span style='color:#808030; '>;</span>
311: 
312: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> HercHLine <span style='color:#808030; '>(</span> x<span style='color:#808030; '>,</span>y<span style='color:#808030; '>,</span>x2 <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span> c<span style='color:#808030; '>:</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
313: <span style='color:#800000; font-weight:bold; '>VAR</span>
314:   I         <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
315:   MapNum    <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
316:   Byte1     <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
317:   Byte2     <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
318:   Bitx      <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
319:   Bitx2     <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
320:   Mask      <span style='color:#808030; '>:</span> bs<span style='color:#808030; '>;</span>
321:   IMask     <span style='color:#808030; '>:</span> bs<span style='color:#808030; '>;</span>
322: <span style='color:#808030; '>BEGIN</span>
323:   <span style='color:#808030; '>IF</span> y <span style='color:#808030; '>></span> HercDepth<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#800000; font-weight:bold; '>RETURN</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
324:   <span style='color:#808030; '>IF</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span> <span style='color:#808030; '>>=</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>HercWidth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#800000; font-weight:bold; '>RETURN</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
325:   <span style='color:#808030; '>IF</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span> <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>THEN</span> x <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
326:   <span style='color:#808030; '>IF</span> x2 <span style='color:#808030; '>>=</span> HercWidth <span style='color:#800000; font-weight:bold; '>THEN</span> x2 <span style='color:#808030; '>:=</span> HercWidth<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
327:   <span style='color:#808030; '>IF</span> c <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
328:      <span style='color:#696969; '>(* No Mask needed *)</span>
329:   <span style='color:#800000; font-weight:bold; '>ELSIF</span> c <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#808030; '>(</span>HercNumColor<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
330:      Mask<span style='color:#808030; '>:=</span> bs<span style='color:#808030; '>{</span><span style='color:#008c00; '>0..7</span><span style='color:#808030; '>}</span>
331:   <span style='color:#800000; font-weight:bold; '>ELSE</span>
332:      Mask<span style='color:#808030; '>:=</span> bs<span style='color:#808030; '>(</span><span style='color:#008c00; '>0AAH</span> <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>(</span>ODD<span style='color:#808030; '>(</span>y<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
333:   <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
334: 
335:   MapNum    <span style='color:#808030; '>:=</span> y <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>4</span><span style='color:#808030; '>;</span>
336:   y         <span style='color:#808030; '>:=</span> y <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>;</span>
337:   Byte1     <span style='color:#808030; '>:=</span> x <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>3</span><span style='color:#808030; '>;</span>
338:   Byte2     <span style='color:#808030; '>:=</span> x2 <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>3</span><span style='color:#808030; '>;</span>
339:   Bitx      <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>7</span><span style='color:#808030; '>-</span><span style='color:#808030; '>(</span>x <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
340:   Bitx2     <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>7</span><span style='color:#808030; '>-</span><span style='color:#808030; '>(</span>x2 <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
341: 
342:   <span style='color:#808030; '>IF</span> c <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
343:      <span style='color:#808030; '>IF</span> Byte2 <span style='color:#808030; '>=</span> Byte1 <span style='color:#800000; font-weight:bold; '>THEN</span>
344:         HercBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte1<span style='color:#808030; '>]</span><span style='color:#808030; '>:=</span>
345:         <span style='color:#808030; '>(</span>HercBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte1<span style='color:#808030; '>]</span> <span style='color:#808030; '>-</span> bs<span style='color:#808030; '>{</span>Bitx2<span style='color:#008c00; '>..</span>Bitx<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
346:      <span style='color:#800000; font-weight:bold; '>ELSE</span>
347:         HercBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte1<span style='color:#808030; '>]</span><span style='color:#808030; '>:=</span>
348:         <span style='color:#808030; '>(</span>HercBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte1<span style='color:#808030; '>]</span> <span style='color:#808030; '>-</span> bs<span style='color:#808030; '>{</span><span style='color:#008c00; '>0..</span>Bitx<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
349: 
350:         <span style='color:#808030; '>IF</span> Byte2<span style='color:#808030; '>-</span>Byte1 <span style='color:#808030; '>></span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
351:            Lib<span style='color:#008c00; '>.</span>Fill<span style='color:#808030; '>(</span>ADR<span style='color:#808030; '>(</span>HercBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte1<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>Byte2<span style='color:#808030; '>-</span>Byte1<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span>
352:         <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
353: 
354:         HercBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte2<span style='color:#808030; '>]</span><span style='color:#808030; '>:=</span>
355:         <span style='color:#808030; '>(</span>HercBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte2<span style='color:#808030; '>]</span> <span style='color:#808030; '>-</span> bs<span style='color:#808030; '>{</span>Bitx2<span style='color:#008c00; '>..7</span><span style='color:#808030; '>}</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
356:      <span style='color:#808030; '>END</span>
357:   <span style='color:#800000; font-weight:bold; '>ELSE</span>
358:      <span style='color:#808030; '>IF</span> Byte2 <span style='color:#808030; '>=</span> Byte1 <span style='color:#800000; font-weight:bold; '>THEN</span>
359:         HercBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte1<span style='color:#808030; '>]</span><span style='color:#808030; '>:=</span>
360:         <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>HercBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte1<span style='color:#808030; '>]</span><span style='color:#808030; '>-</span>bs<span style='color:#808030; '>{</span>Bitx2<span style='color:#008c00; '>..</span>Bitx<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span>
361:         <span style='color:#808030; '>+</span> <span style='color:#808030; '>(</span>Mask <span style='color:#808030; '>*</span> bs<span style='color:#808030; '>{</span>Bitx2<span style='color:#008c00; '>..</span>Bitx<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
362:      <span style='color:#800000; font-weight:bold; '>ELSE</span>
363:         HercBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte1<span style='color:#808030; '>]</span><span style='color:#808030; '>:=</span>
364:         <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>HercBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte1<span style='color:#808030; '>]</span><span style='color:#808030; '>-</span>bs<span style='color:#808030; '>{</span><span style='color:#008c00; '>0..</span>Bitx<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span>
365:         <span style='color:#808030; '>+</span> <span style='color:#808030; '>(</span>Mask <span style='color:#808030; '>*</span> bs<span style='color:#808030; '>{</span><span style='color:#008c00; '>0..</span>Bitx<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
366: 
367:         <span style='color:#808030; '>IF</span> Byte2<span style='color:#808030; '>-</span>Byte1 <span style='color:#808030; '>></span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
368:            Lib<span style='color:#008c00; '>.</span>Fill<span style='color:#808030; '>(</span>ADR<span style='color:#808030; '>(</span>HercBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte1<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>Byte2<span style='color:#808030; '>-</span>Byte1<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span>
369:                     Mask<span style='color:#808030; '>)</span>
370:         <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
371: 
372:         HercBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte2<span style='color:#808030; '>]</span><span style='color:#808030; '>:=</span>
373:         <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>HercBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte2<span style='color:#808030; '>]</span><span style='color:#808030; '>-</span>bs<span style='color:#808030; '>{</span>Bitx2<span style='color:#008c00; '>..7</span><span style='color:#808030; '>}</span><span style='color:#808030; '>)</span>
374:         <span style='color:#808030; '>+</span> <span style='color:#808030; '>(</span>Mask <span style='color:#808030; '>*</span> bs<span style='color:#808030; '>{</span>Bitx2<span style='color:#008c00; '>..7</span><span style='color:#808030; '>}</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
375:      <span style='color:#808030; '>END</span>
376:   <span style='color:#808030; '>END</span>
377: <span style='color:#808030; '>END</span> HercHLine<span style='color:#808030; '>;</span>
378: 
379: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> InitHerc <span style='color:#808030; '>;</span>
380: <span style='color:#808030; '>BEGIN</span>
381:   Width     <span style='color:#808030; '>:=</span> HercWidth <span style='color:#808030; '>;</span>
382:   Depth     <span style='color:#808030; '>:=</span> HercDepth <span style='color:#808030; '>;</span>
383:   NumColor  <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>2</span> <span style='color:#808030; '>;</span>
384:   TextMode  <span style='color:#808030; '>:=</span> HercTextMode <span style='color:#808030; '>;</span>
385:   GraphMode <span style='color:#808030; '>:=</span> HercGraphMode <span style='color:#808030; '>;</span>
386:   Plot      <span style='color:#808030; '>:=</span> HercPlot <span style='color:#808030; '>;</span>
387:   Point     <span style='color:#808030; '>:=</span> HercPoint <span style='color:#808030; '>;</span>
388:   HLine     <span style='color:#808030; '>:=</span> HercHLine <span style='color:#808030; '>;</span>
389:   HercBitMap<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>:=</span> <span style='color:#808030; '>[</span><span style='color:#008c00; '>0B000H</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>;</span>      <span style='color:#696969; '>(* Initialise BitMap pointers *)</span>
390:   HercBitMap<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>:=</span> <span style='color:#808030; '>[</span><span style='color:#008c00; '>0B000H</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>02000H</span><span style='color:#808030; '>]</span><span style='color:#808030; '>;</span>
391:   HercBitMap<span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>:=</span> <span style='color:#808030; '>[</span><span style='color:#008c00; '>0B000H</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>04000H</span><span style='color:#808030; '>]</span><span style='color:#808030; '>;</span>
392:   HercBitMap<span style='color:#808030; '>[</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>]</span><span style='color:#808030; '>:=</span> <span style='color:#808030; '>[</span><span style='color:#008c00; '>0B000H</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>06000H</span><span style='color:#808030; '>]</span><span style='color:#808030; '>;</span>
393: <span style='color:#808030; '>END</span> InitHerc <span style='color:#808030; '>;</span>
394: 
395: <span style='color:#696969; '>(* == AT&amp;T 400 specific routines == *)</span>
396: 
397: 
398: 
399: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> ATTGraphMode<span style='color:#808030; '>;</span>
400: <span style='color:#800000; font-weight:bold; '>VAR</span> r <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>SYSTEM</span><span style='color:#008c00; '>.</span>Registers<span style='color:#808030; '>;</span>
401: <span style='color:#808030; '>BEGIN</span>
402:   r<span style='color:#008c00; '>.</span>AX <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>64</span><span style='color:#808030; '>;</span>
403:   Lib<span style='color:#008c00; '>.</span>Intr<span style='color:#808030; '>(</span> r<span style='color:#808030; '>,</span><span style='color:#008c00; '>10H</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
404: <span style='color:#808030; '>END</span> ATTGraphMode<span style='color:#808030; '>;</span>
405: 
406: 
407: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> ATTPlot<span style='color:#808030; '>(</span>x<span style='color:#808030; '>,</span>y<span style='color:#808030; '>:</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>c<span style='color:#808030; '>:</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
408: <span style='color:#808030; '>BEGIN</span>
409:   <span style='color:#808030; '>IF</span> <span style='color:#808030; '>(</span>x <span style='color:#808030; '>>=</span> ATTWidth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>OR</span> <span style='color:#808030; '>(</span>y <span style='color:#808030; '>>=</span> ATTDepth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#800000; font-weight:bold; '>RETURN</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
410:   <span style='color:#808030; '>IF</span> c <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
411:      EXCL<span style='color:#808030; '>(</span>ATTBitMap<span style='color:#808030; '>[</span>y <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>4</span><span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>x <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>3</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>7</span><span style='color:#808030; '>-</span><span style='color:#808030; '>(</span>x <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
412:   <span style='color:#800000; font-weight:bold; '>ELSE</span>
413:      INCL<span style='color:#808030; '>(</span>ATTBitMap<span style='color:#808030; '>[</span>y <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>4</span><span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>x <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>3</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>7</span><span style='color:#808030; '>-</span><span style='color:#808030; '>(</span>x <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
414:   <span style='color:#808030; '>END</span>
415: <span style='color:#808030; '>END</span> ATTPlot<span style='color:#808030; '>;</span>
416: 
417: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> ATTPoint<span style='color:#808030; '>(</span>x<span style='color:#808030; '>,</span>y<span style='color:#808030; '>:</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
418: <span style='color:#808030; '>BEGIN</span>
419:   <span style='color:#808030; '>IF</span> <span style='color:#808030; '>(</span>x <span style='color:#808030; '>>=</span> ATTWidth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>OR</span> <span style='color:#808030; '>(</span>y <span style='color:#808030; '>>=</span> ATTDepth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#800000; font-weight:bold; '>RETURN</span> MAX<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
420:   <span style='color:#800000; font-weight:bold; '>RETURN</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>7</span><span style='color:#808030; '>-</span><span style='color:#808030; '>(</span>x <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>IN</span> ATTBitMap<span style='color:#808030; '>[</span>y <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>4</span><span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>x <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>3</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span>
421: <span style='color:#808030; '>END</span> ATTPoint<span style='color:#808030; '>;</span>
422: 
423: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> ATTHLine <span style='color:#808030; '>(</span> x<span style='color:#808030; '>,</span>y<span style='color:#808030; '>,</span>x2 <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span> c<span style='color:#808030; '>:</span><span style='color:#800000; font-weight:bold; '>CARDINAL</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
424: <span style='color:#800000; font-weight:bold; '>VAR</span>
425:   I         <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
426:   MapNum    <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
427:   Byte1     <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
428:   Byte2     <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
429:   Bitx      <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
430:   Bitx2     <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
431:   Mask      <span style='color:#808030; '>:</span> bs<span style='color:#808030; '>;</span>
432: <span style='color:#808030; '>BEGIN</span>
433:   <span style='color:#808030; '>IF</span> y <span style='color:#808030; '>></span> ATTDepth<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#800000; font-weight:bold; '>RETURN</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
434:   <span style='color:#808030; '>IF</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span> <span style='color:#808030; '>>=</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>ATTWidth<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#800000; font-weight:bold; '>RETURN</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
435:   <span style='color:#808030; '>IF</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span> <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>THEN</span> x <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
436:   <span style='color:#808030; '>IF</span> x2 <span style='color:#808030; '>>=</span> ATTWidth <span style='color:#800000; font-weight:bold; '>THEN</span> x2 <span style='color:#808030; '>:=</span> ATTWidth<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
437: 
438:   <span style='color:#808030; '>IF</span> c <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
439:      <span style='color:#696969; '>(* No Mask needed *)</span>
440:   <span style='color:#800000; font-weight:bold; '>ELSIF</span> c <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#808030; '>(</span>ATTNumColor<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
441:      Mask<span style='color:#808030; '>:=</span> bs<span style='color:#808030; '>{</span><span style='color:#008c00; '>0..7</span><span style='color:#808030; '>}</span>
442:   <span style='color:#800000; font-weight:bold; '>ELSE</span>
443:      Mask<span style='color:#808030; '>:=</span> bs<span style='color:#808030; '>(</span><span style='color:#008c00; '>0AAH</span> <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>(</span>ODD<span style='color:#808030; '>(</span>y<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
444:   <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
445: 
446:   MapNum    <span style='color:#808030; '>:=</span> y <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>4</span><span style='color:#808030; '>;</span>
447:   y         <span style='color:#808030; '>:=</span> y <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>;</span>
448:   Byte1     <span style='color:#808030; '>:=</span> x <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>3</span><span style='color:#808030; '>;</span>
449:   Byte2     <span style='color:#808030; '>:=</span> x2 <span style='color:#808030; '>></span><span style='color:#808030; '>></span> <span style='color:#008c00; '>3</span><span style='color:#808030; '>;</span>
450:   Bitx      <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>7</span><span style='color:#808030; '>-</span><span style='color:#808030; '>(</span>x <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
451:   Bitx2     <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>7</span><span style='color:#808030; '>-</span><span style='color:#808030; '>(</span>x2 <span style='color:#800000; font-weight:bold; '>MOD</span> <span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
452: 
453:   <span style='color:#808030; '>IF</span> c <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
454:      <span style='color:#808030; '>IF</span> Byte2 <span style='color:#808030; '>=</span> Byte1 <span style='color:#800000; font-weight:bold; '>THEN</span>
455:         ATTBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte1<span style='color:#808030; '>]</span><span style='color:#808030; '>:=</span>
456:         <span style='color:#808030; '>(</span>ATTBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte1<span style='color:#808030; '>]</span> <span style='color:#808030; '>-</span> bs<span style='color:#808030; '>{</span>Bitx2<span style='color:#008c00; '>..</span>Bitx<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
457:      <span style='color:#800000; font-weight:bold; '>ELSE</span>
458:         ATTBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte1<span style='color:#808030; '>]</span><span style='color:#808030; '>:=</span>
459:         <span style='color:#808030; '>(</span>ATTBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte1<span style='color:#808030; '>]</span> <span style='color:#808030; '>-</span> bs<span style='color:#808030; '>{</span><span style='color:#008c00; '>0..</span>Bitx<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
460: 
461:         <span style='color:#808030; '>IF</span> Byte2<span style='color:#808030; '>-</span>Byte1 <span style='color:#808030; '>></span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
462:            Lib<span style='color:#008c00; '>.</span>Fill<span style='color:#808030; '>(</span>ADR<span style='color:#808030; '>(</span>ATTBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte1<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>Byte2<span style='color:#808030; '>-</span>Byte1<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span>
463:         <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
464: 
465:         ATTBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte2<span style='color:#808030; '>]</span><span style='color:#808030; '>:=</span>
466:         <span style='color:#808030; '>(</span>ATTBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte2<span style='color:#808030; '>]</span> <span style='color:#808030; '>-</span> bs<span style='color:#808030; '>{</span>Bitx2<span style='color:#008c00; '>..7</span><span style='color:#808030; '>}</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
467:      <span style='color:#808030; '>END</span>
468:   <span style='color:#800000; font-weight:bold; '>ELSE</span>
469:      <span style='color:#808030; '>IF</span> Byte2 <span style='color:#808030; '>=</span> Byte1 <span style='color:#800000; font-weight:bold; '>THEN</span>
470:         ATTBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte1<span style='color:#808030; '>]</span><span style='color:#808030; '>:=</span>
471:         <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>ATTBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte1<span style='color:#808030; '>]</span><span style='color:#808030; '>-</span>bs<span style='color:#808030; '>{</span>Bitx2<span style='color:#008c00; '>..</span>Bitx<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span>
472:         <span style='color:#808030; '>+</span> <span style='color:#808030; '>(</span>Mask <span style='color:#808030; '>*</span> bs<span style='color:#808030; '>{</span>Bitx2<span style='color:#008c00; '>..</span>Bitx<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
473:      <span style='color:#800000; font-weight:bold; '>ELSE</span>
474:         ATTBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte1<span style='color:#808030; '>]</span><span style='color:#808030; '>:=</span>
475:         <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>ATTBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte1<span style='color:#808030; '>]</span><span style='color:#808030; '>-</span>bs<span style='color:#808030; '>{</span><span style='color:#008c00; '>0..</span>Bitx<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span>
476:         <span style='color:#808030; '>+</span> <span style='color:#808030; '>(</span>Mask <span style='color:#808030; '>*</span> bs<span style='color:#808030; '>{</span><span style='color:#008c00; '>0..</span>Bitx<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
477: 
478:         <span style='color:#808030; '>IF</span> Byte2<span style='color:#808030; '>-</span>Byte1 <span style='color:#808030; '>></span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
479:            Lib<span style='color:#008c00; '>.</span>Fill<span style='color:#808030; '>(</span>ADR<span style='color:#808030; '>(</span>ATTBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte1<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>Byte2<span style='color:#808030; '>-</span>Byte1<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span>
480:                     Mask<span style='color:#808030; '>)</span>
481:         <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
482: 
483:         ATTBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte2<span style='color:#808030; '>]</span><span style='color:#808030; '>:=</span>
484:         <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>ATTBitMap<span style='color:#808030; '>[</span>MapNum<span style='color:#808030; '>]</span><span style='color:#808030; '>^</span><span style='color:#808030; '>[</span>y<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span>Byte2<span style='color:#808030; '>]</span><span style='color:#808030; '>-</span>bs<span style='color:#808030; '>{</span>Bitx2<span style='color:#008c00; '>..7</span><span style='color:#808030; '>}</span><span style='color:#808030; '>)</span>
485:         <span style='color:#808030; '>+</span> <span style='color:#808030; '>(</span>Mask <span style='color:#808030; '>*</span> bs<span style='color:#808030; '>{</span>Bitx2<span style='color:#008c00; '>..7</span><span style='color:#808030; '>}</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
486:      <span style='color:#808030; '>END</span>
487:   <span style='color:#808030; '>END</span>
488: <span style='color:#808030; '>END</span> ATTHLine<span style='color:#808030; '>;</span>
489: 
490: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> InitATT <span style='color:#808030; '>;</span>
491: <span style='color:#808030; '>BEGIN</span>
492:   Width     <span style='color:#808030; '>:=</span> ATTWidth <span style='color:#808030; '>;</span>
493:   Depth     <span style='color:#808030; '>:=</span> ATTDepth <span style='color:#808030; '>;</span>
494:   NumColor  <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>2</span> <span style='color:#808030; '>;</span>
495:   TextMode  <span style='color:#808030; '>:=</span> CGATextMode <span style='color:#808030; '>;</span>
496:   GraphMode <span style='color:#808030; '>:=</span> ATTGraphMode <span style='color:#808030; '>;</span>
497:   Plot      <span style='color:#808030; '>:=</span> ATTPlot <span style='color:#808030; '>;</span>
498:   Point     <span style='color:#808030; '>:=</span> ATTPoint <span style='color:#808030; '>;</span>
499:   HLine     <span style='color:#808030; '>:=</span> ATTHLine <span style='color:#808030; '>;</span>
500:   ATTBitMap<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>:=</span> <span style='color:#808030; '>[</span><span style='color:#008c00; '>0B000H</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>8000H</span><span style='color:#808030; '>]</span><span style='color:#808030; '>;</span>  <span style='color:#696969; '>(* Initialise BitMap pointers *)</span>
501:   ATTBitMap<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>:=</span> <span style='color:#808030; '>[</span><span style='color:#008c00; '>0B000H</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0A000H</span><span style='color:#808030; '>]</span><span style='color:#808030; '>;</span>
502:   ATTBitMap<span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>:=</span> <span style='color:#808030; '>[</span><span style='color:#008c00; '>0B000H</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0C000H</span><span style='color:#808030; '>]</span><span style='color:#808030; '>;</span>
503:   ATTBitMap<span style='color:#808030; '>[</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>]</span><span style='color:#808030; '>:=</span> <span style='color:#808030; '>[</span><span style='color:#008c00; '>0B000H</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0E000H</span><span style='color:#808030; '>]</span><span style='color:#808030; '>;</span>
504: <span style='color:#808030; '>END</span> InitATT <span style='color:#808030; '>;</span>
505: 
506: 
507: <span style='color:#696969; '>(* ------  Device independant routines ------ *)</span>
508: 
509: 
510: 
511: 
512: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> Line<span style='color:#808030; '>(</span>x1<span style='color:#808030; '>,</span>y1<span style='color:#808030; '>,</span>x2<span style='color:#808030; '>,</span>y2<span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span> c<span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
513: <span style='color:#800000; font-weight:bold; '>VAR</span>
514:   dx<span style='color:#808030; '>,</span>dy<span style='color:#808030; '>,</span>e<span style='color:#808030; '>,</span>tmp <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>;</span>
515: <span style='color:#808030; '>BEGIN</span>
516:   <span style='color:#808030; '>IF</span> x1 <span style='color:#808030; '>></span> x2 <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#696969; '>(* ensure that x2 >= x1 *)</span>
517:     tmp <span style='color:#808030; '>:=</span> x1<span style='color:#808030; '>;</span> x1 <span style='color:#808030; '>:=</span> x2<span style='color:#808030; '>;</span> x2 <span style='color:#808030; '>:=</span> tmp<span style='color:#808030; '>;</span>
518:     tmp <span style='color:#808030; '>:=</span> y1<span style='color:#808030; '>;</span> y1 <span style='color:#808030; '>:=</span> y2<span style='color:#808030; '>;</span> y2 <span style='color:#808030; '>:=</span> tmp<span style='color:#808030; '>;</span>
519:   <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
520: 
521:   dx <span style='color:#808030; '>:=</span> x2<span style='color:#808030; '>-</span>x1<span style='color:#808030; '>;</span>
522:   e  <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
523:   <span style='color:#808030; '>IF</span> y1 <span style='color:#808030; '>&lt;=</span> y2 <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#696969; '>(* case where y increases *)</span>
524:     dy <span style='color:#808030; '>:=</span> <span style='color:#808030; '>(</span>y2<span style='color:#808030; '>-</span>y1<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
525:     <span style='color:#808030; '>IF</span> dx <span style='color:#808030; '>>=</span> dy <span style='color:#800000; font-weight:bold; '>THEN</span>
526:       <span style='color:#808030; '>LOOP</span>
527:         Plot<span style='color:#808030; '>(</span> x1<span style='color:#808030; '>,</span>y1<span style='color:#808030; '>,</span>c <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
528:         <span style='color:#808030; '>IF</span> x1 <span style='color:#808030; '>=</span> x2 <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#800000; font-weight:bold; '>EXIT</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
529:         INC<span style='color:#808030; '>(</span>x1<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
530:         INC<span style='color:#808030; '>(</span>e<span style='color:#808030; '>,</span>dy<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
531:         INC<span style='color:#808030; '>(</span>e<span style='color:#808030; '>,</span>dy<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
532:         <span style='color:#808030; '>IF</span> e <span style='color:#808030; '>></span> dx <span style='color:#800000; font-weight:bold; '>THEN</span>
533:           DEC<span style='color:#808030; '>(</span>e<span style='color:#808030; '>,</span>dx<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
534:           DEC<span style='color:#808030; '>(</span>e<span style='color:#808030; '>,</span>dx<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
535:           INC<span style='color:#808030; '>(</span>y1<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
536:         <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
537:       <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
538:     <span style='color:#800000; font-weight:bold; '>ELSE</span>
539:       <span style='color:#808030; '>LOOP</span>
540:         Plot<span style='color:#808030; '>(</span> x1<span style='color:#808030; '>,</span>y1<span style='color:#808030; '>,</span>c <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
541:         <span style='color:#808030; '>IF</span> y1 <span style='color:#808030; '>=</span> y2 <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#800000; font-weight:bold; '>EXIT</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
542:         INC<span style='color:#808030; '>(</span>y1<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
543:         INC<span style='color:#808030; '>(</span>e<span style='color:#808030; '>,</span>dx<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
544:         INC<span style='color:#808030; '>(</span>e<span style='color:#808030; '>,</span>dx<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
545:         <span style='color:#808030; '>IF</span> e <span style='color:#808030; '>></span> dy <span style='color:#800000; font-weight:bold; '>THEN</span>
546:           DEC<span style='color:#808030; '>(</span>e<span style='color:#808030; '>,</span>dy<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
547:           DEC<span style='color:#808030; '>(</span>e<span style='color:#808030; '>,</span>dy<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
548:           INC<span style='color:#808030; '>(</span>x1<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
549:         <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
550:       <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
551:     <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
552:   <span style='color:#800000; font-weight:bold; '>ELSE</span>
553:     <span style='color:#696969; '>(* case where y decreases *)</span>
554:     dy <span style='color:#808030; '>:=</span> <span style='color:#808030; '>(</span>y1<span style='color:#808030; '>-</span>y2<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
555:     <span style='color:#808030; '>IF</span> dx <span style='color:#808030; '>>=</span> dy <span style='color:#800000; font-weight:bold; '>THEN</span>
556:       <span style='color:#808030; '>LOOP</span>
557:         Plot<span style='color:#808030; '>(</span> x1<span style='color:#808030; '>,</span>y1<span style='color:#808030; '>,</span>c <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
558:         <span style='color:#808030; '>IF</span> x1 <span style='color:#808030; '>=</span> x2 <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#800000; font-weight:bold; '>EXIT</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
559:         INC<span style='color:#808030; '>(</span>x1<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
560:         INC<span style='color:#808030; '>(</span>e<span style='color:#808030; '>,</span>dy<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
561:         INC<span style='color:#808030; '>(</span>e<span style='color:#808030; '>,</span>dy<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
562:         <span style='color:#808030; '>IF</span> e <span style='color:#808030; '>></span> dx <span style='color:#800000; font-weight:bold; '>THEN</span>
563:           DEC<span style='color:#808030; '>(</span>e<span style='color:#808030; '>,</span>dx<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
564:           DEC<span style='color:#808030; '>(</span>e<span style='color:#808030; '>,</span>dx<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
565:           DEC<span style='color:#808030; '>(</span>y1<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
566:         <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
567:       <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
568:     <span style='color:#800000; font-weight:bold; '>ELSE</span>
569:       <span style='color:#808030; '>LOOP</span>
570:         Plot<span style='color:#808030; '>(</span> x1<span style='color:#808030; '>,</span>y1<span style='color:#808030; '>,</span>c <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
571:         <span style='color:#808030; '>IF</span> y1 <span style='color:#808030; '>=</span> y2 <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#800000; font-weight:bold; '>EXIT</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
572:         DEC<span style='color:#808030; '>(</span>y1<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
573:         INC<span style='color:#808030; '>(</span>e<span style='color:#808030; '>,</span>dx<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
574:         INC<span style='color:#808030; '>(</span>e<span style='color:#808030; '>,</span>dx<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
575:         <span style='color:#808030; '>IF</span> e <span style='color:#808030; '>></span> dy <span style='color:#800000; font-weight:bold; '>THEN</span>
576:           DEC<span style='color:#808030; '>(</span>e<span style='color:#808030; '>,</span>dy<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
577:           DEC<span style='color:#808030; '>(</span>e<span style='color:#808030; '>,</span>dy<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
578:           INC<span style='color:#808030; '>(</span>x1<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
579:         <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
580:       <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
581:     <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
582:   <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
583: <span style='color:#808030; '>END</span> Line<span style='color:#808030; '>;</span>
584: 
585: 
586: <span style='color:#800000; font-weight:bold; '>CONST</span>
587:   dx <span style='color:#808030; '>=</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>;</span>
588:   dy <span style='color:#808030; '>=</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>;</span>
589: 
590: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> Disc<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>,</span>r<span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span> c<span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
591: <span style='color:#800000; font-weight:bold; '>VAR</span>
592:   e   <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>;</span>
593:   x<span style='color:#808030; '>,</span>y <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
594: <span style='color:#808030; '>BEGIN</span>
595:   x <span style='color:#808030; '>:=</span> r<span style='color:#808030; '>;</span> y <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span> e <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
596:   <span style='color:#808030; '>WHILE</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>y<span style='color:#808030; '>)</span> <span style='color:#808030; '>&lt;=</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>DO</span>
597:     HLine<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>-</span>x<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>+</span>y<span style='color:#808030; '>,</span>x0<span style='color:#808030; '>+</span>x<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
598:     HLine<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>-</span>x<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>-</span>y<span style='color:#808030; '>,</span>x0<span style='color:#808030; '>+</span>x<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
599:     INC<span style='color:#808030; '>(</span>y<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
600:     INC<span style='color:#808030; '>(</span>e<span style='color:#808030; '>,</span>y<span style='color:#808030; '>*</span>dy<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
601:     <span style='color:#808030; '>IF</span> e <span style='color:#808030; '>></span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
602:       DEC<span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
603:       DEC<span style='color:#808030; '>(</span>e<span style='color:#808030; '>,</span>x<span style='color:#808030; '>*</span>dx<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
604:       HLine<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>-</span>y<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>+</span>x<span style='color:#808030; '>,</span>x0<span style='color:#808030; '>+</span>y<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
605:       HLine<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>-</span>y<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>-</span>x<span style='color:#808030; '>,</span>x0<span style='color:#808030; '>+</span>y<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
606:     <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
607:   <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
608: <span style='color:#808030; '>END</span> Disc<span style='color:#808030; '>;</span>
609: 
610: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> Circle<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>,</span>r<span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span> c<span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
611: <span style='color:#800000; font-weight:bold; '>VAR</span>
612:   e   <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>;</span>
613:   x<span style='color:#808030; '>,</span>y <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
614: <span style='color:#808030; '>BEGIN</span>
615:   x <span style='color:#808030; '>:=</span> r<span style='color:#808030; '>;</span> y <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span> e <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
616:   <span style='color:#808030; '>WHILE</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>y<span style='color:#808030; '>)</span> <span style='color:#808030; '>&lt;=</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>DO</span>
617:     Plot<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>+</span>x<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>+</span>y<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
618:     Plot<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>-</span>x<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>+</span>y<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
619:     Plot<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>+</span>x<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>-</span>y<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
620:     Plot<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>-</span>x<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>-</span>y<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
621:     Plot<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>+</span>y<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>+</span>x<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
622:     Plot<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>-</span>y<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>+</span>x<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
623:     Plot<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>+</span>y<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>-</span>x<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
624:     Plot<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>-</span>y<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>-</span>x<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
625:     INC<span style='color:#808030; '>(</span>y<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
626:     INC<span style='color:#808030; '>(</span>e<span style='color:#808030; '>,</span>y<span style='color:#808030; '>*</span>dy<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
627:     <span style='color:#808030; '>IF</span> e <span style='color:#808030; '>></span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
628:       DEC<span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
629:       DEC<span style='color:#808030; '>(</span>e<span style='color:#808030; '>,</span>x<span style='color:#808030; '>*</span>dx<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
630:     <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
631:   <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
632: <span style='color:#808030; '>END</span> Circle<span style='color:#808030; '>;</span>
633: 
634: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> Ellipse <span style='color:#808030; '>(</span> x0<span style='color:#808030; '>,</span>y0 <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span> <span style='color:#808030; '>;</span>  <span style='color:#696969; '>(* center *)</span>
635:                     a0<span style='color:#808030; '>,</span>b0 <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span> <span style='color:#808030; '>;</span>  <span style='color:#696969; '>(* semi-axes *)</span>
636:                     c     <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span> <span style='color:#808030; '>;</span>  <span style='color:#696969; '>(* color *)</span>
637:                     fill  <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>BOOLEAN</span> <span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span> <span style='color:#696969; '>(* wether filled *)</span>
638: <span style='color:#800000; font-weight:bold; '>VAR</span>
639:   x<span style='color:#808030; '>,</span>y <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span> <span style='color:#808030; '>;</span>
640:   a<span style='color:#808030; '>,</span>b <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>LONGINT</span> <span style='color:#808030; '>;</span>
641:   asq<span style='color:#808030; '>,</span>asq2<span style='color:#808030; '>,</span>bsq<span style='color:#808030; '>,</span>bsq2 <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>LONGINT</span> <span style='color:#808030; '>;</span>
642:   d<span style='color:#808030; '>,</span>dx<span style='color:#808030; '>,</span>dy           <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>LONGINT</span> <span style='color:#808030; '>;</span>
643: <span style='color:#808030; '>BEGIN</span>
644:   x <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>;</span>
645:   y <span style='color:#808030; '>:=</span> b0 <span style='color:#808030; '>;</span>
646:   a <span style='color:#808030; '>:=</span> <span style='color:#800000; font-weight:bold; '>LONGINT</span><span style='color:#808030; '>(</span>a0<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
647:   b <span style='color:#808030; '>:=</span> <span style='color:#800000; font-weight:bold; '>LONGINT</span><span style='color:#808030; '>(</span>b0<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
648:   asq <span style='color:#808030; '>:=</span> a<span style='color:#808030; '>*</span>a <span style='color:#808030; '>;</span>
649:   asq2 <span style='color:#808030; '>:=</span> asq<span style='color:#808030; '>*</span><span style='color:#008c00; '>2</span> <span style='color:#808030; '>;</span>
650:   bsq <span style='color:#808030; '>:=</span> b<span style='color:#808030; '>*</span>b <span style='color:#808030; '>;</span>
651:   bsq2 <span style='color:#808030; '>:=</span> bsq<span style='color:#808030; '>*</span><span style='color:#008c00; '>2</span> <span style='color:#808030; '>;</span>
652:   d <span style='color:#808030; '>:=</span> bsq<span style='color:#808030; '>-</span><span style='color:#808030; '>(</span>asq<span style='color:#808030; '>*</span>b<span style='color:#808030; '>)</span><span style='color:#808030; '>+</span><span style='color:#808030; '>(</span>asq <span style='color:#800000; font-weight:bold; '>DIV</span> <span style='color:#008c00; '>4</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
653:   dx <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>;</span>
654:   dy <span style='color:#808030; '>:=</span> asq2<span style='color:#808030; '>*</span>b <span style='color:#808030; '>;</span>
655:   <span style='color:#808030; '>WHILE</span> dx<span style='color:#808030; '>&lt;</span>dy <span style='color:#800000; font-weight:bold; '>DO</span>
656:     <span style='color:#808030; '>IF</span> fill <span style='color:#800000; font-weight:bold; '>THEN</span>
657:       HLine<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>-</span>x<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>+</span>y<span style='color:#808030; '>,</span>x0<span style='color:#808030; '>+</span>x<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
658:       HLine<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>-</span>x<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>-</span>y<span style='color:#808030; '>,</span>x0<span style='color:#808030; '>+</span>x<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
659:     <span style='color:#800000; font-weight:bold; '>ELSE</span>
660:       Plot<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>+</span>x<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>+</span>y<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
661:       Plot<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>-</span>x<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>+</span>y<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
662:       Plot<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>+</span>x<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>-</span>y<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
663:       Plot<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>-</span>x<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>-</span>y<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
664:     <span style='color:#808030; '>END</span> <span style='color:#808030; '>;</span>
665:     <span style='color:#808030; '>IF</span> d<span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
666:       DEC<span style='color:#808030; '>(</span>y<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
667:       DEC<span style='color:#808030; '>(</span>dy<span style='color:#808030; '>,</span>asq2<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
668:       DEC<span style='color:#808030; '>(</span>d<span style='color:#808030; '>,</span>dy<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
669:     <span style='color:#808030; '>END</span> <span style='color:#808030; '>;</span>
670:     INC<span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
671:     INC<span style='color:#808030; '>(</span>dx<span style='color:#808030; '>,</span>bsq2<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
672:     INC<span style='color:#808030; '>(</span>d<span style='color:#808030; '>,</span>bsq<span style='color:#808030; '>+</span>dx<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
673:   <span style='color:#808030; '>END</span> <span style='color:#808030; '>;</span>
674:   INC<span style='color:#808030; '>(</span>d<span style='color:#808030; '>,</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span>asq<span style='color:#808030; '>-</span>bsq<span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>DIV</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>-</span><span style='color:#808030; '>(</span>dx<span style='color:#808030; '>+</span>dy<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>DIV</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
675:   <span style='color:#808030; '>WHILE</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>y<span style='color:#808030; '>)</span><span style='color:#808030; '>>=</span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>DO</span>
676:     <span style='color:#808030; '>IF</span> fill <span style='color:#800000; font-weight:bold; '>THEN</span>
677:       HLine<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>-</span>x<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>+</span>y<span style='color:#808030; '>,</span>x0<span style='color:#808030; '>+</span>x<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
678:       HLine<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>-</span>x<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>-</span>y<span style='color:#808030; '>,</span>x0<span style='color:#808030; '>+</span>x<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
679:     <span style='color:#800000; font-weight:bold; '>ELSE</span>
680:       Plot<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>+</span>x<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>+</span>y<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
681:       Plot<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>-</span>x<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>+</span>y<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
682:       Plot<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>+</span>x<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>-</span>y<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
683:       Plot<span style='color:#808030; '>(</span>x0<span style='color:#808030; '>-</span>x<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>-</span>y<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
684:     <span style='color:#808030; '>END</span> <span style='color:#808030; '>;</span>
685:     <span style='color:#808030; '>IF</span> d<span style='color:#808030; '>&lt;</span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
686:       INC<span style='color:#808030; '>(</span>x<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
687:       INC<span style='color:#808030; '>(</span>dx<span style='color:#808030; '>,</span>bsq2<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
688:       INC<span style='color:#808030; '>(</span>d<span style='color:#808030; '>,</span>dx<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
689:     <span style='color:#808030; '>END</span> <span style='color:#808030; '>;</span>
690:     DEC<span style='color:#808030; '>(</span>y<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
691:     DEC<span style='color:#808030; '>(</span>dy<span style='color:#808030; '>,</span>asq2<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
692:     INC<span style='color:#808030; '>(</span>d<span style='color:#808030; '>,</span>asq<span style='color:#808030; '>-</span>dy<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
693:   <span style='color:#808030; '>END</span> <span style='color:#808030; '>;</span>
694: <span style='color:#808030; '>END</span> Ellipse <span style='color:#808030; '>;</span>
695: 
696: 
697: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> Polygon<span style='color:#808030; '>(</span>n<span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span> px<span style='color:#808030; '>,</span>py<span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>ARRAY</span> <span style='color:#800000; font-weight:bold; '>OF</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span> c<span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
698: <span style='color:#800000; font-weight:bold; '>CONST</span>
699:   MaxPts <span style='color:#808030; '>=</span> <span style='color:#008c00; '>20</span><span style='color:#808030; '>;</span>
700: <span style='color:#800000; font-weight:bold; '>VAR</span>
701:   y<span style='color:#808030; '>,</span>miny<span style='color:#808030; '>,</span>maxy<span style='color:#808030; '>,</span>x0<span style='color:#808030; '>,</span>y0<span style='color:#808030; '>,</span>x1<span style='color:#808030; '>,</span>y1<span style='color:#808030; '>,</span>temp<span style='color:#808030; '>,</span>i<span style='color:#808030; '>,</span>edge<span style='color:#808030; '>,</span>next_edge<span style='color:#808030; '>,</span>active <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>;</span>
702:   xord <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>ARRAY</span> <span style='color:#808030; '>[</span><span style='color:#008c00; '>0..</span>MaxPts<span style='color:#808030; '>]</span> <span style='color:#800000; font-weight:bold; '>OF</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>;</span>
703:   x    <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>ARRAY</span> <span style='color:#808030; '>[</span><span style='color:#008c00; '>0..</span>MaxPts<span style='color:#808030; '>]</span> <span style='color:#800000; font-weight:bold; '>OF</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
704:   e    <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>ARRAY</span> <span style='color:#808030; '>[</span><span style='color:#008c00; '>0..</span>MaxPts<span style='color:#808030; '>]</span> <span style='color:#800000; font-weight:bold; '>OF</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>;</span>
705: 
706: <span style='color:#800000; font-weight:bold; '>PROCEDURE</span> quicksort<span style='color:#808030; '>(</span>l<span style='color:#808030; '>,</span>r<span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
707: <span style='color:#800000; font-weight:bold; '>VAR</span>
708:   i<span style='color:#808030; '>,</span>j<span style='color:#808030; '>,</span>temp <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>;</span>
709:   key <span style='color:#808030; '>:</span> <span style='color:#800000; font-weight:bold; '>CARDINAL</span><span style='color:#808030; '>;</span>
710: <span style='color:#808030; '>BEGIN</span>
711:   <span style='color:#808030; '>WHILE</span> <span style='color:#808030; '>(</span> l <span style='color:#808030; '>&lt;</span> r <span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>DO</span>
712:     i <span style='color:#808030; '>:=</span> l<span style='color:#808030; '>;</span> j <span style='color:#808030; '>:=</span> r<span style='color:#808030; '>;</span> key <span style='color:#808030; '>:=</span> x<span style='color:#808030; '>[</span>xord<span style='color:#808030; '>[</span>j<span style='color:#808030; '>]</span><span style='color:#808030; '>]</span><span style='color:#808030; '>;</span>
713:     <span style='color:#808030; '>REPEAT</span>
714:       <span style='color:#808030; '>WHILE</span> <span style='color:#808030; '>(</span> i <span style='color:#808030; '>&lt;</span> j <span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>AND</span> <span style='color:#808030; '>(</span> x<span style='color:#808030; '>[</span>xord<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>&lt;=</span> key <span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>DO</span> i <span style='color:#808030; '>:=</span> i <span style='color:#808030; '>+</span> <span style='color:#008c00; '>1</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
715:       <span style='color:#808030; '>WHILE</span> <span style='color:#808030; '>(</span> i <span style='color:#808030; '>&lt;</span> j <span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>AND</span> <span style='color:#808030; '>(</span> key <span style='color:#808030; '>&lt;=</span> x<span style='color:#808030; '>[</span>xord<span style='color:#808030; '>[</span>j<span style='color:#808030; '>]</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>DO</span> j <span style='color:#808030; '>:=</span> j <span style='color:#808030; '>-</span> <span style='color:#008c00; '>1</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
716:       <span style='color:#808030; '>IF</span> i <span style='color:#808030; '>&lt;</span> j <span style='color:#800000; font-weight:bold; '>THEN</span>
717:         temp <span style='color:#808030; '>:=</span> xord<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>;</span> xord<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span> <span style='color:#808030; '>:=</span> xord<span style='color:#808030; '>[</span>j<span style='color:#808030; '>]</span><span style='color:#808030; '>;</span> xord<span style='color:#808030; '>[</span>j<span style='color:#808030; '>]</span> <span style='color:#808030; '>:=</span> temp<span style='color:#808030; '>;</span>
718:       <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
719:     <span style='color:#808030; '>UNTIL</span> <span style='color:#808030; '>(</span> i <span style='color:#808030; '>>=</span> j <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
720:     temp <span style='color:#808030; '>:=</span> xord<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>;</span> xord<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span> <span style='color:#808030; '>:=</span> xord<span style='color:#808030; '>[</span>r<span style='color:#808030; '>]</span><span style='color:#808030; '>;</span> xord<span style='color:#808030; '>[</span>r<span style='color:#808030; '>]</span> <span style='color:#808030; '>:=</span> temp<span style='color:#808030; '>;</span>
721:     <span style='color:#808030; '>IF</span> <span style='color:#808030; '>(</span>i<span style='color:#808030; '>-</span>l <span style='color:#808030; '>&lt;</span> r<span style='color:#808030; '>-</span>i<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
722:       quicksort<span style='color:#808030; '>(</span> l<span style='color:#808030; '>,</span> i<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> l <span style='color:#808030; '>:=</span> i<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
723:     <span style='color:#800000; font-weight:bold; '>ELSE</span>
724:       quicksort<span style='color:#808030; '>(</span> i<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> r <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> r <span style='color:#808030; '>:=</span> i<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
725:     <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
726:   <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
727: <span style='color:#808030; '>END</span> quicksort<span style='color:#808030; '>;</span>
728: 
729: <span style='color:#808030; '>BEGIN</span>
730:   <span style='color:#808030; '>IF</span> n <span style='color:#808030; '>></span> MaxPts <span style='color:#800000; font-weight:bold; '>THEN</span> n <span style='color:#808030; '>:=</span> MaxPts <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
731: 
732:   <span style='color:#696969; '>(* find extremal y points *)</span>
733:   miny <span style='color:#808030; '>:=</span> py<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>;</span> maxy <span style='color:#808030; '>:=</span> miny<span style='color:#808030; '>;</span>
734:   <span style='color:#808030; '>FOR</span> i <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>TO</span> n<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>DO</span>
735:     <span style='color:#808030; '>IF</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>py<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>&lt;</span> miny <span style='color:#800000; font-weight:bold; '>THEN</span> miny <span style='color:#808030; '>:=</span> py<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>;</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
736:     <span style='color:#808030; '>IF</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>py<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>></span> maxy <span style='color:#800000; font-weight:bold; '>THEN</span> maxy <span style='color:#808030; '>:=</span> py<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>;</span> <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
737:   <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
738: 
739:   <span style='color:#808030; '>FOR</span> y <span style='color:#808030; '>:=</span> miny <span style='color:#800000; font-weight:bold; '>TO</span> maxy <span style='color:#800000; font-weight:bold; '>DO</span>
740:     active <span style='color:#808030; '>:=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
741:     <span style='color:#808030; '>FOR</span> edge <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>TO</span> n<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>DO</span>
742:       <span style='color:#808030; '>IF</span> edge <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>n<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span> next_edge <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0</span>
743:                              <span style='color:#800000; font-weight:bold; '>ELSE</span> next_edge <span style='color:#808030; '>:=</span> edge <span style='color:#808030; '>+</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
744:       <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
745:       x0 <span style='color:#808030; '>:=</span> px<span style='color:#808030; '>[</span>edge<span style='color:#808030; '>]</span><span style='color:#808030; '>;</span> y0 <span style='color:#808030; '>:=</span> py<span style='color:#808030; '>[</span>edge<span style='color:#808030; '>]</span><span style='color:#808030; '>;</span>
746:       x1 <span style='color:#808030; '>:=</span> px<span style='color:#808030; '>[</span>next_edge<span style='color:#808030; '>]</span><span style='color:#808030; '>;</span> y1 <span style='color:#808030; '>:=</span> py<span style='color:#808030; '>[</span>next_edge<span style='color:#808030; '>]</span><span style='color:#808030; '>;</span>
747:       <span style='color:#808030; '>IF</span> y0 <span style='color:#808030; '>></span> y1 <span style='color:#800000; font-weight:bold; '>THEN</span> temp <span style='color:#808030; '>:=</span> x0<span style='color:#808030; '>;</span> x0 <span style='color:#808030; '>:=</span> x1<span style='color:#808030; '>;</span> x1 <span style='color:#808030; '>:=</span> temp<span style='color:#808030; '>;</span>
748:                       temp <span style='color:#808030; '>:=</span> y0<span style='color:#808030; '>;</span> y0 <span style='color:#808030; '>:=</span> y1<span style='color:#808030; '>;</span> y1 <span style='color:#808030; '>:=</span> temp <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
749:       <span style='color:#808030; '>IF</span> y <span style='color:#808030; '>=</span> y0 <span style='color:#800000; font-weight:bold; '>THEN</span> e<span style='color:#808030; '>[</span>edge<span style='color:#808030; '>]</span> <span style='color:#808030; '>:=</span>  <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span> x<span style='color:#808030; '>[</span>edge<span style='color:#808030; '>]</span> <span style='color:#808030; '>:=</span> x0
750:       <span style='color:#800000; font-weight:bold; '>ELSIF</span> <span style='color:#808030; '>(</span> y0 <span style='color:#808030; '>&lt;=</span> y <span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>AND</span> <span style='color:#808030; '>(</span> y <span style='color:#808030; '>&lt;=</span> y1 <span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>THEN</span>
751:         <span style='color:#808030; '>IF</span> x1 <span style='color:#808030; '>>=</span> x0 <span style='color:#800000; font-weight:bold; '>THEN</span> <span style='color:#696969; '>(* x increases with y *)</span>
752:           INC<span style='color:#808030; '>(</span> e<span style='color:#808030; '>[</span>edge<span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span>x1<span style='color:#808030; '>-</span>x0<span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
753:           <span style='color:#808030; '>WHILE</span> e<span style='color:#808030; '>[</span>edge<span style='color:#808030; '>]</span> <span style='color:#808030; '>></span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>y1<span style='color:#808030; '>-</span>y0<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>DO</span>
754:             DEC<span style='color:#808030; '>(</span> e<span style='color:#808030; '>[</span>edge<span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span>y1<span style='color:#808030; '>-</span>y0<span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> INC<span style='color:#808030; '>(</span>x<span style='color:#808030; '>[</span>edge<span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
755:           <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
756:         <span style='color:#800000; font-weight:bold; '>ELSE</span> <span style='color:#696969; '>(* x decreases with y *)</span>
757:           INC<span style='color:#808030; '>(</span> e<span style='color:#808030; '>[</span>edge<span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span>x0<span style='color:#808030; '>-</span>x1<span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
758:           <span style='color:#808030; '>WHILE</span> e<span style='color:#808030; '>[</span>edge<span style='color:#808030; '>]</span> <span style='color:#808030; '>></span> <span style='color:#800000; font-weight:bold; '>INTEGER</span><span style='color:#808030; '>(</span>y1<span style='color:#808030; '>-</span>y0<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>DO</span>
759:             DEC<span style='color:#808030; '>(</span> e<span style='color:#808030; '>[</span>edge<span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>*</span><span style='color:#808030; '>(</span>y1<span style='color:#808030; '>-</span>y0<span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> DEC<span style='color:#808030; '>(</span>x<span style='color:#808030; '>[</span>edge<span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
760:           <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
761:         <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
762:         active <span style='color:#808030; '>:=</span> active <span style='color:#808030; '>+</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
763:         xord<span style='color:#808030; '>[</span>active<span style='color:#808030; '>]</span> <span style='color:#808030; '>:=</span> edge<span style='color:#808030; '>;</span>
764:       <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
765:     <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
766:     quicksort<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>active<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
767:     i <span style='color:#808030; '>:=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
768:     <span style='color:#808030; '>WHILE</span> i <span style='color:#808030; '>&lt;</span> active <span style='color:#800000; font-weight:bold; '>DO</span>
769:       HLine<span style='color:#808030; '>(</span> x<span style='color:#808030; '>[</span>xord<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> y<span style='color:#808030; '>,</span> x<span style='color:#808030; '>[</span>xord<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> c <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
770:       i <span style='color:#808030; '>:=</span> i <span style='color:#808030; '>+</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>;</span>
771:     <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span>
772:   <span style='color:#808030; '>END</span><span style='color:#808030; '>;</span> <span style='color:#696969; '>(* for y := .. *)</span>
773: <span style='color:#808030; '>END</span> Polygon<span style='color:#808030; '>;</span>
774: 
775: 
776: 
777: 
778: <span style='color:#696969; '>(* - Auto reset to text mode</span>
779: <span style='color:#696969; '></span>
780: <span style='color:#696969; '>VAR Continue:PROC;</span>
781: <span style='color:#696969; '>PROCEDURE Finish;</span>
782: <span style='color:#696969; '>BEGIN</span>
783: <span style='color:#696969; '>  TextMode;</span>
784: <span style='color:#696969; '>  Continue;</span>
785: <span style='color:#696969; '>END Finish;</span>
786: <span style='color:#696969; '></span>
787: <span style='color:#696969; '>BEGIN</span>
788: <span style='color:#696969; '>  Lib.Terminate( Finish, Continue );</span>
789: <span style='color:#696969; '>  InitCGA ;</span>
790: <span style='color:#696969; '>END Gr.</span>
791: <span style='color:#696969; '></span>
792: <span style='color:#696969; '>*)</span>
793: 
794: <span style='color:#808030; '>BEGIN</span>
795:   InitEGA <span style='color:#808030; '>;</span> <span style='color:#696969; '>(* Change this for other adaptors *)</span>
796: <span style='color:#808030; '>END</span> Graph<span style='color:#808030; '>.</span>
797: 
798: 
799: 
