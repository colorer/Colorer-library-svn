  0: <span class='c1c-c1cWord def-Keyword'>Перем</span> НДС19_1<span class='c1c-c1cSymb def-Symbol'>,</span> НДС19_2<span class='c1c-c1cSymb def-Symbol'>,</span> НДС19_3<span class='c1c-c1cSymb def-Symbol'>,</span> НДС19_4<span class='c1c-c1cSymb def-Symbol'>,</span> НДС19_5<span class='c1c-c1cSymb def-Symbol'>,</span> НДС19_6<span class='c1c-c1cSymb def-Symbol'>,</span> НДС19_7<span class='c1c-c1cSymb def-Symbol'>;</span>
  1: <span class='c1c-c1cWord def-Keyword'>Перем</span> Док<span class='c1c-c1cSymb def-Symbol'>;</span>
  2: <span class='c1c-c1cWord def-Keyword'>Перем</span> ФлагЗакрСчФ<span class='c1c-c1cSymb def-Symbol'>;</span>
  3: 
  4: <span class='c1c-c1cComment def-Comment def-Syntax'>// оРегВЗ = рассчитанный объект "Регистр.Взаиморасчеты"</span>
  5: <span class='c1c-c1cComment def-Comment def-Syntax'>// К - коэффициент закрытия СчФ</span>
  6: <span class='c1c-c1cComment def-Comment def-Syntax'>// Возвращает сумму, на которую была закрыта СчФ</span>
  7: <span class='c1c-c1cWord def-Keyword'>Функция</span> ЗакрытьСчетФактуруБезВозвращенных<span class='def-Symbol'>(</span> оРегВЗ<span class='c1c-c1cSymb def-Symbol'>,</span> СчФ<span class='c1c-c1cSymb def-Symbol'>,</span> К<span class='c1c-c1cSymb def-Symbol'>,</span> ТаблицаВозврата <span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Экспорт</span>
  8:     <span class='c1c-c1cWord2 def-Keyword'>Состояние</span><span class='def-Symbol'>(</span> <span class='c1c-c1cString def-String'>"Закрываем счет фактуру &lt;"</span><span class='c1c-c1cSymb def-Symbol'>+</span>СчФ<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>"> с коэффициентом "</span><span class='c1c-c1cSymb def-Symbol'>+</span>К <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
  9:     КомСчФОтгрузки <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cString def-String'>"По СчФ &lt;"</span><span class='c1c-c1cSymb def-Symbol'>+</span>СчФ<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>"> (оплата)"</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 10: 
 11:     ОбщаяСуммаОплаты <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 12:     СчФ<span class='def-Number'>.</span>ВыбратьСтроки<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 13:     <span class='c1c-c1cWord def-Keyword'>Пока</span> СчФ<span class='def-Number'>.</span>ПолучитьСтроку<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Цикл</span>
 14:         НомСтр <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 15:         <span class='c1c-c1cWord def-Keyword'>Если</span> ТаблицаВозврата<span class='def-Number'>.</span>НайтиЗначение<span class='def-Symbol'>(</span> СчФ<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span> НомСтр<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"Наименование"</span> <span class='def-Symbol'>)</span> <span class='c1c-c1cSymb def-Symbol'>></span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
 16:             ТаблицаВозврата<span class='def-Number'>.</span>ПолучитьСтрокуПоНомеру<span class='def-Symbol'>(</span> НомСтр <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 17:             <span class='c1c-c1cWord def-Keyword'>Если</span> ТаблицаВозврата<span class='def-Number'>.</span>БылИзлишекОплаты <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
 18:                 <span class='c1c-c1cWord def-Keyword'>Продолжить</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 19:             <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 20:             вСумма <span class='c1c-c1cSymb def-Symbol'>=</span> ТаблицаВозврата<span class='def-Number'>.</span>Сумма<span class='c1c-c1cSymb def-Symbol'>;</span>
 21:             вНДС <span class='c1c-c1cSymb def-Symbol'>=</span> ТаблицаВозврата<span class='def-Number'>.</span>НДС<span class='c1c-c1cSymb def-Symbol'>;</span>
 22:             вКолич <span class='c1c-c1cSymb def-Symbol'>=</span> ТаблицаВозврата<span class='def-Number'>.</span>Количество<span class='c1c-c1cSymb def-Symbol'>;</span>
 23:             вЕдиница <span class='c1c-c1cSymb def-Symbol'>=</span> ТаблицаВозврата<span class='def-Number'>.</span>Единица<span class='c1c-c1cSymb def-Symbol'>;</span>
 24:             КоэфЕд <span class='c1c-c1cSymb def-Symbol'>=</span> КоэфЕдИзмерения<span class='def-Symbol'>(</span> Единица<span class='c1c-c1cSymb def-Symbol'>,</span> СчФ<span class='def-Number'>.</span>Наименование<span class='def-Number'>.</span>БазоваяЕдиница <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 25:             вКолич <span class='c1c-c1cSymb def-Symbol'>=</span> вКолич <span class='c1c-c1cSymb def-Symbol'>*</span> КоэфЕд<span class='c1c-c1cSymb def-Symbol'>;</span>
 26:         <span class='c1c-c1cWord def-Keyword'>Иначе</span>
 27:             вСумма <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span> вНДС <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span> вКолич <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span> 
 28:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 29: 
 30:         оРегВЗ<span class='def-Number'>.</span>СводныеОстатки<span class='def-Symbol'>(</span> СчФ<span class='def-Number'>.</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span> СчФ<span class='c1c-c1cSymb def-Symbol'>,</span> СчФ<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 31:         ДолгСумма <span class='c1c-c1cSymb def-Symbol'>=</span> оРегВЗ<span class='def-Number'>.</span>Сумма <span class='c1c-c1cSymb def-Symbol'>-</span> вСумма<span class='c1c-c1cSymb def-Symbol'>;</span>
 32:         <span class='c1c-c1cWord def-Keyword'>Если</span> вСумма <span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='c1c-c1cSymb def-Symbol'>></span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
 33:             <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Долг по возвращаемому наименованию &lt;"</span><span class='c1c-c1cSymb def-Symbol'>+</span>СчФ<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>"> составляет "</span><span class='c1c-c1cSymb def-Symbol'>+</span>ДолгСумма<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>"("</span><span class='c1c-c1cSymb def-Symbol'>+</span>оРегВЗ<span class='def-Number'>.</span>Сумма<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" - "</span><span class='c1c-c1cSymb def-Symbol'>+</span>вСумма<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>")"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"i"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 34:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 35:         <span class='c1c-c1cWord def-Keyword'>Если</span> ДолгСумма <span class='c1c-c1cSymb def-Symbol'>&lt;</span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
 36:             <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Долг по возвращаемому наименованию &lt;"</span><span class='c1c-c1cSymb def-Symbol'>+</span>СчФ<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>"> отритцателен: "</span><span class='c1c-c1cSymb def-Symbol'>+</span>ДолгСумма<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>"("</span><span class='c1c-c1cSymb def-Symbol'>+</span>оРегВЗ<span class='def-Number'>.</span>Сумма<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" - "</span><span class='c1c-c1cSymb def-Symbol'>+</span>вСумма<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>")"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"!!!"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 37:             <span class='c1c-c1cWord def-Keyword'>Возврат</span> <span class='c1c-c1cSymb def-Symbol'>-</span><span class='def-Number'>1</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 38:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 39:         ДолгНДС <span class='c1c-c1cSymb def-Symbol'>=</span> оРегВЗ<span class='def-Number'>.</span>Сумма <span class='c1c-c1cSymb def-Symbol'>-</span> вНДС<span class='c1c-c1cSymb def-Symbol'>;</span>
 40:         ДолгКолич <span class='c1c-c1cSymb def-Symbol'>=</span> оРегВЗ<span class='def-Number'>.</span>Количество <span class='c1c-c1cSymb def-Symbol'>-</span> вКолич<span class='c1c-c1cSymb def-Symbol'>;</span>
 41: 
 42:         <span class='c1c-c1cWord def-Keyword'>Если</span> ДолгСумма <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
 43:             <span class='c1c-c1cWord def-Keyword'>Продолжить</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 44:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 45: 
 46:         КоэфЕд <span class='c1c-c1cSymb def-Symbol'>=</span> КоэфЕдИзмерения<span class='def-Symbol'>(</span> СчФ<span class='def-Number'>.</span>Единица<span class='c1c-c1cSymb def-Symbol'>,</span> СчФ<span class='def-Number'>.</span>Наименование<span class='def-Number'>.</span>БазоваяЕдиница <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 47:         ДокКолич <span class='c1c-c1cSymb def-Symbol'>=</span> ДолгКолич <span class='c1c-c1cSymb def-Symbol'>*</span> К <span class='c1c-c1cSymb def-Symbol'>*</span> КоэфЕд<span class='c1c-c1cSymb def-Symbol'>;</span>
 48:         ДокСумма <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cWord2 def-Keyword'>Окр</span><span class='def-Symbol'>(</span> ДолгСумма <span class='c1c-c1cSymb def-Symbol'>*</span> К<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Number'>5</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 49:         ДокНДС <span class='c1c-c1cSymb def-Symbol'>=</span> ДолгНДС <span class='c1c-c1cSymb def-Symbol'>*</span> К<span class='c1c-c1cSymb def-Symbol'>;</span>
 50: 
 51:         <span class='c1c-c1cWord def-Keyword'>Если</span> ЭтоНашаПродукция<span class='def-Symbol'>(</span>СчФ<span class='def-Number'>.</span>Наименование<span class='def-Symbol'>)</span> <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
 52:             ОплатаПоРегиструГотПрод<span class='def-Symbol'>(</span> НомСтр<span class='c1c-c1cSymb def-Symbol'>,</span> СчФ<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span> ДокКолич<span class='c1c-c1cSymb def-Symbol'>,</span> ДокСумма<span class='c1c-c1cSymb def-Symbol'>-</span>ДокНдс<span class='c1c-c1cSymb def-Symbol'>,</span> Регистр<span class='def-Number'>.</span>ГотоваяПродукция <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 53:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 54: 
 55:         Регистр<span class='def-Number'>.</span>Взаиморасчеты<span class='def-Number'>.</span>ПривязыватьСтроку<span class='def-Symbol'>(</span> <span class='def-Number'>0</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 56:         РасходРегВзСОбнул<span class='def-Symbol'>(</span> Регистр<span class='def-Number'>.</span>Взаиморасчеты<span class='c1c-c1cSymb def-Symbol'>,</span> оРегВЗ<span class='c1c-c1cSymb def-Symbol'>,</span> СчФ<span class='c1c-c1cSymb def-Symbol'>,</span> СчФ<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span>
 57:                            ДокСумма<span class='c1c-c1cSymb def-Symbol'>,</span> ДокНДС<span class='c1c-c1cSymb def-Symbol'>,</span> ДокКолич<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>,</span>
 58:                            вСумма<span class='c1c-c1cSymb def-Symbol'>,</span> вНДС<span class='c1c-c1cSymb def-Symbol'>,</span> вКолич <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 59:         ОбщаяСуммаОплаты <span class='c1c-c1cSymb def-Symbol'>=</span> ОбщаяСуммаОплаты <span class='c1c-c1cSymb def-Symbol'>+</span> ДокСумма<span class='c1c-c1cSymb def-Symbol'>;</span>
 60: 
 61:         <span class='c1c-c1cComment def-Comment def-Syntax'>// проводка по оплате</span>
 62:         СуммаПоОтгрЦене <span class='c1c-c1cSymb def-Symbol'>=</span> СчФ<span class='def-Number'>.</span>Наименование<span class='def-Number'>.</span>Прих_Цена<span class='def-Number'>.</span>Получить<span class='def-Symbol'>(</span> ДокОсн<span class='def-Number'>.</span>ДатаДок <span class='def-Symbol'>)</span> <span class='c1c-c1cSymb def-Symbol'>*</span> ДокКолич<span class='c1c-c1cSymb def-Symbol'>;</span>
 63:         Сч46 <span class='c1c-c1cSymb def-Symbol'>=</span> СчетРеализацииПоНаименованию<span class='def-Symbol'>(</span> СчФ<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span> СчФ <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 64:         Проводка<span class='def-Symbol'>(</span> Операция<span class='c1c-c1cSymb def-Symbol'>,</span> Сч46<span class='def-Number'>.</span>Код<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"45.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span> СуммаПоОтгрЦене<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cSymb def-Symbol'>,</span> Клиент<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span> КомСчФОтгрузки<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 65:         Сч76 <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cSymb def-Symbol'>?</span><span class='def-Symbol'>(</span> СчФ<span class='def-Number'>.</span>НДС <span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='c1c-c1cSymb def-Symbol'>></span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"76.12"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"76.11"</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 66:         Проводка<span class='def-Symbol'>(</span> Операция<span class='c1c-c1cSymb def-Symbol'>,</span> Сч76<span class='c1c-c1cSymb def-Symbol'>,</span> Сч46<span class='def-Number'>.</span>Код<span class='c1c-c1cSymb def-Symbol'>,</span> ДокСумма<span class='c1c-c1cSymb def-Symbol'>,</span> Клиент<span class='c1c-c1cSymb def-Symbol'>,</span> Клиент<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span> КомСчФОтгрузки<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 67:         <span class='c1c-c1cWord def-Keyword'>Если</span> СчФ<span class='def-Number'>.</span>НДС <span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='c1c-c1cSymb def-Symbol'>></span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
 68:             Проводка<span class='def-Symbol'>(</span> Операция<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"76.12"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"68.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span> ДокНДС<span class='c1c-c1cSymb def-Symbol'>,</span> Клиент<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>ПлатежиВФонды<span class='def-Number'>.</span>Взносы<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"НДС "</span><span class='c1c-c1cSymb def-Symbol'>+</span>КомСчФОтгрузки<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 69:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 70: 
 71:     <span class='c1c-c1cWord def-Keyword'>КонецЦикла</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 72:     <span class='c1c-c1cWord def-Keyword'>Возврат</span> ОбщаяСуммаОплаты<span class='c1c-c1cSymb def-Symbol'>;</span>
 73: <span class='c1c-c1cWord def-Keyword'>КонецФункции</span>
 74: 
 75: <span class='c1c-c1cWord def-Keyword'>Процедура</span> НДСкВозмещению<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span>
 76:     <span class='c1c-c1cWord def-Keyword'>Перем</span> хДок<span class='c1c-c1cSymb def-Symbol'>;</span>
 77:     <span class='c1c-c1cComment def-Comment def-Syntax'>//Попробуем найти оплату через банк;</span>
 78:     Платежка<span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 79:     СчСчф<span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span>                    <span class='c1c-c1cComment def-Comment def-Syntax'>//Счет или счет-фактура;</span>
 80:     хДок<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cWord2 def-Keyword'>СоздатьОбъект</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Документ.Платежка"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 81:     хДок<span class='def-Number'>.</span>ОбратныйПорядок<span class='def-Symbol'>(</span><span class='def-Number'>1</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 82:     хДок<span class='def-Number'>.</span>ВыбратьДокументы<span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"01.01.98"</span><span class='c1c-c1cSymb def-Symbol'>,</span>ДатаДок<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 83:     <span class='c1c-c1cComment def-Comment def-Syntax'>//Выбираем документы начиная с текущей даты назад</span>
 84:     <span class='c1c-c1cWord def-Keyword'>Пока</span> хДок<span class='def-Number'>.</span>ПолучитьДокумент<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Цикл</span>
 85:         <span class='c1c-c1cWord def-Keyword'>Если</span> хДок<span class='def-Number'>.</span>ТекущийДокумент<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span>.Проведен<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>  <span class='c1c-c1cComment def-Comment def-Syntax'>//?</span>
 86:             <span class='c1c-c1cWord def-Keyword'>Продолжить</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 87:             <span class='c1c-c1cComment def-Comment def-Syntax'>//** Возврат;</span>
 88:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 89:         <span class='c1c-c1cWord def-Keyword'>Если</span> <span class='def-Symbol'>(</span>хДок<span class='def-Number'>.</span>Действие<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"Расчет с поставщиком"</span><span class='def-Symbol'>)</span> И
 90:         <span class='def-Symbol'>(</span>хДок<span class='def-Number'>.</span>Клиент<span class='c1c-c1cSymb def-Symbol'>=</span>Клиент<span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
 91:             хДок<span class='def-Number'>.</span>ВыбратьСтроки<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 92:             <span class='c1c-c1cWord def-Keyword'>Пока</span> хДок<span class='def-Number'>.</span>ПолучитьСтроку<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Цикл</span>
 93:                 <span class='c1c-c1cWord def-Keyword'>Если</span> хДок<span class='def-Number'>.</span>Счф<span class='def-Number'>.</span>Сумма<span class='c1c-c1cSymb def-Symbol'>=</span>Итог<span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Сумма"</span><span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
 94:                     СчСчф<span class='c1c-c1cSymb def-Symbol'>=</span>хДок<span class='def-Number'>.</span>СчФ<span class='c1c-c1cSymb def-Symbol'>;</span>
 95:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 96:             <span class='c1c-c1cWord def-Keyword'>КонецЦикла</span><span class='c1c-c1cSymb def-Symbol'>;</span>
 97:             <span class='c1c-c1cWord def-Keyword'>Если</span> СчСчФ<span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
 98:                 <span class='c1c-c1cWord def-Keyword'>Если</span> хДок<span class='def-Number'>.</span>ПоСчФ<span class='def-Number'>.</span>Выбран<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
 99:                     <span class='c1c-c1cWord def-Keyword'>Если</span> хДок<span class='def-Number'>.</span>ПоСчФ<span class='def-Number'>.</span>Сумма<span class='c1c-c1cSymb def-Symbol'>=</span>Итог<span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Сумма"</span><span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
100:                         СчСчф<span class='c1c-c1cSymb def-Symbol'>=</span>хДок<span class='def-Number'>.</span>ПоСчФ<span class='c1c-c1cSymb def-Symbol'>;</span>
101:                     <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
102:                 <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> хДок<span class='def-Number'>.</span>ПоСчету<span class='def-Number'>.</span>Выбран<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
103:                     <span class='c1c-c1cWord def-Keyword'>Если</span> хДок<span class='def-Number'>.</span>ПоСчету<span class='def-Number'>.</span>Сумма<span class='c1c-c1cSymb def-Symbol'>=</span>Итог<span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Сумма"</span><span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
104:                         СчСчф<span class='c1c-c1cSymb def-Symbol'>=</span>хДок<span class='def-Number'>.</span>ПоСчету<span class='c1c-c1cSymb def-Symbol'>;</span>
105:                     <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
106:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
107:             <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
108:             <span class='c1c-c1cWord def-Keyword'>Если</span> СчСчф<span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='c1c-c1cSymb def-Symbol'>></span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
109:                 Платежка<span class='c1c-c1cSymb def-Symbol'>=</span>хДок<span class='def-Number'>.</span>ТекущийДокумент<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
110:                 Оп<span class='c1c-c1cSymb def-Symbol'>=</span>Платежка<span class='def-Number'>.</span>Операция<span class='c1c-c1cSymb def-Symbol'>;</span>
111:                 Оп<span class='def-Number'>.</span>ВыбратьПроводки<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>  <span class='c1c-c1cComment def-Comment def-Syntax'>//Обращение к проводкам платежки</span>
112:                 <span class='c1c-c1cWord def-Keyword'>Пока</span> Оп<span class='def-Number'>.</span>ПолучитьПроводку<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Цикл</span>
113:                     <span class='c1c-c1cWord def-Keyword'>Если</span> Оп<span class='def-Number'>.</span>Дебет<span class='def-Number'>.</span>Счет<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cWord2 def-Keyword'>СчетПоКоду</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"68.2"</span><span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
114:                         <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>    <span class='c1c-c1cComment def-Comment def-Syntax'>// Если в платежке уже есть проводки по возмещению,</span>
115:                     <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>          <span class='c1c-c1cComment def-Comment def-Syntax'>// Дт68-Кт19, тогда делаем выход из процедуры</span>
116:                 <span class='c1c-c1cWord def-Keyword'>КонецЦикла</span><span class='c1c-c1cSymb def-Symbol'>;</span>
117:                 <span class='c1c-c1cWord def-Keyword'>Прервать</span><span class='c1c-c1cSymb def-Symbol'>;</span>
118:             <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
119:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
120:     <span class='c1c-c1cWord def-Keyword'>КонецЦикла</span><span class='c1c-c1cSymb def-Symbol'>;</span>
121:     <span class='c1c-c1cWord def-Keyword'>Если</span> Платежка<span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
122:         <span class='c1c-c1cComment def-Comment def-Syntax'>//              Сообщить("Не найдена платежка, сделанная по счету или по счет-фактуре на ту же сумму, что и накладная "</span>
123:         <span class='c1c-c1cComment def-Comment def-Syntax'>//              +РазделительСтрок+"Проводки по возмещению НДС не сделаны.");</span>
124:         <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
125:     <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
126: 
127:     НДС19_1 <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span> НДС19_2 <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span> НДС19_3 <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span> НДС19_4 <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span>
128:     НДС19_5 <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span> НДС19_6 <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span> НДС19_7 <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span>
129:     <span class='c1c-c1cComment def-Comment def-Syntax'>//Найдем суммы НДС, выделенные на 19 счет по накладной</span>
130: 
131:     ВыбратьСтроки<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
132:     <span class='c1c-c1cWord def-Keyword'>Пока</span> ПолучитьСтроку<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Цикл</span>
133:         <span class='c1c-c1cWord def-Keyword'>Если</span> <span class='def-Symbol'>(</span>Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"ОС"</span><span class='def-Symbol'>)</span>  <span class='c1c-c1cWord def-Keyword'>Тогда</span>
134:             <span class='c1c-c1cWord def-Keyword'>Если</span> <span class='c1c-c1cVar def-VarStrong def-Var'>Константа</span><span class='def-Number'>.</span>ЛьготаПоНДС<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>Булево<span class='def-Number'>.</span>Да   <span class='c1c-c1cWord def-Keyword'>Тогда</span>
135:                 НДС19_1 <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span>     <span class='c1c-c1cComment def-Comment def-Syntax'>//</span>
136:             <span class='c1c-c1cWord def-Keyword'>Иначе</span>
137:                 НДС19_1 <span class='c1c-c1cSymb def-Symbol'>=</span> НДС19_1 <span class='c1c-c1cSymb def-Symbol'>+</span> НДС<span class='c1c-c1cSymb def-Symbol'>;</span>
138:             <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
139:         <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> <span class='def-Symbol'>(</span>Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"Комплектация"</span><span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
140:             НДС19_1 <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span>         <span class='c1c-c1cComment def-Comment def-Syntax'>//Здесь возмещение не должно быть</span>
141:         <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"НМА"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
142:             НДС19_2 <span class='c1c-c1cSymb def-Symbol'>=</span> НДС19_2 <span class='c1c-c1cSymb def-Symbol'>+</span> НДС<span class='c1c-c1cSymb def-Symbol'>;</span>
143:         <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> <span class='def-Symbol'>(</span>Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"Материалы"</span><span class='def-Symbol'>)</span> ИЛИ <span class='def-Symbol'>(</span>Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"Полуфабрикат"</span><span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
144:             НДС19_3 <span class='c1c-c1cSymb def-Symbol'>=</span> НДС19_3 <span class='c1c-c1cSymb def-Symbol'>+</span> НДС<span class='c1c-c1cSymb def-Symbol'>;</span>
145:         <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"МБП"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
146:             НДС19_4 <span class='c1c-c1cSymb def-Symbol'>=</span> НДС19_4 <span class='c1c-c1cSymb def-Symbol'>+</span> НДС<span class='c1c-c1cSymb def-Symbol'>;</span>
147:         <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"УслугиПолуч"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
148:             НДС19_5 <span class='c1c-c1cSymb def-Symbol'>=</span> НДС19_5 <span class='c1c-c1cSymb def-Symbol'>+</span> НДС<span class='c1c-c1cSymb def-Symbol'>;</span>
149:         <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"Товары"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
150:             НДС19_6 <span class='c1c-c1cSymb def-Symbol'>=</span> НДС19_6 <span class='c1c-c1cSymb def-Symbol'>+</span> НДС<span class='c1c-c1cSymb def-Symbol'>;</span>
151:         <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"РасходыБудущПериода"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
152:             НДС19_7 <span class='c1c-c1cSymb def-Symbol'>=</span> НДС19_7 <span class='c1c-c1cSymb def-Symbol'>+</span> НДС<span class='c1c-c1cSymb def-Symbol'>;</span>
153:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
154:     <span class='c1c-c1cWord def-Keyword'>КонецЦикла</span><span class='c1c-c1cSymb def-Symbol'>;</span>
155:     <span class='c1c-c1cComment def-Comment def-Syntax'>//Найдем суммы НДС, подлежащие возмещению ( оплаченный НДС )</span>
156:     <span class='c1c-c1cWord def-Keyword'>Если</span> Платежка<span class='def-Number'>.</span>Сумма<span class='c1c-c1cSymb def-Symbol'>/</span>Итог<span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Сумма"</span><span class='def-Symbol'>)</span> <span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
157:         К <span class='c1c-c1cSymb def-Symbol'>=</span> Платежка<span class='def-Number'>.</span>Сумма<span class='c1c-c1cSymb def-Symbol'>/</span>Итог<span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Сумма"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>    <span class='c1c-c1cComment def-Comment def-Syntax'>//Коэффициент "оплаты", если накл. вся оплачена К=1.</span>
158:     <span class='c1c-c1cWord def-Keyword'>Иначе</span>
159:         К <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>1</span><span class='c1c-c1cSymb def-Symbol'>;</span>
160:     <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
161: 
162:     <span class='c1c-c1cComment def-Comment def-Syntax'>//Проводки по возмещению НДС</span>
163:     <span class='c1c-c1cWord def-Keyword'>Если</span> НДС19_1<span class='c1c-c1cSymb def-Symbol'>></span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
164:         Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"68.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"19.1"</span><span class='c1c-c1cSymb def-Symbol'>,</span>НДС19_1<span class='c1c-c1cSymb def-Symbol'>*</span>К<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>ПлатежиВФонды<span class='def-Number'>.</span>Взносы<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"Возмещ.НДС"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
165:     <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
166:     <span class='c1c-c1cWord def-Keyword'>Если</span> НДС19_2<span class='c1c-c1cSymb def-Symbol'>></span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
167:         Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"68.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"19.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span>НДС19_2<span class='c1c-c1cSymb def-Symbol'>*</span>К<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>ПлатежиВФонды<span class='def-Number'>.</span>Взносы<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"Возмещ.НДС"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
168:     <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
169:     <span class='c1c-c1cWord def-Keyword'>Если</span> НДС19_3<span class='c1c-c1cSymb def-Symbol'>></span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
170:         Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"68.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"19.3"</span><span class='c1c-c1cSymb def-Symbol'>,</span>НДС19_3<span class='c1c-c1cSymb def-Symbol'>*</span>К<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>ПлатежиВФонды<span class='def-Number'>.</span>Взносы<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"Возмещ.НДС"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
171:     <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
172:     <span class='c1c-c1cWord def-Keyword'>Если</span> НДС19_4<span class='c1c-c1cSymb def-Symbol'>></span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
173:         Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"68.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"19.4"</span><span class='c1c-c1cSymb def-Symbol'>,</span>НДС19_4<span class='c1c-c1cSymb def-Symbol'>*</span>К<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>ПлатежиВФонды<span class='def-Number'>.</span>Взносы<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"Возмещ.НДС"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
174:     <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
175:     <span class='c1c-c1cWord def-Keyword'>Если</span> НДС19_5<span class='c1c-c1cSymb def-Symbol'>></span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
176:         Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"68.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"19.5"</span><span class='c1c-c1cSymb def-Symbol'>,</span>НДС19_5<span class='c1c-c1cSymb def-Symbol'>*</span>К<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>ПлатежиВФонды<span class='def-Number'>.</span>Взносы<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"Возмещ.НДС"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
177:     <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
178:     <span class='c1c-c1cWord def-Keyword'>Если</span> НДС19_6<span class='c1c-c1cSymb def-Symbol'>></span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
179:         Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"68.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"19.6"</span><span class='c1c-c1cSymb def-Symbol'>,</span>НДС19_6<span class='c1c-c1cSymb def-Symbol'>*</span>К<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>ПлатежиВФонды<span class='def-Number'>.</span>Взносы<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"Возмещ.НДС"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
180:     <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
181:     <span class='c1c-c1cWord def-Keyword'>Если</span> НДС19_7<span class='c1c-c1cSymb def-Symbol'>></span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
182:         Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"68.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"19.7"</span><span class='c1c-c1cSymb def-Symbol'>,</span>НДС19_7<span class='c1c-c1cSymb def-Symbol'>*</span>К<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>ПлатежиВФонды<span class='def-Number'>.</span>Взносы<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"Возмещ.НДС"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
183:     <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
184: <span class='c1c-c1cWord def-Keyword'>КонецПроцедуры</span> <span class='c1c-c1cComment def-Comment def-Syntax'>// НДСкВозмещению()</span>
185: 
186: <span class='c1c-c1cComment def-Comment def-Syntax'>// ************************* THE MAIN PART **********************************</span>
187: 
188: <span class='c1c-c1cWord def-Keyword'>Процедура</span> ОбработкаПроведения<span class='def-Symbol'>(</span> Зн <span class='def-Symbol'>)</span>
189: 
190:     <span class='c1c-c1cWord def-Keyword'>Перем</span> СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span> СубСч10<span class='c1c-c1cSymb def-Symbol'>,</span> БИ<span class='c1c-c1cSymb def-Symbol'>,</span> Спр<span class='c1c-c1cSymb def-Symbol'>,</span> Инд<span class='c1c-c1cSymb def-Symbol'>;</span>
191:     <span class='c1c-c1cWord def-Keyword'>Перем</span> УсреднятьЦену<span class='c1c-c1cSymb def-Symbol'>,</span> СпсЦен<span class='c1c-c1cSymb def-Symbol'>,</span> хЭлемент<span class='c1c-c1cSymb def-Symbol'>,</span> СрЦена<span class='c1c-c1cSymb def-Symbol'>,</span> СуммаПроводки<span class='c1c-c1cSymb def-Symbol'>;</span>
192: 
193:     <span class='c1c-c1cWord def-Keyword'>Если</span> ПроведеноРуками<span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>тогда</span>
194:         ТаблицаДляВыбора <span class='c1c-c1cSymb def-Symbol'>=</span> ПредоплатаПоставщику<span class='def-Symbol'>(</span>Контекст<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
195:     <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
196: 
197:     <span class='c1c-c1cWord2 def-Keyword'>Состояние</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Очистка движений..."</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
198:     ОчиститьДвижения<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
199: 
200:     <span class='c1c-c1cWord def-Keyword'>Если</span> <span class='def-Symbol'>(</span>Действие<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"Закупка"</span><span class='def-Symbol'>)</span>
201:          ИЛИ <span class='def-Symbol'>(</span>Действие<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"В уставной фонд"</span><span class='def-Symbol'>)</span>
202:          ИЛИ <span class='def-Symbol'>(</span>Действие<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"Импорт"</span><span class='def-Symbol'>)</span>
203:     <span class='c1c-c1cWord def-Keyword'>Тогда</span>
204:         ПапкаФизЛица<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cWord2 def-Keyword'>СоздатьОбъект</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Справочник.Клиенты"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
205:         <span class='c1c-c1cWord def-Keyword'>Если</span> ПапкаФизЛица<span class='def-Number'>.</span>НайтиПоНаименованию<span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Физические лица"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>тогда</span>
206:             <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Не найдена группа &lt;Физические лица> !!!"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
207:             <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span><span class='def-Number'>0</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span><span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
208:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
209: 
210:         Спр <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cWord2 def-Keyword'>СоздатьОбъект</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Справочник.Клиенты"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
211:         Спр<span class='def-Number'>.</span>НайтиПоКоду<span class='def-Symbol'>(</span>Клиент<span class='def-Number'>.</span>ПолныйКод<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
212:         БИ <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cWord2 def-Keyword'>СоздатьОбъект</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"БухгалтерскиеИтоги"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
213:         БИ<span class='def-Number'>.</span>ИспользоватьПланСчетов<span class='def-Symbol'>(</span><span class='c1c-c1cWord2 def-Keyword'>ВыбранныйПланСчетов</span><span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
214:         БИ<span class='def-Number'>.</span>ИспользоватьСубконто<span class='def-Symbol'>(</span>ВидыСубконто<span class='def-Number'>.</span>Контрагенты<span class='c1c-c1cSymb def-Symbol'>,</span>Спр<span class='def-Number'>.</span>ТекущийЭлемент<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
215:         <span class='c1c-c1cWord2 def-Keyword'>Состояние</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Рассчет итогов"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
216:         БИ<span class='def-Number'>.</span>Рассчитать<span class='def-Symbol'>(</span> <span class='c1c-c1cWord2 def-Keyword'>НачМесяца</span><span class='def-Symbol'>(</span>ДатаДок<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>,</span> ДатаДок<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"61"</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
217:         БИ<span class='def-Number'>.</span>ВыполнитьЗапрос<span class='def-Symbol'>(</span> <span class='c1c-c1cWord2 def-Keyword'>НачМесяца</span><span class='def-Symbol'>(</span>ДатаДок<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>,</span> ДатаДок<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"61"</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
218:         СК61 <span class='c1c-c1cSymb def-Symbol'>=</span> БИ<span class='def-Number'>.</span>СКД<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
219:         <span class='c1c-c1cWord def-Keyword'>Если</span> СК61<span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='c1c-c1cSymb def-Symbol'>></span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>   <span class='c1c-c1cComment def-Comment def-Syntax'>// закрываем выданные авансы</span>
220:             <span class='c1c-c1cWord def-Keyword'>Если</span> СК61<span class='c1c-c1cSymb def-Symbol'>&lt;</span>Итог<span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Сумма"</span><span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
221:                 Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"60.1"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"61"</span><span class='c1c-c1cSymb def-Symbol'>,</span>СК61<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"Погашение аванса"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
222:             <span class='c1c-c1cWord def-Keyword'>Иначе</span>
223:                 Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"60.1"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"61"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Итог<span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Сумма"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"Погашение аванса"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
224:             <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
225:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
226:         <span class='c1c-c1cWord def-Keyword'>Если</span> <span class='def-Symbol'>(</span>Действие<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"Закупка"</span><span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
227:             СчетКт <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cString def-String'>"60.1"</span><span class='c1c-c1cSymb def-Symbol'>;</span>
228:             <span class='c1c-c1cComment def-Comment def-Syntax'>//** 24.08.00 Суммовая разница</span>
229:             <span class='c1c-c1cWord def-Keyword'>Если</span> Валюта<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='c1c-c1cSymb def-Symbol'>></span><span class='c1c-c1cString def-String'>"Рубль"</span> <span class='c1c-c1cWord def-Keyword'>тогда</span>
230:                 ПУ<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cWord2 def-Keyword'>СоздатьОбъект</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Справочник.ПрибылиУбытки"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
231:                 <span class='c1c-c1cWord def-Keyword'>Если</span> ПУ<span class='def-Number'>.</span>НайтиПоНаименованию<span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"СуммоваяРазница"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>тогда</span>
232:                     <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Субконто "</span><span class='c1c-c1cString def-String'>"СуммоваяРазница"</span><span class='c1c-c1cString def-String'>" не обнаружено!!!"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
233:                     <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span><span class='def-Number'>0</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span><span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
234:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
235:                 Тбл<span class='c1c-c1cSymb def-Symbol'>=</span>ТаблицаДляВыбора<span class='c1c-c1cSymb def-Symbol'>;</span>
236:                 Тбл<span class='def-Number'>.</span>ВыбратьСтроки<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
237:                 <span class='c1c-c1cWord def-Keyword'>Пока</span> Тбл<span class='def-Number'>.</span>ПолучитьСтроку<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>цикл</span>
238:                     <span class='c1c-c1cWord def-Keyword'>Если</span> Тбл<span class='def-Number'>.</span>Метка<span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>тогда</span>
239:                         <span class='c1c-c1cWord def-Keyword'>Если</span> Валюта<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>=</span>Тбл<span class='def-Number'>.</span>Документ<span class='def-Number'>.</span>Валюта<span class='def-Number'>.</span>Наименование <span class='c1c-c1cWord def-Keyword'>тогда</span>
240:                             КК<span class='c1c-c1cSymb def-Symbol'>=</span>Валюта<span class='def-Number'>.</span>Текущ_курс<span class='def-Number'>.</span>Получить<span class='def-Symbol'>(</span>ДатаНакладной<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>/</span>Валюта<span class='def-Number'>.</span>Текущ_курс<span class='def-Number'>.</span>Получить<span class='def-Symbol'>(</span>Тбл<span class='def-Number'>.</span>Документ<span class='def-Number'>.</span>ДатаДок<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
241:                             КРазница<span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Symbol'>(</span>КК<span class='c1c-c1cSymb def-Symbol'>-</span><span class='def-Number'>1</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>*</span>Тбл<span class='def-Number'>.</span>Сумма<span class='c1c-c1cSymb def-Symbol'>;</span>
242:                             <span class='c1c-c1cWord def-Keyword'>Если</span> кк<span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>тогда</span>
243:                                 <span class='c1c-c1cComment def-Comment def-Syntax'>//Проводка(Операция,Дт=0,Кт=0,Сумма,СубкДт1=0,СубкКт1=0,Журнал="",Коментарий="",Количество=0,СубкДт2=0,СубкКт2=0,Пл=0) Экспорт</span>
244:                                 Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"60.1"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"80"</span><span class='c1c-c1cSymb def-Symbol'>,</span>КРазница<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span>ПУ<span class='def-Number'>.</span>ТекущийЭлемент<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
245:                             <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> кк<span class='c1c-c1cSymb def-Symbol'>></span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>тогда</span>
246:                                 Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"80"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"60.1"</span><span class='c1c-c1cSymb def-Symbol'>,</span>КРазница<span class='c1c-c1cSymb def-Symbol'>,</span>ПУ<span class='def-Number'>.</span>ТекущийЭлемент<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
247:                             <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
248:                         <span class='c1c-c1cWord def-Keyword'>Иначе</span>
249:                             <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Несовпадение валют!!!"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
250:                             <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span><span class='def-Number'>0</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span><span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
251:                         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
252:                     <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
253:                 <span class='c1c-c1cWord def-Keyword'>КонецЦикла</span><span class='c1c-c1cSymb def-Symbol'>;</span>
254:             <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
255:             <span class='c1c-c1cComment def-Comment def-Syntax'>//**>></span>
256: 
257:         <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> <span class='def-Symbol'>(</span>Действие<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"В уставной фонд"</span><span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
258:             СчетКт <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cString def-String'>"75.1"</span><span class='c1c-c1cSymb def-Symbol'>;</span>
259:         <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> <span class='def-Symbol'>(</span>Действие<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"Импорт"</span><span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
260:             СчетКт <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cString def-String'>"60.2"</span><span class='c1c-c1cSymb def-Symbol'>;</span>
261:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
262:         СубкКт<span class='c1c-c1cSymb def-Symbol'>=</span>Клиент<span class='c1c-c1cSymb def-Symbol'>;</span>
263:         УсреднятьЦену<span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span>
264:         <span class='c1c-c1cComment def-Comment def-Syntax'>//** Двинем регистрами по Поставщикам</span>
265:         <span class='c1c-c1cComment def-Comment def-Syntax'>//Сообщить("Ну не я это,");</span>
266:         Сум<span class='c1c-c1cSymb def-Symbol'>=</span>Итог<span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Сумма"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
267:         Сумм<span class='c1c-c1cSymb def-Symbol'>=</span>Сум<span class='c1c-c1cSymb def-Symbol'>;</span>
268:         <span class='c1c-c1cComment def-Comment def-Syntax'>//** 61-(51)</span>
269:         Пред<span class='c1c-c1cSymb def-Symbol'>=</span>РасходПредоплатыПоставщику<span class='def-Symbol'>(</span>Контекст<span class='c1c-c1cSymb def-Symbol'>,</span>Сум<span class='c1c-c1cSymb def-Symbol'>,</span>Регистр<span class='def-Number'>.</span>ПредоплатаПоставщикам<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
270:         <span class='c1c-c1cComment def-Comment def-Syntax'>//** Теперь сум = тому что осталось от долга ПОСЛЕ предоплаты</span>
271:         <span class='c1c-c1cWord def-Keyword'>Если</span> пред<span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='c1c-c1cSymb def-Symbol'>></span><span class='c1c-c1cSymb def-Symbol'>-</span><span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>тогда</span>
272:             <span class='c1c-c1cComment def-Comment def-Syntax'>//** (10)-60</span>
273:             ДвинутьДолгПоставщику<span class='def-Symbol'>(</span>Контекст<span class='c1c-c1cSymb def-Symbol'>,</span>ТекущийДокумент<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>,</span>Сумм<span class='c1c-c1cSymb def-Symbol'>,</span>Регистр<span class='def-Number'>.</span>РассчетыСПоставщиками<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
274:             <span class='c1c-c1cComment def-Comment def-Syntax'>//** 60-61</span>
275:             ДвинутьДолгПоставщику<span class='def-Symbol'>(</span>Контекст<span class='c1c-c1cSymb def-Symbol'>,</span>ТекущийДокумент<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>,</span>Сумм<span class='c1c-c1cSymb def-Symbol'>-</span>Сум<span class='c1c-c1cSymb def-Symbol'>,</span>Регистр<span class='def-Number'>.</span>РассчетыСПоставщиками<span class='c1c-c1cSymb def-Symbol'>,</span>Пред<span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Number'>0</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span><span class='c1c-c1cComment def-Comment def-Syntax'>//Расход</span>
276:         <span class='c1c-c1cWord def-Keyword'>Иначе</span>
277:             <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span><span class='def-Number'>0</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
278:             <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
279:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
280: 
281:         ВыбратьСтроки<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
282:         <span class='c1c-c1cWord def-Keyword'>Пока</span> ПолучитьСтроку<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Цикл</span>
283:             <span class='c1c-c1cWord def-Keyword'>Если</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"УслугиПолуч"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
284:                 <span class='c1c-c1cComment def-Comment def-Syntax'>//** 10.09.00   Авторские</span>
285:                 СчетКт1<span class='c1c-c1cSymb def-Symbol'>=</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>;</span>
286:                 <span class='c1c-c1cComment def-Comment def-Syntax'>//                Если Клиент.ПринадлежитГруппе(ПапкаФизЛица)=1 тогда</span>
287:                 <span class='c1c-c1cComment def-Comment def-Syntax'>//                  СчетКт="73.5";</span>
288:                 <span class='c1c-c1cComment def-Comment def-Syntax'>//                КонецЕсли;</span>
289:                 <span class='c1c-c1cComment def-Comment def-Syntax'>//**>></span>
290:                 <span class='c1c-c1cWord def-Keyword'>Если</span> ПроводкиПоСписанию<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span>Контекст<span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>(</span>Сумма<span class='c1c-c1cSymb def-Symbol'>-</span>НДС<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>,</span>СубкКт<span class='def-Symbol'>)</span> <span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='c1c-c1cSymb def-Symbol'>></span> <span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
291:                     <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span> <span class='def-Number'>0</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
292:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
293:                 <span class='c1c-c1cWord def-Keyword'>Если</span> НДС<span class='c1c-c1cSymb def-Symbol'>></span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
294:                     Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"19.5"</span><span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span>НДС<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span>СубкКт<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"Начисление НДС"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
295:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
296:                 СчетКт<span class='c1c-c1cSymb def-Symbol'>=</span>СчетКт1<span class='c1c-c1cSymb def-Symbol'>;</span>
297:             <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"Материалы"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
298:                 УсреднятьЦену<span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>1</span><span class='c1c-c1cSymb def-Symbol'>;</span>
299:                 СубСч10 <span class='c1c-c1cSymb def-Symbol'>=</span> глСубСчет10<span class='def-Symbol'>(</span> Наименование <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
300:                 Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span>СубСч10<span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>-</span>НДС<span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span>Количество<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
301:                 <span class='c1c-c1cWord def-Keyword'>Если</span> НДС<span class='c1c-c1cSymb def-Symbol'>></span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
302:                     Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"19.3"</span><span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span>НДС<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
303:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
304:                 <span class='c1c-c1cComment def-Comment def-Syntax'>//Условие оприходования МБП</span>
305:             <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"МБП"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
306:                 УсреднятьЦену<span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>1</span><span class='c1c-c1cSymb def-Symbol'>;</span>
307:                 <span class='c1c-c1cWord def-Keyword'>Если</span> Склад<span class='def-Number'>.</span>Вид<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>ВидСклада<span class='def-Number'>.</span>Основной <span class='c1c-c1cWord def-Keyword'>Тогда</span>
308:                     Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"12.1"</span><span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>-</span>НДС<span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span>Количество<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
309:                 <span class='c1c-c1cWord def-Keyword'>Иначе</span>
310:                     Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"12.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>-</span>НДС<span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span>Количество<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
311:                     <span class='c1c-c1cWord def-Keyword'>Если</span> <span class='def-Symbol'>(</span><span class='def-Symbol'>(</span>Сумма<span class='c1c-c1cSymb def-Symbol'>-</span>НДС<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>/</span>Количество<span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cWord2 def-Keyword'>Число</span><span class='def-Symbol'>(</span><span class='c1c-c1cVar def-VarStrong def-Var'>Константа</span><span class='def-Number'>.</span>МинимальнаяЗарплата<span class='def-Number'>.</span>Получить<span class='def-Symbol'>(</span>ДатаДок<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>*</span><span class='def-Number'>100</span><span class='c1c-c1cSymb def-Symbol'>/</span><span class='def-Number'>20</span><span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
312:                         ОК <span class='c1c-c1cSymb def-Symbol'>=</span> ПроводкиПоСписанию<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span>Контекст<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"13"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>(</span>Сумма<span class='c1c-c1cSymb def-Symbol'>-</span>НДС<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
313:                     <span class='c1c-c1cWord def-Keyword'>Иначе</span>
314:                         ОК <span class='c1c-c1cSymb def-Symbol'>=</span> ПроводкиПоСписанию<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span>Контекст<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"13"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>(</span>Сумма<span class='c1c-c1cSymb def-Symbol'>-</span>НДС<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>/</span><span class='def-Number'>2</span><span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
315:                     <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
316:                     <span class='c1c-c1cWord def-Keyword'>Если</span> ОК <span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='c1c-c1cSymb def-Symbol'>></span> <span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
317:                         <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span> <span class='def-Number'>0</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
318:                     <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span>
319:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
320:                 <span class='c1c-c1cWord def-Keyword'>Если</span> НДС<span class='c1c-c1cSymb def-Symbol'>></span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
321:                     Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"19.4"</span><span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span>НДС<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
322:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>      <span class='c1c-c1cComment def-Comment def-Syntax'>//Конец условия оприходования МБП</span>
323:                 <span class='c1c-c1cComment def-Comment def-Syntax'>//Условие оприходования НМА</span>
324:             <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> <span class='def-Symbol'>(</span>Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"Товары"</span><span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
325:                 УсреднятьЦену<span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>1</span><span class='c1c-c1cSymb def-Symbol'>;</span>
326:                 <span class='c1c-c1cWord def-Keyword'>Если</span> Склад<span class='def-Number'>.</span>Вид<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>ВидСклада<span class='def-Number'>.</span>Основной <span class='c1c-c1cWord def-Keyword'>Тогда</span>
327:                     Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"41.1"</span><span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>-</span>НДС<span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span>Количество<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
328:                     <span class='c1c-c1cWord def-Keyword'>Если</span> НДС<span class='c1c-c1cSymb def-Symbol'>></span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
329:                         Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"19.6"</span><span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span>НДС<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
330:                     <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
331:                 <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Склад<span class='def-Number'>.</span>Вид<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>ВидСклада<span class='def-Number'>.</span>Розничный <span class='c1c-c1cWord def-Keyword'>Тогда</span>
332:                     Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"41.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span>Количество<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
333:                 <span class='c1c-c1cWord def-Keyword'>Иначе</span>
334:                     <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Выберите для оприходования товара "</span><span class='c1c-c1cSymb def-Symbol'>+</span>Наименование<span class='def-Number'>.</span>Наименование
335:                     <span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" оптовый или розничный склад. Строка "</span><span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cVar def-VarStrong def-Var'>НомерСтроки</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
336: 
337:                     <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span> <span class='def-Number'>0</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
338:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
339:             <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"НМА"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
340:                 <span class='c1c-c1cComment def-Comment def-Syntax'>//Условие оприходования НМА     на забалансовый счет</span>
341:                 <span class='c1c-c1cWord def-Keyword'>Если</span> <span class='def-Symbol'>(</span>Наименование<span class='def-Number'>.</span>Родитель<span class='def-Number'>.</span>ПолныйКод<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"28"</span><span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
342:                     Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"006"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"010"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>-</span>НДС<span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span>Количество<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
343:                     <span class='c1c-c1cWord def-Keyword'>Если</span> ПроводкиПоСписанию<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span>Контекст<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"60.1"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>-</span>НДС<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span> <span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='c1c-c1cSymb def-Symbol'>></span> <span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
344:                         <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span> <span class='def-Number'>0</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
345:                     <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
346:                 <span class='c1c-c1cWord def-Keyword'>Иначе</span>
347:                     Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"04"</span><span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>-</span>НДС<span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span>Количество<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
348:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
349: 
350:                 <span class='c1c-c1cWord def-Keyword'>Если</span> НДС<span class='c1c-c1cSymb def-Symbol'>></span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
351:                     Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"19.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span>НДС<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
352:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>      <span class='c1c-c1cComment def-Comment def-Syntax'>//Конец условия оприходования НМА</span>
353:             <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"РасходыБудущПериода"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
354:                 Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"31"</span><span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>-</span>НДС<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
355:                 <span class='c1c-c1cWord def-Keyword'>Если</span> НДС<span class='c1c-c1cSymb def-Symbol'>></span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
356:                     Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"19.7"</span><span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span>НДС<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
357:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
358:             <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"Комплектация"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
359:                 Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"07.1"</span><span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>-</span>НДС<span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span>Количество<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
360:                 <span class='c1c-c1cWord def-Keyword'>Если</span> НДС<span class='c1c-c1cSymb def-Symbol'>></span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
361:                     Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"19.1"</span><span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span>НДС<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
362:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
363:             <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"ОС"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
364:                 <span class='c1c-c1cWord def-Keyword'>Если</span> Наименование<span class='def-Number'>.</span>Статус<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>СтатусОС<span class='def-Number'>.</span>Собственное <span class='c1c-c1cWord def-Keyword'>Тогда</span>
365:                     <span class='c1c-c1cWord def-Keyword'>Если</span> <span class='c1c-c1cVar def-VarStrong def-Var'>Константа</span><span class='def-Number'>.</span>ЛьготаПоНДС<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>Булево<span class='def-Number'>.</span>Да <span class='c1c-c1cWord def-Keyword'>Тогда</span>
366:                         Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"01.1"</span><span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span>Количество<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
367:                         <span class='c1c-c1cWord def-Keyword'>Если</span> Наименование<span class='def-Number'>.</span>НачИзнос<span class='c1c-c1cSymb def-Symbol'>></span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
368:                             Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"02.1"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='def-Number'>.</span>НачИзнос<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
369:                         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
370:                     <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> <span class='c1c-c1cVar def-VarStrong def-Var'>Константа</span><span class='def-Number'>.</span>ЛьготаПоНДС<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>Булево<span class='def-Number'>.</span>Нет <span class='c1c-c1cWord def-Keyword'>Тогда</span>
371:                         Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"01.1"</span><span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>-</span>НДС<span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span>Количество<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
372:                         <span class='c1c-c1cWord def-Keyword'>Если</span> Наименование<span class='def-Number'>.</span>НачИзнос<span class='c1c-c1cSymb def-Symbol'>></span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
373:                             Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"02.1"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='def-Number'>.</span>НачИзнос<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
374:                         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
375:                         <span class='c1c-c1cWord def-Keyword'>Если</span> НДС<span class='c1c-c1cSymb def-Symbol'>></span><span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
376:                             Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"19.1"</span><span class='c1c-c1cSymb def-Symbol'>,</span>СчетКт<span class='c1c-c1cSymb def-Symbol'>,</span>НДС<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
377:                         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
378:                     <span class='c1c-c1cWord def-Keyword'>Иначе</span>
379:                         <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Заполните константу ЛьготаПоНДС. Док № "</span><span class='c1c-c1cSymb def-Symbol'>+</span>НомерДок<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" от "</span><span class='c1c-c1cSymb def-Symbol'>+</span>ДатаДок<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
380:                         <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span> <span class='def-Number'>0</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
381:                     <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
382:                 <span class='c1c-c1cWord def-Keyword'>Иначе</span>
383:                     <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Вы не можете закупить ОС со статусом "</span><span class='c1c-c1cSymb def-Symbol'>+</span>Наименование<span class='def-Number'>.</span>Статус<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>". Выберите другое действие. Строка "</span><span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cVar def-VarStrong def-Var'>НомерСтроки</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
384:                     <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span> <span class='def-Number'>0</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
385:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
386:             <span class='c1c-c1cWord def-Keyword'>Иначе</span>
387:                 <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Для "</span><span class='c1c-c1cSymb def-Symbol'>+</span>Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" не разработаны проводки! Док № "</span><span class='c1c-c1cSymb def-Symbol'>+</span>НомерДок<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" от "</span><span class='c1c-c1cSymb def-Symbol'>+</span>ДатаДок<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
388:                 <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span> <span class='def-Number'>0</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
389:             <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
390:         <span class='c1c-c1cWord def-Keyword'>КонецЦикла</span><span class='c1c-c1cSymb def-Symbol'>;</span>
391:         <span class='c1c-c1cWord def-Keyword'>Если</span> УсреднятьЦену <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
392:             СпсЦен<span class='c1c-c1cSymb def-Symbol'>=</span>ЗаписатьЦену<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span>ТекущийДокумент<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
393:             <span class='c1c-c1cWord def-Keyword'>Для</span> Сч<span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>по</span> СпсЦен<span class='def-Number'>.</span>РазмерСписка<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Цикл</span>
394:                 хЭлемент<span class='c1c-c1cSymb def-Symbol'>=</span>СпсЦен<span class='def-Number'>.</span>ПолучитьЗначение<span class='def-Symbol'>(</span>Сч<span class='c1c-c1cSymb def-Symbol'>,</span>СрЦена<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
395:                 СрЦена<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cWord2 def-Keyword'>Число</span><span class='def-Symbol'>(</span>СрЦена<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
396:                 УстановитьРеквизитСправочника<span class='def-Symbol'>(</span>хЭлемент<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"Прих_Цена"</span><span class='c1c-c1cSymb def-Symbol'>,</span> СрЦена<span class='c1c-c1cSymb def-Symbol'>,</span> ДатаДок<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
397:             <span class='c1c-c1cWord def-Keyword'>КонецЦикла</span><span class='c1c-c1cSymb def-Symbol'>;</span>
398:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
399:         НДСкВозмещению<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
400:     <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Действие<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"Ответственное хранение"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
401:       ВыбратьСтроки<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
402:         <span class='c1c-c1cWord def-Keyword'>Пока</span> ПолучитьСтроку<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Цикл</span>
403:       <span class='c1c-c1cWord def-Keyword'>Если</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"МБП"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
404:                 Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"002"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"010"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"Ответ.хранение"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Количество<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
405:             <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"Материалы"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
406:                 Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"003"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"010"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"Ответ.хранение"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Количество<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cComment def-Comment def-Syntax'>//нужен ли Клиент в СубкДт2 ?</span>
407:             <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"Товары"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
408:                 Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"004"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"010"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"Ответ.хранение"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Количество<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cComment def-Comment def-Syntax'>//нужен ли Клиент в СубкДт2 ?</span>
409:             <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"ОС"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
410:                 Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"005"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"010"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"Ответ.хранение"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Количество<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cComment def-Comment def-Syntax'>//нужен ли Клиент в СубкДт2 ?</span>
411:             <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"НМА"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
412:                 Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"006"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"010"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"Ответ.хранение"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Количество<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cComment def-Comment def-Syntax'>//нужен ли Клиент в СубкДт2 ?</span>
413:             <span class='c1c-c1cWord def-Keyword'>Иначе</span>
414:                 <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Для действия "</span><span class='c1c-c1cString def-String'>"Ответственное хранение"</span><span class='c1c-c1cString def-String'>" "</span><span class='c1c-c1cSymb def-Symbol'>+</span>Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" не разработаны проводки! Строка "</span><span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cVar def-VarStrong def-Var'>НомерСтроки</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
415:                 <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span> <span class='def-Number'>0</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
416:             <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
417:         <span class='c1c-c1cWord def-Keyword'>КонецЦикла</span><span class='c1c-c1cSymb def-Symbol'>;</span>
418:     <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> <span class='def-Symbol'>(</span>Действие<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"На реализацию без права собственности"</span><span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
419:       ВыбратьСтроки<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
420:         <span class='c1c-c1cWord def-Keyword'>Пока</span> ПолучитьСтроку<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Цикл</span>
421:           <span class='c1c-c1cWord def-Keyword'>Если</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"Товары"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
422:             <span class='c1c-c1cWord def-Keyword'>Если</span> Наименование<span class='def-Number'>.</span>СтатусТовара<span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='c1c-c1cSymb def-Symbol'>></span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>СтатусТовара<span class='def-Number'>.</span>НаРеализации <span class='c1c-c1cWord def-Keyword'>Тогда</span>
423:               <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Статус товара должен быть "</span><span class='c1c-c1cString def-String'>"На реализации"</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cVar def-VarStrong def-Var'>РазделительСтрок</span>
424:                               <span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>"строка "</span><span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cWord2 def-Keyword'>строка</span><span class='def-Symbol'>(</span><span class='c1c-c1cVar def-VarStrong def-Var'>НомерСтроки</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
425:               <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span><span class='def-Number'>0</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span><span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
426:           <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
427:                     Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"004"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"010"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"На реализации"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Количество<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cComment def-Comment def-Syntax'>//нужен ли Клиент в СубкДт2 ?</span>
428:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
429:             <span class='c1c-c1cWord def-Keyword'>КонецЦикла</span><span class='c1c-c1cSymb def-Symbol'>;</span>
430:     <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> <span class='def-Symbol'>(</span>Действие<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"На комиссию"</span><span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
431:       ВыбратьСтроки<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
432:         <span class='c1c-c1cWord def-Keyword'>Пока</span> ПолучитьСтроку<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Цикл</span>
433:           <span class='c1c-c1cWord def-Keyword'>Если</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"Товары"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
434:             <span class='c1c-c1cWord def-Keyword'>Если</span> Наименование<span class='def-Number'>.</span>СтатусТовара<span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='c1c-c1cSymb def-Symbol'>></span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>СтатусТовара<span class='def-Number'>.</span>НаРеализации <span class='c1c-c1cWord def-Keyword'>Тогда</span>
435:               <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Статус товара должен быть "</span><span class='c1c-c1cString def-String'>"На реализации"</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cVar def-VarStrong def-Var'>РазделительСтрок</span>
436:                               <span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>"строка "</span><span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cWord2 def-Keyword'>строка</span><span class='def-Symbol'>(</span><span class='c1c-c1cVar def-VarStrong def-Var'>НомерСтроки</span><span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
437:               <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span><span class='def-Number'>0</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span><span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
438:           <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
439:                     Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"004"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"010"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"Поступил на комиссию"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Количество<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cComment def-Comment def-Syntax'>//нужен ли Клиент в СубкДт2 ?</span>
440:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
441:             <span class='c1c-c1cWord def-Keyword'>КонецЦикла</span><span class='c1c-c1cSymb def-Symbol'>;</span>
442:      <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Действие<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"В аренду"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
443:         ВыбратьСтроки<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
444:         <span class='c1c-c1cWord def-Keyword'>Пока</span> ПолучитьСтроку<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Цикл</span>
445:             <span class='c1c-c1cWord def-Keyword'>Если</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cString def-String'>"ОС"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
446:                 <span class='c1c-c1cWord def-Keyword'>Если</span> Наименование<span class='def-Number'>.</span>Статус<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>СтатусОС<span class='def-Number'>.</span>Собственное <span class='c1c-c1cWord def-Keyword'>Тогда</span>
447:                     <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Вы не можете взять в аренду собственное ОС. Выберите действие "</span><span class='c1c-c1cString def-String'>"Закупка"</span><span class='c1c-c1cString def-String'>". Строка "</span><span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cVar def-VarStrong def-Var'>НомерСтроки</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
448:                     <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span> <span class='def-Number'>0</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
449:                 <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> <span class='def-Symbol'>(</span> Наименование<span class='def-Number'>.</span>Статус<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>СтатусОС<span class='def-Number'>.</span>АрендаПлатнаяБезИзноса<span class='def-Symbol'>)</span> или
450:                 <span class='def-Symbol'>(</span> Наименование<span class='def-Number'>.</span>Статус<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>СтатусОС<span class='def-Number'>.</span>АрендаПлатнаяИзносом<span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
451:                     Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"001.1"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"010"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"В аренду"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Количество<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
452:                 <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Наименование<span class='def-Number'>.</span>Статус<span class='c1c-c1cSymb def-Symbol'>=</span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>СтатусОС<span class='def-Number'>.</span>АрендаБезвозмездная <span class='c1c-c1cWord def-Keyword'>Тогда</span>
453:                     Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"001.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"010"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Сумма<span class='c1c-c1cSymb def-Symbol'>,</span>Склад<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"В аренду"</span><span class='c1c-c1cSymb def-Symbol'>,</span>Количество<span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
454:                 <span class='c1c-c1cWord def-Keyword'>Иначе</span>
455:                     <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Для ОС со статусом "</span><span class='c1c-c1cSymb def-Symbol'>+</span>Наименование<span class='def-Number'>.</span>Статус<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" не разработаны проводки. Строка "</span><span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cVar def-VarStrong def-Var'>НомерСтроки</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
456:                     <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span> <span class='def-Number'>0</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
457:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
458:             <span class='c1c-c1cWord def-Keyword'>Иначе</span>
459:                 <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Для "</span><span class='c1c-c1cSymb def-Symbol'>+</span>Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" не разработаны проводки! Строка "</span><span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cVar def-VarStrong def-Var'>НомерСтроки</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
460:                 <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span> <span class='def-Number'>0</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
461:             <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
462:         <span class='c1c-c1cWord def-Keyword'>КонецЦикла</span><span class='c1c-c1cSymb def-Symbol'>;</span>
463: 
464:     <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Действие<span class='def-Number'>.</span>Наименование <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cString def-String'>"Возврат от покупателя"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
465: 
466:         <span class='c1c-c1cComment def-Comment def-Syntax'>// *******************************************************************</span>
467:         <span class='c1c-c1cComment def-Comment def-Syntax'>// ********* Возвожно самая сложная часть самого сложного ************</span>
468:         <span class='c1c-c1cComment def-Comment def-Syntax'>// ************ первичного документа нашей конфигурации **************</span>
469:         <span class='c1c-c1cComment def-Comment def-Syntax'>// *******************************************************************</span>
470: 
471:         <span class='c1c-c1cWord def-Keyword'>Если</span> ДокОсн<span class='def-Number'>.</span>Выбран<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
472:             <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Действие "</span><span class='c1c-c1cString def-String'>"Возврат от покупателя"</span><span class='c1c-c1cString def-String'>": Необходимо указать документ-основание"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"!"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
473:             <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span> <span class='def-Number'>0</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
474:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
475: 
476:         СчФакт <span class='c1c-c1cSymb def-Symbol'>=</span> СчетФактура<span class='def-Symbol'>(</span> ТекущийДокумент<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
477:         <span class='c1c-c1cWord def-Keyword'>Если</span> СчФакт <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
478:             <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span> <span class='c1c-c1cString def-String'>"Не найден связанный документ "</span><span class='c1c-c1cString def-String'>"Регистрация счета-фактуры"</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"!"</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
479:             <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span> <span class='def-Number'>0</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
480:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
481: 
482:         ДокРН <span class='c1c-c1cSymb def-Symbol'>=</span> ДокОсн<span class='c1c-c1cSymb def-Symbol'>;</span>
483:         СчФОтгрузки <span class='c1c-c1cSymb def-Symbol'>=</span> СчетФактура<span class='def-Symbol'>(</span> ДокРН <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
484: 
485:         <span class='c1c-c1cWord def-Keyword'>Если</span> <span class='def-Symbol'>(</span>СчФОтгрузки<span class='def-Number'>.</span>Действие<span class='def-Number'>.</span>Наименование <span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='c1c-c1cSymb def-Symbol'>></span> <span class='c1c-c1cString def-String'>"Продукция отгружена"</span><span class='def-Symbol'>)</span>
486:              И <span class='def-Symbol'>(</span> СчФОтгрузки<span class='def-Number'>.</span>Действие<span class='def-Number'>.</span>Наименование <span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='c1c-c1cSymb def-Symbol'>></span> <span class='c1c-c1cString def-String'>"На комиссию"</span><span class='def-Symbol'>)</span>
487:         <span class='c1c-c1cWord def-Keyword'>Тогда</span>
488:             <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span> <span class='c1c-c1cString def-String'>"Счет-фактура оплаты не на отгрузку и не на комиссию!"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"!!!"</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
489:             <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span><span class='def-Number'>0</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
490:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
491: 
492:         <span class='c1c-c1cComment def-Comment def-Syntax'>// Построим список наименований ПН по возврату</span>
493:         ТаблицаВозврата <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cWord2 def-Keyword'>СоздатьОбъект</span><span class='def-Symbol'>(</span> <span class='c1c-c1cString def-String'>"ТаблицаЗначений"</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
494:         ВыгрузитьТабличнуюЧасть<span class='def-Symbol'>(</span> ТаблицаВозврата<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"НомерСтроки,Наименование,Количество,Сумма,НДС,Единица"</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
495:         ТаблицаВозврата<span class='def-Number'>.</span>НоваяКолонка<span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"БылИзлишекОплаты"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"Число"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
496: 
497:         Сум76_11 <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span> Сум76_12 <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span>
498: 
499:         Рег <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cWord2 def-Keyword'>СоздатьОбъект</span><span class='def-Symbol'>(</span> <span class='c1c-c1cString def-String'>"Регистр.Взаиморасчеты"</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
500:         <span class='c1c-c1cWord def-Keyword'>Если</span> <span class='c1c-c1cWord2 def-Keyword'>ПолучитьДатуТА</span><span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='c1c-c1cSymb def-Symbol'>></span> ДатаДок <span class='c1c-c1cWord def-Keyword'>Тогда</span> <span class='c1c-c1cComment def-Comment def-Syntax'>// если итоги не актуальны</span>
501:             <span class='c1c-c1cWord2 def-Keyword'>Состояние</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Рассчет регистра..."</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
502:             Рег<span class='def-Number'>.</span>ВременныйРасчет<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
503:             Рег<span class='def-Number'>.</span>УстановитьФильтр<span class='def-Symbol'>(</span> Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
504:             <span class='c1c-c1cWord2 def-Keyword'>РассчитатьРегистрыНа</span><span class='def-Symbol'>(</span> ТекущийДокумент<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
505:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
506: 
507:         <span class='c1c-c1cComment def-Comment def-Syntax'>// Процесс пошел...</span>
508: 
509:         ОбщийИзлишекСуммы <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span>
510: 
511:         ВыбратьСтроки<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
512:         <span class='c1c-c1cWord def-Keyword'>Пока</span> ПолучитьСтроку<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Цикл</span>
513:             <span class='c1c-c1cComment def-Comment def-Syntax'>//** 24/07/00</span>
514:             ОплатаПоРегиструГотПрод<span class='def-Symbol'>(</span><span class='c1c-c1cVar def-VarStrong def-Var'>НомерСтроки</span><span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span>Количество<span class='c1c-c1cSymb def-Symbol'>,</span>СуммаБезНДС<span class='c1c-c1cSymb def-Symbol'>,</span>Регистр<span class='def-Number'>.</span>ГотоваяПродукция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='def-Number'>1</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
515: 
516:             ФлагОплачено <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span>
517:             <span class='c1c-c1cComment def-Comment def-Syntax'>// Сообщить("Обрабатывается ("+ОбрабСтр+" из "+КоличествоСтрок()+ ") """+Наименование+"""");</span>
518:             ОбрабСтр <span class='c1c-c1cSymb def-Symbol'>=</span> ОбрабСтр<span class='c1c-c1cSymb def-Symbol'>+</span><span class='def-Number'>1</span><span class='c1c-c1cSymb def-Symbol'>;</span>
519:             СуммаПроводки <span class='c1c-c1cSymb def-Symbol'>=</span> Наименование<span class='def-Number'>.</span>Прих_Цена<span class='def-Number'>.</span>Получить<span class='def-Symbol'>(</span>ДокОсн<span class='def-Number'>.</span>ДатаДок<span class='def-Symbol'>)</span> <span class='c1c-c1cSymb def-Symbol'>*</span> Количество<span class='c1c-c1cSymb def-Symbol'>;</span>
520:             <span class='c1c-c1cComment def-Comment def-Syntax'>// Начало изврата с регистрами</span>
521:             СумОтгПоРН <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cComment def-Comment def-Syntax'>// Сумма отгрузки по РН</span>
522:             КолОтгПоРН <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cComment def-Comment def-Syntax'>// Кол-во отгрузки по РН</span>
523:             ЭлементПН <span class='c1c-c1cSymb def-Symbol'>=</span> ЭлементНеопрСправ<span class='def-Symbol'>(</span> Наименование <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cComment def-Comment def-Syntax'>// текущее наименование в ПН</span>
524:             ДокРН<span class='def-Number'>.</span>ВыбратьСтроки<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
525:             <span class='c1c-c1cWord def-Keyword'>Пока</span> ДокРН<span class='def-Number'>.</span>ПолучитьСтроку<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Цикл</span>
526:                 ЭлементРН <span class='c1c-c1cSymb def-Symbol'>=</span> ЭлементНеопрСправ<span class='def-Symbol'>(</span> ДокРН<span class='def-Number'>.</span>Наименование <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
527:                 <span class='c1c-c1cWord def-Keyword'>Если</span> <span class='def-Symbol'>(</span> ЭлементПН <span class='c1c-c1cSymb def-Symbol'>=</span> ЭлементРН <span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
528:                     КолОтгПоРН <span class='c1c-c1cSymb def-Symbol'>=</span> КолОтгПоРН <span class='c1c-c1cSymb def-Symbol'>+</span> ДокРН<span class='def-Number'>.</span>Количество<span class='c1c-c1cSymb def-Symbol'>;</span>
529:                     СумОтгПоРН <span class='c1c-c1cSymb def-Symbol'>=</span> ДокРН<span class='def-Number'>.</span>СуммаБезНДС<span class='c1c-c1cSymb def-Symbol'>;</span><span class='c1c-c1cComment def-Comment def-Syntax'>//**ДокРН.Сумма;</span>
530:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
531:             <span class='c1c-c1cWord def-Keyword'>КонецЦикла</span><span class='c1c-c1cSymb def-Symbol'>;</span>
532: 
533:             <span class='c1c-c1cWord def-Keyword'>Если</span> Количество <span class='c1c-c1cSymb def-Symbol'>></span> КолОтгПоРН <span class='c1c-c1cWord def-Keyword'>Тогда</span>
534:                 <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span> <span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>+</span>Наименование<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cString def-String'>" Возвращается больше, чем отгружено"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"!!!"</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
535:                 <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span> <span class='def-Number'>0</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
536:             <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> <span class='def-Symbol'>(</span> Количество <span class='c1c-c1cSymb def-Symbol'>=</span> КолОтгПоРН <span class='def-Symbol'>)</span> и <span class='def-Symbol'>(</span>СуммаБезНДС <span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='c1c-c1cSymb def-Symbol'>></span> СумОтгПоРН <span class='def-Symbol'>)</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
537:                 <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span> <span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>+</span>Наименование<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cString def-String'>" Не совпадают суммы отгрузки и возврата при равном количестве"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"!!!"</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
538:                 <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cWord2 def-Keyword'>строка</span><span class='def-Symbol'>(</span>СуммаC_НДС<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>"; по накл. "</span><span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cWord2 def-Keyword'>строка</span><span class='def-Symbol'>(</span>СумОтгПоРН<span class='def-Symbol'>)</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
539:                 <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span> <span class='def-Number'>0</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
540:             <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
541: 
542: 
543:             КомСчФОтгрузки <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cString def-String'>"По СчФ &lt;"</span><span class='c1c-c1cSymb def-Symbol'>+</span>СчФОтгрузки<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>"> (сторн. отгрузки/оплаты)"</span><span class='c1c-c1cSymb def-Symbol'>;</span>
544: 
545:             <span class='c1c-c1cComment def-Comment def-Syntax'>// "Интеллектуальное" движение регистра Взаиморасчеты.</span>
546:             <span class='c1c-c1cComment def-Comment def-Syntax'>// Оно состоит в том, чтобы двинуть регистр "туда" и "обратно"</span>
547:             <span class='c1c-c1cComment def-Comment def-Syntax'>// с минусом. То есть для возврата продукции приходовать его с минусом,</span>
548:             <span class='c1c-c1cComment def-Comment def-Syntax'>// а для возврата "лишних" денег расходовать с минусом</span>
549: 
550:             <span class='c1c-c1cComment def-Comment def-Syntax'>// Часть 1. Погашение долга перед клиентом</span>
551:             <span class='c1c-c1cComment def-Comment def-Syntax'>// Обратное движение регистра Взаиморасчеты, возвращающее продукцию</span>
552:             КоэфЕд <span class='c1c-c1cSymb def-Symbol'>=</span> КоэфЕдИзмерения<span class='def-Symbol'>(</span> Единица<span class='c1c-c1cSymb def-Symbol'>,</span> Наименование<span class='def-Number'>.</span>БазоваяЕдиница <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
553:             ПолноеКолич <span class='c1c-c1cSymb def-Symbol'>=</span> Количество <span class='c1c-c1cSymb def-Symbol'>*</span> КоэфЕд<span class='c1c-c1cSymb def-Symbol'>;</span>
554:             Регистр<span class='def-Number'>.</span>Взаиморасчеты<span class='def-Number'>.</span>ПривязыватьСтроку<span class='def-Symbol'>(</span> <span class='c1c-c1cVar def-VarStrong def-Var'>НомерСтроки</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
555:             Регистр<span class='def-Number'>.</span>Взаиморасчеты<span class='def-Number'>.</span>Клиент <span class='c1c-c1cSymb def-Symbol'>=</span> Клиент<span class='c1c-c1cSymb def-Symbol'>;</span>
556:             Регистр<span class='def-Number'>.</span>Взаиморасчеты<span class='def-Number'>.</span>СчетФактура <span class='c1c-c1cSymb def-Symbol'>=</span> СчФОтгрузки<span class='c1c-c1cSymb def-Symbol'>;</span>
557:             Регистр<span class='def-Number'>.</span>Взаиморасчеты<span class='def-Number'>.</span>Наименование <span class='c1c-c1cSymb def-Symbol'>=</span> Наименование<span class='c1c-c1cSymb def-Symbol'>;</span>
558:             Регистр<span class='def-Number'>.</span>Взаиморасчеты<span class='def-Number'>.</span>Оплата <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span>
559:             Регистр<span class='def-Number'>.</span>Взаиморасчеты<span class='def-Number'>.</span>Количество <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cSymb def-Symbol'>-</span> ПолноеКолич<span class='c1c-c1cSymb def-Symbol'>;</span>
560:             Регистр<span class='def-Number'>.</span>Взаиморасчеты<span class='def-Number'>.</span>Сумма <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cSymb def-Symbol'>-</span> Сумма<span class='c1c-c1cSymb def-Symbol'>;</span>
561:             Регистр<span class='def-Number'>.</span>Взаиморасчеты<span class='def-Number'>.</span>НДС <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cSymb def-Symbol'>-</span> НДС<span class='c1c-c1cSymb def-Symbol'>;</span>
562:             Регистр<span class='def-Number'>.</span>Взаиморасчеты<span class='def-Number'>.</span>Закрытие64 <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span>
563:             Регистр<span class='def-Number'>.</span>Взаиморасчеты<span class='def-Number'>.</span>ДвижениеПриходВыполнить<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
564: 
565:             <span class='c1c-c1cComment def-Comment def-Syntax'>// Часть 2. Убирание излишков оплаты</span>
566: 
567:             Рег<span class='def-Number'>.</span>СводныеОстатки<span class='def-Symbol'>(</span> Клиент<span class='c1c-c1cSymb def-Symbol'>,</span> СчФОтгрузки<span class='c1c-c1cSymb def-Symbol'>,</span> Наименование<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
568: 
569:             <span class='c1c-c1cWord def-Keyword'>Если</span> Рег<span class='def-Number'>.</span>Сумма <span class='c1c-c1cSymb def-Symbol'>&lt;</span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
570:                 <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span> КомСчФОтгрузки<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" по наименованию &lt;"</span><span class='c1c-c1cSymb def-Symbol'>+</span>Наименование<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>"> имеется отритцательный долг: "</span><span class='c1c-c1cSymb def-Symbol'>+</span>Рег<span class='def-Number'>.</span>Сумма<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"!!!"</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
571:                 <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span><span class='def-Number'>0</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
572:             <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
573: 
574:             <span class='c1c-c1cComment def-Comment def-Syntax'>// Превышение суммы возврата над суммой долга по наименованию</span>
575:             ИзлишекОплСуммы <span class='c1c-c1cSymb def-Symbol'>=</span> Сумма <span class='c1c-c1cSymb def-Symbol'>-</span> Рег<span class='def-Number'>.</span>Сумма<span class='c1c-c1cSymb def-Symbol'>;</span>
576:             ИзлишекОплНДС <span class='c1c-c1cSymb def-Symbol'>=</span> НДС <span class='c1c-c1cSymb def-Symbol'>-</span> Рег<span class='def-Number'>.</span>НДС<span class='c1c-c1cSymb def-Symbol'>;</span>
577:             ИзлишекОплКолич <span class='c1c-c1cSymb def-Symbol'>=</span> ПолноеКолич <span class='c1c-c1cSymb def-Symbol'>-</span> Рег<span class='def-Number'>.</span>Количество<span class='c1c-c1cSymb def-Symbol'>;</span>
578: 
579:             <span class='c1c-c1cWord def-Keyword'>Если</span> <span class='c1c-c1cWord2 def-Keyword'>Окр</span><span class='def-Symbol'>(</span> ИзлишекОплСуммы<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Number'>5</span> <span class='def-Symbol'>)</span> <span class='c1c-c1cSymb def-Symbol'>&lt;</span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
580:                 <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span> <span class='c1c-c1cString def-String'>"В строке №"</span><span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cVar def-VarStrong def-Var'>НомерСтроки</span><span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" возвращается больше, чем нам должны на "</span><span class='c1c-c1cSymb def-Symbol'>+</span>ИзлишекОплСуммы<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" рублей!"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"!"</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
581:             <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
582: 
583:             <span class='c1c-c1cComment def-Comment def-Syntax'>// Убираем излишки оплаты по данному наименованию</span>
584:             Регистр<span class='def-Number'>.</span>Взаиморасчеты<span class='def-Number'>.</span>ПривязыватьСтроку<span class='def-Symbol'>(</span> <span class='c1c-c1cVar def-VarStrong def-Var'>НомерСтроки</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
585:             РасходРегВзСОбнул<span class='def-Symbol'>(</span> Регистр<span class='def-Number'>.</span>Взаиморасчеты<span class='c1c-c1cSymb def-Symbol'>,</span> Рег<span class='c1c-c1cSymb def-Symbol'>,</span>
586:                                 СчФОтгрузки<span class='c1c-c1cSymb def-Symbol'>,</span> Наименование<span class='c1c-c1cSymb def-Symbol'>,</span>
587:                                 <span class='c1c-c1cSymb def-Symbol'>-</span>ИзлишекОплСуммы<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cSymb def-Symbol'>-</span>ИзлишекОплНДС<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cSymb def-Symbol'>-</span>ИзлишекОплКолич<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>,</span>
588:                                 <span class='c1c-c1cSymb def-Symbol'>-</span>Сумма<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cSymb def-Symbol'>-</span>НДС<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cSymb def-Symbol'>-</span>ПолноеКолич <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
589: 
590:             <span class='c1c-c1cWord def-Keyword'>Если</span> ИзлишекОплСуммы <span class='c1c-c1cSymb def-Symbol'>></span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
591:                 НомСтр <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span>
592:                 <span class='c1c-c1cWord def-Keyword'>Если</span> ТаблицаВозврата<span class='def-Number'>.</span>НайтиЗначение<span class='def-Symbol'>(</span> Наименование<span class='c1c-c1cSymb def-Symbol'>,</span> НомСтр<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"Наименование"</span> <span class='def-Symbol'>)</span> <span class='c1c-c1cSymb def-Symbol'>></span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
593:                     ТаблицаВозврата<span class='def-Number'>.</span>ПолучитьСтрокуПоНомеру<span class='def-Symbol'>(</span> НомСтр <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
594:                     ТаблицаВозврата<span class='def-Number'>.</span>БылИзлишекОплаты <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>1</span><span class='c1c-c1cSymb def-Symbol'>;</span>
595:                 <span class='c1c-c1cWord def-Keyword'>Иначе</span>
596:                     <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Super Trouble!"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"!!!"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
597:                     <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span><span class='def-Number'>0</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
598:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
599:             <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
600: 
601:             ОбщийИзлишекСуммы <span class='c1c-c1cSymb def-Symbol'>=</span> ОбщийИзлишекСуммы <span class='c1c-c1cSymb def-Symbol'>+</span> ИзлишекОплСуммы<span class='c1c-c1cSymb def-Symbol'>;</span>
602: 
603:             <span class='c1c-c1cComment def-Comment def-Syntax'>// ********** Конец интеллектуального движения регистров ******</span>
604: 
605:             <span class='c1c-c1cComment def-Comment def-Syntax'>// ********** ИНТЕЛЛЕКТУАЛЬНЫЕ ПРОВОДКИ ***********************</span>
606: 
607:             <span class='c1c-c1cComment def-Comment def-Syntax'>// Возврат самой продукции </span>
608:             СуммаВозврПоОтгрЦене <span class='c1c-c1cSymb def-Symbol'>=</span> Наименование<span class='def-Number'>.</span>Прих_Цена<span class='def-Number'>.</span>Получить<span class='def-Symbol'>(</span> ДокОсн<span class='def-Number'>.</span>ДатаДок <span class='def-Symbol'>)</span> <span class='c1c-c1cSymb def-Symbol'>*</span> ПолноеКолич<span class='c1c-c1cSymb def-Symbol'>;</span>
609:             Сч4041 <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cSymb def-Symbol'>?</span><span class='def-Symbol'>(</span> Наименование<span class='def-Number'>.</span>Вид<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cString def-String'>"Товары"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"41.1"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"40"</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
610:             Проводка<span class='def-Symbol'>(</span> Операция<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"45.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span> Сч4041<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cSymb def-Symbol'>-</span>СуммаВозврПоОтгрЦене<span class='c1c-c1cSymb def-Symbol'>,</span> Клиент<span class='c1c-c1cSymb def-Symbol'>,</span> Склад<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span> КомСчФОтгрузки<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cSymb def-Symbol'>-</span>ПолноеКолич<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cSymb def-Symbol'>,</span>Наименование<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
611: 
612:             <span class='c1c-c1cWord def-Keyword'>Если</span> ИзлишекОплСуммы <span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='c1c-c1cSymb def-Symbol'>></span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
613:                 <span class='c1c-c1cComment def-Comment def-Syntax'>// Возврат денежек</span>
614:                 Сч46 <span class='c1c-c1cSymb def-Symbol'>=</span> СчетРеализацииПоНаименованию<span class='def-Symbol'>(</span> Наименование<span class='c1c-c1cSymb def-Symbol'>,</span> СчФОтгрузки <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
615:                 Проводка<span class='def-Symbol'>(</span> Операция<span class='c1c-c1cSymb def-Symbol'>,</span> Сч46<span class='def-Number'>.</span>Код<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"45.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cSymb def-Symbol'>-</span>СуммаВозврПоОтгрЦене<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span> КомСчФОтгрузки<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
616:                 Проводка<span class='def-Symbol'>(</span> Операция<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"76.11"</span><span class='c1c-c1cSymb def-Symbol'>,</span> Сч46<span class='def-Number'>.</span>Код<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cSymb def-Symbol'>-</span>ИзлишекОплСуммы<span class='c1c-c1cSymb def-Symbol'>,</span> Клиент<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span> КомСчФОтгрузки<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
617:             <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
618: 
619:             <span class='c1c-c1cWord def-Keyword'>Если</span> ИзлишекОплНДС <span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='c1c-c1cSymb def-Symbol'>></span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
620:                 <span class='c1c-c1cComment def-Comment def-Syntax'>// Сторнирование НДС</span>
621:                 Проводка<span class='def-Symbol'>(</span> Операция<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"76.12"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"68.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cSymb def-Symbol'>-</span>ИзлишекОплНДС<span class='c1c-c1cSymb def-Symbol'>,</span> Клиент<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>ПлатежиВФонды<span class='def-Number'>.</span>Взносы<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"Сторн. НДС "</span><span class='c1c-c1cSymb def-Symbol'>+</span>КомСчФОтгрузки<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
622:             <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
623: 
624:             <span class='c1c-c1cWord def-Keyword'>Если</span> НДС <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
625:                 Сум76_11 <span class='c1c-c1cSymb def-Symbol'>=</span> Сум76_11 <span class='c1c-c1cSymb def-Symbol'>+</span> Сумма<span class='c1c-c1cSymb def-Symbol'>;</span>
626:             <span class='c1c-c1cWord def-Keyword'>Иначе</span>
627:                 Сум76_12 <span class='c1c-c1cSymb def-Symbol'>=</span> Сум76_12 <span class='c1c-c1cSymb def-Symbol'>+</span> Сумма<span class='c1c-c1cSymb def-Symbol'>;</span>
628:             <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
629:             <span class='c1c-c1cComment def-Comment def-Syntax'>// ********** Конец интеллектуальных проводок *****************</span>
630:         <span class='c1c-c1cWord def-Keyword'>КонецЦикла</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cComment def-Comment def-Syntax'>// по текущему документу ПН</span>
631: 
632:         <span class='c1c-c1cComment def-Comment def-Syntax'>// --------- Разбрасывание лишней суммы -----------------</span>
633: 
634:         ОбщийИзлишекСуммы <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cWord2 def-Keyword'>Окр</span><span class='def-Symbol'>(</span> ОбщийИзлишекСуммы<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Number'>2</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
635:         <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span> <span class='c1c-c1cString def-String'>"После возврата у нас высвободилось "</span><span class='c1c-c1cSymb def-Symbol'>+</span>ОбщийИзлишекСуммы<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" рублей."</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
636:         <span class='c1c-c1cWord def-Keyword'>Если</span> ОбщийИзлишекСуммы <span class='c1c-c1cSymb def-Symbol'>&lt;</span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
637:             <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span> <span class='c1c-c1cString def-String'>"То есть были отритцательные долги судя по регистру Взаиморассчеты!"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"!!!"</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
638:             <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span><span class='def-Number'>0</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
639:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
640: 
641:         <span class='c1c-c1cComment def-Comment def-Syntax'>// на общую сумму возврата</span>
642:         <span class='c1c-c1cWord def-Keyword'>Если</span> Сум76_11 <span class='c1c-c1cSymb def-Symbol'>></span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
643:             Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"62.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"76.11"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>-</span>Сум76_11<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span> КомСчФОтгрузки<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
644:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
645:         <span class='c1c-c1cWord def-Keyword'>Если</span> Сум76_12 <span class='c1c-c1cSymb def-Symbol'>></span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
646:             Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"62.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"76.12"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>-</span>Сум76_12<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span>Клиент<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"ПН"</span><span class='c1c-c1cSymb def-Symbol'>,</span> КомСчФОтгрузки<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
647:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
648: 
649:         <span class='c1c-c1cWord def-Keyword'>Если</span> ОбщийИзлишекСуммы <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
650:             <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Денег после возврата у нас не появилось."</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"i"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
651:             <span class='c1c-c1cWord def-Keyword'>Перейти</span> ~ОбходПроплаты<span class='c1c-c1cSymb def-Symbol'>;</span>
652:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
653: 
654:         <span class='c1c-c1cComment def-Comment def-Syntax'>// Дозакрываем счет-фактуру отгрузки</span>
655: 
656:         Неопл_Сумма <span class='c1c-c1cSymb def-Symbol'>=</span> ИтогДокументаДляОплаты<span class='def-Symbol'>(</span> СчФОтгрузки<span class='c1c-c1cSymb def-Symbol'>,</span> Рег<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"Сумма"</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
657:         ИтогСумма <span class='c1c-c1cSymb def-Symbol'>=</span> Итог<span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Сумма"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
658:         НеоплСумма <span class='c1c-c1cSymb def-Symbol'>=</span> Неопл_Сумма <span class='c1c-c1cSymb def-Symbol'>-</span> ИтогСумма <span class='c1c-c1cSymb def-Symbol'>+</span> ОбщийИзлишекСуммы<span class='c1c-c1cSymb def-Symbol'>;</span>
659:         <span class='c1c-c1cWord def-Keyword'>Если</span> НеоплСумма <span class='c1c-c1cSymb def-Symbol'>&lt;</span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
660:             <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"По СчФ отгрузки ("</span><span class='c1c-c1cSymb def-Symbol'>+</span>СчФОтгрузки<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>") отритцательный долг ("</span><span class='c1c-c1cSymb def-Symbol'>+</span>НеоплСумма<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>")!"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"!!!"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
661:             <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span><span class='def-Number'>0</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
662:         <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> НеоплСумма <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
663:             <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"СчФ отгрузки уже полностью оплачена"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
664:         <span class='c1c-c1cWord def-Keyword'>Иначе</span>
665:             <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"СчФ отгрузки частично оплачена, осталось доплатить: "</span><span class='c1c-c1cSymb def-Symbol'>+</span>Неопл_Сумма<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" - "</span><span class='c1c-c1cSymb def-Symbol'>+</span>ИтогСумма<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" = "</span><span class='c1c-c1cSymb def-Symbol'>+</span>НеоплСумма<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
666:             <span class='c1c-c1cWord def-Keyword'>Если</span> ОбщийИзлишекСуммы <span class='c1c-c1cSymb def-Symbol'>></span> НеоплСумма <span class='c1c-c1cWord def-Keyword'>Тогда</span>
667:                 КоэфЗакрытия <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>1</span><span class='c1c-c1cSymb def-Symbol'>;</span>
668:             <span class='c1c-c1cWord def-Keyword'>Иначе</span>
669:                 КоэфЗакрытия <span class='c1c-c1cSymb def-Symbol'>=</span> ОбщийИзлишекСуммы <span class='c1c-c1cSymb def-Symbol'>/</span> НеоплСумма<span class='c1c-c1cSymb def-Symbol'>;</span>
670:             <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
671: 
672:             <span class='c1c-c1cWord def-Keyword'>Если</span> КоэфЗакрытия <span class='c1c-c1cSymb def-Symbol'>></span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
673:                 СуммаЗакр <span class='c1c-c1cSymb def-Symbol'>=</span> ЗакрытьСчетФактуруБезВозвращенных<span class='def-Symbol'>(</span> Рег<span class='c1c-c1cSymb def-Symbol'>,</span>
674:                     СчФОтгрузки<span class='c1c-c1cSymb def-Symbol'>,</span> КоэфЗакрытия<span class='c1c-c1cSymb def-Symbol'>,</span> ТаблицаВозврата <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
675:                 <span class='c1c-c1cWord def-Keyword'>Если</span> СуммаЗакр <span class='c1c-c1cSymb def-Symbol'>&lt;</span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
676:                     <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span><span class='def-Number'>0</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
677:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
678:                 СуммаЗакр <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cWord2 def-Keyword'>Окр</span><span class='def-Symbol'>(</span> СуммаЗакр<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Number'>2</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
679:                 <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Закрыли &lt;"</span><span class='c1c-c1cSymb def-Symbol'>+</span>СчФОтгрузки<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>"> на "</span><span class='c1c-c1cSymb def-Symbol'>+</span>СуммаЗакр<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" рублей с коэф-м "</span><span class='c1c-c1cSymb def-Symbol'>+</span>КоэфЗакрытия<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"i"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
680:             <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
681:             ОбщийИзлишекСуммы <span class='c1c-c1cSymb def-Symbol'>=</span> ОбщийИзлишекСуммы <span class='c1c-c1cSymb def-Symbol'>-</span> СуммаЗакр<span class='c1c-c1cSymb def-Symbol'>;</span>
682:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
683: 
684:         <span class='c1c-c1cComment def-Comment def-Syntax'>// Закрываем счет-фактуру закрытия</span>
685: 
686:         <span class='c1c-c1cWord def-Keyword'>Если</span> СчФЗакр<span class='def-Number'>.</span>Выбран<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span> <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>1</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
687:             НеоплСумма <span class='c1c-c1cSymb def-Symbol'>=</span> ИтогДокументаДляОплаты<span class='def-Symbol'>(</span> СчФЗакр<span class='c1c-c1cSymb def-Symbol'>,</span> Рег<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"Сумма"</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
688: 
689:                <span class='c1c-c1cWord def-Keyword'>Если</span> НеоплСумма <span class='c1c-c1cSymb def-Symbol'>&lt;</span> ОбщийИзлишекСуммы <span class='c1c-c1cWord def-Keyword'>Тогда</span>
690:                    СуммаОплСчФ <span class='c1c-c1cSymb def-Symbol'>=</span> НеоплСумма<span class='c1c-c1cSymb def-Symbol'>;</span>
691:                    <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Долг по счет-фактуре закрытия ("</span><span class='c1c-c1cSymb def-Symbol'>+</span>НеоплСумма<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>") меньше, чем оставшиеся средства ( "</span><span class='c1c-c1cSymb def-Symbol'>+</span>ОбщийИзлишекСуммы<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" )"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"i"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
692:                <span class='c1c-c1cWord def-Keyword'>Иначе</span>
693:                    СуммаОплСчФ <span class='c1c-c1cSymb def-Symbol'>=</span> ОбщийИзлишекСуммы<span class='c1c-c1cSymb def-Symbol'>;</span>
694:                <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
695: 
696:             <span class='c1c-c1cWord def-Keyword'>Если</span> СуммаОплСчФ <span class='c1c-c1cSymb def-Symbol'>&lt;</span><span class='c1c-c1cSymb def-Symbol'>></span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
697:                 <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Закрываем &lt;"</span><span class='c1c-c1cSymb def-Symbol'>+</span>СчФЗакр<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>"> на "</span><span class='c1c-c1cSymb def-Symbol'>+</span>СуммаОплСчФ<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" рублей"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"i"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
698:                 КоэфЗакрытия <span class='c1c-c1cSymb def-Symbol'>=</span> СуммаОплСчФ <span class='c1c-c1cSymb def-Symbol'>/</span> НеоплСумма<span class='c1c-c1cSymb def-Symbol'>;</span>
699:                 <span class='c1c-c1cComment def-Comment def-Syntax'>// Двигаем регистрами</span>
700:                 СуммаЗакр <span class='c1c-c1cSymb def-Symbol'>=</span> ЗакрытьСчетФактуру<span class='def-Symbol'>(</span> Регистр<span class='def-Number'>.</span>Взаиморасчеты<span class='c1c-c1cSymb def-Symbol'>,</span>
701:                                     Регистр<span class='def-Number'>.</span>КорректСебест<span class='c1c-c1cSymb def-Symbol'>,</span>
702:                                     Регистр<span class='def-Number'>.</span>ГотоваяПродукция<span class='c1c-c1cSymb def-Symbol'>,</span> Рег<span class='c1c-c1cSymb def-Symbol'>,</span>
703:                                     СчФЗакр<span class='c1c-c1cSymb def-Symbol'>,</span> КоэфЗакрытия<span class='c1c-c1cSymb def-Symbol'>,</span> ДатаДок<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Number'>0</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
704:                 Док <span class='c1c-c1cSymb def-Symbol'>=</span> РасхНакл<span class='def-Symbol'>(</span> СчФЗакр <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
705:                 СумНДС <span class='c1c-c1cSymb def-Symbol'>=</span> СуммаОплСчФ <span class='c1c-c1cSymb def-Symbol'>/</span> СчФЗакр<span class='def-Number'>.</span>Итог<span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"Сумма"</span><span class='def-Symbol'>)</span> <span class='c1c-c1cSymb def-Symbol'>*</span> СчФЗакр<span class='def-Number'>.</span>Итог<span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"НДС"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
706:                 <span class='c1c-c1cWord def-Keyword'>Если</span> ПроводкиПо46<span class='def-Symbol'>(</span> Рег<span class='c1c-c1cSymb def-Symbol'>,</span> Операция<span class='c1c-c1cSymb def-Symbol'>,</span> Док<span class='c1c-c1cSymb def-Symbol'>,</span> СуммаОплСчФ<span class='c1c-c1cSymb def-Symbol'>,</span> СумНДС<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"По СчФ &lt;"</span><span class='c1c-c1cSymb def-Symbol'>+</span>СчФЗакр<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>">"</span> <span class='def-Symbol'>)</span> <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
707:                     <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span> <span class='def-Number'>0</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span>
708:                 <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
709: 
710:                 ОбщийИзлишекСуммы <span class='c1c-c1cSymb def-Symbol'>=</span> ОбщийИзлишекСуммы <span class='c1c-c1cSymb def-Symbol'>-</span> СуммаОплСчФ<span class='c1c-c1cSymb def-Symbol'>;</span>
711:             <span class='c1c-c1cWord def-Keyword'>Иначе</span>
712:                 <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"К сожалению у нас не осталось денег на закрытие &lt;"</span><span class='c1c-c1cSymb def-Symbol'>+</span>СчФЗакр<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>">."</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"i"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
713:             <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
714:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
715: 
716:         <span class='c1c-c1cWord def-Keyword'>Если</span> ОбщийИзлишекСуммы <span class='c1c-c1cSymb def-Symbol'>></span> <span class='def-Number'>0</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
717:             <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span><span class='c1c-c1cString def-String'>"У нас осталось еще "</span><span class='c1c-c1cSymb def-Symbol'>+</span>ОбщийИзлишекСуммы<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" рублей, которые мы запишем "</span><span class='c1c-c1cSymb def-Symbol'>+</span>Клиент<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" как предоплату"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"i"</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
718: 
719:             Проводка<span class='def-Symbol'>(</span> Операция<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"62.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"64"</span><span class='c1c-c1cSymb def-Symbol'>,</span> ОбщийИзлишекСуммы<span class='c1c-c1cSymb def-Symbol'>,</span> Клиент<span class='c1c-c1cSymb def-Symbol'>,</span> Клиент<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
720:             Проводка<span class='def-Symbol'>(</span> Операция<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"64"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"68.2"</span><span class='c1c-c1cSymb def-Symbol'>,</span> ОбщийИзлишекСуммы <span class='c1c-c1cSymb def-Symbol'>*</span> <span class='def-Number'>20</span><span class='c1c-c1cSymb def-Symbol'>/</span><span class='def-Number'>120</span><span class='c1c-c1cSymb def-Symbol'>,</span> Клиент<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>ПлатежиВФонды<span class='def-Number'>.</span>Взносы<span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
721: 
722:             Регистр<span class='def-Number'>.</span>Предоплата<span class='def-Number'>.</span>Клиент <span class='c1c-c1cSymb def-Symbol'>=</span> Клиент<span class='c1c-c1cSymb def-Symbol'>;</span>
723:             Регистр<span class='def-Number'>.</span>Предоплата<span class='def-Number'>.</span>Сумма <span class='c1c-c1cSymb def-Symbol'>=</span> ОбщийИзлишекСуммы<span class='c1c-c1cSymb def-Symbol'>;</span>
724:             Регистр<span class='def-Number'>.</span>Предоплата<span class='def-Number'>.</span>НДС <span class='c1c-c1cSymb def-Symbol'>=</span> ОбщийИзлишекСуммы <span class='c1c-c1cSymb def-Symbol'>*</span> <span class='def-Number'>20</span><span class='c1c-c1cSymb def-Symbol'>/</span><span class='def-Number'>120</span><span class='c1c-c1cSymb def-Symbol'>;</span>
725:             Регистр<span class='def-Number'>.</span>Предоплата<span class='def-Number'>.</span>ДвижениеПриходВыполнить<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
726:         <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
727: 
728: ~ОбходПроплаты:
729: 
730:         <span class='c1c-c1cComment def-Comment def-Syntax'>// ********************************************************************</span>
731:         <span class='c1c-c1cComment def-Comment def-Syntax'>// ********* КОНЕЦ ДЕЙСТВИЯ "Возврат от покупателя" *******************</span>
732:         <span class='c1c-c1cComment def-Comment def-Syntax'>// ********************************************************************</span>
733: 
734:     <span class='c1c-c1cWord def-Keyword'>ИначеЕсли</span> Действие<span class='def-Number'>.</span>Наименование <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cString def-String'>"Возврат с комиссии"</span> <span class='c1c-c1cWord def-Keyword'>Тогда</span>
735:         <span class='c1c-c1cWord2 def-Keyword'>Сообщить</span><span class='def-Symbol'>(</span> <span class='c1c-c1cString def-String'>"Действие "</span><span class='c1c-c1cSymb def-Symbol'>+</span>Действие<span class='def-Number'>.</span>Наименование<span class='c1c-c1cSymb def-Symbol'>+</span><span class='c1c-c1cString def-String'>" сейчас не работает!"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='c1c-c1cString def-String'>"!!!"</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
736:         <span class='c1c-c1cWord2 def-Keyword'>СтатусВозврата</span><span class='def-Symbol'>(</span><span class='def-Number'>0</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cWord def-Keyword'>Возврат</span><span class='c1c-c1cSymb def-Symbol'>;</span> 
737:     <span class='c1c-c1cWord def-Keyword'>КонецЕсли</span><span class='c1c-c1cSymb def-Symbol'>;</span>
738: 
739:     _Спр <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='c1c-c1cWord2 def-Keyword'>СоздатьОбъект</span><span class='def-Symbol'>(</span> <span class='c1c-c1cString def-String'>"Справочник.ПрибылиУбытки"</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
740:     _Спр<span class='def-Number'>.</span>НайтиПоНаименованию<span class='def-Symbol'>(</span> <span class='c1c-c1cString def-String'>"Налоги"</span><span class='c1c-c1cSymb def-Symbol'>,</span> <span class='def-Number'>0</span> <span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
741:     <span class='c1c-c1cComment def-Comment def-Syntax'>//    Проводка(Операция,"68.19",СчетКт,СумНалРекл, Перечисление.ПлатежиВФонды.Взносы,Клиент,"РН",""+ВтчДопНалог);</span>
742:     Проводка<span class='def-Symbol'>(</span>Операция<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"80"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"68.19"</span><span class='c1c-c1cSymb def-Symbol'>,</span>СумНалРекл<span class='c1c-c1cSymb def-Symbol'>,</span> _Спр<span class='def-Number'>.</span>ТекущийЭлемент<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cVar def-VarStrong def-Var'>Перечисление</span><span class='def-Number'>.</span>ПлатежиВФонды<span class='def-Number'>.</span>Взносы<span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>"РН"</span><span class='c1c-c1cSymb def-Symbol'>,</span><span class='c1c-c1cString def-String'>""</span><span class='c1c-c1cSymb def-Symbol'>+</span>ВтчДопНалог<span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
743: 
744:     Операция<span class='def-Number'>.</span>Записать<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span>
745:     Рег <span class='c1c-c1cSymb def-Symbol'>=</span> <span class='def-Number'>0</span><span class='c1c-c1cSymb def-Symbol'>;</span>
746: <span class='c1c-c1cWord def-Keyword'>КонецПроцедуры</span>
747: 
748: ФлагЗакрСчФ <span class='c1c-c1cSymb def-Symbol'>=</span> СчФЗакр<span class='def-Number'>.</span>Выбран<span class='def-Symbol'>(</span><span class='def-Symbol'>)</span><span class='c1c-c1cSymb def-Symbol'>;</span> <span class='c1c-c1cComment def-Comment def-Syntax'>// если 1, то закрываем счет-фактуру</span>
749: 
