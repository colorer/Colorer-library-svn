<html><body style='color:#000000; background:#ffffff; '><pre>
  0: <span style='color:#800000; font-weight:bold; '>Перем</span> НДС19_1<span style='color:#808030; '>,</span> НДС19_2<span style='color:#808030; '>,</span> НДС19_3<span style='color:#808030; '>,</span> НДС19_4<span style='color:#808030; '>,</span> НДС19_5<span style='color:#808030; '>,</span> НДС19_6<span style='color:#808030; '>,</span> НДС19_7<span style='color:#808030; '>;</span>
  1: <span style='color:#800000; font-weight:bold; '>Перем</span> Док<span style='color:#808030; '>;</span>
  2: <span style='color:#800000; font-weight:bold; '>Перем</span> ФлагЗакрСчФ<span style='color:#808030; '>;</span>
  3: 
  4: <span style='color:#696969; '>// оРегВЗ = рассчитанный объект "Регистр.Взаиморасчеты"</span>
  5: <span style='color:#696969; '>// К - коэффициент закрытия СчФ</span>
  6: <span style='color:#696969; '>// Возвращает сумму, на которую была закрыта СчФ</span>
  7: <span style='color:#800000; font-weight:bold; '>Функция</span> ЗакрытьСчетФактуруБезВозвращенных<span style='color:#808030; '>(</span> оРегВЗ<span style='color:#808030; '>,</span> СчФ<span style='color:#808030; '>,</span> К<span style='color:#808030; '>,</span> ТаблицаВозврата <span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Экспорт</span>
  8:     <span style='color:#800000; font-weight:bold; '>Состояние</span><span style='color:#808030; '>(</span> <span style='color:#0000e6; '>"Закрываем счет фактуру &lt;"</span><span style='color:#808030; '>+</span>СчФ<span style='color:#808030; '>+</span><span style='color:#0000e6; '>"> с коэффициентом "</span><span style='color:#808030; '>+</span>К <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
  9:     КомСчФОтгрузки <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"По СчФ &lt;"</span><span style='color:#808030; '>+</span>СчФ<span style='color:#808030; '>+</span><span style='color:#0000e6; '>"> (оплата)"</span><span style='color:#808030; '>;</span>
 10: 
 11:     ОбщаяСуммаОплаты <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
 12:     СчФ<span style='color:#008c00; '>.</span>ВыбратьСтроки<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 13:     <span style='color:#800000; font-weight:bold; '>Пока</span> СчФ<span style='color:#008c00; '>.</span>ПолучитьСтроку<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Цикл</span>
 14:         НомСтр <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
 15:         <span style='color:#800000; font-weight:bold; '>Если</span> ТаблицаВозврата<span style='color:#008c00; '>.</span>НайтиЗначение<span style='color:#808030; '>(</span> СчФ<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>,</span> НомСтр<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"Наименование"</span> <span style='color:#808030; '>)</span> <span style='color:#808030; '>></span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
 16:             ТаблицаВозврата<span style='color:#008c00; '>.</span>ПолучитьСтрокуПоНомеру<span style='color:#808030; '>(</span> НомСтр <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 17:             <span style='color:#800000; font-weight:bold; '>Если</span> ТаблицаВозврата<span style='color:#008c00; '>.</span>БылИзлишекОплаты <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
 18:                 <span style='color:#800000; font-weight:bold; '>Продолжить</span><span style='color:#808030; '>;</span>
 19:             <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
 20:             вСумма <span style='color:#808030; '>=</span> ТаблицаВозврата<span style='color:#008c00; '>.</span>Сумма<span style='color:#808030; '>;</span>
 21:             вНДС <span style='color:#808030; '>=</span> ТаблицаВозврата<span style='color:#008c00; '>.</span>НДС<span style='color:#808030; '>;</span>
 22:             вКолич <span style='color:#808030; '>=</span> ТаблицаВозврата<span style='color:#008c00; '>.</span>Количество<span style='color:#808030; '>;</span>
 23:             вЕдиница <span style='color:#808030; '>=</span> ТаблицаВозврата<span style='color:#008c00; '>.</span>Единица<span style='color:#808030; '>;</span>
 24:             КоэфЕд <span style='color:#808030; '>=</span> КоэфЕдИзмерения<span style='color:#808030; '>(</span> Единица<span style='color:#808030; '>,</span> СчФ<span style='color:#008c00; '>.</span>Наименование<span style='color:#008c00; '>.</span>БазоваяЕдиница <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 25:             вКолич <span style='color:#808030; '>=</span> вКолич <span style='color:#808030; '>*</span> КоэфЕд<span style='color:#808030; '>;</span>
 26:         <span style='color:#800000; font-weight:bold; '>Иначе</span>
 27:             вСумма <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span> вНДС <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span> вКолич <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span> 
 28:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
 29: 
 30:         оРегВЗ<span style='color:#008c00; '>.</span>СводныеОстатки<span style='color:#808030; '>(</span> СчФ<span style='color:#008c00; '>.</span>Клиент<span style='color:#808030; '>,</span> СчФ<span style='color:#808030; '>,</span> СчФ<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>,</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 31:         ДолгСумма <span style='color:#808030; '>=</span> оРегВЗ<span style='color:#008c00; '>.</span>Сумма <span style='color:#808030; '>-</span> вСумма<span style='color:#808030; '>;</span>
 32:         <span style='color:#800000; font-weight:bold; '>Если</span> вСумма <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>></span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
 33:             <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Долг по возвращаемому наименованию &lt;"</span><span style='color:#808030; '>+</span>СчФ<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>+</span><span style='color:#0000e6; '>"> составляет "</span><span style='color:#808030; '>+</span>ДолгСумма<span style='color:#808030; '>+</span><span style='color:#0000e6; '>"("</span><span style='color:#808030; '>+</span>оРегВЗ<span style='color:#008c00; '>.</span>Сумма<span style='color:#808030; '>+</span><span style='color:#0000e6; '>" - "</span><span style='color:#808030; '>+</span>вСумма<span style='color:#808030; '>+</span><span style='color:#0000e6; '>")"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"i"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 34:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
 35:         <span style='color:#800000; font-weight:bold; '>Если</span> ДолгСумма <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
 36:             <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Долг по возвращаемому наименованию &lt;"</span><span style='color:#808030; '>+</span>СчФ<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>+</span><span style='color:#0000e6; '>"> отритцателен: "</span><span style='color:#808030; '>+</span>ДолгСумма<span style='color:#808030; '>+</span><span style='color:#0000e6; '>"("</span><span style='color:#808030; '>+</span>оРегВЗ<span style='color:#008c00; '>.</span>Сумма<span style='color:#808030; '>+</span><span style='color:#0000e6; '>" - "</span><span style='color:#808030; '>+</span>вСумма<span style='color:#808030; '>+</span><span style='color:#0000e6; '>")"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"!!!"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 37:             <span style='color:#800000; font-weight:bold; '>Возврат</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
 38:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
 39:         ДолгНДС <span style='color:#808030; '>=</span> оРегВЗ<span style='color:#008c00; '>.</span>Сумма <span style='color:#808030; '>-</span> вНДС<span style='color:#808030; '>;</span>
 40:         ДолгКолич <span style='color:#808030; '>=</span> оРегВЗ<span style='color:#008c00; '>.</span>Количество <span style='color:#808030; '>-</span> вКолич<span style='color:#808030; '>;</span>
 41: 
 42:         <span style='color:#800000; font-weight:bold; '>Если</span> ДолгСумма <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
 43:             <span style='color:#800000; font-weight:bold; '>Продолжить</span><span style='color:#808030; '>;</span>
 44:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
 45: 
 46:         КоэфЕд <span style='color:#808030; '>=</span> КоэфЕдИзмерения<span style='color:#808030; '>(</span> СчФ<span style='color:#008c00; '>.</span>Единица<span style='color:#808030; '>,</span> СчФ<span style='color:#008c00; '>.</span>Наименование<span style='color:#008c00; '>.</span>БазоваяЕдиница <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 47:         ДокКолич <span style='color:#808030; '>=</span> ДолгКолич <span style='color:#808030; '>*</span> К <span style='color:#808030; '>*</span> КоэфЕд<span style='color:#808030; '>;</span>
 48:         ДокСумма <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>Окр</span><span style='color:#808030; '>(</span> ДолгСумма <span style='color:#808030; '>*</span> К<span style='color:#808030; '>,</span> <span style='color:#008c00; '>5</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 49:         ДокНДС <span style='color:#808030; '>=</span> ДолгНДС <span style='color:#808030; '>*</span> К<span style='color:#808030; '>;</span>
 50: 
 51:         <span style='color:#800000; font-weight:bold; '>Если</span> ЭтоНашаПродукция<span style='color:#808030; '>(</span>СчФ<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
 52:             ОплатаПоРегиструГотПрод<span style='color:#808030; '>(</span> НомСтр<span style='color:#808030; '>,</span> СчФ<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>,</span> ДокКолич<span style='color:#808030; '>,</span> ДокСумма<span style='color:#808030; '>-</span>ДокНдс<span style='color:#808030; '>,</span> Регистр<span style='color:#008c00; '>.</span>ГотоваяПродукция <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 53:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
 54: 
 55:         Регистр<span style='color:#008c00; '>.</span>Взаиморасчеты<span style='color:#008c00; '>.</span>ПривязыватьСтроку<span style='color:#808030; '>(</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 56:         РасходРегВзСОбнул<span style='color:#808030; '>(</span> Регистр<span style='color:#008c00; '>.</span>Взаиморасчеты<span style='color:#808030; '>,</span> оРегВЗ<span style='color:#808030; '>,</span> СчФ<span style='color:#808030; '>,</span> СчФ<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>,</span>
 57:                            ДокСумма<span style='color:#808030; '>,</span> ДокНДС<span style='color:#808030; '>,</span> ДокКолич<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>
 58:                            вСумма<span style='color:#808030; '>,</span> вНДС<span style='color:#808030; '>,</span> вКолич <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 59:         ОбщаяСуммаОплаты <span style='color:#808030; '>=</span> ОбщаяСуммаОплаты <span style='color:#808030; '>+</span> ДокСумма<span style='color:#808030; '>;</span>
 60: 
 61:         <span style='color:#696969; '>// проводка по оплате</span>
 62:         СуммаПоОтгрЦене <span style='color:#808030; '>=</span> СчФ<span style='color:#008c00; '>.</span>Наименование<span style='color:#008c00; '>.</span>Прих_Цена<span style='color:#008c00; '>.</span>Получить<span style='color:#808030; '>(</span> ДокОсн<span style='color:#008c00; '>.</span>ДатаДок <span style='color:#808030; '>)</span> <span style='color:#808030; '>*</span> ДокКолич<span style='color:#808030; '>;</span>
 63:         Сч46 <span style='color:#808030; '>=</span> СчетРеализацииПоНаименованию<span style='color:#808030; '>(</span> СчФ<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>,</span> СчФ <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 64:         Проводка<span style='color:#808030; '>(</span> Операция<span style='color:#808030; '>,</span> Сч46<span style='color:#008c00; '>.</span>Код<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"45.2"</span><span style='color:#808030; '>,</span> СуммаПоОтгрЦене<span style='color:#808030; '>,</span> <span style='color:#808030; '>,</span> Клиент<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span> КомСчФОтгрузки<span style='color:#808030; '>,</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 65:         Сч76 <span style='color:#808030; '>=</span> <span style='color:#808030; '>?</span><span style='color:#808030; '>(</span> СчФ<span style='color:#008c00; '>.</span>НДС <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>></span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"76.12"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"76.11"</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 66:         Проводка<span style='color:#808030; '>(</span> Операция<span style='color:#808030; '>,</span> Сч76<span style='color:#808030; '>,</span> Сч46<span style='color:#008c00; '>.</span>Код<span style='color:#808030; '>,</span> ДокСумма<span style='color:#808030; '>,</span> Клиент<span style='color:#808030; '>,</span> Клиент<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span> КомСчФОтгрузки<span style='color:#808030; '>,</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 67:         <span style='color:#800000; font-weight:bold; '>Если</span> СчФ<span style='color:#008c00; '>.</span>НДС <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>></span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
 68:             Проводка<span style='color:#808030; '>(</span> Операция<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"76.12"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"68.2"</span><span style='color:#808030; '>,</span> ДокНДС<span style='color:#808030; '>,</span> Клиент<span style='color:#808030; '>,</span> <span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>ПлатежиВФонды<span style='color:#008c00; '>.</span>Взносы<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"НДС "</span><span style='color:#808030; '>+</span>КомСчФОтгрузки<span style='color:#808030; '>,</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 69:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
 70: 
 71:     <span style='color:#800000; font-weight:bold; '>КонецЦикла</span><span style='color:#808030; '>;</span>
 72:     <span style='color:#800000; font-weight:bold; '>Возврат</span> ОбщаяСуммаОплаты<span style='color:#808030; '>;</span>
 73: <span style='color:#800000; font-weight:bold; '>КонецФункции</span>
 74: 
 75: <span style='color:#800000; font-weight:bold; '>Процедура</span> НДСкВозмещению<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span>
 76:     <span style='color:#800000; font-weight:bold; '>Перем</span> хДок<span style='color:#808030; '>;</span>
 77:     <span style='color:#696969; '>//Попробуем найти оплату через банк;</span>
 78:     Платежка<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
 79:     СчСчф<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>                    <span style='color:#696969; '>//Счет или счет-фактура;</span>
 80:     хДок<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>СоздатьОбъект</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Документ.Платежка"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 81:     хДок<span style='color:#008c00; '>.</span>ОбратныйПорядок<span style='color:#808030; '>(</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 82:     хДок<span style='color:#008c00; '>.</span>ВыбратьДокументы<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"01.01.98"</span><span style='color:#808030; '>,</span>ДатаДок<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 83:     <span style='color:#696969; '>//Выбираем документы начиная с текущей даты назад</span>
 84:     <span style='color:#800000; font-weight:bold; '>Пока</span> хДок<span style='color:#008c00; '>.</span>ПолучитьДокумент<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Цикл</span>
 85:         <span style='color:#800000; font-weight:bold; '>Если</span> хДок<span style='color:#008c00; '>.</span>ТекущийДокумент<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span>.Проведен<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>  <span style='color:#696969; '>//?</span>
 86:             <span style='color:#800000; font-weight:bold; '>Продолжить</span><span style='color:#808030; '>;</span>
 87:             <span style='color:#696969; '>//** Возврат;</span>
 88:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
 89:         <span style='color:#800000; font-weight:bold; '>Если</span> <span style='color:#808030; '>(</span>хДок<span style='color:#008c00; '>.</span>Действие<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>=</span><span style='color:#0000e6; '>"Расчет с поставщиком"</span><span style='color:#808030; '>)</span> И
 90:         <span style='color:#808030; '>(</span>хДок<span style='color:#008c00; '>.</span>Клиент<span style='color:#808030; '>=</span>Клиент<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
 91:             хДок<span style='color:#008c00; '>.</span>ВыбратьСтроки<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
 92:             <span style='color:#800000; font-weight:bold; '>Пока</span> хДок<span style='color:#008c00; '>.</span>ПолучитьСтроку<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Цикл</span>
 93:                 <span style='color:#800000; font-weight:bold; '>Если</span> хДок<span style='color:#008c00; '>.</span>Счф<span style='color:#008c00; '>.</span>Сумма<span style='color:#808030; '>=</span>Итог<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Сумма"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
 94:                     СчСчф<span style='color:#808030; '>=</span>хДок<span style='color:#008c00; '>.</span>СчФ<span style='color:#808030; '>;</span>
 95:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
 96:             <span style='color:#800000; font-weight:bold; '>КонецЦикла</span><span style='color:#808030; '>;</span>
 97:             <span style='color:#800000; font-weight:bold; '>Если</span> СчСчФ<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
 98:                 <span style='color:#800000; font-weight:bold; '>Если</span> хДок<span style='color:#008c00; '>.</span>ПоСчФ<span style='color:#008c00; '>.</span>Выбран<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
 99:                     <span style='color:#800000; font-weight:bold; '>Если</span> хДок<span style='color:#008c00; '>.</span>ПоСчФ<span style='color:#008c00; '>.</span>Сумма<span style='color:#808030; '>=</span>Итог<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Сумма"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
100:                         СчСчф<span style='color:#808030; '>=</span>хДок<span style='color:#008c00; '>.</span>ПоСчФ<span style='color:#808030; '>;</span>
101:                     <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
102:                 <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> хДок<span style='color:#008c00; '>.</span>ПоСчету<span style='color:#008c00; '>.</span>Выбран<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
103:                     <span style='color:#800000; font-weight:bold; '>Если</span> хДок<span style='color:#008c00; '>.</span>ПоСчету<span style='color:#008c00; '>.</span>Сумма<span style='color:#808030; '>=</span>Итог<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Сумма"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
104:                         СчСчф<span style='color:#808030; '>=</span>хДок<span style='color:#008c00; '>.</span>ПоСчету<span style='color:#808030; '>;</span>
105:                     <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
106:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
107:             <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
108:             <span style='color:#800000; font-weight:bold; '>Если</span> СчСчф<span style='color:#808030; '>&lt;</span><span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
109:                 Платежка<span style='color:#808030; '>=</span>хДок<span style='color:#008c00; '>.</span>ТекущийДокумент<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
110:                 Оп<span style='color:#808030; '>=</span>Платежка<span style='color:#008c00; '>.</span>Операция<span style='color:#808030; '>;</span>
111:                 Оп<span style='color:#008c00; '>.</span>ВыбратьПроводки<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>  <span style='color:#696969; '>//Обращение к проводкам платежки</span>
112:                 <span style='color:#800000; font-weight:bold; '>Пока</span> Оп<span style='color:#008c00; '>.</span>ПолучитьПроводку<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Цикл</span>
113:                     <span style='color:#800000; font-weight:bold; '>Если</span> Оп<span style='color:#008c00; '>.</span>Дебет<span style='color:#008c00; '>.</span>Счет<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>СчетПоКоду</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"68.2"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
114:                         <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>    <span style='color:#696969; '>// Если в платежке уже есть проводки по возмещению,</span>
115:                     <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>          <span style='color:#696969; '>// Дт68-Кт19, тогда делаем выход из процедуры</span>
116:                 <span style='color:#800000; font-weight:bold; '>КонецЦикла</span><span style='color:#808030; '>;</span>
117:                 <span style='color:#800000; font-weight:bold; '>Прервать</span><span style='color:#808030; '>;</span>
118:             <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
119:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
120:     <span style='color:#800000; font-weight:bold; '>КонецЦикла</span><span style='color:#808030; '>;</span>
121:     <span style='color:#800000; font-weight:bold; '>Если</span> Платежка<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
122:         <span style='color:#696969; '>//              Сообщить("Не найдена платежка, сделанная по счету или по счет-фактуре на ту же сумму, что и накладная "</span>
123:         <span style='color:#696969; '>//              +РазделительСтрок+"Проводки по возмещению НДС не сделаны.");</span>
124:         <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
125:     <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
126: 
127:     НДС19_1 <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span> НДС19_2 <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span> НДС19_3 <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span> НДС19_4 <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
128:     НДС19_5 <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span> НДС19_6 <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span> НДС19_7 <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
129:     <span style='color:#696969; '>//Найдем суммы НДС, выделенные на 19 счет по накладной</span>
130: 
131:     ВыбратьСтроки<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
132:     <span style='color:#800000; font-weight:bold; '>Пока</span> ПолучитьСтроку<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Цикл</span>
133:         <span style='color:#800000; font-weight:bold; '>Если</span> <span style='color:#808030; '>(</span>Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"ОС"</span><span style='color:#808030; '>)</span>  <span style='color:#800000; font-weight:bold; '>Тогда</span>
134:             <span style='color:#800000; font-weight:bold; '>Если</span> <span style='color:#007997; '>Константа</span><span style='color:#008c00; '>.</span>ЛьготаПоНДС<span style='color:#808030; '>=</span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>Булево<span style='color:#008c00; '>.</span>Да   <span style='color:#800000; font-weight:bold; '>Тогда</span>
135:                 НДС19_1 <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>     <span style='color:#696969; '>//</span>
136:             <span style='color:#800000; font-weight:bold; '>Иначе</span>
137:                 НДС19_1 <span style='color:#808030; '>=</span> НДС19_1 <span style='color:#808030; '>+</span> НДС<span style='color:#808030; '>;</span>
138:             <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
139:         <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> <span style='color:#808030; '>(</span>Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"Комплектация"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
140:             НДС19_1 <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>         <span style='color:#696969; '>//Здесь возмещение не должно быть</span>
141:         <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"НМА"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
142:             НДС19_2 <span style='color:#808030; '>=</span> НДС19_2 <span style='color:#808030; '>+</span> НДС<span style='color:#808030; '>;</span>
143:         <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> <span style='color:#808030; '>(</span>Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"Материалы"</span><span style='color:#808030; '>)</span> ИЛИ <span style='color:#808030; '>(</span>Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"Полуфабрикат"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
144:             НДС19_3 <span style='color:#808030; '>=</span> НДС19_3 <span style='color:#808030; '>+</span> НДС<span style='color:#808030; '>;</span>
145:         <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"МБП"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
146:             НДС19_4 <span style='color:#808030; '>=</span> НДС19_4 <span style='color:#808030; '>+</span> НДС<span style='color:#808030; '>;</span>
147:         <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"УслугиПолуч"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
148:             НДС19_5 <span style='color:#808030; '>=</span> НДС19_5 <span style='color:#808030; '>+</span> НДС<span style='color:#808030; '>;</span>
149:         <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"Товары"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
150:             НДС19_6 <span style='color:#808030; '>=</span> НДС19_6 <span style='color:#808030; '>+</span> НДС<span style='color:#808030; '>;</span>
151:         <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"РасходыБудущПериода"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
152:             НДС19_7 <span style='color:#808030; '>=</span> НДС19_7 <span style='color:#808030; '>+</span> НДС<span style='color:#808030; '>;</span>
153:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
154:     <span style='color:#800000; font-weight:bold; '>КонецЦикла</span><span style='color:#808030; '>;</span>
155:     <span style='color:#696969; '>//Найдем суммы НДС, подлежащие возмещению ( оплаченный НДС )</span>
156:     <span style='color:#800000; font-weight:bold; '>Если</span> Платежка<span style='color:#008c00; '>.</span>Сумма<span style='color:#808030; '>/</span>Итог<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Сумма"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
157:         К <span style='color:#808030; '>=</span> Платежка<span style='color:#008c00; '>.</span>Сумма<span style='color:#808030; '>/</span>Итог<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Сумма"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>    <span style='color:#696969; '>//Коэффициент "оплаты", если накл. вся оплачена К=1.</span>
158:     <span style='color:#800000; font-weight:bold; '>Иначе</span>
159:         К <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
160:     <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
161: 
162:     <span style='color:#696969; '>//Проводки по возмещению НДС</span>
163:     <span style='color:#800000; font-weight:bold; '>Если</span> НДС19_1<span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
164:         Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"68.2"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"19.1"</span><span style='color:#808030; '>,</span>НДС19_1<span style='color:#808030; '>*</span>К<span style='color:#808030; '>,</span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>ПлатежиВФонды<span style='color:#008c00; '>.</span>Взносы<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"Возмещ.НДС"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
165:     <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
166:     <span style='color:#800000; font-weight:bold; '>Если</span> НДС19_2<span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
167:         Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"68.2"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"19.2"</span><span style='color:#808030; '>,</span>НДС19_2<span style='color:#808030; '>*</span>К<span style='color:#808030; '>,</span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>ПлатежиВФонды<span style='color:#008c00; '>.</span>Взносы<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"Возмещ.НДС"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
168:     <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
169:     <span style='color:#800000; font-weight:bold; '>Если</span> НДС19_3<span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
170:         Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"68.2"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"19.3"</span><span style='color:#808030; '>,</span>НДС19_3<span style='color:#808030; '>*</span>К<span style='color:#808030; '>,</span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>ПлатежиВФонды<span style='color:#008c00; '>.</span>Взносы<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"Возмещ.НДС"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
171:     <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
172:     <span style='color:#800000; font-weight:bold; '>Если</span> НДС19_4<span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
173:         Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"68.2"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"19.4"</span><span style='color:#808030; '>,</span>НДС19_4<span style='color:#808030; '>*</span>К<span style='color:#808030; '>,</span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>ПлатежиВФонды<span style='color:#008c00; '>.</span>Взносы<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"Возмещ.НДС"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
174:     <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
175:     <span style='color:#800000; font-weight:bold; '>Если</span> НДС19_5<span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
176:         Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"68.2"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"19.5"</span><span style='color:#808030; '>,</span>НДС19_5<span style='color:#808030; '>*</span>К<span style='color:#808030; '>,</span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>ПлатежиВФонды<span style='color:#008c00; '>.</span>Взносы<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"Возмещ.НДС"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
177:     <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
178:     <span style='color:#800000; font-weight:bold; '>Если</span> НДС19_6<span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
179:         Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"68.2"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"19.6"</span><span style='color:#808030; '>,</span>НДС19_6<span style='color:#808030; '>*</span>К<span style='color:#808030; '>,</span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>ПлатежиВФонды<span style='color:#008c00; '>.</span>Взносы<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"Возмещ.НДС"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
180:     <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
181:     <span style='color:#800000; font-weight:bold; '>Если</span> НДС19_7<span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
182:         Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"68.2"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"19.7"</span><span style='color:#808030; '>,</span>НДС19_7<span style='color:#808030; '>*</span>К<span style='color:#808030; '>,</span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>ПлатежиВФонды<span style='color:#008c00; '>.</span>Взносы<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"Возмещ.НДС"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
183:     <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
184: <span style='color:#800000; font-weight:bold; '>КонецПроцедуры</span> <span style='color:#696969; '>// НДСкВозмещению()</span>
185: 
186: <span style='color:#696969; '>// ************************* THE MAIN PART **********************************</span>
187: 
188: <span style='color:#800000; font-weight:bold; '>Процедура</span> ОбработкаПроведения<span style='color:#808030; '>(</span> Зн <span style='color:#808030; '>)</span>
189: 
190:     <span style='color:#800000; font-weight:bold; '>Перем</span> СчетКт<span style='color:#808030; '>,</span> СубСч10<span style='color:#808030; '>,</span> БИ<span style='color:#808030; '>,</span> Спр<span style='color:#808030; '>,</span> Инд<span style='color:#808030; '>;</span>
191:     <span style='color:#800000; font-weight:bold; '>Перем</span> УсреднятьЦену<span style='color:#808030; '>,</span> СпсЦен<span style='color:#808030; '>,</span> хЭлемент<span style='color:#808030; '>,</span> СрЦена<span style='color:#808030; '>,</span> СуммаПроводки<span style='color:#808030; '>;</span>
192: 
193:     <span style='color:#800000; font-weight:bold; '>Если</span> ПроведеноРуками<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>тогда</span>
194:         ТаблицаДляВыбора <span style='color:#808030; '>=</span> ПредоплатаПоставщику<span style='color:#808030; '>(</span>Контекст<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
195:     <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
196: 
197:     <span style='color:#800000; font-weight:bold; '>Состояние</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Очистка движений..."</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
198:     ОчиститьДвижения<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
199: 
200:     <span style='color:#800000; font-weight:bold; '>Если</span> <span style='color:#808030; '>(</span>Действие<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>=</span><span style='color:#0000e6; '>"Закупка"</span><span style='color:#808030; '>)</span>
201:          ИЛИ <span style='color:#808030; '>(</span>Действие<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>=</span><span style='color:#0000e6; '>"В уставной фонд"</span><span style='color:#808030; '>)</span>
202:          ИЛИ <span style='color:#808030; '>(</span>Действие<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>=</span><span style='color:#0000e6; '>"Импорт"</span><span style='color:#808030; '>)</span>
203:     <span style='color:#800000; font-weight:bold; '>Тогда</span>
204:         ПапкаФизЛица<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>СоздатьОбъект</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Справочник.Клиенты"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
205:         <span style='color:#800000; font-weight:bold; '>Если</span> ПапкаФизЛица<span style='color:#008c00; '>.</span>НайтиПоНаименованию<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Физические лица"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>тогда</span>
206:             <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Не найдена группа &lt;Физические лица> !!!"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
207:             <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span><span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
208:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
209: 
210:         Спр <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>СоздатьОбъект</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Справочник.Клиенты"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
211:         Спр<span style='color:#008c00; '>.</span>НайтиПоКоду<span style='color:#808030; '>(</span>Клиент<span style='color:#008c00; '>.</span>ПолныйКод<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
212:         БИ <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>СоздатьОбъект</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"БухгалтерскиеИтоги"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
213:         БИ<span style='color:#008c00; '>.</span>ИспользоватьПланСчетов<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>ВыбранныйПланСчетов</span><span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
214:         БИ<span style='color:#008c00; '>.</span>ИспользоватьСубконто<span style='color:#808030; '>(</span>ВидыСубконто<span style='color:#008c00; '>.</span>Контрагенты<span style='color:#808030; '>,</span>Спр<span style='color:#008c00; '>.</span>ТекущийЭлемент<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
215:         <span style='color:#800000; font-weight:bold; '>Состояние</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Рассчет итогов"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
216:         БИ<span style='color:#008c00; '>.</span>Рассчитать<span style='color:#808030; '>(</span> <span style='color:#800000; font-weight:bold; '>НачМесяца</span><span style='color:#808030; '>(</span>ДатаДок<span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> ДатаДок<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"61"</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
217:         БИ<span style='color:#008c00; '>.</span>ВыполнитьЗапрос<span style='color:#808030; '>(</span> <span style='color:#800000; font-weight:bold; '>НачМесяца</span><span style='color:#808030; '>(</span>ДатаДок<span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> ДатаДок<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"61"</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
218:         СК61 <span style='color:#808030; '>=</span> БИ<span style='color:#008c00; '>.</span>СКД<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
219:         <span style='color:#800000; font-weight:bold; '>Если</span> СК61<span style='color:#808030; '>&lt;</span><span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>   <span style='color:#696969; '>// закрываем выданные авансы</span>
220:             <span style='color:#800000; font-weight:bold; '>Если</span> СК61<span style='color:#808030; '>&lt;</span>Итог<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Сумма"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
221:                 Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"60.1"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"61"</span><span style='color:#808030; '>,</span>СК61<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"Погашение аванса"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
222:             <span style='color:#800000; font-weight:bold; '>Иначе</span>
223:                 Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"60.1"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"61"</span><span style='color:#808030; '>,</span>Итог<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Сумма"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"Погашение аванса"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
224:             <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
225:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
226:         <span style='color:#800000; font-weight:bold; '>Если</span> <span style='color:#808030; '>(</span>Действие<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>=</span><span style='color:#0000e6; '>"Закупка"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
227:             СчетКт <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"60.1"</span><span style='color:#808030; '>;</span>
228:             <span style='color:#696969; '>//** 24.08.00 Суммовая разница</span>
229:             <span style='color:#800000; font-weight:bold; '>Если</span> Валюта<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>&lt;</span><span style='color:#808030; '>></span><span style='color:#0000e6; '>"Рубль"</span> <span style='color:#800000; font-weight:bold; '>тогда</span>
230:                 ПУ<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>СоздатьОбъект</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Справочник.ПрибылиУбытки"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
231:                 <span style='color:#800000; font-weight:bold; '>Если</span> ПУ<span style='color:#008c00; '>.</span>НайтиПоНаименованию<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"СуммоваяРазница"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>тогда</span>
232:                     <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Субконто "</span><span style='color:#0000e6; '>"СуммоваяРазница"</span><span style='color:#0000e6; '>" не обнаружено!!!"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
233:                     <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span><span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
234:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
235:                 Тбл<span style='color:#808030; '>=</span>ТаблицаДляВыбора<span style='color:#808030; '>;</span>
236:                 Тбл<span style='color:#008c00; '>.</span>ВыбратьСтроки<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
237:                 <span style='color:#800000; font-weight:bold; '>Пока</span> Тбл<span style='color:#008c00; '>.</span>ПолучитьСтроку<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>цикл</span>
238:                     <span style='color:#800000; font-weight:bold; '>Если</span> Тбл<span style='color:#008c00; '>.</span>Метка<span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>тогда</span>
239:                         <span style='color:#800000; font-weight:bold; '>Если</span> Валюта<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>=</span>Тбл<span style='color:#008c00; '>.</span>Документ<span style='color:#008c00; '>.</span>Валюта<span style='color:#008c00; '>.</span>Наименование <span style='color:#800000; font-weight:bold; '>тогда</span>
240:                             КК<span style='color:#808030; '>=</span>Валюта<span style='color:#008c00; '>.</span>Текущ_курс<span style='color:#008c00; '>.</span>Получить<span style='color:#808030; '>(</span>ДатаНакладной<span style='color:#808030; '>)</span><span style='color:#808030; '>/</span>Валюта<span style='color:#008c00; '>.</span>Текущ_курс<span style='color:#008c00; '>.</span>Получить<span style='color:#808030; '>(</span>Тбл<span style='color:#008c00; '>.</span>Документ<span style='color:#008c00; '>.</span>ДатаДок<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
241:                             КРазница<span style='color:#808030; '>=</span><span style='color:#808030; '>(</span>КК<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#808030; '>*</span>Тбл<span style='color:#008c00; '>.</span>Сумма<span style='color:#808030; '>;</span>
242:                             <span style='color:#800000; font-weight:bold; '>Если</span> кк<span style='color:#808030; '>&lt;</span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>тогда</span>
243:                                 <span style='color:#696969; '>//Проводка(Операция,Дт=0,Кт=0,Сумма,СубкДт1=0,СубкКт1=0,Журнал="",Коментарий="",Количество=0,СубкДт2=0,СубкКт2=0,Пл=0) Экспорт</span>
244:                                 Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"60.1"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"80"</span><span style='color:#808030; '>,</span>КРазница<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span>ПУ<span style='color:#008c00; '>.</span>ТекущийЭлемент<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
245:                             <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> кк<span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>тогда</span>
246:                                 Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"80"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"60.1"</span><span style='color:#808030; '>,</span>КРазница<span style='color:#808030; '>,</span>ПУ<span style='color:#008c00; '>.</span>ТекущийЭлемент<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
247:                             <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
248:                         <span style='color:#800000; font-weight:bold; '>Иначе</span>
249:                             <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Несовпадение валют!!!"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
250:                             <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span><span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
251:                         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
252:                     <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
253:                 <span style='color:#800000; font-weight:bold; '>КонецЦикла</span><span style='color:#808030; '>;</span>
254:             <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
255:             <span style='color:#696969; '>//**>></span>
256: 
257:         <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> <span style='color:#808030; '>(</span>Действие<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>=</span><span style='color:#0000e6; '>"В уставной фонд"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
258:             СчетКт <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"75.1"</span><span style='color:#808030; '>;</span>
259:         <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> <span style='color:#808030; '>(</span>Действие<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>=</span><span style='color:#0000e6; '>"Импорт"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
260:             СчетКт <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"60.2"</span><span style='color:#808030; '>;</span>
261:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
262:         СубкКт<span style='color:#808030; '>=</span>Клиент<span style='color:#808030; '>;</span>
263:         УсреднятьЦену<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
264:         <span style='color:#696969; '>//** Двинем регистрами по Поставщикам</span>
265:         <span style='color:#696969; '>//Сообщить("Ну не я это,");</span>
266:         Сум<span style='color:#808030; '>=</span>Итог<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Сумма"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
267:         Сумм<span style='color:#808030; '>=</span>Сум<span style='color:#808030; '>;</span>
268:         <span style='color:#696969; '>//** 61-(51)</span>
269:         Пред<span style='color:#808030; '>=</span>РасходПредоплатыПоставщику<span style='color:#808030; '>(</span>Контекст<span style='color:#808030; '>,</span>Сум<span style='color:#808030; '>,</span>Регистр<span style='color:#008c00; '>.</span>ПредоплатаПоставщикам<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
270:         <span style='color:#696969; '>//** Теперь сум = тому что осталось от долга ПОСЛЕ предоплаты</span>
271:         <span style='color:#800000; font-weight:bold; '>Если</span> пред<span style='color:#808030; '>&lt;</span><span style='color:#808030; '>></span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>тогда</span>
272:             <span style='color:#696969; '>//** (10)-60</span>
273:             ДвинутьДолгПоставщику<span style='color:#808030; '>(</span>Контекст<span style='color:#808030; '>,</span>ТекущийДокумент<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>Сумм<span style='color:#808030; '>,</span>Регистр<span style='color:#008c00; '>.</span>РассчетыСПоставщиками<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
274:             <span style='color:#696969; '>//** 60-61</span>
275:             ДвинутьДолгПоставщику<span style='color:#808030; '>(</span>Контекст<span style='color:#808030; '>,</span>ТекущийДокумент<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>Сумм<span style='color:#808030; '>-</span>Сум<span style='color:#808030; '>,</span>Регистр<span style='color:#008c00; '>.</span>РассчетыСПоставщиками<span style='color:#808030; '>,</span>Пред<span style='color:#808030; '>,</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span><span style='color:#696969; '>//Расход</span>
276:         <span style='color:#800000; font-weight:bold; '>Иначе</span>
277:             <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
278:             <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
279:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
280: 
281:         ВыбратьСтроки<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
282:         <span style='color:#800000; font-weight:bold; '>Пока</span> ПолучитьСтроку<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Цикл</span>
283:             <span style='color:#800000; font-weight:bold; '>Если</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"УслугиПолуч"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
284:                 <span style='color:#696969; '>//** 10.09.00   Авторские</span>
285:                 СчетКт1<span style='color:#808030; '>=</span>СчетКт<span style='color:#808030; '>;</span>
286:                 <span style='color:#696969; '>//                Если Клиент.ПринадлежитГруппе(ПапкаФизЛица)=1 тогда</span>
287:                 <span style='color:#696969; '>//                  СчетКт="73.5";</span>
288:                 <span style='color:#696969; '>//                КонецЕсли;</span>
289:                 <span style='color:#696969; '>//**>></span>
290:                 <span style='color:#800000; font-weight:bold; '>Если</span> ПроводкиПоСписанию<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span>Контекст<span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span><span style='color:#808030; '>(</span>Сумма<span style='color:#808030; '>-</span>НДС<span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>СубкКт<span style='color:#808030; '>)</span> <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>></span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
291:                     <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
292:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
293:                 <span style='color:#800000; font-weight:bold; '>Если</span> НДС<span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
294:                     Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"19.5"</span><span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span>НДС<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span>СубкКт<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"Начисление НДС"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
295:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
296:                 СчетКт<span style='color:#808030; '>=</span>СчетКт1<span style='color:#808030; '>;</span>
297:             <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"Материалы"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
298:                 УсреднятьЦену<span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
299:                 СубСч10 <span style='color:#808030; '>=</span> глСубСчет10<span style='color:#808030; '>(</span> Наименование <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
300:                 Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span>СубСч10<span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>-</span>НДС<span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span>Количество<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
301:                 <span style='color:#800000; font-weight:bold; '>Если</span> НДС<span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
302:                     Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"19.3"</span><span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span>НДС<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
303:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
304:                 <span style='color:#696969; '>//Условие оприходования МБП</span>
305:             <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"МБП"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
306:                 УсреднятьЦену<span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
307:                 <span style='color:#800000; font-weight:bold; '>Если</span> Склад<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>=</span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>ВидСклада<span style='color:#008c00; '>.</span>Основной <span style='color:#800000; font-weight:bold; '>Тогда</span>
308:                     Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"12.1"</span><span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>-</span>НДС<span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span>Количество<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
309:                 <span style='color:#800000; font-weight:bold; '>Иначе</span>
310:                     Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"12.2"</span><span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>-</span>НДС<span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span>Количество<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
311:                     <span style='color:#800000; font-weight:bold; '>Если</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>Сумма<span style='color:#808030; '>-</span>НДС<span style='color:#808030; '>)</span><span style='color:#808030; '>/</span>Количество<span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>Число</span><span style='color:#808030; '>(</span><span style='color:#007997; '>Константа</span><span style='color:#008c00; '>.</span>МинимальнаяЗарплата<span style='color:#008c00; '>.</span>Получить<span style='color:#808030; '>(</span>ДатаДок<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>*</span><span style='color:#008c00; '>100</span><span style='color:#808030; '>/</span><span style='color:#008c00; '>20</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
312:                         ОК <span style='color:#808030; '>=</span> ПроводкиПоСписанию<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span>Контекст<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"13"</span><span style='color:#808030; '>,</span><span style='color:#808030; '>(</span>Сумма<span style='color:#808030; '>-</span>НДС<span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
313:                     <span style='color:#800000; font-weight:bold; '>Иначе</span>
314:                         ОК <span style='color:#808030; '>=</span> ПроводкиПоСписанию<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span>Контекст<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"13"</span><span style='color:#808030; '>,</span><span style='color:#808030; '>(</span>Сумма<span style='color:#808030; '>-</span>НДС<span style='color:#808030; '>)</span><span style='color:#808030; '>/</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
315:                     <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
316:                     <span style='color:#800000; font-weight:bold; '>Если</span> ОК <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>></span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
317:                         <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
318:                     <span style='color:#800000; font-weight:bold; '>КонецЕсли</span>
319:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
320:                 <span style='color:#800000; font-weight:bold; '>Если</span> НДС<span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
321:                     Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"19.4"</span><span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span>НДС<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
322:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>      <span style='color:#696969; '>//Конец условия оприходования МБП</span>
323:                 <span style='color:#696969; '>//Условие оприходования НМА</span>
324:             <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> <span style='color:#808030; '>(</span>Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"Товары"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
325:                 УсреднятьЦену<span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
326:                 <span style='color:#800000; font-weight:bold; '>Если</span> Склад<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>=</span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>ВидСклада<span style='color:#008c00; '>.</span>Основной <span style='color:#800000; font-weight:bold; '>Тогда</span>
327:                     Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"41.1"</span><span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>-</span>НДС<span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span>Количество<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
328:                     <span style='color:#800000; font-weight:bold; '>Если</span> НДС<span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
329:                         Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"19.6"</span><span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span>НДС<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
330:                     <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
331:                 <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Склад<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>=</span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>ВидСклада<span style='color:#008c00; '>.</span>Розничный <span style='color:#800000; font-weight:bold; '>Тогда</span>
332:                     Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"41.2"</span><span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span>Количество<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
333:                 <span style='color:#800000; font-weight:bold; '>Иначе</span>
334:                     <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Выберите для оприходования товара "</span><span style='color:#808030; '>+</span>Наименование<span style='color:#008c00; '>.</span>Наименование
335:                     <span style='color:#808030; '>+</span><span style='color:#0000e6; '>" оптовый или розничный склад. Строка "</span><span style='color:#808030; '>+</span><span style='color:#007997; '>НомерСтроки</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
336: 
337:                     <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
338:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
339:             <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"НМА"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
340:                 <span style='color:#696969; '>//Условие оприходования НМА     на забалансовый счет</span>
341:                 <span style='color:#800000; font-weight:bold; '>Если</span> <span style='color:#808030; '>(</span>Наименование<span style='color:#008c00; '>.</span>Родитель<span style='color:#008c00; '>.</span>ПолныйКод<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"28"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
342:                     Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"006"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"010"</span><span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>-</span>НДС<span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span>Количество<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
343:                     <span style='color:#800000; font-weight:bold; '>Если</span> ПроводкиПоСписанию<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span>Контекст<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"60.1"</span><span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>-</span>НДС<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>></span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
344:                         <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
345:                     <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
346:                 <span style='color:#800000; font-weight:bold; '>Иначе</span>
347:                     Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"04"</span><span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>-</span>НДС<span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span>Количество<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
348:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
349: 
350:                 <span style='color:#800000; font-weight:bold; '>Если</span> НДС<span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
351:                     Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"19.2"</span><span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span>НДС<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
352:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>      <span style='color:#696969; '>//Конец условия оприходования НМА</span>
353:             <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"РасходыБудущПериода"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
354:                 Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"31"</span><span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>-</span>НДС<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
355:                 <span style='color:#800000; font-weight:bold; '>Если</span> НДС<span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
356:                     Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"19.7"</span><span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span>НДС<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
357:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
358:             <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"Комплектация"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
359:                 Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"07.1"</span><span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>-</span>НДС<span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span>Количество<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
360:                 <span style='color:#800000; font-weight:bold; '>Если</span> НДС<span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
361:                     Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"19.1"</span><span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span>НДС<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
362:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
363:             <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"ОС"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
364:                 <span style='color:#800000; font-weight:bold; '>Если</span> Наименование<span style='color:#008c00; '>.</span>Статус<span style='color:#808030; '>=</span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>СтатусОС<span style='color:#008c00; '>.</span>Собственное <span style='color:#800000; font-weight:bold; '>Тогда</span>
365:                     <span style='color:#800000; font-weight:bold; '>Если</span> <span style='color:#007997; '>Константа</span><span style='color:#008c00; '>.</span>ЛьготаПоНДС<span style='color:#808030; '>=</span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>Булево<span style='color:#008c00; '>.</span>Да <span style='color:#800000; font-weight:bold; '>Тогда</span>
366:                         Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"01.1"</span><span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span>Количество<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
367:                         <span style='color:#800000; font-weight:bold; '>Если</span> Наименование<span style='color:#008c00; '>.</span>НачИзнос<span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
368:                             Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"02.1"</span><span style='color:#808030; '>,</span>Наименование<span style='color:#008c00; '>.</span>НачИзнос<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
369:                         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
370:                     <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> <span style='color:#007997; '>Константа</span><span style='color:#008c00; '>.</span>ЛьготаПоНДС<span style='color:#808030; '>=</span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>Булево<span style='color:#008c00; '>.</span>Нет <span style='color:#800000; font-weight:bold; '>Тогда</span>
371:                         Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"01.1"</span><span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>-</span>НДС<span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span>Количество<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
372:                         <span style='color:#800000; font-weight:bold; '>Если</span> Наименование<span style='color:#008c00; '>.</span>НачИзнос<span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
373:                             Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"02.1"</span><span style='color:#808030; '>,</span>Наименование<span style='color:#008c00; '>.</span>НачИзнос<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
374:                         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
375:                         <span style='color:#800000; font-weight:bold; '>Если</span> НДС<span style='color:#808030; '>></span><span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
376:                             Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"19.1"</span><span style='color:#808030; '>,</span>СчетКт<span style='color:#808030; '>,</span>НДС<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
377:                         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
378:                     <span style='color:#800000; font-weight:bold; '>Иначе</span>
379:                         <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Заполните константу ЛьготаПоНДС. Док № "</span><span style='color:#808030; '>+</span>НомерДок<span style='color:#808030; '>+</span><span style='color:#0000e6; '>" от "</span><span style='color:#808030; '>+</span>ДатаДок<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
380:                         <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
381:                     <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
382:                 <span style='color:#800000; font-weight:bold; '>Иначе</span>
383:                     <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Вы не можете закупить ОС со статусом "</span><span style='color:#808030; '>+</span>Наименование<span style='color:#008c00; '>.</span>Статус<span style='color:#808030; '>+</span><span style='color:#0000e6; '>". Выберите другое действие. Строка "</span><span style='color:#808030; '>+</span><span style='color:#007997; '>НомерСтроки</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
384:                     <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
385:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
386:             <span style='color:#800000; font-weight:bold; '>Иначе</span>
387:                 <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Для "</span><span style='color:#808030; '>+</span>Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>+</span><span style='color:#0000e6; '>" не разработаны проводки! Док № "</span><span style='color:#808030; '>+</span>НомерДок<span style='color:#808030; '>+</span><span style='color:#0000e6; '>" от "</span><span style='color:#808030; '>+</span>ДатаДок<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
388:                 <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
389:             <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
390:         <span style='color:#800000; font-weight:bold; '>КонецЦикла</span><span style='color:#808030; '>;</span>
391:         <span style='color:#800000; font-weight:bold; '>Если</span> УсреднятьЦену <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
392:             СпсЦен<span style='color:#808030; '>=</span>ЗаписатьЦену<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span>ТекущийДокумент<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
393:             <span style='color:#800000; font-weight:bold; '>Для</span> Сч<span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>по</span> СпсЦен<span style='color:#008c00; '>.</span>РазмерСписка<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Цикл</span>
394:                 хЭлемент<span style='color:#808030; '>=</span>СпсЦен<span style='color:#008c00; '>.</span>ПолучитьЗначение<span style='color:#808030; '>(</span>Сч<span style='color:#808030; '>,</span>СрЦена<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
395:                 СрЦена<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>Число</span><span style='color:#808030; '>(</span>СрЦена<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
396:                 УстановитьРеквизитСправочника<span style='color:#808030; '>(</span>хЭлемент<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"Прих_Цена"</span><span style='color:#808030; '>,</span> СрЦена<span style='color:#808030; '>,</span> ДатаДок<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
397:             <span style='color:#800000; font-weight:bold; '>КонецЦикла</span><span style='color:#808030; '>;</span>
398:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
399:         НДСкВозмещению<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
400:     <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Действие<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>=</span><span style='color:#0000e6; '>"Ответственное хранение"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
401:       ВыбратьСтроки<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
402:         <span style='color:#800000; font-weight:bold; '>Пока</span> ПолучитьСтроку<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Цикл</span>
403:       <span style='color:#800000; font-weight:bold; '>Если</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"МБП"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
404:                 Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"002"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"010"</span><span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"Ответ.хранение"</span><span style='color:#808030; '>,</span>Количество<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
405:             <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"Материалы"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
406:                 Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"003"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"010"</span><span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"Ответ.хранение"</span><span style='color:#808030; '>,</span>Количество<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#696969; '>//нужен ли Клиент в СубкДт2 ?</span>
407:             <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"Товары"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
408:                 Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"004"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"010"</span><span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"Ответ.хранение"</span><span style='color:#808030; '>,</span>Количество<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#696969; '>//нужен ли Клиент в СубкДт2 ?</span>
409:             <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"ОС"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
410:                 Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"005"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"010"</span><span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"Ответ.хранение"</span><span style='color:#808030; '>,</span>Количество<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#696969; '>//нужен ли Клиент в СубкДт2 ?</span>
411:             <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"НМА"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
412:                 Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"006"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"010"</span><span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"Ответ.хранение"</span><span style='color:#808030; '>,</span>Количество<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#696969; '>//нужен ли Клиент в СубкДт2 ?</span>
413:             <span style='color:#800000; font-weight:bold; '>Иначе</span>
414:                 <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Для действия "</span><span style='color:#0000e6; '>"Ответственное хранение"</span><span style='color:#0000e6; '>" "</span><span style='color:#808030; '>+</span>Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>+</span><span style='color:#0000e6; '>" не разработаны проводки! Строка "</span><span style='color:#808030; '>+</span><span style='color:#007997; '>НомерСтроки</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
415:                 <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
416:             <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
417:         <span style='color:#800000; font-weight:bold; '>КонецЦикла</span><span style='color:#808030; '>;</span>
418:     <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> <span style='color:#808030; '>(</span>Действие<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>=</span><span style='color:#0000e6; '>"На реализацию без права собственности"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
419:       ВыбратьСтроки<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
420:         <span style='color:#800000; font-weight:bold; '>Пока</span> ПолучитьСтроку<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Цикл</span>
421:           <span style='color:#800000; font-weight:bold; '>Если</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"Товары"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
422:             <span style='color:#800000; font-weight:bold; '>Если</span> Наименование<span style='color:#008c00; '>.</span>СтатусТовара<span style='color:#808030; '>&lt;</span><span style='color:#808030; '>></span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>СтатусТовара<span style='color:#008c00; '>.</span>НаРеализации <span style='color:#800000; font-weight:bold; '>Тогда</span>
423:               <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Статус товара должен быть "</span><span style='color:#0000e6; '>"На реализации"</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>+</span><span style='color:#007997; '>РазделительСтрок</span>
424:                               <span style='color:#808030; '>+</span><span style='color:#0000e6; '>"строка "</span><span style='color:#808030; '>+</span><span style='color:#800000; font-weight:bold; '>строка</span><span style='color:#808030; '>(</span><span style='color:#007997; '>НомерСтроки</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
425:               <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span><span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
426:           <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
427:                     Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"004"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"010"</span><span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"На реализации"</span><span style='color:#808030; '>,</span>Количество<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#696969; '>//нужен ли Клиент в СубкДт2 ?</span>
428:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
429:             <span style='color:#800000; font-weight:bold; '>КонецЦикла</span><span style='color:#808030; '>;</span>
430:     <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> <span style='color:#808030; '>(</span>Действие<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>=</span><span style='color:#0000e6; '>"На комиссию"</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
431:       ВыбратьСтроки<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
432:         <span style='color:#800000; font-weight:bold; '>Пока</span> ПолучитьСтроку<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Цикл</span>
433:           <span style='color:#800000; font-weight:bold; '>Если</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"Товары"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
434:             <span style='color:#800000; font-weight:bold; '>Если</span> Наименование<span style='color:#008c00; '>.</span>СтатусТовара<span style='color:#808030; '>&lt;</span><span style='color:#808030; '>></span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>СтатусТовара<span style='color:#008c00; '>.</span>НаРеализации <span style='color:#800000; font-weight:bold; '>Тогда</span>
435:               <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Статус товара должен быть "</span><span style='color:#0000e6; '>"На реализации"</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>+</span><span style='color:#007997; '>РазделительСтрок</span>
436:                               <span style='color:#808030; '>+</span><span style='color:#0000e6; '>"строка "</span><span style='color:#808030; '>+</span><span style='color:#800000; font-weight:bold; '>строка</span><span style='color:#808030; '>(</span><span style='color:#007997; '>НомерСтроки</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
437:               <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span><span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
438:           <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
439:                     Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"004"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"010"</span><span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"Поступил на комиссию"</span><span style='color:#808030; '>,</span>Количество<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#696969; '>//нужен ли Клиент в СубкДт2 ?</span>
440:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
441:             <span style='color:#800000; font-weight:bold; '>КонецЦикла</span><span style='color:#808030; '>;</span>
442:      <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Действие<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>=</span><span style='color:#0000e6; '>"В аренду"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
443:         ВыбратьСтроки<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
444:         <span style='color:#800000; font-weight:bold; '>Пока</span> ПолучитьСтроку<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Цикл</span>
445:             <span style='color:#800000; font-weight:bold; '>Если</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"ОС"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
446:                 <span style='color:#800000; font-weight:bold; '>Если</span> Наименование<span style='color:#008c00; '>.</span>Статус<span style='color:#808030; '>=</span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>СтатусОС<span style='color:#008c00; '>.</span>Собственное <span style='color:#800000; font-weight:bold; '>Тогда</span>
447:                     <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Вы не можете взять в аренду собственное ОС. Выберите действие "</span><span style='color:#0000e6; '>"Закупка"</span><span style='color:#0000e6; '>". Строка "</span><span style='color:#808030; '>+</span><span style='color:#007997; '>НомерСтроки</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
448:                     <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
449:                 <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> <span style='color:#808030; '>(</span> Наименование<span style='color:#008c00; '>.</span>Статус<span style='color:#808030; '>=</span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>СтатусОС<span style='color:#008c00; '>.</span>АрендаПлатнаяБезИзноса<span style='color:#808030; '>)</span> или
450:                 <span style='color:#808030; '>(</span> Наименование<span style='color:#008c00; '>.</span>Статус<span style='color:#808030; '>=</span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>СтатусОС<span style='color:#008c00; '>.</span>АрендаПлатнаяИзносом<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
451:                     Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"001.1"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"010"</span><span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"В аренду"</span><span style='color:#808030; '>,</span>Количество<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
452:                 <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Наименование<span style='color:#008c00; '>.</span>Статус<span style='color:#808030; '>=</span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>СтатусОС<span style='color:#008c00; '>.</span>АрендаБезвозмездная <span style='color:#800000; font-weight:bold; '>Тогда</span>
453:                     Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"001.2"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"010"</span><span style='color:#808030; '>,</span>Сумма<span style='color:#808030; '>,</span>Склад<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"В аренду"</span><span style='color:#808030; '>,</span>Количество<span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
454:                 <span style='color:#800000; font-weight:bold; '>Иначе</span>
455:                     <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Для ОС со статусом "</span><span style='color:#808030; '>+</span>Наименование<span style='color:#008c00; '>.</span>Статус<span style='color:#808030; '>+</span><span style='color:#0000e6; '>" не разработаны проводки. Строка "</span><span style='color:#808030; '>+</span><span style='color:#007997; '>НомерСтроки</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
456:                     <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
457:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
458:             <span style='color:#800000; font-weight:bold; '>Иначе</span>
459:                 <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Для "</span><span style='color:#808030; '>+</span>Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>+</span><span style='color:#0000e6; '>" не разработаны проводки! Строка "</span><span style='color:#808030; '>+</span><span style='color:#007997; '>НомерСтроки</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
460:                 <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
461:             <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
462:         <span style='color:#800000; font-weight:bold; '>КонецЦикла</span><span style='color:#808030; '>;</span>
463: 
464:     <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Действие<span style='color:#008c00; '>.</span>Наименование <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"Возврат от покупателя"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
465: 
466:         <span style='color:#696969; '>// *******************************************************************</span>
467:         <span style='color:#696969; '>// ********* Возвожно самая сложная часть самого сложного ************</span>
468:         <span style='color:#696969; '>// ************ первичного документа нашей конфигурации **************</span>
469:         <span style='color:#696969; '>// *******************************************************************</span>
470: 
471:         <span style='color:#800000; font-weight:bold; '>Если</span> ДокОсн<span style='color:#008c00; '>.</span>Выбран<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
472:             <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Действие "</span><span style='color:#0000e6; '>"Возврат от покупателя"</span><span style='color:#0000e6; '>": Необходимо указать документ-основание"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"!"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
473:             <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
474:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
475: 
476:         СчФакт <span style='color:#808030; '>=</span> СчетФактура<span style='color:#808030; '>(</span> ТекущийДокумент<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
477:         <span style='color:#800000; font-weight:bold; '>Если</span> СчФакт <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
478:             <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span> <span style='color:#0000e6; '>"Не найден связанный документ "</span><span style='color:#0000e6; '>"Регистрация счета-фактуры"</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"!"</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
479:             <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
480:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
481: 
482:         ДокРН <span style='color:#808030; '>=</span> ДокОсн<span style='color:#808030; '>;</span>
483:         СчФОтгрузки <span style='color:#808030; '>=</span> СчетФактура<span style='color:#808030; '>(</span> ДокРН <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
484: 
485:         <span style='color:#800000; font-weight:bold; '>Если</span> <span style='color:#808030; '>(</span>СчФОтгрузки<span style='color:#008c00; '>.</span>Действие<span style='color:#008c00; '>.</span>Наименование <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>></span> <span style='color:#0000e6; '>"Продукция отгружена"</span><span style='color:#808030; '>)</span>
486:              И <span style='color:#808030; '>(</span> СчФОтгрузки<span style='color:#008c00; '>.</span>Действие<span style='color:#008c00; '>.</span>Наименование <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>></span> <span style='color:#0000e6; '>"На комиссию"</span><span style='color:#808030; '>)</span>
487:         <span style='color:#800000; font-weight:bold; '>Тогда</span>
488:             <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span> <span style='color:#0000e6; '>"Счет-фактура оплаты не на отгрузку и не на комиссию!"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"!!!"</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
489:             <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
490:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
491: 
492:         <span style='color:#696969; '>// Построим список наименований ПН по возврату</span>
493:         ТаблицаВозврата <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>СоздатьОбъект</span><span style='color:#808030; '>(</span> <span style='color:#0000e6; '>"ТаблицаЗначений"</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
494:         ВыгрузитьТабличнуюЧасть<span style='color:#808030; '>(</span> ТаблицаВозврата<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"НомерСтроки,Наименование,Количество,Сумма,НДС,Единица"</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
495:         ТаблицаВозврата<span style='color:#008c00; '>.</span>НоваяКолонка<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"БылИзлишекОплаты"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"Число"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
496: 
497:         Сум76_11 <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span> Сум76_12 <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
498: 
499:         Рег <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>СоздатьОбъект</span><span style='color:#808030; '>(</span> <span style='color:#0000e6; '>"Регистр.Взаиморасчеты"</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
500:         <span style='color:#800000; font-weight:bold; '>Если</span> <span style='color:#800000; font-weight:bold; '>ПолучитьДатуТА</span><span style='color:#808030; '>(</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>></span> ДатаДок <span style='color:#800000; font-weight:bold; '>Тогда</span> <span style='color:#696969; '>// если итоги не актуальны</span>
501:             <span style='color:#800000; font-weight:bold; '>Состояние</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Рассчет регистра..."</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
502:             Рег<span style='color:#008c00; '>.</span>ВременныйРасчет<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
503:             Рег<span style='color:#008c00; '>.</span>УстановитьФильтр<span style='color:#808030; '>(</span> Клиент<span style='color:#808030; '>,</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
504:             <span style='color:#800000; font-weight:bold; '>РассчитатьРегистрыНа</span><span style='color:#808030; '>(</span> ТекущийДокумент<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
505:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
506: 
507:         <span style='color:#696969; '>// Процесс пошел...</span>
508: 
509:         ОбщийИзлишекСуммы <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
510: 
511:         ВыбратьСтроки<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
512:         <span style='color:#800000; font-weight:bold; '>Пока</span> ПолучитьСтроку<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Цикл</span>
513:             <span style='color:#696969; '>//** 24/07/00</span>
514:             ОплатаПоРегиструГотПрод<span style='color:#808030; '>(</span><span style='color:#007997; '>НомерСтроки</span><span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span>Количество<span style='color:#808030; '>,</span>СуммаБезНДС<span style='color:#808030; '>,</span>Регистр<span style='color:#008c00; '>.</span>ГотоваяПродукция<span style='color:#808030; '>,</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
515: 
516:             ФлагОплачено <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
517:             <span style='color:#696969; '>// Сообщить("Обрабатывается ("+ОбрабСтр+" из "+КоличествоСтрок()+ ") """+Наименование+"""");</span>
518:             ОбрабСтр <span style='color:#808030; '>=</span> ОбрабСтр<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
519:             СуммаПроводки <span style='color:#808030; '>=</span> Наименование<span style='color:#008c00; '>.</span>Прих_Цена<span style='color:#008c00; '>.</span>Получить<span style='color:#808030; '>(</span>ДокОсн<span style='color:#008c00; '>.</span>ДатаДок<span style='color:#808030; '>)</span> <span style='color:#808030; '>*</span> Количество<span style='color:#808030; '>;</span>
520:             <span style='color:#696969; '>// Начало изврата с регистрами</span>
521:             СумОтгПоРН <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span> <span style='color:#696969; '>// Сумма отгрузки по РН</span>
522:             КолОтгПоРН <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span> <span style='color:#696969; '>// Кол-во отгрузки по РН</span>
523:             ЭлементПН <span style='color:#808030; '>=</span> ЭлементНеопрСправ<span style='color:#808030; '>(</span> Наименование <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#696969; '>// текущее наименование в ПН</span>
524:             ДокРН<span style='color:#008c00; '>.</span>ВыбратьСтроки<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
525:             <span style='color:#800000; font-weight:bold; '>Пока</span> ДокРН<span style='color:#008c00; '>.</span>ПолучитьСтроку<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Цикл</span>
526:                 ЭлементРН <span style='color:#808030; '>=</span> ЭлементНеопрСправ<span style='color:#808030; '>(</span> ДокРН<span style='color:#008c00; '>.</span>Наименование <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
527:                 <span style='color:#800000; font-weight:bold; '>Если</span> <span style='color:#808030; '>(</span> ЭлементПН <span style='color:#808030; '>=</span> ЭлементРН <span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
528:                     КолОтгПоРН <span style='color:#808030; '>=</span> КолОтгПоРН <span style='color:#808030; '>+</span> ДокРН<span style='color:#008c00; '>.</span>Количество<span style='color:#808030; '>;</span>
529:                     СумОтгПоРН <span style='color:#808030; '>=</span> ДокРН<span style='color:#008c00; '>.</span>СуммаБезНДС<span style='color:#808030; '>;</span><span style='color:#696969; '>//**ДокРН.Сумма;</span>
530:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
531:             <span style='color:#800000; font-weight:bold; '>КонецЦикла</span><span style='color:#808030; '>;</span>
532: 
533:             <span style='color:#800000; font-weight:bold; '>Если</span> Количество <span style='color:#808030; '>></span> КолОтгПоРН <span style='color:#800000; font-weight:bold; '>Тогда</span>
534:                 <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span> <span style='color:#0000e6; '>""</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>+</span>Наименование<span style='color:#808030; '>+</span><span style='color:#0000e6; '>""</span><span style='color:#0000e6; '>" Возвращается больше, чем отгружено"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"!!!"</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
535:                 <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
536:             <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> <span style='color:#808030; '>(</span> Количество <span style='color:#808030; '>=</span> КолОтгПоРН <span style='color:#808030; '>)</span> и <span style='color:#808030; '>(</span>СуммаБезНДС <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>></span> СумОтгПоРН <span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
537:                 <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span> <span style='color:#0000e6; '>""</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>+</span>Наименование<span style='color:#808030; '>+</span><span style='color:#0000e6; '>""</span><span style='color:#0000e6; '>" Не совпадают суммы отгрузки и возврата при равном количестве"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"!!!"</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
538:                 <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>строка</span><span style='color:#808030; '>(</span>СуммаC_НДС<span style='color:#808030; '>)</span><span style='color:#808030; '>+</span><span style='color:#0000e6; '>"; по накл. "</span><span style='color:#808030; '>+</span><span style='color:#800000; font-weight:bold; '>строка</span><span style='color:#808030; '>(</span>СумОтгПоРН<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
539:                 <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
540:             <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
541: 
542: 
543:             КомСчФОтгрузки <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"По СчФ &lt;"</span><span style='color:#808030; '>+</span>СчФОтгрузки<span style='color:#808030; '>+</span><span style='color:#0000e6; '>"> (сторн. отгрузки/оплаты)"</span><span style='color:#808030; '>;</span>
544: 
545:             <span style='color:#696969; '>// "Интеллектуальное" движение регистра Взаиморасчеты.</span>
546:             <span style='color:#696969; '>// Оно состоит в том, чтобы двинуть регистр "туда" и "обратно"</span>
547:             <span style='color:#696969; '>// с минусом. То есть для возврата продукции приходовать его с минусом,</span>
548:             <span style='color:#696969; '>// а для возврата "лишних" денег расходовать с минусом</span>
549: 
550:             <span style='color:#696969; '>// Часть 1. Погашение долга перед клиентом</span>
551:             <span style='color:#696969; '>// Обратное движение регистра Взаиморасчеты, возвращающее продукцию</span>
552:             КоэфЕд <span style='color:#808030; '>=</span> КоэфЕдИзмерения<span style='color:#808030; '>(</span> Единица<span style='color:#808030; '>,</span> Наименование<span style='color:#008c00; '>.</span>БазоваяЕдиница <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
553:             ПолноеКолич <span style='color:#808030; '>=</span> Количество <span style='color:#808030; '>*</span> КоэфЕд<span style='color:#808030; '>;</span>
554:             Регистр<span style='color:#008c00; '>.</span>Взаиморасчеты<span style='color:#008c00; '>.</span>ПривязыватьСтроку<span style='color:#808030; '>(</span> <span style='color:#007997; '>НомерСтроки</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
555:             Регистр<span style='color:#008c00; '>.</span>Взаиморасчеты<span style='color:#008c00; '>.</span>Клиент <span style='color:#808030; '>=</span> Клиент<span style='color:#808030; '>;</span>
556:             Регистр<span style='color:#008c00; '>.</span>Взаиморасчеты<span style='color:#008c00; '>.</span>СчетФактура <span style='color:#808030; '>=</span> СчФОтгрузки<span style='color:#808030; '>;</span>
557:             Регистр<span style='color:#008c00; '>.</span>Взаиморасчеты<span style='color:#008c00; '>.</span>Наименование <span style='color:#808030; '>=</span> Наименование<span style='color:#808030; '>;</span>
558:             Регистр<span style='color:#008c00; '>.</span>Взаиморасчеты<span style='color:#008c00; '>.</span>Оплата <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
559:             Регистр<span style='color:#008c00; '>.</span>Взаиморасчеты<span style='color:#008c00; '>.</span>Количество <span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span> ПолноеКолич<span style='color:#808030; '>;</span>
560:             Регистр<span style='color:#008c00; '>.</span>Взаиморасчеты<span style='color:#008c00; '>.</span>Сумма <span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span> Сумма<span style='color:#808030; '>;</span>
561:             Регистр<span style='color:#008c00; '>.</span>Взаиморасчеты<span style='color:#008c00; '>.</span>НДС <span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span> НДС<span style='color:#808030; '>;</span>
562:             Регистр<span style='color:#008c00; '>.</span>Взаиморасчеты<span style='color:#008c00; '>.</span>Закрытие64 <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
563:             Регистр<span style='color:#008c00; '>.</span>Взаиморасчеты<span style='color:#008c00; '>.</span>ДвижениеПриходВыполнить<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
564: 
565:             <span style='color:#696969; '>// Часть 2. Убирание излишков оплаты</span>
566: 
567:             Рег<span style='color:#008c00; '>.</span>СводныеОстатки<span style='color:#808030; '>(</span> Клиент<span style='color:#808030; '>,</span> СчФОтгрузки<span style='color:#808030; '>,</span> Наименование<span style='color:#808030; '>,</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
568: 
569:             <span style='color:#800000; font-weight:bold; '>Если</span> Рег<span style='color:#008c00; '>.</span>Сумма <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
570:                 <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span> КомСчФОтгрузки<span style='color:#808030; '>+</span><span style='color:#0000e6; '>" по наименованию &lt;"</span><span style='color:#808030; '>+</span>Наименование<span style='color:#808030; '>+</span><span style='color:#0000e6; '>"> имеется отритцательный долг: "</span><span style='color:#808030; '>+</span>Рег<span style='color:#008c00; '>.</span>Сумма<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"!!!"</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
571:                 <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
572:             <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
573: 
574:             <span style='color:#696969; '>// Превышение суммы возврата над суммой долга по наименованию</span>
575:             ИзлишекОплСуммы <span style='color:#808030; '>=</span> Сумма <span style='color:#808030; '>-</span> Рег<span style='color:#008c00; '>.</span>Сумма<span style='color:#808030; '>;</span>
576:             ИзлишекОплНДС <span style='color:#808030; '>=</span> НДС <span style='color:#808030; '>-</span> Рег<span style='color:#008c00; '>.</span>НДС<span style='color:#808030; '>;</span>
577:             ИзлишекОплКолич <span style='color:#808030; '>=</span> ПолноеКолич <span style='color:#808030; '>-</span> Рег<span style='color:#008c00; '>.</span>Количество<span style='color:#808030; '>;</span>
578: 
579:             <span style='color:#800000; font-weight:bold; '>Если</span> <span style='color:#800000; font-weight:bold; '>Окр</span><span style='color:#808030; '>(</span> ИзлишекОплСуммы<span style='color:#808030; '>,</span> <span style='color:#008c00; '>5</span> <span style='color:#808030; '>)</span> <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
580:                 <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span> <span style='color:#0000e6; '>"В строке №"</span><span style='color:#808030; '>+</span><span style='color:#007997; '>НомерСтроки</span><span style='color:#808030; '>+</span><span style='color:#0000e6; '>" возвращается больше, чем нам должны на "</span><span style='color:#808030; '>+</span>ИзлишекОплСуммы<span style='color:#808030; '>+</span><span style='color:#0000e6; '>" рублей!"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"!"</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
581:             <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
582: 
583:             <span style='color:#696969; '>// Убираем излишки оплаты по данному наименованию</span>
584:             Регистр<span style='color:#008c00; '>.</span>Взаиморасчеты<span style='color:#008c00; '>.</span>ПривязыватьСтроку<span style='color:#808030; '>(</span> <span style='color:#007997; '>НомерСтроки</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
585:             РасходРегВзСОбнул<span style='color:#808030; '>(</span> Регистр<span style='color:#008c00; '>.</span>Взаиморасчеты<span style='color:#808030; '>,</span> Рег<span style='color:#808030; '>,</span>
586:                                 СчФОтгрузки<span style='color:#808030; '>,</span> Наименование<span style='color:#808030; '>,</span>
587:                                 <span style='color:#808030; '>-</span>ИзлишекОплСуммы<span style='color:#808030; '>,</span> <span style='color:#808030; '>-</span>ИзлишекОплНДС<span style='color:#808030; '>,</span> <span style='color:#808030; '>-</span>ИзлишекОплКолич<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>
588:                                 <span style='color:#808030; '>-</span>Сумма<span style='color:#808030; '>,</span> <span style='color:#808030; '>-</span>НДС<span style='color:#808030; '>,</span> <span style='color:#808030; '>-</span>ПолноеКолич <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
589: 
590:             <span style='color:#800000; font-weight:bold; '>Если</span> ИзлишекОплСуммы <span style='color:#808030; '>></span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
591:                 НомСтр <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
592:                 <span style='color:#800000; font-weight:bold; '>Если</span> ТаблицаВозврата<span style='color:#008c00; '>.</span>НайтиЗначение<span style='color:#808030; '>(</span> Наименование<span style='color:#808030; '>,</span> НомСтр<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"Наименование"</span> <span style='color:#808030; '>)</span> <span style='color:#808030; '>></span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
593:                     ТаблицаВозврата<span style='color:#008c00; '>.</span>ПолучитьСтрокуПоНомеру<span style='color:#808030; '>(</span> НомСтр <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
594:                     ТаблицаВозврата<span style='color:#008c00; '>.</span>БылИзлишекОплаты <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
595:                 <span style='color:#800000; font-weight:bold; '>Иначе</span>
596:                     <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Super Trouble!"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"!!!"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
597:                     <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
598:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
599:             <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
600: 
601:             ОбщийИзлишекСуммы <span style='color:#808030; '>=</span> ОбщийИзлишекСуммы <span style='color:#808030; '>+</span> ИзлишекОплСуммы<span style='color:#808030; '>;</span>
602: 
603:             <span style='color:#696969; '>// ********** Конец интеллектуального движения регистров ******</span>
604: 
605:             <span style='color:#696969; '>// ********** ИНТЕЛЛЕКТУАЛЬНЫЕ ПРОВОДКИ ***********************</span>
606: 
607:             <span style='color:#696969; '>// Возврат самой продукции </span>
608:             СуммаВозврПоОтгрЦене <span style='color:#808030; '>=</span> Наименование<span style='color:#008c00; '>.</span>Прих_Цена<span style='color:#008c00; '>.</span>Получить<span style='color:#808030; '>(</span> ДокОсн<span style='color:#008c00; '>.</span>ДатаДок <span style='color:#808030; '>)</span> <span style='color:#808030; '>*</span> ПолноеКолич<span style='color:#808030; '>;</span>
609:             Сч4041 <span style='color:#808030; '>=</span> <span style='color:#808030; '>?</span><span style='color:#808030; '>(</span> Наименование<span style='color:#008c00; '>.</span>Вид<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"Товары"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"41.1"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"40"</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
610:             Проводка<span style='color:#808030; '>(</span> Операция<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"45.2"</span><span style='color:#808030; '>,</span> Сч4041<span style='color:#808030; '>,</span> <span style='color:#808030; '>-</span>СуммаВозврПоОтгрЦене<span style='color:#808030; '>,</span> Клиент<span style='color:#808030; '>,</span> Склад<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span> КомСчФОтгрузки<span style='color:#808030; '>,</span> <span style='color:#808030; '>-</span>ПолноеКолич<span style='color:#808030; '>,</span> <span style='color:#808030; '>,</span>Наименование<span style='color:#808030; '>,</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
611: 
612:             <span style='color:#800000; font-weight:bold; '>Если</span> ИзлишекОплСуммы <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>></span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
613:                 <span style='color:#696969; '>// Возврат денежек</span>
614:                 Сч46 <span style='color:#808030; '>=</span> СчетРеализацииПоНаименованию<span style='color:#808030; '>(</span> Наименование<span style='color:#808030; '>,</span> СчФОтгрузки <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
615:                 Проводка<span style='color:#808030; '>(</span> Операция<span style='color:#808030; '>,</span> Сч46<span style='color:#008c00; '>.</span>Код<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"45.2"</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>-</span>СуммаВозврПоОтгрЦене<span style='color:#808030; '>,</span> <span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span> КомСчФОтгрузки<span style='color:#808030; '>,</span> <span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
616:                 Проводка<span style='color:#808030; '>(</span> Операция<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"76.11"</span><span style='color:#808030; '>,</span> Сч46<span style='color:#008c00; '>.</span>Код<span style='color:#808030; '>,</span> <span style='color:#808030; '>-</span>ИзлишекОплСуммы<span style='color:#808030; '>,</span> Клиент<span style='color:#808030; '>,</span> <span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span> КомСчФОтгрузки<span style='color:#808030; '>,</span> <span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
617:             <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
618: 
619:             <span style='color:#800000; font-weight:bold; '>Если</span> ИзлишекОплНДС <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>></span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
620:                 <span style='color:#696969; '>// Сторнирование НДС</span>
621:                 Проводка<span style='color:#808030; '>(</span> Операция<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"76.12"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"68.2"</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>-</span>ИзлишекОплНДС<span style='color:#808030; '>,</span> Клиент<span style='color:#808030; '>,</span> <span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>ПлатежиВФонды<span style='color:#008c00; '>.</span>Взносы<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"Сторн. НДС "</span><span style='color:#808030; '>+</span>КомСчФОтгрузки<span style='color:#808030; '>,</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
622:             <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
623: 
624:             <span style='color:#800000; font-weight:bold; '>Если</span> НДС <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
625:                 Сум76_11 <span style='color:#808030; '>=</span> Сум76_11 <span style='color:#808030; '>+</span> Сумма<span style='color:#808030; '>;</span>
626:             <span style='color:#800000; font-weight:bold; '>Иначе</span>
627:                 Сум76_12 <span style='color:#808030; '>=</span> Сум76_12 <span style='color:#808030; '>+</span> Сумма<span style='color:#808030; '>;</span>
628:             <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
629:             <span style='color:#696969; '>// ********** Конец интеллектуальных проводок *****************</span>
630:         <span style='color:#800000; font-weight:bold; '>КонецЦикла</span><span style='color:#808030; '>;</span> <span style='color:#696969; '>// по текущему документу ПН</span>
631: 
632:         <span style='color:#696969; '>// --------- Разбрасывание лишней суммы -----------------</span>
633: 
634:         ОбщийИзлишекСуммы <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>Окр</span><span style='color:#808030; '>(</span> ОбщийИзлишекСуммы<span style='color:#808030; '>,</span> <span style='color:#008c00; '>2</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
635:         <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span> <span style='color:#0000e6; '>"После возврата у нас высвободилось "</span><span style='color:#808030; '>+</span>ОбщийИзлишекСуммы<span style='color:#808030; '>+</span><span style='color:#0000e6; '>" рублей."</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
636:         <span style='color:#800000; font-weight:bold; '>Если</span> ОбщийИзлишекСуммы <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
637:             <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span> <span style='color:#0000e6; '>"То есть были отритцательные долги судя по регистру Взаиморассчеты!"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"!!!"</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
638:             <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
639:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
640: 
641:         <span style='color:#696969; '>// на общую сумму возврата</span>
642:         <span style='color:#800000; font-weight:bold; '>Если</span> Сум76_11 <span style='color:#808030; '>></span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
643:             Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"62.2"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"76.11"</span><span style='color:#808030; '>,</span><span style='color:#808030; '>-</span>Сум76_11<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span> КомСчФОтгрузки<span style='color:#808030; '>,</span> <span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
644:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
645:         <span style='color:#800000; font-weight:bold; '>Если</span> Сум76_12 <span style='color:#808030; '>></span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
646:             Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"62.2"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"76.12"</span><span style='color:#808030; '>,</span><span style='color:#808030; '>-</span>Сум76_12<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span>Клиент<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"ПН"</span><span style='color:#808030; '>,</span> КомСчФОтгрузки<span style='color:#808030; '>,</span> <span style='color:#808030; '>,</span><span style='color:#808030; '>,</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
647:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
648: 
649:         <span style='color:#800000; font-weight:bold; '>Если</span> ОбщийИзлишекСуммы <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
650:             <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Денег после возврата у нас не появилось."</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"i"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
651:             <span style='color:#800000; font-weight:bold; '>Перейти</span> ~ОбходПроплаты<span style='color:#808030; '>;</span>
652:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
653: 
654:         <span style='color:#696969; '>// Дозакрываем счет-фактуру отгрузки</span>
655: 
656:         Неопл_Сумма <span style='color:#808030; '>=</span> ИтогДокументаДляОплаты<span style='color:#808030; '>(</span> СчФОтгрузки<span style='color:#808030; '>,</span> Рег<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"Сумма"</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
657:         ИтогСумма <span style='color:#808030; '>=</span> Итог<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Сумма"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
658:         НеоплСумма <span style='color:#808030; '>=</span> Неопл_Сумма <span style='color:#808030; '>-</span> ИтогСумма <span style='color:#808030; '>+</span> ОбщийИзлишекСуммы<span style='color:#808030; '>;</span>
659:         <span style='color:#800000; font-weight:bold; '>Если</span> НеоплСумма <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
660:             <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"По СчФ отгрузки ("</span><span style='color:#808030; '>+</span>СчФОтгрузки<span style='color:#808030; '>+</span><span style='color:#0000e6; '>") отритцательный долг ("</span><span style='color:#808030; '>+</span>НеоплСумма<span style='color:#808030; '>+</span><span style='color:#0000e6; '>")!"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"!!!"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
661:             <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
662:         <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> НеоплСумма <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
663:             <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"СчФ отгрузки уже полностью оплачена"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
664:         <span style='color:#800000; font-weight:bold; '>Иначе</span>
665:             <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"СчФ отгрузки частично оплачена, осталось доплатить: "</span><span style='color:#808030; '>+</span>Неопл_Сумма<span style='color:#808030; '>+</span><span style='color:#0000e6; '>" - "</span><span style='color:#808030; '>+</span>ИтогСумма<span style='color:#808030; '>+</span><span style='color:#0000e6; '>" = "</span><span style='color:#808030; '>+</span>НеоплСумма<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
666:             <span style='color:#800000; font-weight:bold; '>Если</span> ОбщийИзлишекСуммы <span style='color:#808030; '>></span> НеоплСумма <span style='color:#800000; font-weight:bold; '>Тогда</span>
667:                 КоэфЗакрытия <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
668:             <span style='color:#800000; font-weight:bold; '>Иначе</span>
669:                 КоэфЗакрытия <span style='color:#808030; '>=</span> ОбщийИзлишекСуммы <span style='color:#808030; '>/</span> НеоплСумма<span style='color:#808030; '>;</span>
670:             <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
671: 
672:             <span style='color:#800000; font-weight:bold; '>Если</span> КоэфЗакрытия <span style='color:#808030; '>></span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
673:                 СуммаЗакр <span style='color:#808030; '>=</span> ЗакрытьСчетФактуруБезВозвращенных<span style='color:#808030; '>(</span> Рег<span style='color:#808030; '>,</span>
674:                     СчФОтгрузки<span style='color:#808030; '>,</span> КоэфЗакрытия<span style='color:#808030; '>,</span> ТаблицаВозврата <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
675:                 <span style='color:#800000; font-weight:bold; '>Если</span> СуммаЗакр <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
676:                     <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
677:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
678:                 СуммаЗакр <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>Окр</span><span style='color:#808030; '>(</span> СуммаЗакр<span style='color:#808030; '>,</span> <span style='color:#008c00; '>2</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
679:                 <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Закрыли &lt;"</span><span style='color:#808030; '>+</span>СчФОтгрузки<span style='color:#808030; '>+</span><span style='color:#0000e6; '>"> на "</span><span style='color:#808030; '>+</span>СуммаЗакр<span style='color:#808030; '>+</span><span style='color:#0000e6; '>" рублей с коэф-м "</span><span style='color:#808030; '>+</span>КоэфЗакрытия<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"i"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
680:             <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
681:             ОбщийИзлишекСуммы <span style='color:#808030; '>=</span> ОбщийИзлишекСуммы <span style='color:#808030; '>-</span> СуммаЗакр<span style='color:#808030; '>;</span>
682:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
683: 
684:         <span style='color:#696969; '>// Закрываем счет-фактуру закрытия</span>
685: 
686:         <span style='color:#800000; font-weight:bold; '>Если</span> СчФЗакр<span style='color:#008c00; '>.</span>Выбран<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
687:             НеоплСумма <span style='color:#808030; '>=</span> ИтогДокументаДляОплаты<span style='color:#808030; '>(</span> СчФЗакр<span style='color:#808030; '>,</span> Рег<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"Сумма"</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
688: 
689:                <span style='color:#800000; font-weight:bold; '>Если</span> НеоплСумма <span style='color:#808030; '>&lt;</span> ОбщийИзлишекСуммы <span style='color:#800000; font-weight:bold; '>Тогда</span>
690:                    СуммаОплСчФ <span style='color:#808030; '>=</span> НеоплСумма<span style='color:#808030; '>;</span>
691:                    <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Долг по счет-фактуре закрытия ("</span><span style='color:#808030; '>+</span>НеоплСумма<span style='color:#808030; '>+</span><span style='color:#0000e6; '>") меньше, чем оставшиеся средства ( "</span><span style='color:#808030; '>+</span>ОбщийИзлишекСуммы<span style='color:#808030; '>+</span><span style='color:#0000e6; '>" )"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"i"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
692:                <span style='color:#800000; font-weight:bold; '>Иначе</span>
693:                    СуммаОплСчФ <span style='color:#808030; '>=</span> ОбщийИзлишекСуммы<span style='color:#808030; '>;</span>
694:                <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
695: 
696:             <span style='color:#800000; font-weight:bold; '>Если</span> СуммаОплСчФ <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>></span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
697:                 <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Закрываем &lt;"</span><span style='color:#808030; '>+</span>СчФЗакр<span style='color:#808030; '>+</span><span style='color:#0000e6; '>"> на "</span><span style='color:#808030; '>+</span>СуммаОплСчФ<span style='color:#808030; '>+</span><span style='color:#0000e6; '>" рублей"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"i"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
698:                 КоэфЗакрытия <span style='color:#808030; '>=</span> СуммаОплСчФ <span style='color:#808030; '>/</span> НеоплСумма<span style='color:#808030; '>;</span>
699:                 <span style='color:#696969; '>// Двигаем регистрами</span>
700:                 СуммаЗакр <span style='color:#808030; '>=</span> ЗакрытьСчетФактуру<span style='color:#808030; '>(</span> Регистр<span style='color:#008c00; '>.</span>Взаиморасчеты<span style='color:#808030; '>,</span>
701:                                     Регистр<span style='color:#008c00; '>.</span>КорректСебест<span style='color:#808030; '>,</span>
702:                                     Регистр<span style='color:#008c00; '>.</span>ГотоваяПродукция<span style='color:#808030; '>,</span> Рег<span style='color:#808030; '>,</span>
703:                                     СчФЗакр<span style='color:#808030; '>,</span> КоэфЗакрытия<span style='color:#808030; '>,</span> ДатаДок<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
704:                 Док <span style='color:#808030; '>=</span> РасхНакл<span style='color:#808030; '>(</span> СчФЗакр <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
705:                 СумНДС <span style='color:#808030; '>=</span> СуммаОплСчФ <span style='color:#808030; '>/</span> СчФЗакр<span style='color:#008c00; '>.</span>Итог<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Сумма"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>*</span> СчФЗакр<span style='color:#008c00; '>.</span>Итог<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"НДС"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
706:                 <span style='color:#800000; font-weight:bold; '>Если</span> ПроводкиПо46<span style='color:#808030; '>(</span> Рег<span style='color:#808030; '>,</span> Операция<span style='color:#808030; '>,</span> Док<span style='color:#808030; '>,</span> СуммаОплСчФ<span style='color:#808030; '>,</span> СумНДС<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"По СчФ &lt;"</span><span style='color:#808030; '>+</span>СчФЗакр<span style='color:#808030; '>+</span><span style='color:#0000e6; '>">"</span> <span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
707:                     <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span>
708:                 <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
709: 
710:                 ОбщийИзлишекСуммы <span style='color:#808030; '>=</span> ОбщийИзлишекСуммы <span style='color:#808030; '>-</span> СуммаОплСчФ<span style='color:#808030; '>;</span>
711:             <span style='color:#800000; font-weight:bold; '>Иначе</span>
712:                 <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"К сожалению у нас не осталось денег на закрытие &lt;"</span><span style='color:#808030; '>+</span>СчФЗакр<span style='color:#808030; '>+</span><span style='color:#0000e6; '>">."</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"i"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
713:             <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
714:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
715: 
716:         <span style='color:#800000; font-weight:bold; '>Если</span> ОбщийИзлишекСуммы <span style='color:#808030; '>></span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
717:             <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"У нас осталось еще "</span><span style='color:#808030; '>+</span>ОбщийИзлишекСуммы<span style='color:#808030; '>+</span><span style='color:#0000e6; '>" рублей, которые мы запишем "</span><span style='color:#808030; '>+</span>Клиент<span style='color:#808030; '>+</span><span style='color:#0000e6; '>" как предоплату"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"i"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
718: 
719:             Проводка<span style='color:#808030; '>(</span> Операция<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"62.2"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"64"</span><span style='color:#808030; '>,</span> ОбщийИзлишекСуммы<span style='color:#808030; '>,</span> Клиент<span style='color:#808030; '>,</span> Клиент<span style='color:#808030; '>,</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
720:             Проводка<span style='color:#808030; '>(</span> Операция<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"64"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"68.2"</span><span style='color:#808030; '>,</span> ОбщийИзлишекСуммы <span style='color:#808030; '>*</span> <span style='color:#008c00; '>20</span><span style='color:#808030; '>/</span><span style='color:#008c00; '>120</span><span style='color:#808030; '>,</span> Клиент<span style='color:#808030; '>,</span> <span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>ПлатежиВФонды<span style='color:#008c00; '>.</span>Взносы<span style='color:#808030; '>,</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
721: 
722:             Регистр<span style='color:#008c00; '>.</span>Предоплата<span style='color:#008c00; '>.</span>Клиент <span style='color:#808030; '>=</span> Клиент<span style='color:#808030; '>;</span>
723:             Регистр<span style='color:#008c00; '>.</span>Предоплата<span style='color:#008c00; '>.</span>Сумма <span style='color:#808030; '>=</span> ОбщийИзлишекСуммы<span style='color:#808030; '>;</span>
724:             Регистр<span style='color:#008c00; '>.</span>Предоплата<span style='color:#008c00; '>.</span>НДС <span style='color:#808030; '>=</span> ОбщийИзлишекСуммы <span style='color:#808030; '>*</span> <span style='color:#008c00; '>20</span><span style='color:#808030; '>/</span><span style='color:#008c00; '>120</span><span style='color:#808030; '>;</span>
725:             Регистр<span style='color:#008c00; '>.</span>Предоплата<span style='color:#008c00; '>.</span>ДвижениеПриходВыполнить<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
726:         <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
727: 
728: ~ОбходПроплаты:
729: 
730:         <span style='color:#696969; '>// ********************************************************************</span>
731:         <span style='color:#696969; '>// ********* КОНЕЦ ДЕЙСТВИЯ "Возврат от покупателя" *******************</span>
732:         <span style='color:#696969; '>// ********************************************************************</span>
733: 
734:     <span style='color:#800000; font-weight:bold; '>ИначеЕсли</span> Действие<span style='color:#008c00; '>.</span>Наименование <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"Возврат с комиссии"</span> <span style='color:#800000; font-weight:bold; '>Тогда</span>
735:         <span style='color:#800000; font-weight:bold; '>Сообщить</span><span style='color:#808030; '>(</span> <span style='color:#0000e6; '>"Действие "</span><span style='color:#808030; '>+</span>Действие<span style='color:#008c00; '>.</span>Наименование<span style='color:#808030; '>+</span><span style='color:#0000e6; '>" сейчас не работает!"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"!!!"</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
736:         <span style='color:#800000; font-weight:bold; '>СтатусВозврата</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#800000; font-weight:bold; '>Возврат</span><span style='color:#808030; '>;</span> 
737:     <span style='color:#800000; font-weight:bold; '>КонецЕсли</span><span style='color:#808030; '>;</span>
738: 
739:     _Спр <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>СоздатьОбъект</span><span style='color:#808030; '>(</span> <span style='color:#0000e6; '>"Справочник.ПрибылиУбытки"</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
740:     _Спр<span style='color:#008c00; '>.</span>НайтиПоНаименованию<span style='color:#808030; '>(</span> <span style='color:#0000e6; '>"Налоги"</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
741:     <span style='color:#696969; '>//    Проводка(Операция,"68.19",СчетКт,СумНалРекл, Перечисление.ПлатежиВФонды.Взносы,Клиент,"РН",""+ВтчДопНалог);</span>
742:     Проводка<span style='color:#808030; '>(</span>Операция<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"80"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"68.19"</span><span style='color:#808030; '>,</span>СумНалРекл<span style='color:#808030; '>,</span> _Спр<span style='color:#008c00; '>.</span>ТекущийЭлемент<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span><span style='color:#007997; '>Перечисление</span><span style='color:#008c00; '>.</span>ПлатежиВФонды<span style='color:#008c00; '>.</span>Взносы<span style='color:#808030; '>,</span><span style='color:#0000e6; '>"РН"</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>+</span>ВтчДопНалог<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
743: 
744:     Операция<span style='color:#008c00; '>.</span>Записать<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
745:     Рег <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
746: <span style='color:#800000; font-weight:bold; '>КонецПроцедуры</span>
747: 
748: ФлагЗакрСчФ <span style='color:#808030; '>=</span> СчФЗакр<span style='color:#008c00; '>.</span>Выбран<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span> <span style='color:#696969; '>// если 1, то закрываем счет-фактуру</span>
749: 
</pre></body></html>
