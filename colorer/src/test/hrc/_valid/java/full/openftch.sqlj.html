<html><body style='color:#000000; background:#ffffff; '><pre>
  0: <span style='color:#696969; '>//  Source File Name: Openftch.sqlj  %I%</span>
  1: <span style='color:#696969; '>//</span>
  2: <span style='color:#696969; '>//  Licensed Materials -- Property of IBM</span>
  3: <span style='color:#696969; '>//</span>
  4: <span style='color:#696969; '>//  (c) Copyright International Business Machines Corporation, 1999.</span>
  5: <span style='color:#696969; '>//      All Rights Reserved.</span>
  6: <span style='color:#696969; '>//</span>
  7: <span style='color:#696969; '>//  US Government Users Restricted Rights -</span>
  8: <span style='color:#696969; '>//  Use, duplication or disclosure restricted by</span>
  9: <span style='color:#696969; '>//  GSA ADP Schedule Contract with IBM Corp.</span>
 10: 
 11: <span style='color:#696969; '>//  This sample program shows how to execute </span>
 12: <span style='color:#696969; '>//  SQLJ positioned update/delete statements.</span>
 13: 
 14: <span style='color:#696969; '>// For more information about this sample, refer to the README file.</span>
 15: 
 16: <span style='color:#696969; '>// For more information on programming in Java, refer to the </span>
 17: <span style='color:#696969; '>// "Programming in Java" section of the Application Development Guide.</span>
 18: 
 19: <span style='color:#696969; '>// For more information on building and running Java programs for DB2,</span>
 20: <span style='color:#696969; '>// refer to the "Building Java Applets and Applications" section of the </span>
 21: <span style='color:#696969; '>// Application Building Guide.</span>
 22: 
 23: <span style='color:#696969; '>// For more information on the SQL language, refer to the SQL Reference.</span>
 24: 
 25: <span style='color:#800000; font-weight:bold; '>import</span><span style='color:#004a43; '> java</span><span style='color:#808030; '>.</span><span style='color:#004a43; '>sql</span><span style='color:#808030; '>.</span><span style='color:#800000; font-weight:bold; '>*</span><span style='color:#800080; '>;</span>
 26: <span style='color:#800000; font-weight:bold; '>import</span><span style='color:#004a43; '> sqlj</span><span style='color:#808030; '>.</span><span style='color:#004a43; '>runtime</span><span style='color:#808030; '>.</span><span style='color:#800000; font-weight:bold; '>*</span><span style='color:#800080; '>;</span>
 27: <span style='color:#800000; font-weight:bold; '>import</span><span style='color:#004a43; '> sqlj</span><span style='color:#808030; '>.</span><span style='color:#004a43; '>runtime</span><span style='color:#808030; '>.</span><span style='color:#004a43; '>ref</span><span style='color:#808030; '>.</span><span style='color:#800000; font-weight:bold; '>*</span><span style='color:#800080; '>;</span>
 28: 
 29: <span style='color:#800000; font-weight:bold; '>class</span> Openftch 
 30: <span style='color:#800080; '>{</span>   <span style='color:#800000; font-weight:bold; '>static</span>
 31:     <span style='color:#800080; '>{</span>   <span style='color:#800000; font-weight:bold; '>try</span>
 32:         <span style='color:#800080; '>{</span>   <span style='color:#bb7977; font-weight:bold; '>Class</span><span style='color:#808030; '>.</span>forName <span style='color:#808030; '>(</span><span style='color:#0000e6; '>"COM.ibm.db2.jdbc.app.DB2Driver"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span>newInstance <span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 33:         <span style='color:#800080; '>}</span> 
 34:         <span style='color:#800000; font-weight:bold; '>catch</span> <span style='color:#808030; '>(</span><span style='color:#bb7977; font-weight:bold; '>Exception</span> e<span style='color:#808030; '>)</span>
 35:         <span style='color:#800080; '>{</span>   <span style='color:#bb7977; font-weight:bold; '>System</span><span style='color:#808030; '>.</span>out<span style='color:#808030; '>.</span>println <span style='color:#808030; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>  Error loading DB2 Driver...</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 36:             <span style='color:#bb7977; font-weight:bold; '>System</span><span style='color:#808030; '>.</span>out<span style='color:#808030; '>.</span>println <span style='color:#808030; '>(</span>e<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 37:             <span style='color:#bb7977; font-weight:bold; '>System</span><span style='color:#808030; '>.</span>exit<span style='color:#808030; '>(</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 38:         <span style='color:#800080; '>}</span>
 39:     <span style='color:#800080; '>}</span>
 40: 
 41:     <span style='color:#800000; font-weight:bold; '>public</span> <span style='color:#800000; font-weight:bold; '>static</span> <span style='color:#bb7977; '>void</span> main<span style='color:#808030; '>(</span><span style='color:#bb7977; font-weight:bold; '>String</span> argv<span style='color:#808030; '>[</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span>
 42:     <span style='color:#800080; '>{</span>   <span style='color:#800000; font-weight:bold; '>try</span> 
 43:         <span style='color:#800080; '>{</span>   <span style='color:#bb7977; font-weight:bold; '>System</span><span style='color:#808030; '>.</span>out<span style='color:#808030; '>.</span>println <span style='color:#808030; '>(</span><span style='color:#0000e6; '>"  Java Openftch Sample"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 44: 
 45:             <span style='color:#bb7977; font-weight:bold; '>String</span> url <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"jdbc:db2:sample"</span><span style='color:#800080; '>;</span>       <span style='color:#696969; '>// URL is jdbc:db2:dbname</span>
 46:             <span style='color:#bb7977; font-weight:bold; '>Connection</span> con <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>null</span><span style='color:#800080; '>;</span>          
 47: 
 48:             <span style='color:#696969; '>// Set the connection</span>
 49:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>argv<span style='color:#808030; '>.</span>length <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> 
 50:             <span style='color:#800080; '>{</span>   <span style='color:#696969; '>// connect with default id/password</span>
 51:                 con <span style='color:#808030; '>=</span> <span style='color:#bb7977; font-weight:bold; '>DriverManager</span><span style='color:#808030; '>.</span>getConnection<span style='color:#808030; '>(</span>url<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>  
 52:             <span style='color:#800080; '>}</span>
 53:             <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>argv<span style='color:#808030; '>.</span>length <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span>
 54:             <span style='color:#800080; '>{</span>   <span style='color:#bb7977; font-weight:bold; '>String</span> userid <span style='color:#808030; '>=</span> argv<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
 55:                 <span style='color:#bb7977; font-weight:bold; '>String</span> passwd <span style='color:#808030; '>=</span> argv<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
 56: 
 57:                 <span style='color:#696969; '>// connect with user-provided username and password</span>
 58:                 con <span style='color:#808030; '>=</span> <span style='color:#bb7977; font-weight:bold; '>DriverManager</span><span style='color:#808030; '>.</span>getConnection<span style='color:#808030; '>(</span>url<span style='color:#808030; '>,</span> userid<span style='color:#808030; '>,</span> passwd<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span> 
 59:             <span style='color:#800080; '>}</span>
 60:             <span style='color:#800000; font-weight:bold; '>else</span> 
 61:             <span style='color:#800080; '>{</span>   <span style='color:#800000; font-weight:bold; '>throw</span> <span style='color:#800000; font-weight:bold; '>new</span> <span style='color:#bb7977; font-weight:bold; '>Exception</span><span style='color:#808030; '>(</span>
 62:                        <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>Usage: java Openftch [username password]</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 63:             <span style='color:#800080; '>}</span> <span style='color:#696969; '>// if - else if - else </span>
 64: 
 65:             <span style='color:#696969; '>// Set the default context</span>
 66:             DefaultContext ctx <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>new</span> DefaultContext<span style='color:#808030; '>(</span>con<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>            
 67:             DefaultContext<span style='color:#808030; '>.</span>setDefaultContext<span style='color:#808030; '>(</span>ctx<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 68: 
 69:             <span style='color:#696969; '>// Enable transactions</span>
 70:             con<span style='color:#808030; '>.</span>setAutoCommit<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>false</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 71: 
 72:             <span style='color:#696969; '>// Executing SQLJ positioned update/delete statements.</span>
 73:             <span style='color:#800000; font-weight:bold; '>try</span>
 74:             <span style='color:#800080; '>{</span>   OpF_Curs forUpdateCursor<span style='color:#800080; '>;</span>
 75: 
 76:                 <span style='color:#bb7977; font-weight:bold; '>String</span> name <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>null</span><span style='color:#800080; '>;</span>
 77:                 <span style='color:#bb7977; '>short</span>  dept<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 78:  
 79:  
 80:                 <span style='color:#004a43; '>#sql forUpdateCursor </span><span style='color:#808030; '>=</span><span style='color:#004a43; '> </span>
 81: <span style='color:#004a43; '>                </span><span style='color:#808030; '>{</span><span style='color:#004a43; '>   </span><span style='color:#800000; font-weight:bold; '>SELECT</span><span style='color:#004a43; '> name</span><span style='color:#808030; '>,</span><span style='color:#004a43; '> dept </span>
 82: <span style='color:#004a43; '>                        </span><span style='color:#800000; font-weight:bold; '>FROM</span><span style='color:#004a43; '> staff</span>
 83: <span style='color:#004a43; '>                        </span><span style='color:#800000; font-weight:bold; '>WHERE</span><span style='color:#004a43; '> job</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>'Mgr'</span><span style='color:#004a43; '> </span>
 84: <span style='color:#004a43; '>                </span><span style='color:#808030; '>}</span><span style='color:#004a43; '>;</span> <span style='color:#696969; '>// #sql            /* :rk.1:erk. *//* :rk.2:erk. */</span>
 85:  
 86:                 <span style='color:#800000; font-weight:bold; '>while</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>true</span><span style='color:#808030; '>)</span> 
 87:                 <span style='color:#800080; '>{</span>   <span style='color:#004a43; '>#sql </span>
 88: <span style='color:#004a43; '>                    </span><span style='color:#808030; '>{</span><span style='color:#004a43; '>   </span><span style='color:#800000; font-weight:bold; '>FETCH</span><span style='color:#004a43; '> </span><span style='color:#004a43; '>:forUpdateCursor</span><span style='color:#004a43; '></span>
 89: <span style='color:#004a43; '>                            </span><span style='color:#800000; font-weight:bold; '>INTO</span><span style='color:#004a43; '> </span><span style='color:#004a43; '>:name</span><span style='color:#808030; '>,</span><span style='color:#004a43; '> </span><span style='color:#004a43; '>:dept</span><span style='color:#004a43; '></span>
 90: <span style='color:#004a43; '>                    </span><span style='color:#808030; '>}</span><span style='color:#004a43; '>;</span> <span style='color:#696969; '>// #sql                        /* :rk.3:erk. */</span>
 91:                     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>forUpdateCursor<span style='color:#808030; '>.</span>endFetch<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 92: 
 93:                     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>dept <span style='color:#808030; '>></span> <span style='color:#008c00; '>40</span><span style='color:#808030; '>)</span>
 94:                     <span style='color:#800080; '>{</span>   <span style='color:#bb7977; font-weight:bold; '>System</span><span style='color:#808030; '>.</span>out<span style='color:#808030; '>.</span>println <span style='color:#808030; '>(</span>
 95:                             name <span style='color:#808030; '>+</span> <span style='color:#0000e6; '>" in dept. "</span> 
 96:                             <span style='color:#808030; '>+</span> dept <span style='color:#808030; '>+</span> <span style='color:#0000e6; '>" will be demoted to Clerk"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 97:                         <span style='color:#004a43; '>#sql</span>
 98: <span style='color:#004a43; '>                        </span><span style='color:#808030; '>{</span><span style='color:#004a43; '>   </span><span style='color:#800000; font-weight:bold; '>UPDATE</span><span style='color:#004a43; '> staff </span><span style='color:#800000; font-weight:bold; '>SET</span><span style='color:#004a43; '> job </span><span style='color:#808030; '>=</span><span style='color:#004a43; '> </span><span style='color:#0000e6; '>'Clerk'</span><span style='color:#004a43; '></span>
 99: <span style='color:#004a43; '>                            </span><span style='color:#800000; font-weight:bold; '>WHERE</span><span style='color:#004a43; '> </span><span style='color:#800000; font-weight:bold; '>CURRENT</span><span style='color:#004a43; '> </span><span style='color:#800000; font-weight:bold; '>OF</span><span style='color:#004a43; '> </span><span style='color:#004a43; '>:forUpdateCursor</span><span style='color:#004a43; '></span>
100: <span style='color:#004a43; '>                        </span><span style='color:#808030; '>}</span><span style='color:#004a43; '>;</span> <span style='color:#696969; '>// #sql                    /* :rk.4:erk. */</span>
101:                     <span style='color:#800080; '>}</span>
102:                     <span style='color:#800000; font-weight:bold; '>else</span>
103:                     <span style='color:#800080; '>{</span>   <span style='color:#bb7977; font-weight:bold; '>System</span><span style='color:#808030; '>.</span>out<span style='color:#808030; '>.</span>println <span style='color:#808030; '>(</span>
104:                             name <span style='color:#808030; '>+</span> <span style='color:#0000e6; '>" in dept. "</span> <span style='color:#808030; '>+</span> dept
105:                             <span style='color:#808030; '>+</span> <span style='color:#0000e6; '>" will be DELETED!"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
106:                         <span style='color:#004a43; '>#sql</span>
107: <span style='color:#004a43; '>                        </span><span style='color:#808030; '>{</span><span style='color:#004a43; '>   </span><span style='color:#800000; font-weight:bold; '>DELETE</span><span style='color:#004a43; '> </span><span style='color:#800000; font-weight:bold; '>FROM</span><span style='color:#004a43; '> staff</span>
108: <span style='color:#004a43; '>                            </span><span style='color:#800000; font-weight:bold; '>WHERE</span><span style='color:#004a43; '> </span><span style='color:#800000; font-weight:bold; '>CURRENT</span><span style='color:#004a43; '> </span><span style='color:#800000; font-weight:bold; '>OF</span><span style='color:#004a43; '> </span><span style='color:#004a43; '>:forUpdateCursor</span><span style='color:#004a43; '></span>
109: <span style='color:#004a43; '>                        </span><span style='color:#808030; '>}</span><span style='color:#004a43; '>;</span> <span style='color:#696969; '>// #sql</span>
110:                     <span style='color:#800080; '>}</span> <span style='color:#696969; '>// if - else</span>
111:                 <span style='color:#800080; '>}</span>
112:                 forUpdateCursor<span style='color:#808030; '>.</span>close<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>  <span style='color:#696969; '>/* :rk.5:erk. */</span>
113:             <span style='color:#800080; '>}</span>
114:             <span style='color:#800000; font-weight:bold; '>catch</span><span style='color:#808030; '>(</span> <span style='color:#bb7977; font-weight:bold; '>Exception</span> e <span style='color:#808030; '>)</span>
115:             <span style='color:#800080; '>{</span>   <span style='color:#800000; font-weight:bold; '>throw</span> e<span style='color:#800080; '>;</span> 
116:             <span style='color:#800080; '>}</span> 
117:             <span style='color:#800000; font-weight:bold; '>finally</span>
118:             <span style='color:#800080; '>{</span>   <span style='color:#696969; '>// Rollback the transaction</span>
119:                 <span style='color:#bb7977; font-weight:bold; '>System</span><span style='color:#808030; '>.</span>out<span style='color:#808030; '>.</span>println<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>Rollback the transaction..."</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
120:                 <span style='color:#004a43; '>#sql </span><span style='color:#808030; '>{</span><span style='color:#004a43; '> </span><span style='color:#800000; font-weight:bold; '>ROLLBACK</span><span style='color:#004a43; '> </span><span style='color:#808030; '>}</span><span style='color:#004a43; '>;</span>
121:                 <span style='color:#bb7977; font-weight:bold; '>System</span><span style='color:#808030; '>.</span>out<span style='color:#808030; '>.</span>println<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Rollback done."</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
122:             <span style='color:#800080; '>}</span> <span style='color:#696969; '>// try - catch - finally</span>
123:         <span style='color:#800080; '>}</span>
124:         <span style='color:#800000; font-weight:bold; '>catch</span><span style='color:#808030; '>(</span> <span style='color:#bb7977; font-weight:bold; '>Exception</span> e <span style='color:#808030; '>)</span>
125:         <span style='color:#800080; '>{</span>   <span style='color:#bb7977; font-weight:bold; '>System</span><span style='color:#808030; '>.</span>out<span style='color:#808030; '>.</span>println <span style='color:#808030; '>(</span>e<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
126:         <span style='color:#800080; '>}</span> <span style='color:#696969; '>// try - catch</span>
127:     <span style='color:#800080; '>}</span> <span style='color:#696969; '>// main</span>
128: <span style='color:#800080; '>}</span> <span style='color:#696969; '>// class Openftch</span>
129: 
</pre></body></html>
