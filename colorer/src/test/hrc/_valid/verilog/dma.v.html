<html><body style='color:#000000; background:#ffffff; '><pre>
  0: <span style='color:#696969; '>// 5.02.98      - date of creation</span>
  1: <span style='color:#696969; '>// Verilog HDL for "btx3_v3", "DMA" "functional"</span>
  2: 
  3: <span style='color:#800000; font-weight:bold; '>module DMA</span><span style='color:#808030; '>(</span>InSysClk<span style='color:#808030; '>,</span> DMA_BusReq<span style='color:#808030; '>,</span> BusGnt<span style='color:#808030; '>,</span> DMA_Sel<span style='color:#808030; '>,</span> DMA_Ack<span style='color:#808030; '>,</span> DMA_IntReq<span style='color:#808030; '>,</span> DMA_IntAck<span style='color:#808030; '>,</span> ADInput<span style='color:#808030; '>,</span> DMA_ADOutput<span style='color:#808030; '>,</span> DMA_ADOutEn<span style='color:#808030; '>,</span> SRd<span style='color:#808030; '>,</span> SWr<span style='color:#808030; '>,</span> InRun<span style='color:#808030; '>,</span> InAdr<span style='color:#808030; '>,</span> SysReset<span style='color:#808030; '>,</span> Ack<span style='color:#808030; '>,</span> Berr<span style='color:#808030; '>,</span> DMA_Rd<span style='color:#808030; '>,</span> DMA_Wr<span style='color:#808030; '>,</span> DMA_Burst<span style='color:#808030; '>,</span> DMA_ALE<span style='color:#808030; '>,</span> DMA_DataEn<span style='color:#808030; '>,</span> DMA_Cycle<span style='color:#808030; '>,</span> DMA_Adr3_2<span style='color:#808030; '>,</span> ADPInput<span style='color:#808030; '>,</span> DMA_ADPOutput<span style='color:#808030; '>,</span> DMA_ADPOutEn<span style='color:#808030; '>)</span> <span style='color:#808030; '>;</span>
  4: <span style='color:#800000; font-weight:bold; '>input</span>   InSysClk<span style='color:#800000; font-weight:bold; '>;</span>
  5: <span style='color:#800000; font-weight:bold; '>output</span>  DMA_BusReq<span style='color:#800000; font-weight:bold; '>;</span>
  6: <span style='color:#800000; font-weight:bold; '>reg</span>     DMA_BusReq<span style='color:#800000; font-weight:bold; '>;</span>
  7: <span style='color:#800000; font-weight:bold; '>input</span>   BusGnt<span style='color:#800000; font-weight:bold; '>;</span>
  8: <span style='color:#800000; font-weight:bold; '>input</span>   DMA_Sel<span style='color:#800000; font-weight:bold; '>;</span>
  9: <span style='color:#800000; font-weight:bold; '>output</span>  DMA_Ack<span style='color:#800000; font-weight:bold; '>;</span>
 10: <span style='color:#800000; font-weight:bold; '>output</span>  DMA_IntReq<span style='color:#800000; font-weight:bold; '>;</span>
 11: <span style='color:#800000; font-weight:bold; '>input</span>   DMA_IntAck<span style='color:#800000; font-weight:bold; '>;</span>
 12: <span style='color:#800000; font-weight:bold; '>input</span>   <span style='color:#808030; '>[</span><span style='color:#008c00; '>31</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span>  ADInput<span style='color:#800000; font-weight:bold; '>;</span>
 13: <span style='color:#800000; font-weight:bold; '>output</span>  <span style='color:#808030; '>[</span><span style='color:#008c00; '>31</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span>  DMA_ADOutput<span style='color:#800000; font-weight:bold; '>;</span>
 14: <span style='color:#800000; font-weight:bold; '>output</span>  DMA_ADOutEn<span style='color:#800000; font-weight:bold; '>;</span>
 15: <span style='color:#800000; font-weight:bold; '>input</span>   SRd<span style='color:#808030; '>,</span> SWr<span style='color:#808030; '>,</span> InRun<span style='color:#800000; font-weight:bold; '>;</span>
 16: <span style='color:#800000; font-weight:bold; '>input</span>   <span style='color:#808030; '>[</span><span style='color:#008c00; '>5</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span>   InAdr<span style='color:#800000; font-weight:bold; '>;</span>
 17: <span style='color:#800000; font-weight:bold; '>input</span>   SysReset<span style='color:#800000; font-weight:bold; '>;</span>
 18: <span style='color:#800000; font-weight:bold; '>input</span>   Ack<span style='color:#808030; '>,</span> Berr<span style='color:#800000; font-weight:bold; '>;</span>
 19: <span style='color:#800000; font-weight:bold; '>output</span>  DMA_Rd<span style='color:#808030; '>,</span> DMA_Wr<span style='color:#808030; '>,</span> DMA_ALE<span style='color:#808030; '>,</span> DMA_DataEn<span style='color:#808030; '>,</span> DMA_Burst<span style='color:#800000; font-weight:bold; '>;</span>
 20: <span style='color:#800000; font-weight:bold; '>output</span>  DMA_Cycle<span style='color:#800000; font-weight:bold; '>;</span>
 21: <span style='color:#800000; font-weight:bold; '>output</span>  <span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span>   DMA_Adr3_2<span style='color:#800000; font-weight:bold; '>;</span>
 22: <span style='color:#800000; font-weight:bold; '>input</span>   <span style='color:#808030; '>[</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span>   ADPInput<span style='color:#800000; font-weight:bold; '>;</span>
 23: <span style='color:#800000; font-weight:bold; '>output</span>  <span style='color:#808030; '>[</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span>   DMA_ADPOutput<span style='color:#800000; font-weight:bold; '>;</span>
 24: <span style='color:#800000; font-weight:bold; '>output</span>          DMA_ADPOutEn<span style='color:#800000; font-weight:bold; '>;</span>
 25: 
 26: <span style='color:#800000; font-weight:bold; '>reg</span>     <span style='color:#808030; '>[</span><span style='color:#008c00; '>31</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span>  InitAdr_A<span style='color:#808030; '>,</span> InitAdr_B<span style='color:#808030; '>,</span> InitTransfLengh<span style='color:#800000; font-weight:bold; '>;</span>
 27: <span style='color:#800000; font-weight:bold; '>wire</span>    <span style='color:#808030; '>[</span><span style='color:#008c00; '>31</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span>  CurrentAdr_A<span style='color:#808030; '>,</span> CurrentAdr_B<span style='color:#808030; '>,</span> CurrentTransfLengh<span style='color:#800000; font-weight:bold; '>;</span>
 28: <span style='color:#800000; font-weight:bold; '>reg</span>     <span style='color:#808030; '>[</span><span style='color:#008c00; '>7</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span>   BurstLengh<span style='color:#808030; '>,</span> TimeOutLengh<span style='color:#800000; font-weight:bold; '>;</span>
 29: <span style='color:#800000; font-weight:bold; '>wire</span>    <span style='color:#808030; '>[</span><span style='color:#008c00; '>31</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span>  RegOut<span style='color:#800000; font-weight:bold; '>;</span>
 30: <span style='color:#800000; font-weight:bold; '>wire</span>    <span style='color:#808030; '>[</span><span style='color:#008c00; '>31</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span>  StatusRegOut<span style='color:#800000; font-weight:bold; '>;</span>
 31: <span style='color:#800000; font-weight:bold; '>reg</span>     <span style='color:#808030; '>[</span><span style='color:#008c00; '>31</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span>  StoreReg<span style='color:#808030; '>,</span> DataOut<span style='color:#800000; font-weight:bold; '>;</span>
 32: <span style='color:#800000; font-weight:bold; '>reg</span>     <span style='color:#808030; '>[</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span>   StoreParReg<span style='color:#800000; font-weight:bold; '>;</span>
 33: <span style='color:#800000; font-weight:bold; '>wire</span>    WrReg<span style='color:#800000; font-weight:bold; '>;</span>
 34: <span style='color:#800000; font-weight:bold; '>reg</span>     DMA_Ack<span style='color:#808030; '>,</span> SDMA_DataEn<span style='color:#808030; '>,</span> DMA_Burst<span style='color:#808030; '>,</span> DMA_IntReq<span style='color:#800000; font-weight:bold; '>;</span>
 35: <span style='color:#800000; font-weight:bold; '>reg</span>     SAck<span style='color:#808030; '>,</span> SBerr<span style='color:#808030; '>,</span> SEnd<span style='color:#800000; font-weight:bold; '>;</span>
 36: <span style='color:#800000; font-weight:bold; '>reg</span>     <span style='color:#808030; '>[</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span>   state<span style='color:#800000; font-weight:bold; '>;</span>
 37: <span style='color:#800000; font-weight:bold; '>wire</span>    AtoB<span style='color:#808030; '>,</span> BtoA<span style='color:#808030; '>,</span> DMAReg_Out<span style='color:#808030; '>,</span> DelAfterRead<span style='color:#808030; '>,</span> WordFill<span style='color:#800000; font-weight:bold; '>;</span>
 38: <span style='color:#800000; font-weight:bold; '>reg</span>     WrState<span style='color:#808030; '>,</span> RdState<span style='color:#808030; '>,</span>  LoadTimeOut<span style='color:#800000; font-weight:bold; '>;</span>
 39: <span style='color:#800000; font-weight:bold; '>reg</span>     LoadCounter<span style='color:#808030; '>,</span> DMA_InProgress<span style='color:#808030; '>,</span> TimeOutDone<span style='color:#800000; font-weight:bold; '>;</span>
 40: <span style='color:#800000; font-weight:bold; '>wire</span>    Burst_Done<span style='color:#808030; '>,</span>LoadBurst<span style='color:#808030; '>,</span> BurstLengh_En<span style='color:#808030; '>,</span> ParError<span style='color:#808030; '>,</span> DMA_Done<span style='color:#800000; font-weight:bold; '>;</span>
 41: <span style='color:#800000; font-weight:bold; '>reg</span>     BusErrFlag<span style='color:#800000; font-weight:bold; '>;</span>
 42: 
 43: <span style='color:#696969; '>//</span>
 44: <span style='color:#696969; '>//********* state</span>
 45: <span style='color:#800000; font-weight:bold; '>parameter</span>       IDLE            <span style='color:#808030; '>=</span> <span style='color:#008c00; '>4'h0</span><span style='color:#800000; font-weight:bold; '>;</span>
 46: <span style='color:#800000; font-weight:bold; '>parameter</span>       READ            <span style='color:#808030; '>=</span> <span style='color:#008c00; '>4'h1</span><span style='color:#800000; font-weight:bold; '>;</span>
 47: <span style='color:#800000; font-weight:bold; '>parameter</span>       WRITE           <span style='color:#808030; '>=</span> <span style='color:#008c00; '>4'h2</span><span style='color:#800000; font-weight:bold; '>;</span>
 48: <span style='color:#800000; font-weight:bold; '>parameter</span>       WAIT_ACK_Read   <span style='color:#808030; '>=</span> <span style='color:#008c00; '>4'h3</span><span style='color:#800000; font-weight:bold; '>;</span>
 49: <span style='color:#800000; font-weight:bold; '>parameter</span>       WAIT_ACK_Write  <span style='color:#808030; '>=</span> <span style='color:#008c00; '>4'h4</span><span style='color:#800000; font-weight:bold; '>;</span>
 50: <span style='color:#800000; font-weight:bold; '>parameter</span>       TIME_OUT        <span style='color:#808030; '>=</span> <span style='color:#008c00; '>4'h5</span><span style='color:#800000; font-weight:bold; '>;</span>
 51: <span style='color:#800000; font-weight:bold; '>parameter</span>       ERROR           <span style='color:#808030; '>=</span> <span style='color:#008c00; '>4'h6</span><span style='color:#800000; font-weight:bold; '>;</span>
 52: <span style='color:#800000; font-weight:bold; '>parameter</span>       STOP            <span style='color:#808030; '>=</span> <span style='color:#008c00; '>4'h7</span><span style='color:#800000; font-weight:bold; '>;</span>
 53: <span style='color:#800000; font-weight:bold; '>parameter</span>       DEL_AFTER_READ  <span style='color:#808030; '>=</span> <span style='color:#008c00; '>4'h8</span><span style='color:#800000; font-weight:bold; '>;</span>
 54: <span style='color:#800000; font-weight:bold; '>parameter</span>       BUS_REQ         <span style='color:#808030; '>=</span> <span style='color:#008c00; '>4'h9</span><span style='color:#800000; font-weight:bold; '>;</span>
 55: <span style='color:#696969; '>//***********</span>
 56: <span style='color:#800000; font-weight:bold; '>wire</span>    InitAdr_ASel    <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>InAdr<span style='color:#808030; '>[</span><span style='color:#008c00; '>5</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>4'h1</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>;</span> <span style='color:#696969; '>//0x4</span>
 57: <span style='color:#800000; font-weight:bold; '>wire</span>    InitAdr_BSel    <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>InAdr<span style='color:#808030; '>[</span><span style='color:#008c00; '>5</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>4'h2</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>;</span> <span style='color:#696969; '>//0x8</span>
 58: <span style='color:#800000; font-weight:bold; '>wire</span>    CurrentAdr_ASel <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>InAdr<span style='color:#808030; '>[</span><span style='color:#008c00; '>5</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>4'h3</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>;</span> <span style='color:#696969; '>//0xc</span>
 59: <span style='color:#800000; font-weight:bold; '>wire</span>    CurrentAdr_BSel <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>InAdr<span style='color:#808030; '>[</span><span style='color:#008c00; '>5</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>4'h4</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>;</span> <span style='color:#696969; '>//0x10</span>
 60: <span style='color:#800000; font-weight:bold; '>wire</span>    InitTransfLenghSel      <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>InAdr<span style='color:#808030; '>[</span><span style='color:#008c00; '>5</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>4'h5</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>;</span><span style='color:#696969; '>//0x14</span>
 61: <span style='color:#800000; font-weight:bold; '>wire</span>    CurrentTransfLenghSel   <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>InAdr<span style='color:#808030; '>[</span><span style='color:#008c00; '>5</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>4'h6</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>;</span><span style='color:#696969; '>//0x18</span>
 62: <span style='color:#800000; font-weight:bold; '>wire</span>    BurstLenghSel           <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>InAdr<span style='color:#808030; '>[</span><span style='color:#008c00; '>5</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>4'h7</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>;</span><span style='color:#696969; '>//0x1c</span>
 63: <span style='color:#800000; font-weight:bold; '>wire</span>    TimeOutLenghSel         <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>InAdr<span style='color:#808030; '>[</span><span style='color:#008c00; '>5</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>4'h8</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>;</span><span style='color:#696969; '>//0x20</span>
 64: <span style='color:#800000; font-weight:bold; '>wire</span>    StatusRegSel            <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>InAdr<span style='color:#808030; '>[</span><span style='color:#008c00; '>5</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>4'h0</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>;</span><span style='color:#696969; '>//0x0</span>
 65: 
 66: <span style='color:#696969; '>// read/write registers</span>
 67: <span style='color:#696969; '>// initAdrA</span>
 68: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
 69:         if<span style='color:#808030; '>(</span>SysReset<span style='color:#808030; '>)</span>    InitAdr_A       <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>32'h00000000</span><span style='color:#808030; '>;</span>
 70:         else
 71:         if<span style='color:#808030; '>(</span>WrReg <span style='color:#808030; '>&amp;</span> InitAdr_ASel<span style='color:#808030; '>)</span>        InitAdr_A       <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#800080; '>{</span>ADInput<span style='color:#808030; '>[</span><span style='color:#008c00; '>31</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>2'b00</span><span style='color:#800080; '>}</span><span style='color:#808030; '>;</span>
 72: <span style='color:#696969; '>// initAdrB</span>
 73: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
 74:         if<span style='color:#808030; '>(</span>SysReset<span style='color:#808030; '>)</span>    InitAdr_B       <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>32'h00000000</span><span style='color:#808030; '>;</span>
 75:         else
 76:         if<span style='color:#808030; '>(</span>WrReg <span style='color:#808030; '>&amp;</span> InitAdr_BSel<span style='color:#808030; '>)</span>        InitAdr_B       <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#800080; '>{</span>ADInput<span style='color:#808030; '>[</span><span style='color:#008c00; '>31</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>2'b00</span><span style='color:#800080; '>}</span><span style='color:#808030; '>;</span>
 77: <span style='color:#696969; '>//</span>
 78: <span style='color:#696969; '>// initTransfLengh</span>
 79: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
 80:         if<span style='color:#808030; '>(</span>SysReset<span style='color:#808030; '>)</span>    InitTransfLengh <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>32'h00000000</span><span style='color:#808030; '>;</span>
 81:         else
 82:         if<span style='color:#808030; '>(</span>WrReg <span style='color:#808030; '>&amp;</span> InitTransfLenghSel<span style='color:#808030; '>)</span>  InitTransfLengh <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#800080; '>{</span>ADInput<span style='color:#808030; '>[</span><span style='color:#008c00; '>31</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>2'b0</span><span style='color:#800080; '>}</span><span style='color:#808030; '>;</span>
 83: <span style='color:#696969; '>//</span>
 84: <span style='color:#696969; '>// BurstLengh</span>
 85: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
 86:         if<span style='color:#808030; '>(</span>SysReset<span style='color:#808030; '>)</span>    BurstLengh      <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>8'h00</span><span style='color:#808030; '>;</span>
 87:         else
 88:         if<span style='color:#808030; '>(</span>WrReg <span style='color:#808030; '>&amp;</span> BurstLenghSel<span style='color:#808030; '>)</span>       BurstLengh      <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ADInput<span style='color:#808030; '>[</span><span style='color:#008c00; '>7</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>;</span>
 89: <span style='color:#696969; '>// TimeOutLengh</span>
 90: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
 91:         if<span style='color:#808030; '>(</span>SysReset<span style='color:#808030; '>)</span>    TimeOutLengh    <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>8'h00</span><span style='color:#808030; '>;</span>
 92:         else
 93:         if<span style='color:#808030; '>(</span>WrReg <span style='color:#808030; '>&amp;</span> TimeOutLenghSel<span style='color:#808030; '>)</span>     TimeOutLengh    <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ADInput<span style='color:#808030; '>[</span><span style='color:#008c00; '>7</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>;</span>
 94: <span style='color:#696969; '>//</span>
 95: <span style='color:#800000; font-weight:bold; '>reg</span>     Status0<span style='color:#808030; '>,</span>Status1<span style='color:#808030; '>,</span>Status2<span style='color:#808030; '>,</span>Status3<span style='color:#808030; '>,</span>Status4<span style='color:#808030; '>,</span>Status5<span style='color:#808030; '>,</span>Status6<span style='color:#808030; '>,</span> Status7<span style='color:#808030; '>,</span>Status8<span style='color:#808030; '>,</span>Status9<span style='color:#808030; '>,</span> Status10<span style='color:#808030; '>,</span>Status14<span style='color:#808030; '>,</span>Status15<span style='color:#800000; font-weight:bold; '>;</span>
 96: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
 97:         if<span style='color:#808030; '>(</span>SysReset<span style='color:#808030; '>)</span>    <span style='color:#800000; font-weight:bold; '>begin</span>                   
 98:                         Status3 <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
 99:                         Status4 <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
100:                         Status5 <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
101:                         Status6 <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
102:                         Status7 <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
103:                         Status8 <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
104:                         Status9 <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
105:                         Status14        <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
106:                         <span style='color:#800000; font-weight:bold; '>end</span>
107:         else    
108:         if<span style='color:#808030; '>(</span>WrReg <span style='color:#808030; '>&amp;</span> StatusRegSel<span style='color:#808030; '>)</span>
109:                         <span style='color:#800000; font-weight:bold; '>begin</span>   
110:                                 Status3         <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ADInput<span style='color:#008c00; '>[3]</span><span style='color:#808030; '>;</span>
111:                                 Status4         <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ADInput<span style='color:#008c00; '>[4]</span><span style='color:#808030; '>;</span>
112:                                 Status5         <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ADInput<span style='color:#008c00; '>[5]</span><span style='color:#808030; '>;</span>
113:                                 Status6         <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ADInput<span style='color:#008c00; '>[6]</span><span style='color:#808030; '>;</span>
114:                                 Status7         <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ADInput<span style='color:#008c00; '>[7]</span><span style='color:#808030; '>;</span>
115:                                 Status8         <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ADInput<span style='color:#008c00; '>[8]</span><span style='color:#808030; '>;</span>
116:                                 Status9         <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ADInput<span style='color:#008c00; '>[9]</span><span style='color:#808030; '>;</span>
117:                                 Status14        <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ADInput<span style='color:#008c00; '>[14]</span><span style='color:#808030; '>;</span>
118:                 <span style='color:#800000; font-weight:bold; '>end</span>
119: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
120:         if<span style='color:#808030; '>(</span>SysReset<span style='color:#808030; '>)</span>    Status0 <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
121:         else
122:         if<span style='color:#808030; '>(</span>WrReg <span style='color:#808030; '>&amp;</span> StatusRegSel<span style='color:#808030; '>)</span>        Status0 <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ADInput<span style='color:#008c00; '>[0]</span><span style='color:#808030; '>;</span>
123:         else
124:         if<span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> STOP<span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> ERROR<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>  Status0 <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
125: <span style='color:#696969; '>//</span>
126: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
127:         if<span style='color:#808030; '>(</span>SysReset<span style='color:#808030; '>)</span>    Status1 <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
128:         else
129:         if<span style='color:#808030; '>(</span>WrReg <span style='color:#808030; '>&amp;</span> StatusRegSel <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>ADInput<span style='color:#808030; '>)</span>     Status1 <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
130:         else
131:         if<span style='color:#808030; '>(</span>BusErrFlag <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> ERROR<span style='color:#808030; '>)</span> <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>BtoA <span style='color:#808030; '>&amp;</span> RdState<span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>AtoB <span style='color:#808030; '>&amp;</span> WrState<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>       Status1 <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
132: <span style='color:#696969; '>//</span>
133: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
134:         if<span style='color:#808030; '>(</span>SysReset<span style='color:#808030; '>)</span>    Status2 <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
135:         else
136:         if<span style='color:#808030; '>(</span>WrReg <span style='color:#808030; '>&amp;</span> StatusRegSel <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>ADInput<span style='color:#808030; '>)</span>     Status2 <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
137:         else
138:         if<span style='color:#808030; '>(</span>BusErrFlag <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> ERROR<span style='color:#808030; '>)</span> <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>AtoB <span style='color:#808030; '>&amp;</span> RdState<span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>BtoA <span style='color:#808030; '>&amp;</span> WrState<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>       Status2 <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
139: <span style='color:#696969; '>//</span>
140: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
141:         if<span style='color:#808030; '>(</span>SysReset<span style='color:#808030; '>)</span>    Status10        <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
142:         else
143:         if<span style='color:#808030; '>(</span>WrReg <span style='color:#808030; '>&amp;</span> StatusRegSel <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>ADInput<span style='color:#808030; '>)</span>     Status10        <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
144:         else
145:         if<span style='color:#808030; '>(</span>ParError<span style='color:#808030; '>)</span>    Status10        <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
146: <span style='color:#696969; '>//</span>
147: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
148:         if<span style='color:#808030; '>(</span>SysReset<span style='color:#808030; '>)</span>    Status15        <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
149:         else
150:         if<span style='color:#808030; '>(</span>WrReg <span style='color:#808030; '>&amp;</span> StatusRegSel <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>ADInput<span style='color:#808030; '>)</span>     Status15        <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
151:         else
152:         if<span style='color:#808030; '>(</span>DMA_IntAck<span style='color:#808030; '>)</span>                          Status15        <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
153:         else
154:         if<span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> STOP<span style='color:#808030; '>)</span>       Status15        <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>;</span>
155: 
156: <span style='color:#800000; font-weight:bold; '>assign</span>  StatusRegOut <span style='color:#808030; '>=</span> <span style='color:#800080; '>{</span>Status15<span style='color:#808030; '>,</span> Status14<span style='color:#808030; '>,</span> <span style='color:#008c00; '>3'h0</span><span style='color:#808030; '>,</span> Status10<span style='color:#808030; '>,</span> Status9<span style='color:#808030; '>,</span> Status8<span style='color:#808030; '>,</span> Status7<span style='color:#808030; '>,</span> Status6<span style='color:#808030; '>,</span> Status5<span style='color:#808030; '>,</span> Status4<span style='color:#808030; '>,</span> Status3<span style='color:#808030; '>,</span> Status2<span style='color:#808030; '>,</span> Status1<span style='color:#808030; '>,</span> Status0<span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>;</span>          
157: 
158: <span style='color:#800000; font-weight:bold; '>assign</span>  RegOut  <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>DMAReg_Out <span style='color:#808030; '>&amp;</span> InitAdr_ASel<span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> InitAdr_A <span style='color:#808030; '>:</span> <span style='color:#008c00; '>32</span>'hzzzzzzzz<span style='color:#800000; font-weight:bold; '>;</span>
159: <span style='color:#800000; font-weight:bold; '>assign</span>  RegOut  <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>DMAReg_Out <span style='color:#808030; '>&amp;</span> InitAdr_BSel<span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> InitAdr_B <span style='color:#808030; '>:</span> <span style='color:#008c00; '>32</span>'hzzzzzzzz<span style='color:#800000; font-weight:bold; '>;</span>
160: <span style='color:#800000; font-weight:bold; '>assign</span>  RegOut  <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>DMAReg_Out <span style='color:#808030; '>&amp;</span> CurrentAdr_ASel<span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> CurrentAdr_A <span style='color:#808030; '>:</span> <span style='color:#008c00; '>32</span>'hzzzzzzzz<span style='color:#800000; font-weight:bold; '>;</span>
161: <span style='color:#800000; font-weight:bold; '>assign</span>  RegOut  <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>DMAReg_Out <span style='color:#808030; '>&amp;</span> CurrentAdr_BSel<span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> CurrentAdr_B <span style='color:#808030; '>:</span> <span style='color:#008c00; '>32</span>'hzzzzzzzz<span style='color:#800000; font-weight:bold; '>;</span>
162: <span style='color:#800000; font-weight:bold; '>assign</span>  RegOut  <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>DMAReg_Out <span style='color:#808030; '>&amp;</span> InitTransfLenghSel<span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> InitTransfLengh <span style='color:#808030; '>:</span> <span style='color:#008c00; '>32</span>'hzzzzzzzz<span style='color:#800000; font-weight:bold; '>;</span>
163: <span style='color:#800000; font-weight:bold; '>assign</span>  RegOut  <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>DMAReg_Out <span style='color:#808030; '>&amp;</span> CurrentTransfLenghSel<span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> CurrentTransfLengh <span style='color:#808030; '>:</span> <span style='color:#008c00; '>32</span>'hzzzzzzzz<span style='color:#800000; font-weight:bold; '>;</span>
164: <span style='color:#800000; font-weight:bold; '>assign</span>  RegOut  <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>DMAReg_Out <span style='color:#808030; '>&amp;</span> BurstLenghSel<span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> <span style='color:#800080; '>{</span><span style='color:#008c00; '>24'h000000</span><span style='color:#808030; '>,</span> BurstLengh<span style='color:#800080; '>}</span> <span style='color:#808030; '>:</span> <span style='color:#008c00; '>32</span>'hzzzzzzzz<span style='color:#800000; font-weight:bold; '>;</span>
165: <span style='color:#800000; font-weight:bold; '>assign</span>  RegOut  <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>DMAReg_Out <span style='color:#808030; '>&amp;</span> TimeOutLenghSel<span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> <span style='color:#800080; '>{</span><span style='color:#008c00; '>24'h000000</span><span style='color:#808030; '>,</span> TimeOutLengh<span style='color:#800080; '>}</span> <span style='color:#808030; '>:</span> <span style='color:#008c00; '>32</span>'hzzzzzzzz<span style='color:#800000; font-weight:bold; '>;</span>
166: <span style='color:#800000; font-weight:bold; '>assign</span>  RegOut  <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>DMAReg_Out <span style='color:#808030; '>&amp;</span> StatusRegSel<span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> <span style='color:#800080; '>{</span><span style='color:#008c00; '>16'h0000</span><span style='color:#808030; '>,</span> StatusRegOut<span style='color:#800080; '>}</span> <span style='color:#808030; '>:</span> <span style='color:#008c00; '>32</span>'hzzzzzzzz<span style='color:#800000; font-weight:bold; '>;</span>
167: <span style='color:#800000; font-weight:bold; '>wire</span>    BusPullDown     <span style='color:#808030; '>=</span> <span style='color:#808030; '>~</span>DMAReg_Out<span style='color:#800000; font-weight:bold; '>;</span>
168: <span style='color:#800000; font-weight:bold; '>assign</span>  RegOut  <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>BusPullDown<span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> <span style='color:#008c00; '>32'h0</span> <span style='color:#808030; '>:</span> <span style='color:#008c00; '>32</span>'hz<span style='color:#800000; font-weight:bold; '>;</span>
169: <span style='color:#696969; '>//************</span>
170: <span style='color:#800000; font-weight:bold; '>assign</span>  DMAReg_Out      <span style='color:#808030; '>=</span> SRd <span style='color:#808030; '>&amp;</span> DMA_Sel<span style='color:#800000; font-weight:bold; '>;</span>
171: 
172: <span style='color:#696969; '>//****************</span>
173: <span style='color:#800000; font-weight:bold; '>assign</span>  WrReg   <span style='color:#808030; '>=</span> SWr <span style='color:#808030; '>&amp;</span> DMA_Sel <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>DMA_Ack<span style='color:#800000; font-weight:bold; '>;</span>
174: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
175:         DMA_Ack <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> DMA_Sel<span style='color:#808030; '>;</span>
176: <span style='color:#696969; '>//</span>
177: <span style='color:#696969; '>//********</span>
178: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>InRun</span>)
179:         if<span style='color:#808030; '>(</span><span style='color:#808030; '>~</span>InRun<span style='color:#808030; '>)</span>
180:                 <span style='color:#800000; font-weight:bold; '>begin</span>
181:                 assign  DMA_Ack <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>    
182:                 <span style='color:#800000; font-weight:bold; '>end</span>
183:         else    <span style='color:#800000; font-weight:bold; '>begin</span>
184:                 deassign        DMA_Ack<span style='color:#808030; '>;</span>
185:                 <span style='color:#800000; font-weight:bold; '>end</span>
186: <span style='color:#696969; '>//******************************************************************</span>
187: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
188: if<span style='color:#808030; '>(</span>SysReset<span style='color:#808030; '>)</span>    state <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> IDLE<span style='color:#808030; '>;</span>
189: else
190: case<span style='color:#808030; '>(</span>state<span style='color:#808030; '>)</span>
191: IDLE<span style='color:#808030; '>:</span>   <span style='color:#800000; font-weight:bold; '>begin</span>
192:         <span style='color:#800000; font-weight:bold; '>if</span>(Status0) state <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> BUS_REQ<span style='color:#808030; '>;</span>
193:         <span style='color:#800000; font-weight:bold; '>else</span> state      <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> IDLE<span style='color:#808030; '>;</span>
194:         <span style='color:#800000; font-weight:bold; '>end</span>
195: BUS_REQ<span style='color:#808030; '>:</span>        
196:         if<span style='color:#808030; '>(</span><span style='color:#808030; '>~</span>BusGnt <span style='color:#808030; '>|</span> <span style='color:#808030; '>~</span>DMA_BusReq<span style='color:#808030; '>)</span>       state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> BUS_REQ<span style='color:#808030; '>;</span>
197:         else
198:         if<span style='color:#808030; '>(</span>RdState<span style='color:#808030; '>)</span>     state <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> READ<span style='color:#808030; '>;</span>
199:         else                    state <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> WRITE<span style='color:#808030; '>;</span>  
200: 
201: READ<span style='color:#808030; '>:</span>   if<span style='color:#808030; '>(</span>ParError<span style='color:#808030; '>)</span>    state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ERROR<span style='color:#808030; '>;</span>
202:         else    state <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> WAIT_ACK_Read<span style='color:#808030; '>;</span>
203: WAIT_ACK_Read<span style='color:#808030; '>:</span>
204:         if<span style='color:#808030; '>(</span>SBerr<span style='color:#808030; '>)</span>       state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ERROR<span style='color:#808030; '>;</span>
205:         else
206:         if<span style='color:#808030; '>(</span><span style='color:#808030; '>~</span>SAck<span style='color:#808030; '>)</span>       state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> WAIT_ACK_Read<span style='color:#808030; '>;</span>
207:         else
208:         if<span style='color:#808030; '>(</span><span style='color:#808030; '>~</span>WordFill<span style='color:#808030; '>)</span>           
209:                 if<span style='color:#808030; '>(</span>DelAfterRead<span style='color:#808030; '>)</span>        state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> DEL_AFTER_READ<span style='color:#808030; '>;</span>
210:                 else                    state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> READ<span style='color:#808030; '>;</span>
211:         else    
212:                 if<span style='color:#808030; '>(</span>DelAfterRead<span style='color:#808030; '>)</span>        state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> DEL_AFTER_READ<span style='color:#808030; '>;</span>
213:                 else                    state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> WRITE<span style='color:#808030; '>;</span>
214: DEL_AFTER_READ<span style='color:#808030; '>:</span> if<span style='color:#808030; '>(</span>ParError<span style='color:#808030; '>)</span>    state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ERROR<span style='color:#808030; '>;</span>
215:                 else
216:                 if<span style='color:#808030; '>(</span>WordFill<span style='color:#808030; '>)</span>    state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> WRITE<span style='color:#808030; '>;</span>
217:                 else            state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> READ<span style='color:#808030; '>;</span>
218: 
219: WRITE<span style='color:#808030; '>:</span>  if<span style='color:#808030; '>(</span>ParError<span style='color:#808030; '>)</span>    state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ERROR<span style='color:#808030; '>;</span>
220:         else    state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> WAIT_ACK_Write<span style='color:#808030; '>;</span>
221: WAIT_ACK_Write<span style='color:#808030; '>:</span>
222:         if<span style='color:#808030; '>(</span>SBerr<span style='color:#808030; '>)</span>       state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ERROR<span style='color:#808030; '>;</span>
223:         else
224:         if<span style='color:#808030; '>(</span><span style='color:#808030; '>~</span>SAck<span style='color:#808030; '>)</span>       state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> WAIT_ACK_Write<span style='color:#808030; '>;</span>
225:         else    
226:         if<span style='color:#808030; '>(</span><span style='color:#808030; '>~</span>WordFill<span style='color:#808030; '>)</span>
227:                 state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> WRITE<span style='color:#808030; '>;</span>
228:         else                    
229:         if<span style='color:#808030; '>(</span><span style='color:#808030; '>~</span>DMA_Done<span style='color:#808030; '>)</span>   
230:                 if<span style='color:#808030; '>(</span>Burst_Done<span style='color:#808030; '>)</span>  state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> TIME_OUT<span style='color:#808030; '>;</span>
231:                 else
232:                 state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> READ<span style='color:#808030; '>;</span>
233:         else
234:         state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> STOP<span style='color:#808030; '>;</span>                                                                                        
235: STOP<span style='color:#808030; '>:</span>   state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> IDLE<span style='color:#808030; '>;</span>
236: ERROR<span style='color:#808030; '>:</span>  state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> STOP<span style='color:#808030; '>;</span>
237: TIME_OUT<span style='color:#808030; '>:</span>
238:         if<span style='color:#808030; '>(</span>TimeOutDone<span style='color:#808030; '>)</span> state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> BUS_REQ<span style='color:#808030; '>;</span>                             
239:         else            state   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> TIME_OUT<span style='color:#808030; '>;</span>
240: endcase
241: 
242: <span style='color:#696969; '>//</span>
243: <span style='color:#800000; font-weight:bold; '>assign</span>  DelAfterRead    <span style='color:#808030; '>=</span> <span style='color:#808030; '>~</span>Status8<span style='color:#800000; font-weight:bold; '>;</span>
244: 
245: <span style='color:#696969; '>//********* counters</span>
246: <span style='color:#800000; font-weight:bold; '>reg</span>     LoadAdrCounters<span style='color:#808030; '>,</span> IncAdrA_En<span style='color:#808030; '>,</span> IncAdrB_En<span style='color:#800000; font-weight:bold; '>;</span>
247: <span style='color:#800000; font-weight:bold; '>wire</span>     TransfLengh_En<span style='color:#800000; font-weight:bold; '>;</span>
248: <span style='color:#800000; font-weight:bold; '>wire</span>    LoadAll <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>Status0 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> IDLE<span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> SysReset<span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>;</span>
249: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
250:         <span style='color:#800000; font-weight:bold; '>begin</span>
251:         LoadAdrCounters         <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> LoadAll<span style='color:#808030; '>;</span>
252:         DMA_InProgress          <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> Status0 <span style='color:#808030; '>&amp;</span> BusGnt<span style='color:#808030; '>;</span>
253:         IncAdrA_En      <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#808030; '>~</span>ParError <span style='color:#808030; '>&amp;</span> (AtoB <span style='color:#808030; '>&amp;</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ)) <span style='color:#808030; '>|</span> (BtoA <span style='color:#808030; '>&amp;</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE)) <span style='color:#808030; '>|</span> LoadAll<span style='color:#808030; '>;</span>
254:         IncAdrB_En      <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> (<span style='color:#808030; '>~</span>ParError <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status4 <span style='color:#808030; '>&amp;</span> (BtoA <span style='color:#808030; '>&amp;</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ))) <span style='color:#808030; '>|</span> (<span style='color:#808030; '>~</span>Status4 <span style='color:#808030; '>&amp;</span> (AtoB <span style='color:#808030; '>&amp;</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE))) <span style='color:#808030; '>|</span> LoadAll<span style='color:#808030; '>;</span>
255:         <span style='color:#800000; font-weight:bold; '>end</span>
256: <span style='color:#800000; font-weight:bold; '>assign</span>          TransfLengh_En  <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>~</span>ParError <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ<span style='color:#808030; '>)</span> <span style='color:#808030; '>&amp;</span> AtoB<span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE<span style='color:#808030; '>)</span> <span style='color:#808030; '>&amp;</span> BtoA <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>ParError<span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> LoadAdrCounters<span style='color:#800000; font-weight:bold; '>;</span>
257: 
258: <span style='color:#800000; font-weight:bold; '>wire</span>    EnAdr1  <span style='color:#808030; '>=</span> Status6 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status7<span style='color:#800000; font-weight:bold; '>;</span>
259: <span style='color:#800000; font-weight:bold; '>wire</span>    EnAdr0  <span style='color:#808030; '>=</span> Status6 <span style='color:#808030; '>&amp;</span> Status5 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status7<span style='color:#800000; font-weight:bold; '>;</span>
260: <span style='color:#800000; font-weight:bold; '>wire</span>    <span style='color:#808030; '>[</span><span style='color:#008c00; '>7</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span>   CurrentBurstLengh<span style='color:#808030; '>,</span> CurrentTimeOut<span style='color:#800000; font-weight:bold; '>;</span>
261: 
262: bt83DMAcounter32        IncAdr_ACounter<span style='color:#808030; '>(</span>InSysClk<span style='color:#808030; '>,</span> IncAdrA_En<span style='color:#808030; '>,</span> LoadAdrCounters<span style='color:#808030; '>,</span> InitAdr_A<span style='color:#808030; '>,</span> CurrentAdr_A<span style='color:#808030; '>,</span> <span style='color:#008c00; '>1'b0</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>1'b0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
263: bt83DMAcounter32        IncAdr_BCounter<span style='color:#808030; '>(</span>InSysClk<span style='color:#808030; '>,</span> IncAdrB_En<span style='color:#808030; '>,</span> LoadAdrCounters<span style='color:#808030; '>,</span> InitAdr_B<span style='color:#808030; '>,</span> CurrentAdr_B<span style='color:#808030; '>,</span> EnAdr1<span style='color:#808030; '>,</span> EnAdr0<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
264: 
265: bt83DMAcounter32        TransfLenghCounter<span style='color:#808030; '>(</span>InSysClk<span style='color:#808030; '>,</span> TransfLengh_En<span style='color:#808030; '>,</span> LoadAdrCounters<span style='color:#808030; '>,</span> <span style='color:#008c00; '>32'h00000000</span><span style='color:#808030; '>,</span> CurrentTransfLengh<span style='color:#808030; '>,</span> <span style='color:#008c00; '>1'b0</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>1'b0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
266: 
267: bt83DMAcounter8 BurstLenghCounter<span style='color:#808030; '>(</span>InSysClk<span style='color:#808030; '>,</span> BurstLengh_En<span style='color:#808030; '>,</span> LoadBurst<span style='color:#808030; '>,</span> <span style='color:#008c00; '>8'h00</span><span style='color:#808030; '>,</span> CurrentBurstLengh<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
268: 
269: bt83DMAcounter8 TimeOutCounter<span style='color:#808030; '>(</span>InSysClk<span style='color:#808030; '>,</span> <span style='color:#008c00; '>1'b1</span><span style='color:#808030; '>,</span> LoadTimeOut<span style='color:#808030; '>,</span> <span style='color:#008c00; '>8'h00</span><span style='color:#808030; '>,</span> CurrentTimeOut<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
270: 
271: <span style='color:#800000; font-weight:bold; '>assign</span>  Burst_Done      <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>CurrentBurstLengh <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> BurstLengh<span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>;</span>
272: <span style='color:#800000; font-weight:bold; '>assign</span>  LoadBurst       <span style='color:#808030; '>=</span> LoadAll <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> TIME_OUT<span style='color:#808030; '>)</span> <span style='color:#808030; '>&amp;</span> TimeOutDone<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>;</span>
273: <span style='color:#800000; font-weight:bold; '>assign</span>  BurstLengh_En   <span style='color:#808030; '>=</span> LoadAll <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> TIME_OUT<span style='color:#808030; '>)</span> <span style='color:#808030; '>&amp;</span> TimeOutDone<span style='color:#808030; '>)</span> 
274:                         <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ<span style='color:#808030; '>)</span><span style='color:#808030; '>&amp;</span> AtoB<span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>BtoA <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>;</span>
275: <span style='color:#800000; font-weight:bold; '>assign</span>  DMA_Done        <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>CurrentTransfLengh<span style='color:#808030; '>[</span><span style='color:#008c00; '>31</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> InitTransfLengh<span style='color:#808030; '>[</span><span style='color:#008c00; '>31</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>;</span> 
276: 
277: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
278:         <span style='color:#800000; font-weight:bold; '>begin</span>
279:         TimeOutDone     <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> (CurrentTimeOut <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> TimeOutLengh)<span style='color:#808030; '>;</span>
280:         <span style='color:#800000; font-weight:bold; '>end</span>
281: <span style='color:#696969; '>// Count En</span>
282: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
283:         <span style='color:#800000; font-weight:bold; '>begin</span>
284:         LoadTimeOut     <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> SysReset 
285:                         <span style='color:#808030; '>|</span> (state !<span style='color:#808030; '>=</span> TIME_OUT)<span style='color:#808030; '>;</span>
286:         <span style='color:#800000; font-weight:bold; '>end</span>
287: <span style='color:#696969; '>// ****** WordFill</span>
288: <span style='color:#800000; font-weight:bold; '>reg</span>     <span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span>   BtCounter<span style='color:#800000; font-weight:bold; '>;</span>
289: <span style='color:#800000; font-weight:bold; '>assign</span>  AtoB    <span style='color:#808030; '>=</span> <span style='color:#808030; '>~</span>Status3<span style='color:#800000; font-weight:bold; '>;</span>
290: <span style='color:#800000; font-weight:bold; '>assign</span>  BtoA    <span style='color:#808030; '>=</span> Status3<span style='color:#800000; font-weight:bold; '>;</span>
291: <span style='color:#800000; font-weight:bold; '>assign</span>  WordFill <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>RdState <span style='color:#808030; '>&amp;</span> AtoB<span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>WrState <span style='color:#808030; '>&amp;</span> BtoA<span style='color:#808030; '>)</span> 
292:                 <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>RdState <span style='color:#808030; '>&amp;</span> BtoA <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>BtCounter <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
293:                 <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>WrState <span style='color:#808030; '>&amp;</span> AtoB <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>BtCounter <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>;</span>
294: 
295: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
296:         <span style='color:#800000; font-weight:bold; '>begin</span>
297:         <span style='color:#800000; font-weight:bold; '>if</span>(SysReset <span style='color:#808030; '>|</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> IDLE) <span style='color:#808030; '>|</span> ParError)       BtCounter <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>2'b00</span><span style='color:#808030; '>;</span>
298:         <span style='color:#800000; font-weight:bold; '>if</span> (((state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ) <span style='color:#808030; '>&amp;</span> BtoA) <span style='color:#808030; '>|</span> ((state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE) <span style='color:#808030; '>&amp;</span> AtoB))
299:          <span style='color:#800000; font-weight:bold; '>case</span><span style='color:#800000; font-weight:bold; '>(</span><span style='color:#800000; font-weight:bold; '>{</span>Status6<span style='color:#800000; font-weight:bold; '>,</span> Status5<span style='color:#800000; font-weight:bold; '>}</span><span style='color:#800000; font-weight:bold; '>)</span>
300:                 <span style='color:#008c00; '>2'b00</span><span style='color:#800000; font-weight:bold; '>:</span>  BtCounter       <span style='color:#800000; font-weight:bold; '>&lt;=</span> <span style='color:#008c00; '>0</span><span style='color:#800000; font-weight:bold; '>;</span>
301:                 <span style='color:#008c00; '>2'b10</span><span style='color:#800000; font-weight:bold; '>:</span>  BtCounter       <span style='color:#800000; font-weight:bold; '>&lt;=</span> BtCounter + <span style='color:#008c00; '>2</span><span style='color:#800000; font-weight:bold; '>;</span>
302:                 <span style='color:#008c00; '>2'b11</span><span style='color:#800000; font-weight:bold; '>:</span>  BtCounter       <span style='color:#800000; font-weight:bold; '>&lt;=</span> BtCounter + <span style='color:#008c00; '>1</span><span style='color:#800000; font-weight:bold; '>;</span>
303:                 <span style='color:#008c00; '>2'b01</span><span style='color:#800000; font-weight:bold; '>:</span>  BtCounter       <span style='color:#800000; font-weight:bold; '>&lt;=</span> BtCounter<span style='color:#800000; font-weight:bold; '>;</span>   
304:          <span style='color:#800000; font-weight:bold; '>endcase</span>
305:         <span style='color:#800000; font-weight:bold; '>end</span>
306: <span style='color:#696969; '>//******</span>
307: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
308:         <span style='color:#800000; font-weight:bold; '>begin</span>
309:         <span style='color:#800000; font-weight:bold; '>if</span> ((state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> IDLE) <span style='color:#808030; '>|</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WAIT_ACK_Read) <span style='color:#808030; '>|</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WAIT_ACK_Write) <span style='color:#808030; '>|</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ) <span style='color:#808030; '>|</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE))
310:                 <span style='color:#800000; font-weight:bold; '>begin</span>
311:                 RdState <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> IDLE) <span style='color:#808030; '>|</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ) <span style='color:#808030; '>|</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WAIT_ACK_Read <span style='color:#808030; '>&amp;</span> (<span style='color:#808030; '>~</span>SEnd <span style='color:#808030; '>|</span> <span style='color:#808030; '>~</span>WordFill)) <span style='color:#808030; '>|</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WAIT_ACK_Write <span style='color:#808030; '>&amp;</span> SEnd <span style='color:#808030; '>&amp;</span> WordFill) <span style='color:#808030; '>;</span>
312:                 WrState <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE) <span style='color:#808030; '>|</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WAIT_ACK_Read <span style='color:#808030; '>&amp;</span> SEnd <span style='color:#808030; '>&amp;</span> WordFill) <span style='color:#808030; '>|</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WAIT_ACK_Write <span style='color:#808030; '>&amp;</span> (<span style='color:#808030; '>~</span>SEnd <span style='color:#808030; '>|</span> <span style='color:#808030; '>~</span>WordFill)) <span style='color:#808030; '>;</span>
313:                 <span style='color:#800000; font-weight:bold; '>end</span>
314:         <span style='color:#800000; font-weight:bold; '>end</span>
315: <span style='color:#696969; '>//******* Data Path</span>
316: <span style='color:#696969; '>//read</span>
317: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
318:         <span style='color:#800000; font-weight:bold; '>begin</span>
319:         <span style='color:#800000; font-weight:bold; '>if</span>(state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> IDLE)       <span style='color:#800000; font-weight:bold; '>begin</span>   StoreReg        <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>32'h0</span><span style='color:#808030; '>;</span>
320:                                         StoreParReg     <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>4'h0</span><span style='color:#808030; '>;</span>
321:                                 <span style='color:#800000; font-weight:bold; '>end</span>
322:         <span style='color:#800000; font-weight:bold; '>else</span>
323:         <span style='color:#800000; font-weight:bold; '>if</span>((state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WAIT_ACK_Read) <span style='color:#808030; '>&amp;</span> SAck)
324:                 <span style='color:#800000; font-weight:bold; '>if</span>(AtoB)
325:                         <span style='color:#800000; font-weight:bold; '>begin</span>   StoreReg        <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ADInput<span style='color:#808030; '>;</span>
326:                                 StoreParReg     <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ADPInput<span style='color:#808030; '>;</span>
327:                         <span style='color:#800000; font-weight:bold; '>end</span>     
328:                 <span style='color:#800000; font-weight:bold; '>else</span>
329:         <span style='color:#800000; font-weight:bold; '>case</span><span style='color:#800000; font-weight:bold; '>(</span><span style='color:#800000; font-weight:bold; '>{</span>Status6<span style='color:#800000; font-weight:bold; '>,</span> Status5<span style='color:#800000; font-weight:bold; '>}</span><span style='color:#800000; font-weight:bold; '>)</span>
330: <span style='color:#008c00; '>2'b00</span><span style='color:#800000; font-weight:bold; '>:</span>          begin   StoreReg        <span style='color:#800000; font-weight:bold; '>&lt;=</span> ADInput<span style='color:#800000; font-weight:bold; '>;</span>
331:                         StoreParReg     <span style='color:#800000; font-weight:bold; '>&lt;=</span> ADPInput<span style='color:#800000; font-weight:bold; '>;</span>
332:                 end
333: <span style='color:#008c00; '>2'b10</span><span style='color:#800000; font-weight:bold; '>:</span>          if<span style='color:#800000; font-weight:bold; '>(</span>BtCounter == <span style='color:#008c00; '>2'h2</span><span style='color:#800000; font-weight:bold; '>)</span>   
334:                     if<span style='color:#800000; font-weight:bold; '>(</span>Status7|Status4<span style='color:#800000; font-weight:bold; '>)</span> begin StoreReg[<span style='color:#008c00; '>31</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>16</span>]<span style='color:#800000; font-weight:bold; '>&lt;=</span> ADInput[<span style='color:#008c00; '>31</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>16</span>]<span style='color:#800000; font-weight:bold; '>;</span>
335:                                         StoreParReg[<span style='color:#008c00; '>3</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>2</span>]<span style='color:#800000; font-weight:bold; '>&lt;=</span> ADPInput[<span style='color:#008c00; '>3</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>2</span>]<span style='color:#800000; font-weight:bold; '>;</span>
336:                                 end     
337:                     else        begin   StoreReg[<span style='color:#008c00; '>31</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>16</span>] <span style='color:#800000; font-weight:bold; '>&lt;=</span> ADInput[<span style='color:#008c00; '>31</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>16</span>]<span style='color:#800000; font-weight:bold; '>;</span>
338:                                         StoreParReg[<span style='color:#008c00; '>3</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>2</span>]<span style='color:#800000; font-weight:bold; '>&lt;=</span> ADPInput[<span style='color:#008c00; '>3</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>2</span>]<span style='color:#800000; font-weight:bold; '>;</span>
339:                                 end
340:                 else
341:                 if<span style='color:#800000; font-weight:bold; '>(</span>BtCounter == <span style='color:#008c00; '>2'h0</span><span style='color:#800000; font-weight:bold; '>)</span>   
342:                    if<span style='color:#800000; font-weight:bold; '>(</span>Status7|Status4<span style='color:#800000; font-weight:bold; '>)</span>  begin StoreReg[<span style='color:#008c00; '>15</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>0</span>]<span style='color:#800000; font-weight:bold; '>&lt;=</span> ADInput[<span style='color:#008c00; '>31</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>16</span>]<span style='color:#800000; font-weight:bold; '>;</span>
343:                                         StoreParReg[<span style='color:#008c00; '>1</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>0</span>]<span style='color:#800000; font-weight:bold; '>&lt;=</span> ADPInput[<span style='color:#008c00; '>3</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>2</span>]<span style='color:#800000; font-weight:bold; '>;</span>
344:                                 end
345:                     else        begin   StoreReg[<span style='color:#008c00; '>15</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>0</span>]  <span style='color:#800000; font-weight:bold; '>&lt;=</span> ADInput[<span style='color:#008c00; '>15</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>0</span>]<span style='color:#800000; font-weight:bold; '>;</span>
346:                                         StoreParReg[<span style='color:#008c00; '>1</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>0</span>]<span style='color:#800000; font-weight:bold; '>&lt;=</span> ADPInput[<span style='color:#008c00; '>1</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>0</span>]<span style='color:#800000; font-weight:bold; '>;</span>
347:                                 end
348: <span style='color:#008c00; '>2'b11</span><span style='color:#800000; font-weight:bold; '>:</span>          case<span style='color:#800000; font-weight:bold; '>(</span>BtCounter<span style='color:#800000; font-weight:bold; '>)</span>
349:         <span style='color:#008c00; '>2'b01</span><span style='color:#800000; font-weight:bold; '>:</span>  if<span style='color:#800000; font-weight:bold; '>(</span>Status7|Status4<span style='color:#800000; font-weight:bold; '>)</span>     begin StoreReg[<span style='color:#008c00; '>31</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>24</span>]&lt;=ADInput[<span style='color:#008c00; '>31</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>24</span>]<span style='color:#800000; font-weight:bold; '>;</span>
350:                                         StoreParReg<span style='color:#008c00; '>[3]</span>  <span style='color:#800000; font-weight:bold; '>&lt;=</span> ADPInput<span style='color:#008c00; '>[3]</span><span style='color:#800000; font-weight:bold; '>;</span>
351:                                 end
352:                 else            begin   StoreReg[<span style='color:#008c00; '>31</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>24</span>] <span style='color:#800000; font-weight:bold; '>&lt;=</span> ADInput[<span style='color:#008c00; '>31</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>24</span>]<span style='color:#800000; font-weight:bold; '>;</span>
353:                                         StoreParReg<span style='color:#008c00; '>[3]</span>  <span style='color:#800000; font-weight:bold; '>&lt;=</span> ADPInput<span style='color:#008c00; '>[3]</span><span style='color:#800000; font-weight:bold; '>;</span>
354:                                 end
355:         <span style='color:#008c00; '>2'b10</span><span style='color:#800000; font-weight:bold; '>:</span>  if<span style='color:#800000; font-weight:bold; '>(</span>Status7|Status4<span style='color:#800000; font-weight:bold; '>)</span>     begin StoreReg[<span style='color:#008c00; '>23</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>16</span>] <span style='color:#800000; font-weight:bold; '>&lt;=</span> ADInput[<span style='color:#008c00; '>31</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>24</span>]<span style='color:#800000; font-weight:bold; '>;</span>
356:                                         StoreParReg<span style='color:#008c00; '>[2]</span>  <span style='color:#800000; font-weight:bold; '>&lt;=</span> ADPInput<span style='color:#008c00; '>[3]</span><span style='color:#800000; font-weight:bold; '>;</span>
357:                                 end     
358:                 else            begin   StoreReg[<span style='color:#008c00; '>23</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>16</span>] <span style='color:#800000; font-weight:bold; '>&lt;=</span> ADInput[<span style='color:#008c00; '>23</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>16</span>]<span style='color:#800000; font-weight:bold; '>;</span>
359:                                         StoreParReg<span style='color:#008c00; '>[2]</span>  <span style='color:#800000; font-weight:bold; '>&lt;=</span> ADPInput<span style='color:#008c00; '>[2]</span><span style='color:#800000; font-weight:bold; '>;</span>
360:                                 end
361:         <span style='color:#008c00; '>2'b11</span><span style='color:#800000; font-weight:bold; '>:</span>  if<span style='color:#800000; font-weight:bold; '>(</span>Status7|Status4<span style='color:#800000; font-weight:bold; '>)</span>     begin StoreReg[<span style='color:#008c00; '>15</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>8</span>] <span style='color:#800000; font-weight:bold; '>&lt;=</span> ADInput[<span style='color:#008c00; '>31</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>24</span>]<span style='color:#800000; font-weight:bold; '>;</span>
362:                                         StoreParReg<span style='color:#008c00; '>[1]</span>  <span style='color:#800000; font-weight:bold; '>&lt;=</span> ADPInput<span style='color:#008c00; '>[3]</span><span style='color:#800000; font-weight:bold; '>;</span>
363:                                 end
364:                 else            begin   StoreReg[<span style='color:#008c00; '>15</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>8</span>]  <span style='color:#800000; font-weight:bold; '>&lt;=</span> ADInput[<span style='color:#008c00; '>15</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>8</span>]<span style='color:#800000; font-weight:bold; '>;</span>
365:                                         StoreParReg<span style='color:#008c00; '>[1]</span>  <span style='color:#800000; font-weight:bold; '>&lt;=</span> ADPInput<span style='color:#008c00; '>[1]</span><span style='color:#800000; font-weight:bold; '>;</span>
366:                                 end
367:         <span style='color:#008c00; '>2'b00</span><span style='color:#800000; font-weight:bold; '>:</span>  if<span style='color:#800000; font-weight:bold; '>(</span>Status7|Status4<span style='color:#800000; font-weight:bold; '>)</span>     begin StoreReg[<span style='color:#008c00; '>7</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>0</span>] <span style='color:#800000; font-weight:bold; '>&lt;=</span> ADInput[<span style='color:#008c00; '>31</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>24</span>]<span style='color:#800000; font-weight:bold; '>;</span>
368:                                         StoreParReg<span style='color:#008c00; '>[0]</span>  <span style='color:#800000; font-weight:bold; '>&lt;=</span> ADPInput<span style='color:#008c00; '>[3]</span><span style='color:#800000; font-weight:bold; '>;</span>
369:                                 end
370:                 else            begin   StoreReg[<span style='color:#008c00; '>7</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>0</span>]   <span style='color:#800000; font-weight:bold; '>&lt;=</span> ADInput[<span style='color:#008c00; '>7</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>0</span>]<span style='color:#800000; font-weight:bold; '>;</span>
371:                                         StoreParReg<span style='color:#008c00; '>[0]</span>  <span style='color:#800000; font-weight:bold; '>&lt;=</span> ADPInput<span style='color:#008c00; '>[0]</span><span style='color:#800000; font-weight:bold; '>;</span>
372:                                 end
373:                 <span style='color:#800000; font-weight:bold; '>endcase</span>
374:         endcase
375:         <span style='color:#800000; font-weight:bold; '>end</span>
376: <span style='color:#696969; '>//*** BE</span>
377: <span style='color:#800000; font-weight:bold; '>wire</span>    <span style='color:#808030; '>[</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span>   BE<span style='color:#800000; font-weight:bold; '>;</span>
378: <span style='color:#800000; font-weight:bold; '>assign</span>  BE<span style='color:#008c00; '>[0]</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>AtoB <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span>
379:                 <span style='color:#808030; '>(</span>BtoA <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span>
380:                 <span style='color:#808030; '>(</span>
381:                 <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>AtoB <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>BtoA <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> 
382:                 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#808030; '>~</span>Status6 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status5<span style='color:#808030; '>)</span> 
383:                 <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>Status6 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status5 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status4 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status7 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>BtCounter <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>2'h2</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> 
384:                 <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>Status6 <span style='color:#808030; '>&amp;</span> Status5 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status4 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status7 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>BtCounter <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>2'h3</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
385:                 <span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>;</span>
386: <span style='color:#800000; font-weight:bold; '>assign</span>  BE<span style='color:#008c00; '>[1]</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>AtoB <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span>
387:                 <span style='color:#808030; '>(</span>BtoA <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span>
388:                 <span style='color:#808030; '>(</span>
389:                 <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>AtoB <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>BtoA <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> 
390:                 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#808030; '>~</span>Status6 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status5<span style='color:#808030; '>)</span> 
391:                 <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>Status6 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status5 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status4 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status7 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>BtCounter <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>2'h2</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> 
392:                 <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>Status6 <span style='color:#808030; '>&amp;</span> Status5 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status4 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status7 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>BtCounter <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>2'h2</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
393:                 <span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>;</span>
394: <span style='color:#800000; font-weight:bold; '>assign</span>  BE<span style='color:#008c00; '>[2]</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>AtoB <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span>
395:                 <span style='color:#808030; '>(</span>BtoA <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span>
396:                 <span style='color:#808030; '>(</span>
397:                 <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>AtoB <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>BtoA <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> 
398:                 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#808030; '>~</span>Status6 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status5<span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>Status6 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status5 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>BtCounter <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>2'h0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>Status6 <span style='color:#808030; '>&amp;</span> Status5 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>BtCounter <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>2'h1</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
399:                 <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>Status6 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status5 <span style='color:#808030; '>&amp;</span> Status4<span style='color:#808030; '>)</span> 
400:                 <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>Status6 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status5 <span style='color:#808030; '>&amp;</span> Status7<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>;</span>
401: 
402: <span style='color:#800000; font-weight:bold; '>assign</span>  BE<span style='color:#008c00; '>[3]</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>AtoB <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span>
403:                 <span style='color:#808030; '>(</span>BtoA <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span>
404:                 <span style='color:#808030; '>(</span>
405:                 <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>AtoB <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>BtoA <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> 
406:                 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#808030; '>~</span>Status6 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status5<span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>Status6 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status5 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>BtCounter <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>2'h0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>Status6 <span style='color:#808030; '>&amp;</span> Status5 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>BtCounter <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>2'h0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
407:                 <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>Status6 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status5 <span style='color:#808030; '>&amp;</span> Status7<span style='color:#808030; '>)</span>
408:                 <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>Status6 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status5 <span style='color:#808030; '>&amp;</span> Status4<span style='color:#808030; '>)</span>
409:                 <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>Status6 <span style='color:#808030; '>&amp;</span> Status5 <span style='color:#808030; '>&amp;</span> Status4<span style='color:#808030; '>)</span>
410:                 <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>Status6 <span style='color:#808030; '>&amp;</span> Status5 <span style='color:#808030; '>&amp;</span> Status7<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>;</span>
411: 
412: <span style='color:#696969; '>// write</span>
413: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
414:  if<span style='color:#808030; '>(</span>SysReset<span style='color:#808030; '>)</span>   DataOut <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>31'h0</span><span style='color:#808030; '>;</span>
415:  else   
416:  if<span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE<span style='color:#808030; '>)</span>
417:  <span style='color:#800000; font-weight:bold; '>begin</span>
418:         <span style='color:#800000; font-weight:bold; '>if</span>(BtoA)
419:         DataOut <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> StoreReg<span style='color:#808030; '>;</span>
420:         <span style='color:#800000; font-weight:bold; '>else</span>
421:  <span style='color:#800000; font-weight:bold; '>case</span><span style='color:#800000; font-weight:bold; '>(</span><span style='color:#800000; font-weight:bold; '>{</span>Status6<span style='color:#800000; font-weight:bold; '>,</span> Status5<span style='color:#800000; font-weight:bold; '>}</span><span style='color:#800000; font-weight:bold; '>)</span>
422: <span style='color:#008c00; '>2'b00</span><span style='color:#800000; font-weight:bold; '>:</span>  DataOut <span style='color:#800000; font-weight:bold; '>&lt;=</span> StoreReg<span style='color:#800000; font-weight:bold; '>;</span>
423: <span style='color:#008c00; '>2'b10</span><span style='color:#800000; font-weight:bold; '>:</span>  if<span style='color:#800000; font-weight:bold; '>(</span>~Status7 &amp; ~Status4<span style='color:#800000; font-weight:bold; '>)</span> DataOut <span style='color:#800000; font-weight:bold; '>&lt;=</span> StoreReg<span style='color:#800000; font-weight:bold; '>;</span>
424:         else            
425:         case<span style='color:#800000; font-weight:bold; '>(</span>BtCounter<span style='color:#800000; font-weight:bold; '>)</span>
426:                 <span style='color:#008c00; '>2'b00</span><span style='color:#800000; font-weight:bold; '>:</span>  DataOut <span style='color:#800000; font-weight:bold; '>&lt;=</span> StoreReg<span style='color:#800000; font-weight:bold; '>;</span>
427:                 <span style='color:#008c00; '>2'b10</span><span style='color:#800000; font-weight:bold; '>:</span>  DataOut <span style='color:#800000; font-weight:bold; '>&lt;=</span> <span style='color:#800000; font-weight:bold; '>{</span>StoreReg[<span style='color:#008c00; '>15</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>0</span>]<span style='color:#800000; font-weight:bold; '>,</span> StoreReg[<span style='color:#008c00; '>15</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>0</span>]<span style='color:#800000; font-weight:bold; '>}</span><span style='color:#800000; font-weight:bold; '>;</span>
428:         <span style='color:#800000; font-weight:bold; '>endcase</span>
429: <span style='color:#008c00; '>2'b11</span><span style='color:#808030; '>:</span>  <span style='color:#800000; font-weight:bold; '>if</span>(<span style='color:#808030; '>~</span>Status7 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>Status4)         DataOut <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> StoreReg<span style='color:#808030; '>;</span>
430:         <span style='color:#800000; font-weight:bold; '>else</span>
431:         <span style='color:#800000; font-weight:bold; '>case</span><span style='color:#800000; font-weight:bold; '>(</span>BtCounter<span style='color:#800000; font-weight:bold; '>)</span>
432:                 <span style='color:#008c00; '>2'b00</span><span style='color:#800000; font-weight:bold; '>:</span>  DataOut <span style='color:#800000; font-weight:bold; '>&lt;=</span> StoreReg<span style='color:#800000; font-weight:bold; '>;</span>
433:                 <span style='color:#008c00; '>2'b01</span><span style='color:#800000; font-weight:bold; '>:</span>  DataOut <span style='color:#800000; font-weight:bold; '>&lt;=</span> <span style='color:#800000; font-weight:bold; '>{</span>StoreReg[<span style='color:#008c00; '>23</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>16</span>]<span style='color:#800000; font-weight:bold; '>,</span> StoreReg[<span style='color:#008c00; '>23</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>0</span>]<span style='color:#800000; font-weight:bold; '>}</span><span style='color:#800000; font-weight:bold; '>;</span>
434:                 <span style='color:#008c00; '>2'b10</span><span style='color:#800000; font-weight:bold; '>:</span>  DataOut <span style='color:#800000; font-weight:bold; '>&lt;=</span> <span style='color:#800000; font-weight:bold; '>{</span>StoreReg[<span style='color:#008c00; '>15</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>0</span>]<span style='color:#800000; font-weight:bold; '>,</span> StoreReg[<span style='color:#008c00; '>15</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>0</span>]<span style='color:#800000; font-weight:bold; '>}</span><span style='color:#800000; font-weight:bold; '>;</span>
435:                 <span style='color:#008c00; '>2'b11</span><span style='color:#800000; font-weight:bold; '>:</span>  DataOut <span style='color:#800000; font-weight:bold; '>&lt;=</span> <span style='color:#800000; font-weight:bold; '>{</span>StoreReg[<span style='color:#008c00; '>7</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>0</span>]<span style='color:#800000; font-weight:bold; '>,</span> StoreReg[<span style='color:#008c00; '>23</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#008c00; '>0</span>]<span style='color:#800000; font-weight:bold; '>}</span><span style='color:#800000; font-weight:bold; '>;</span>
436:         <span style='color:#800000; font-weight:bold; '>endcase</span>         
437:  endcase         
438:  <span style='color:#800000; font-weight:bold; '>end</span>
439: <span style='color:#696969; '>// BE</span>
440: 
441: <span style='color:#696969; '>//</span>
442: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>negedge InSysClk</span>)      
443:         <span style='color:#800000; font-weight:bold; '>begin</span>
444:         SAck    <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> Ack<span style='color:#808030; '>;</span>
445:         SBerr   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> Berr<span style='color:#808030; '>;</span>
446:         SEnd    <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> Ack <span style='color:#808030; '>|</span> Berr<span style='color:#808030; '>;</span>
447:         <span style='color:#800000; font-weight:bold; '>if</span>((state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> IDLE) <span style='color:#808030; '>|</span> SBerr)
448:         BusErrFlag      <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> SBerr<span style='color:#808030; '>;</span>
449:         <span style='color:#800000; font-weight:bold; '>end</span>
450: <span style='color:#696969; '>//</span>
451: <span style='color:#800000; font-weight:bold; '>reg</span>     SDMA_Rd<span style='color:#808030; '>,</span> SDMA_Wr<span style='color:#808030; '>,</span> DMA_ALE<span style='color:#808030; '>,</span> ResRead<span style='color:#808030; '>,</span> ResWrite<span style='color:#808030; '>,</span> ResALE<span style='color:#800000; font-weight:bold; '>;</span>
452: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>negedge InSysClk</span>)
453: <span style='color:#800000; font-weight:bold; '>begin</span>
454: SDMA_Rd <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ((state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ) <span style='color:#808030; '>|</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WAIT_ACK_Read)) <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>ParError<span style='color:#808030; '>;</span>
455: SDMA_Wr <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ((state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE) <span style='color:#808030; '>|</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WAIT_ACK_Write)) <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>ParError<span style='color:#808030; '>;</span>
456: DMA_ALE <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ((state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ) <span style='color:#808030; '>|</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE)) <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>ParError <span style='color:#808030; '>;</span>
457: 
458: <span style='color:#800000; font-weight:bold; '>end</span>
459: <span style='color:#696969; '>//</span>
460: <span style='color:#800000; font-weight:bold; '>reg</span>     DMA_DataOutEn<span style='color:#800000; font-weight:bold; '>;</span>
461: <span style='color:#800000; font-weight:bold; '>always</span>  @(<span style='color:#0000e6; '>posedge InSysClk</span>)
462:         <span style='color:#800000; font-weight:bold; '>begin</span>
463:         ResRead         <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WAIT_ACK_Read) <span style='color:#808030; '>&amp;</span> SEnd<span style='color:#808030; '>;</span>
464:         ResWrite        <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WAIT_ACK_Write) <span style='color:#808030; '>&amp;</span> SEnd<span style='color:#808030; '>;</span>
465:         ResALE          <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ) <span style='color:#808030; '>|</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE)<span style='color:#808030; '>;</span>
466:         SDMA_DataEn     <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> ((state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ) <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>ParError) <span style='color:#808030; '>|</span> ((state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WAIT_ACK_Read) <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>SEnd)<span style='color:#808030; '>;</span>
467:         DMA_Burst       <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>;</span>
468:         DMA_IntReq      <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span>  Status14 <span style='color:#808030; '>&amp;</span> Status15<span style='color:#808030; '>;</span>
469: 
470:         <span style='color:#800000; font-weight:bold; '>end</span>
471: <span style='color:#800000; font-weight:bold; '>assign</span>  DMA_DataEn      <span style='color:#808030; '>=</span> SDMA_DataEn <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>DMA_ALE<span style='color:#800000; font-weight:bold; '>;</span>
472: 
473: <span style='color:#696969; '>/*</span>
474: <span style='color:#696969; '>always @(ResRead)</span>
475: <span style='color:#696969; '>        if(ResRead)     assign  DMA_Rd  = 0;</span>
476: <span style='color:#696969; '>        else            deassign DMA_Rd;</span>
477: <span style='color:#696969; '>always @(ResWrite)</span>
478: <span style='color:#696969; '>        if(ResWrite)    assign  DMA_Wr  = 0;</span>
479: <span style='color:#696969; '>        else            deassign DMA_Wr;</span>
480: <span style='color:#696969; '>*/</span>
481: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>ResALE</span>)
482:         if<span style='color:#808030; '>(</span>ResALE<span style='color:#808030; '>)</span>      <span style='color:#800000; font-weight:bold; '>assign</span>  DMA_ALE <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800000; font-weight:bold; '>;</span>
483:         else            deassign        DMA_ALE<span style='color:#808030; '>;</span>
484: <span style='color:#696969; '>//</span>
485: <span style='color:#800000; font-weight:bold; '>wire</span>    DMA_Rd<span style='color:#808030; '>,</span> DMA_Wr<span style='color:#808030; '>,</span> ResReadAsync<span style='color:#808030; '>,</span> ResWriteAsync<span style='color:#800000; font-weight:bold; '>;</span>
486: <span style='color:#800000; font-weight:bold; '>assign</span>  ResWriteAsync   <span style='color:#808030; '>=</span> ResWrite <span style='color:#808030; '>&amp;</span> SEnd<span style='color:#800000; font-weight:bold; '>;</span>
487: <span style='color:#800000; font-weight:bold; '>assign</span>  ResReadAsync    <span style='color:#808030; '>=</span> ResRead <span style='color:#808030; '>&amp;</span> SEnd<span style='color:#800000; font-weight:bold; '>;</span>
488: <span style='color:#800000; font-weight:bold; '>assign</span>  DMA_Rd  <span style='color:#808030; '>=</span> SDMA_Rd <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>ResReadAsync<span style='color:#800000; font-weight:bold; '>;</span>
489: <span style='color:#800000; font-weight:bold; '>assign</span>  DMA_Wr  <span style='color:#808030; '>=</span> SDMA_Wr <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>ResWriteAsync<span style='color:#800000; font-weight:bold; '>;</span>
490: 
491: <span style='color:#696969; '>//</span>
492: <span style='color:#800000; font-weight:bold; '>wire</span>    <span style='color:#808030; '>[</span><span style='color:#008c00; '>31</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span>  AdrOut<span style='color:#800000; font-weight:bold; '>;</span>
493: <span style='color:#800000; font-weight:bold; '>assign</span>  AdrOut  <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>AtoB <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>BtoA <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> CurrentAdr_A <span style='color:#808030; '>:</span> CurrentAdr_B<span style='color:#800000; font-weight:bold; '>;</span>
494: <span style='color:#800000; font-weight:bold; '>assign</span>  DMA_ADOutput    <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>DMA_ALE<span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> <span style='color:#800080; '>{</span>AdrOut<span style='color:#808030; '>[</span><span style='color:#008c00; '>31</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>4</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>~</span>BE<span style='color:#800080; '>}</span> <span style='color:#808030; '>:</span> <span style='color:#808030; '>(</span>DMAReg_Out<span style='color:#808030; '>)</span> <span style='color:#808030; '>?</span> RegOut <span style='color:#808030; '>:</span> DataOut<span style='color:#800000; font-weight:bold; '>;</span>
495: <span style='color:#800000; font-weight:bold; '>assign</span>  DMA_ADOutEn     <span style='color:#808030; '>=</span> DMA_ALE <span style='color:#808030; '>|</span> DMA_DataOutEn <span style='color:#808030; '>|</span> DMAReg_Out<span style='color:#800000; font-weight:bold; '>;</span> 
496: <span style='color:#696969; '>//</span>
497: <span style='color:#800000; font-weight:bold; '>reg</span>     <span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span>   DMA_Adr3_2<span style='color:#800000; font-weight:bold; '>;</span>
498: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>negedge InSysClk</span>)
499:         <span style='color:#800000; font-weight:bold; '>begin</span>
500:         <span style='color:#800000; font-weight:bold; '>if</span>((state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ) <span style='color:#808030; '>|</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE))
501:         DMA_Adr3_2      <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span>  AdrOut<span style='color:#808030; '>[</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>;</span>
502: 
503:         DMA_DataOutEn   <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> (((state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE) <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>ParError) <span style='color:#808030; '>|</span> (state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WAIT_ACK_Write))<span style='color:#808030; '>;</span>
504: 
505:         <span style='color:#800000; font-weight:bold; '>end</span>
506: <span style='color:#696969; '>//</span>
507: <span style='color:#800000; font-weight:bold; '>assign</span>  DMA_Cycle       <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>DMA_BusReq <span style='color:#808030; '>&amp;</span> BusGnt<span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>;</span>
508: <span style='color:#800000; font-weight:bold; '>always</span> @(<span style='color:#0000e6; '>posedge InSysClk</span>)
509:         DMA_BusReq      <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> BUS_REQ<span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> READ<span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WAIT_ACK_Read<span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WRITE<span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> WAIT_ACK_Write<span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> DEL_AFTER_READ<span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>state <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> ERROR<span style='color:#808030; '>)</span><span style='color:#808030; '>;</span>
510: 
511: <span style='color:#696969; '>//*********** parity section</span>
512: <span style='color:#800000; font-weight:bold; '>wire</span>    DMA_ParErr0<span style='color:#808030; '>,</span> DMA_ParErr1<span style='color:#808030; '>,</span> DMA_ParErr2<span style='color:#808030; '>,</span> DMA_ParErr3<span style='color:#800000; font-weight:bold; '>;</span>
513: <span style='color:#800000; font-weight:bold; '>assign</span>  DMA_ADPOutEn    <span style='color:#808030; '>=</span> DMA_DataOutEn <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>~</span>DMA_ALE<span style='color:#800000; font-weight:bold; '>;</span>
514: 
515: <span style='color:#800000; font-weight:bold; '>assign</span>  DMA_ADPOutput<span style='color:#008c00; '>[0]</span>        <span style='color:#808030; '>=</span> <span style='color:#808030; '>^</span>DataOut<span style='color:#808030; '>[</span><span style='color:#008c00; '>7</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#800000; font-weight:bold; '>;</span>
516: <span style='color:#800000; font-weight:bold; '>assign</span>  DMA_ADPOutput<span style='color:#008c00; '>[1]</span>        <span style='color:#808030; '>=</span> <span style='color:#808030; '>^</span>DataOut<span style='color:#808030; '>[</span><span style='color:#008c00; '>15</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>8</span><span style='color:#808030; '>]</span><span style='color:#800000; font-weight:bold; '>;</span>
517: <span style='color:#800000; font-weight:bold; '>assign</span>  DMA_ADPOutput<span style='color:#008c00; '>[2]</span>        <span style='color:#808030; '>=</span> <span style='color:#808030; '>^</span>DataOut<span style='color:#808030; '>[</span><span style='color:#008c00; '>23</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>16</span><span style='color:#808030; '>]</span><span style='color:#800000; font-weight:bold; '>;</span>
518: <span style='color:#800000; font-weight:bold; '>assign</span>  DMA_ADPOutput<span style='color:#008c00; '>[3]</span>        <span style='color:#808030; '>=</span> <span style='color:#808030; '>^</span>DataOut<span style='color:#808030; '>[</span><span style='color:#008c00; '>31</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>24</span><span style='color:#808030; '>]</span><span style='color:#800000; font-weight:bold; '>;</span>
519: <span style='color:#696969; '>//</span>
520: <span style='color:#800000; font-weight:bold; '>assign</span>  DMA_ParErr3     <span style='color:#808030; '>=</span> <span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#800080; '>{</span>StoreReg<span style='color:#808030; '>[</span><span style='color:#008c00; '>31</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>24</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> StoreParReg<span style='color:#008c00; '>[3]</span><span style='color:#800080; '>}</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>;</span>
521: <span style='color:#800000; font-weight:bold; '>assign</span>  DMA_ParErr2     <span style='color:#808030; '>=</span> <span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#800080; '>{</span>StoreReg<span style='color:#808030; '>[</span><span style='color:#008c00; '>23</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>16</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> StoreParReg<span style='color:#008c00; '>[2]</span><span style='color:#800080; '>}</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>;</span>
522: <span style='color:#800000; font-weight:bold; '>assign</span>  DMA_ParErr1     <span style='color:#808030; '>=</span> <span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#800080; '>{</span>StoreReg<span style='color:#808030; '>[</span><span style='color:#008c00; '>15</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>8</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> StoreParReg<span style='color:#008c00; '>[1]</span><span style='color:#800080; '>}</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>;</span>
523: <span style='color:#800000; font-weight:bold; '>assign</span>  DMA_ParErr0     <span style='color:#808030; '>=</span> <span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#800080; '>{</span>StoreReg<span style='color:#808030; '>[</span><span style='color:#008c00; '>7</span><span style='color:#808030; '>:</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> StoreParReg<span style='color:#008c00; '>[0]</span><span style='color:#800080; '>}</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>;</span>
524: 
525: <span style='color:#800000; font-weight:bold; '>assign</span>  ParError        <span style='color:#808030; '>=</span> Status9 <span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>DMA_ParErr0 <span style='color:#808030; '>|</span> DMA_ParErr1 <span style='color:#808030; '>|</span> DMA_ParErr2 <span style='color:#808030; '>|</span> DMA_ParErr3<span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>;</span>
526: 
527: <span style='color:#800000; font-weight:bold; '>endmodule</span>
528: 
</pre></body></html>
