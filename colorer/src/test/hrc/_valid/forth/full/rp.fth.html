  0: <span style='color:#696969; '>\ Resolve path device procedure LNM 04-11-1999 based on IEEE 1275-1994</span>
  1: <span style='color:#0000e6; '>." Resolve path device procedure"</span>
  2: include? task-aw.fth        aw.fth
  3: include? task-showdevs.fth  showdevs.fth
  4: <span style='color:#800000; font-weight:bold; '>forth</span> <span style='color:#000000; background:#a8a800; '>definitions</span> anew task-rp.fth <span style='color:#e34adc; '>decimal</span>
  5: 
  6: <span style='color:#008c00; '>255</span> <span style='color:#800000; font-weight:bold; '>value</span> sizestr
  7: <span style='color:#008c00; '>0</span> string emptystr    <span style='color:#696969; '>\ Empty string for varios needs</span>
  8: sizestr string shead <span style='color:#696969; '>\ String for head of sourse string</span>
  9: sizestr string stail <span style='color:#696969; '>\ String for tail of sourse string</span>
 10: sizestr string path_name <span style='color:#696969; '>\ Target full alias name</span>
 11: sizestr string arguments <span style='color:#696969; '>\ Arguments string</span>
 12: <span style='color:#008c00; '>31</span>      string unit_addr
 13: <span style='color:#008c00; '>31</span>      string node_name <span style='color:#696969; '>\ The current node name</span>
 14: 
 15: <span style='color:#800000; font-weight:bold; '>variable</span> targetnode <span style='color:#696969; '>\ Pnode of finded name</span>
 16: <span style='color:#800000; font-weight:bold; '>variable</span> active-package  <span style='color:#008c00; '>0</span> active-package <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ Current active package</span>
 17: <span style='color:#800000; font-weight:bold; '>variable</span> parentnode
 18: 2variable ptail      <span style='color:#696969; '>\ Pointer to tail string</span>
 19: 2variable phead      <span style='color:#696969; '>\ Pointer to head string</span>
 20: 2variable paliasargs <span style='color:#696969; '>\ Pointer to string alias arguments</span>
 21: <span style='color:#800000; font-weight:bold; '>variable</span> unit_phys <span style='color:#008c00; '>0</span> unit_phys <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ Physical adress of unit</span>
 22: 
 23: <span style='color:#696969; '>\ Parent</span>
 24: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>parent</span> <span style='color:#696969; '>( Phandle )</span> <span style='color:#800000; font-weight:bold; '>>code</span> parenthandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#696969; '>( ParentHandle )</span> ; <span style='color:#696969; '>\ ++ 16-02-2000</span>
 25: <span style='color:#696969; '>\ If Phandle exist in device tree return Phandle else return true</span>
 26: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>provphandle</span> <span style='color:#696969; '>( Phandle -- Phandle | T )</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>25</span> <span style='color:#008c00; '>0</span>
 27:     <span style='color:#e34adc; '>do</span>  <span style='color:#696969; '>( Phandle )</span>
 28:         parent <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#696969; '>( Parent )</span>
 29:         <span style='color:#696969; '>\ not</span>
 30:         roothandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>=</span> <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>leave</span> <span style='color:#e34adc; '>then</span>
 31:     <span style='color:#e34adc; '>loop</span> <span style='color:#696969; '>( PhandleBeg PhandleEnd )</span>
 32:     roothandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>=</span> <span style='color:#800000; font-weight:bold; '>not</span>
 33:     <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#800000; font-weight:bold; '>true</span> <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>( Phandle | T )</span> ; <span style='color:#696969; '>\ ++ 16-05-2000</span>
 34: <span style='color:#696969; '>\ Child</span>
 35: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>child</span> <span style='color:#696969; '>( PhandleParent -- PhandleChild )</span> provphandle <span style='color:#800000; font-weight:bold; '>dup</span>
 36:     <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>>code</span> childhandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>( PhandleChild )</span> ;
 37: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>findalias</span> <span style='color:#696969; '>( Adr Len -- AdrAlias LenAlias 0 | 1 )</span>
 38:     aliashandle <span style='color:#800000; font-weight:bold; '>@</span> getPhandleProperty <span style='color:#696969; '>( Adr Len 0 | 1 )</span> ;
 39: 
 40: <span style='color:#696969; '>\ Concatenate 2 string and 1 symbol to shead string</span>
 41: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>conc2str&amp;symb</span> <span style='color:#696969; '>( AStr1 LStr1 AStr2 LStr2 Symb -- A L )</span> { symb -- }
 42:     <span style='color:#800000; font-weight:bold; '>2swap</span> <span style='color:#696969; '>( AStr2 LStr2 AStr1 LStr1 )</span>
 43:     shead st! <span style='color:#696969; '>\ Story count in shead</span>
 44:     shead <span style='color:#800000; font-weight:bold; '>2dup</span> <span style='color:#800000; font-weight:bold; '>+</span> symb <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#008c00; '>c</span>! <span style='color:#696969; '>( AStr2 LStr2 Ash Lsh )</span>
 45:     <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>+</span> <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#800000; font-weight:bold; '>over</span> <span style='color:#800000; font-weight:bold; '>+</span> <span style='color:#696969; '>( AStr2 LStr2 Ash Lsh Lnew )</span>
 46:     <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>-</span> <span style='color:#008c00; '>c</span>! <span style='color:#696969; '>( AStr2 LStr2 Ash Lsh )</span> <span style='color:#696969; '>\ Story new len in shead</span>
 47:     <span style='color:#800000; font-weight:bold; '>+</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>move</span> <span style='color:#696969; '>( ( Story content of alias_shead )</span> shead <span style='color:#696969; '>( A L )</span> ;
 48: 
 49: <span style='color:#696969; '>\ 4.3.1.A.3 Change alias by real name</span>
 50: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>workwithalias</span> <span style='color:#696969; '>( AdrAlias LenAlias )</span>
 51:     paliasargs <span style='color:#008c00; '>2</span>@ <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>\ Not empty args of alias</span>
 52:     <span style='color:#696969; '>( AdrAlias LenAlias AdrAlArg LenAlArg LenAlArg )</span>
 53:     <span style='color:#e34adc; '>if</span>  <span style='color:#696969; '>\ 3-ii Alias args is not empty</span>
 54:         <span style='color:#696969; '>\ 3-ii-a</span>
 55:         <span style='color:#0000e6; '>ascii /</span> right-split <span style='color:#696969; '>( AdrAlHead LenAlhead AdrAlTail LenAltail )</span>
 56:         <span style='color:#696969; '>\ 3-ii-b</span>
 57:         <span style='color:#0000e6; '>ascii :</span> right-split <span style='color:#696969; '>( AdrAlHead LenAlhead AdrAlTail LenAltail ADeadArg LDeadArg )</span>
 58:         <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#696969; '>( AdrAlHead LenAlhead AdrAlTail LenAltail  )</span>
 59:         <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#696969; '>\ AliasHead length</span>
 60:         <span style='color:#e34adc; '>if</span>  <span style='color:#696969; '>\ 3-ii-c concatenate (alias_head,"/",Alias_tail)</span>
 61:             <span style='color:#0000e6; '>ascii /</span> conc2str&amp;symb <span style='color:#696969; '>( A L )</span>
 62:         <span style='color:#e34adc; '>else</span> 
 63:             <span style='color:#800000; font-weight:bold; '>2swap</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#696969; '>( AdrAlTail LenAltail )</span>
 64:         <span style='color:#e34adc; '>then</span>
 65:         <span style='color:#696969; '>( A L )</span> paliasargs <span style='color:#008c00; '>2</span>@ <span style='color:#0000e6; '>ascii :</span> conc2str&amp;symb
 66:         <span style='color:#696969; '>\ 3-ii-d concatinate aliastail : aliasargs</span>
 67:     <span style='color:#e34adc; '>then</span>  <span style='color:#696969; '>( AdrAlias' LenAlias' )</span> ;
 68: 
 69: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>setroot</span> <span style='color:#696969; '>\ cr ." I must set root active package !!!!"</span>
 70:     roothandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>dup</span> nodehandle <span style='color:#800000; font-weight:bold; '>!</span> active-package <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>(  )</span> ;
 71: 
 72: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>copynode</span> <span style='color:#696969; '>( -- )</span> nodehandle <span style='color:#007997; '>@nt</span> creanode <span style='color:#007997; '>@nt</span> sizenode <span style='color:#800000; font-weight:bold; '>move</span> ;
 73: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>copydata</span> <span style='color:#696969; '>( -- )</span> nodehandle <span style='color:#007997; '>@nt</span> <span style='color:#800000; font-weight:bold; '>dup</span> adrinstdata <span style='color:#007997; '>@nt</span> <span style='color:#800000; font-weight:bold; '>swap</span> leninstdata <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#696969; '>( Adr Dl )</span>
 74:     <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>here</span> <span style='color:#800000; font-weight:bold; '>-rot</span> altovoc <span style='color:#800000; font-weight:bold; '>code></span> <span style='color:#e34adc; '>else</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#800000; font-weight:bold; '>false</span> <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>( adr )</span>
 75:     creanode <span style='color:#007997; '>@nt</span> adrinstdata <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>( ( Copy and store adrinsdata )</span> ;
 76: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>copyproperty</span> <span style='color:#696969; '>( -- )</span>
 77:     <span style='color:#008c00; '>0</span> creanode <span style='color:#007997; '>@nt</span> prophandle <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ No property in created instance before copying's</span>
 78:     nodehandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#696969; '>( Phandle )</span>
 79:     creanode <span style='color:#800000; font-weight:bold; '>@</span> nodehandle <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>( Phandle )</span>
 80:     <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>>code</span> prophandle <span style='color:#696969; '>( Phandle AdrPtrChainProp )</span>
 81:     <span style='color:#e34adc; '>begin</span>
 82:         <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#696969; '>(  )</span>
 83:     <span style='color:#e34adc; '>while</span>
 84:         <span style='color:#696969; '>\ >code</span>
 85:         <span style='color:#800000; font-weight:bold; '>code></span> ptrprop>valprop <span style='color:#696969; '>( Av Lv An Ln )</span>
 86: <span style='color:#696969; '>\        @nt dup cell+ dup cell+ swap @nt count rot count</span>
 87:         <span style='color:#696969; '>\ cr 2dup type space 3 pick 3 pick type</span>
 88:         <span style='color:#007997; '>property</span> <span style='color:#696969; '>(  .s key drop )</span>
 89:     <span style='color:#e34adc; '>repeat</span> <span style='color:#800000; font-weight:bold; '>drop</span>
 90:     <span style='color:#696969; '>( Phandle )</span> nodehandle <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>( -- )</span> ;
 91: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>resolvelinks</span> <span style='color:#696969; '>( -- )</span>
 92:     nodehandle <span style='color:#800000; font-weight:bold; '>@</span> creanode <span style='color:#007997; '>@nt</span> <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ Story phandle of prototype</span>
 93:     <span style='color:#008c00; '>0</span> creanode <span style='color:#007997; '>@nt</span> childhandle <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ No child on new created instance</span>
 94:     <span style='color:#008c00; '>0</span> creanode <span style='color:#007997; '>@nt</span> siblinghandle <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ No sibling on new created instance</span>
 95:     <span style='color:#008c00; '>0</span> creanode <span style='color:#007997; '>@nt</span> ihandle <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ No instance on new created instance</span>
 96:     <span style='color:#696969; '>\ creanode @ dup p.node</span>
 97:     <span style='color:#696969; '>( >code @ p.node insinchainsibling (  )</span> ;
 98: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>copyfromprototype</span> <span style='color:#696969; '>( -- )</span>
 99: <span style='color:#696969; '>\   ."  Go "</span>
100:     copynode
101: <span style='color:#696969; '>\   ."  node "</span>
102:     copydata
103: <span style='color:#696969; '>\   ."  Data "</span>
104:     copyproperty
105: <span style='color:#696969; '>\   ."  Property "</span>
106:     resolvelinks
107: <span style='color:#696969; '>\   ."  Links "</span>
108: <span style='color:#696969; '>\    creanode @ p.node   key drop</span>
109:     <span style='color:#696969; '>(   )</span> ;
110: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>first-component</span> <span style='color:#696969; '>( Adr Dl )</span> <span style='color:#008c00; '>0</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>2swap</span> <span style='color:#800000; font-weight:bold; '>>number</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>( N )</span> ;
111: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>setmy-unit</span> <span style='color:#696969; '>( -- )</span>
112:     unit_addr <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>( L )</span> <span style='color:#008c00; '>0</span>=
113:     <span style='color:#e34adc; '>if</span> <span style='color:#0000e6; '> s" reg"</span> get-my-property <span style='color:#800000; font-weight:bold; '>false</span> <span style='color:#800000; font-weight:bold; '>=</span>
114:         <span style='color:#e34adc; '>if</span>  <span style='color:#696969; '>( Adr Dl )</span>
115:             first-component my-unit <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ 4.3.2.e.1.i</span>
116:         <span style='color:#e34adc; '>else</span>
117:             <span style='color:#008c00; '>0</span> my-unit <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ 4.3.2.e.1.ii</span>
118:         <span style='color:#e34adc; '>then</span>
119:     <span style='color:#e34adc; '>else</span>
120:         unit_phys <span style='color:#800000; font-weight:bold; '>@</span> my-unit <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ 4.3.2.e.2</span>
121:     <span style='color:#e34adc; '>then</span> ;
122: 
123: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>crinst</span> <span style='color:#696969; '>\ Create new instance, add it to instance chain, and set various fields</span>
124:     makeinstnode <span style='color:#696969; '>\ 4.3.2.a</span>
125: <span style='color:#696969; '>\    ."  Crea "</span>
126:     copyfromprototype <span style='color:#696969; '>\ cr ." Save new arguments!"</span>
127:     <span style='color:#696969; '>( ."  Inst. of " node_name type )</span> <span style='color:#008c00; '>40</span> space.to.column
128:     arguments <span style='color:#696969; '>( A L )</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>here</span> placeinvoc <span style='color:#696969; '>( Ahere )</span> <span style='color:#800000; font-weight:bold; '>code></span> <span style='color:#e34adc; '>else</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#e34adc; '>then</span>
129:     creanode <span style='color:#007997; '>@nt</span> adrarguments <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ 4.3.2.b cr ." 4.3.2.b"</span>
130:     parentnode <span style='color:#800000; font-weight:bold; '>@</span> creanode <span style='color:#007997; '>@nt</span> parenthandle <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ 4.3.2.c Set my-parent field Story parent ihandle Story parent ihandle</span>
131:     creanode <span style='color:#800000; font-weight:bold; '>@</span> parentnode <span style='color:#007997; '>@nt</span> childhandle <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ NEW added in BM - Store child field in parentnode</span>
132:     <span style='color:#696969; '>\ cr ." 4.3.2.c Set my-parent field"</span>
133:     creanode <span style='color:#800000; font-weight:bold; '>@</span> parentnode <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ 4.3.2.d cr ." 4.3.2.d"</span>
134:     setmy-unit <span style='color:#696969; '>( ( 4.3.2.d )</span> ;
135: 
136: <span style='color:#696969; '>\ 4.3.6. Node name match</span>
137: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>afternamecomma</span> <span style='color:#696969; '>( -- )</span>  node_name<span style='color:#0000e6; '> s" name"</span> get-my-property <span style='color:#0000e6; '>ascii ,</span>
138:     left-split  <span style='color:#800000; font-weight:bold; '>2swap</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#800000; font-weight:bold; '>compare</span> <span style='color:#800000; font-weight:bold; '>not</span> ;
139: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>namecompare</span> <span style='color:#696969; '>( Al Ll AN LN )</span> <span style='color:#800000; font-weight:bold; '>compare</span> <span style='color:#007997; '>br0</span> <span style='color:#800000; font-weight:bold; '>true</span> afternamecomma <span style='color:#696969; '>( T/F )</span> ;
140: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>2dropfalse</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#800000; font-weight:bold; '>false</span> ;
141: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>nocomma</span> <span style='color:#696969; '>( Al Ll Ar Lr )</span> <span style='color:#800000; font-weight:bold; '>2drop</span><span style='color:#0000e6; '> s" name"</span> get-my-property
142:     <span style='color:#007997; '>br0</span> namecompare 2dropfalse ;
143: 
144: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>iscomma</span> <span style='color:#696969; '>( Al Ll Ar Lr )</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#800000; font-weight:bold; '>2drop</span> node_name<span style='color:#0000e6; '> s" name"</span> get-my-property <span style='color:#800000; font-weight:bold; '>drop</span>
145:     <span style='color:#800000; font-weight:bold; '>compare</span> <span style='color:#800000; font-weight:bold; '>not</span> <span style='color:#696969; '>( T/F )</span> ;
146: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>prov_vender</span>  <span style='color:#696969; '>( -- T/F )</span>
147:     node_name <span style='color:#696969; '>( Adr Dl )</span> <span style='color:#0000e6; '>ascii ,</span> left-split <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#007997; '>br0</span> nocomma iscomma <span style='color:#696969; '>( T/F )</span> ;
148: 
149: <span style='color:#696969; '>\ 4.3.5. Wildcard math</span>
150: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>contnoempty</span> <span style='color:#696969; '>( -- )</span> node_name <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#008c00; '>0</span>= unit_addr <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#008c00; '>0</span>= <span style='color:#800000; font-weight:bold; '>and</span> <span style='color:#800000; font-weight:bold; '>not</span> ;
151: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>noempty</span> <span style='color:#696969; '>( -- )</span><span style='color:#0000e6; '> s" reg"</span> get-my-property <span style='color:#007997; '>br0</span> 2dropfalse contnoempty ;
152: 
153: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>withemptynode</span> <span style='color:#696969; '>( AN LN )</span> <span style='color:#800000; font-weight:bold; '>2drop</span><span style='color:#0000e6; '> s" name"</span> get-my-property <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#800000; font-weight:bold; '>2drop</span>
154:     <span style='color:#007997; '>br0</span> prov_vender <span style='color:#800000; font-weight:bold; '>false</span> ;
155: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>wildeq?</span> <span style='color:#696969; '>( -- T/F )</span> node_name <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#007997; '>br0</span> withemptynode noempty ;
156: 
157: <span style='color:#696969; '>\ 4.3.4. Exact match</span>
158: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>cmp_phys</span> <span style='color:#696969; '>( -- )</span><span style='color:#0000e6; '> s" reg"</span> get-my-property
159:     <span style='color:#e34adc; '>if</span><span style='color:#0000e6; '> abort" No adres defined"</span> <span style='color:#e34adc; '>else</span> <span style='color:#008c00; '>0</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>2swap</span> <span style='color:#800000; font-weight:bold; '>>number</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#e34adc; '>then</span>
160:     unit_phys <span style='color:#800000; font-weight:bold; '>=</span> <span style='color:#696969; '>( T/F )</span> ;
161: 
162: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>nuempty?</span> <span style='color:#696969; '>( -- )</span><span style='color:#0000e6; '> s" name"</span> get-my-property
163:     <span style='color:#007997; '>br0</span> cmp_phys <span style='color:#800000; font-weight:bold; '>false</span> <span style='color:#696969; '>( T/F )</span> ;
164: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>exactemptynode</span> <span style='color:#696969; '>( -- )</span> unit_addr <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#007997; '>br0</span> nuempty? cmp_phys ;
165: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>exactmatch</span> <span style='color:#696969; '>( -- )</span> node_name <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#007997; '>br0</span> exactemptynode prov_vender <span style='color:#696969; '>( T/F )</span> ;
166: 
167: <span style='color:#696969; '>\ 4.3.3. Matching child node</span>
168: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>recursivefindmatch</span> <span style='color:#696969; '>( False -- T/F )</span> nodehandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>swap</span> norealize
169:     <span style='color:#800000; font-weight:bold; '>swap</span> nodehandle <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>( T/F )</span> ;
170: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>findwildmatch</span> <span style='color:#696969; '>( False -- T/F )</span> norealize <span style='color:#007997; '>ex</span> ;
171: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>findexactmatch</span> <span style='color:#696969; '>( False -- T/F )</span> norealize <span style='color:#007997; '>ex</span> ;
172: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>rpfindwildmatch</span> <span style='color:#007997; '>rp</span> findwildmatch <span style='color:#696969; '>( T/F )</span> ;
173: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>contmatchchild</span> <span style='color:#696969; '>( -- )</span> <span style='color:#008c00; '>0</span> <span style='color:#007997; '>rp</span> findexactmatch <span style='color:#696969; '>( T/F )</span>
174:     <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#007997; '>if0</span> rpfindwildmatch <span style='color:#696969; '>( T/F )</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#007997; '>if0</span> recursivefindmatch <span style='color:#696969; '>( T/F )</span> ;
175: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>exmetphys</span> <span style='color:#696969; '>( Xt T )</span> <span style='color:#800000; font-weight:bold; '>drop</span> unit_addr <span style='color:#800000; font-weight:bold; '>rot</span> <span style='color:#800000; font-weight:bold; '>execute</span> unit_phys <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>( Rezult )</span> ;
176: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>execdecodeunit</span> <span style='color:#696969; '>( -- )</span><span style='color:#0000e6; '> s" decode-unit"</span> nodehandle <span style='color:#800000; font-weight:bold; '>@</span> find-method
177:     <span style='color:#696969; '>( False | Xt True )</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>not</span> <span style='color:#007997; '>if0</span> exmetphys <span style='color:#696969; '>( T/F )</span> ;
178: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>matchchild</span> <span style='color:#696969; '>( -- )</span> unit_addr <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>( len )</span>
179:     <span style='color:#007997; '>br0</span> execdecodeunit contmatchchild <span style='color:#696969; '>( T/F )</span> ;
180: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>initocrugenie</span> <span style='color:#696969; '>( -- )</span> <span style='color:#008c00; '>0</span> parentnode <span style='color:#800000; font-weight:bold; '>!</span> emptystr arguments st!
181:     emptystr unit_addr st! <span style='color:#696969; '>(  )</span> ;
182: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>?root</span> <span style='color:#696969; '>( A L -- T | F )</span> <span style='color:#800000; font-weight:bold; '>over</span> <span style='color:#008c00; '>c</span>@ <span style='color:#0000e6; '>ascii /</span> <span style='color:#800000; font-weight:bold; '>=</span> <span style='color:#696969; '>( T | F )</span> ;
183: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>exchangealiasbyvalue</span> <span style='color:#696969; '>( AdrAlias LenAlias )</span>
184:     <span style='color:#800000; font-weight:bold; '>2swap</span> <span style='color:#800000; font-weight:bold; '>2drop</span> workwithalias <span style='color:#696969; '>( AValAlias LValAlias )</span>
185:     ptail <span style='color:#008c00; '>2</span>@ <span style='color:#0000e6; '>ascii /</span> <span style='color:#800000; font-weight:bold; '>over</span> <span style='color:#e34adc; '>if</span> conc2str&amp;symb <span style='color:#e34adc; '>else</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>( A' L' )</span> ;
186: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>extractalias</span> <span style='color:#696969; '>( A L )</span>
187:     <span style='color:#0000e6; '>ascii /</span> left-split <span style='color:#696969; '>( AdrL LenL AdrR LenR )</span> ptail <span style='color:#008c00; '>2</span>! <span style='color:#696969; '>\ 4.3.1.A.1</span>
188:     <span style='color:#0000e6; '>ascii :</span> left-split <span style='color:#696969; '>( AdrAlN LenAlN AdrAlArg LenAlArg )</span> <span style='color:#696969; '>\ 4.3.1.A.2</span>
189:     paliasargs <span style='color:#008c00; '>2</span>! <span style='color:#696969; '>\ Store string's arguments for alias</span>
190:     <span style='color:#800000; font-weight:bold; '>2dup</span> findalias <span style='color:#696969; '>( AdrAlias LenAlias 1 | 0 )</span> <span style='color:#800000; font-weight:bold; '>not</span>
191:     <span style='color:#e34adc; '>if</span> exchangealiasbyvalue <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>( A' L' )</span> ;
192: 
193: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>findchildnode</span> <span style='color:#696969; '>( -- T/F )</span>
194:     nodehandle <span style='color:#007997; '>@nt</span> <span style='color:#696969; '>( Phandle )</span> childhandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#696969; '>( Phandle )</span>
195:     <span style='color:#e34adc; '>begin</span>
196:        <span style='color:#0000e6; '> s" name"</span> <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> getPhandleProperty <span style='color:#696969; '>( A L F | T )</span> <span style='color:#800000; font-weight:bold; '>not</span>
197:         <span style='color:#e34adc; '>if</span>  <span style='color:#696969; '>\ cr 2dup type </span>
198:             node_name <span style='color:#800000; font-weight:bold; '>compare</span> <span style='color:#008c00; '>0</span>&lt;> <span style='color:#696969; '>( False if equ )</span>
199:         <span style='color:#e34adc; '>else</span> <span style='color:#800000; font-weight:bold; '>true</span>
200:         <span style='color:#e34adc; '>then</span>
201:         <span style='color:#696969; '>( Phandle Flag )</span> <span style='color:#800000; font-weight:bold; '>over</span> <span style='color:#800000; font-weight:bold; '>>code</span> siblinghandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>over</span> <span style='color:#800000; font-weight:bold; '>and</span> <span style='color:#696969; '>( Phandle Flag )</span>
202:     <span style='color:#e34adc; '>while</span>
203:         <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#800000; font-weight:bold; '>>code</span> siblinghandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#696969; '>( Phandle' )</span>
204:     <span style='color:#e34adc; '>repeat</span> <span style='color:#696969; '>( Phandle' F/T )</span> <span style='color:#800000; font-weight:bold; '>not</span> <span style='color:#800000; font-weight:bold; '>swap</span> targetnode <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>( T/F )</span> ;
205: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>creacall</span> creanode <span style='color:#800000; font-weight:bold; '>@</span> $call-method <span style='color:#696969; '>(  )</span> ;
206: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>execopen</span>  <span style='color:#696969; '>( -- )</span><span style='color:#0000e6; '> s" OPEN"</span> creacall <span style='color:#696969; '>(  )</span> ;
207: 
208: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>gototargetnode</span> <span style='color:#696969; '>( -- )</span> targetnode <span style='color:#800000; font-weight:bold; '>@</span> nodehandle <span style='color:#800000; font-weight:bold; '>!</span> crinst <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>\ In final node Len=0</span>
209:     <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#e34adc; '>if</span> execopen <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>(  )</span> ;
210: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>razbornode</span> <span style='color:#696969; '>( A L )</span>
211:     <span style='color:#0000e6; '>ascii /</span> left-split <span style='color:#696969; '>( 2Component 2PathName )</span> <span style='color:#800000; font-weight:bold; '>2swap</span>
212:     <span style='color:#0000e6; '>ascii :</span> left-split <span style='color:#696969; '>( 2PathName 2NodeAdr 2Arguments )</span> <span style='color:#800000; font-weight:bold; '>2swap</span>
213:     <span style='color:#0000e6; '>ascii @</span> left-split <span style='color:#696969; '>( 2PathName 2Arguments 2NodeName 2Unit_Adr )</span>
214:     unit_addr st! <span style='color:#696969; '>( 2PathName 2Arguments 2NodeName )</span>
215:     node_name st! <span style='color:#696969; '>( 2PathName 2Arguments )</span>
216:     arguments st! <span style='color:#696969; '>( 2PathName )</span> <span style='color:#696969; '>( Aost Lost )</span> ;
217: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>inode</span> creanode <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#696969; '>( Inode )</span> <span style='color:#696969; '>( norealize )</span> ;
218: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>fullotkat</span> <span style='color:#696969; '>( 2PathName )</span> inode <span style='color:#696969; '>( Phandle )</span>
219:     <span style='color:#e34adc; '>begin</span> <span style='color:#696969; '>( Phandle )</span> <span style='color:#696969; '>\ map .s key drop</span>
220:        <span style='color:#0000e6; '> s" CLOSE"</span> <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> $call-method
221:         <span style='color:#696969; '>\ dup here - allot \ Release memory assigned for this node !!!</span>
222:         parent <span style='color:#696969; '>( Parent )</span> <span style='color:#800000; font-weight:bold; '>dup</span> roothandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>=</span> <span style='color:#800000; font-weight:bold; '>not</span>
223:     <span style='color:#e34adc; '>until</span> <span style='color:#696969; '>( False )</span> ;
224: 
225: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>gobynodefrompath</span> <span style='color:#696969; '>( A L )</span>
226:     razbornode
227:     findchildnode <span style='color:#696969; '>( 2PathName T/F )</span>
228:     <span style='color:#e34adc; '>if</span>   gototargetnode <span style='color:#800000; font-weight:bold; '>true</span> <span style='color:#696969; '>\ 4.3.1.K</span>
229:     <span style='color:#e34adc; '>else</span> fullotkat <span style='color:#696969; '>\ 4.3.1.L</span>
230:     <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>( A L )</span> ;
231: <span style='color:#800000; font-weight:bold; '>defer</span> execfinalnode ' <span style='color:#800000; font-weight:bold; '>noop</span> <span style='color:#800000; font-weight:bold; '>is</span> execfinalnode
232: <span style='color:#800000; font-weight:bold; '>variable</span> oldnode <span style='color:#696969; '>\ Node  before beginig procedure, for restoring in crash finding</span>
233: <span style='color:#800000; font-weight:bold; '>variable</span> oldinst <span style='color:#696969; '>\ Inode before beginig procedure, for restoring in crash finding</span>
234: 
235: <span style='color:#696969; '>\ Path resolve procedure 4.3.1 Variant 2</span>
236: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>shpath</span> <span style='color:#800000; font-weight:bold; '>2dup</span> path_name st! <span style='color:#800000; font-weight:bold; '>cr</span><span style='color:#0000e6; '> ." Full path="</span> <span style='color:#800000; font-weight:bold; '>2dup</span> <span style='color:#800000; font-weight:bold; '>type</span> ;
237: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>contgopath</span> <span style='color:#696969; '>( Adr Len )</span> shpath <span style='color:#800000; font-weight:bold; '>true</span> <span style='color:#696969; '>\ Special initial flag</span>
238:     <span style='color:#e34adc; '>begin</span>
239:         <span style='color:#800000; font-weight:bold; '>drop</span> gobynodefrompath <span style='color:#696969; '>( Adr Len T/F )</span> <span style='color:#800000; font-weight:bold; '>over</span> <span style='color:#800000; font-weight:bold; '>not</span> <span style='color:#800000; font-weight:bold; '>over</span> <span style='color:#800000; font-weight:bold; '>not</span> <span style='color:#800000; font-weight:bold; '>or</span>
240:     <span style='color:#e34adc; '>until</span> <span style='color:#696969; '>( Adr False )</span>
241:     <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>2drop</span> execfinalnode inode <span style='color:#696969; '>( Inode )</span> <span style='color:#e34adc; '>else</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#696969; '>(  )</span> <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>(  )</span> ;
242: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>extalias</span>
243:     <span style='color:#696969; '>( Adr Len XtFinalExec -- Inode )</span> <span style='color:#800000; font-weight:bold; '>is</span> execfinalnode <span style='color:#696969; '>( Adr Len )</span>
244:     nodehandle <span style='color:#800000; font-weight:bold; '>@</span> oldnode <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ Saving node</span>
245:     inode oldinst <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ Saving Inode</span>
246:     ?root <span style='color:#e34adc; '>if</span> setroot <span style='color:#e34adc; '>else</span> extractalias <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>( Adr Len )</span>
247:     ?root <span style='color:#e34adc; '>if</span> setroot <span style='color:#008c00; '>1</span>- <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#008c00; '>1</span>+ <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>( Adr Len ( 4.3.1.b )</span> ;
248: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>gobypath</span> <span style='color:#696969; '>( A L )</span> extalias active-package <span style='color:#800000; font-weight:bold; '>@</span>
249:     <span style='color:#e34adc; '>if</span> contgopath <span style='color:#696969; '>( ( 4.3.1.c )</span> <span style='color:#e34adc; '>else</span> 2dropfalse <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>( F | Inode )</span> ;
250: 
251: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>open-dev</span> <span style='color:#696969; '>( Adr Len )</span> <span style='color:#000000; background:#a8a800; '>[']</span> execopen gobypath <span style='color:#696969; '>(  )</span> ;
252: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>find-dev</span> <span style='color:#696969; '>( Adr Len )</span> <span style='color:#000000; background:#a8a800; '>[']</span> <span style='color:#800000; font-weight:bold; '>noop</span>     gobypath <span style='color:#696969; '>(  )</span> ;
253: 
254: <span style='color:#008c00; '>31</span> string ispmethod <span style='color:#696969; '>\ Name of method that will be executed on last node</span>
255: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>execispmethod</span> <span style='color:#696969; '>( -- )</span> ispmethod creacall <span style='color:#696969; '>(  )</span> ;
256: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>execute-device-method</span> <span style='color:#696969; '>( Am Lm Ap Lp )</span> <span style='color:#800000; font-weight:bold; '>2swap</span> ispmethod st! <span style='color:#696969; '>( Ap Lp )</span>
257:     <span style='color:#000000; background:#a8a800; '>[']</span> execispmethod gobypath <span style='color:#696969; '>(  )</span> ;
258: 
259: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>begin-package</span> <span style='color:#696969; '>( arg-str, arg-len, reg-str, reg-len, dev-str, dev-len -- )</span>
260:     open-dev    <span style='color:#696969; '>( arg-str, arg-len, reg-str, reg-len )</span>
261:     <span style='color:#007997; '>new-device</span>  <span style='color:#696969; '>( arg-str, arg-len, reg-str, reg-len )</span>
262:     set-args creanewvoc <span style='color:#696969; '>( -- )</span> ;
263: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>savenode</span>       norealize ;
264: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>delnode</span>        norealize ;
265: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>deleteinstance</span> norealize ;
266: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>selectparent</span>   <span style='color:#696969; '>( norealize )</span>
267:                  nodehandle <span style='color:#800000; font-weight:bold; '>@</span> parenthandle <span style='color:#800000; font-weight:bold; '>>code</span> <span style='color:#800000; font-weight:bold; '>@</span>
268:                  <span style='color:#696969; '>\ cr ."  Parent =" .s</span>
269:                  <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>dup</span> nodehandle <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#800000; font-weight:bold; '>-></span> <span style='color:#007997; '>my-self</span>
270:                  parent parentnode <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>( -- )</span> ;
271: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>close-dev</span>      norealize ;
272: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>finish-device</span> <span style='color:#696969; '>( -- )</span>
273: <span style='color:#696969; '>\    s" name" creanode @ getPhandleProperty ( A L F | T )</span>
274: <span style='color:#696969; '>\    ."  Property taken"</span>
275: <span style='color:#696969; '>\    if delnode else 2drop savenode then</span>
276: <span style='color:#696969; '>\    deleteinstance</span>
277:     <span style='color:#800000; font-weight:bold; '>forth</span> <span style='color:#696969; '>( previous )</span> <span style='color:#000000; background:#a8a800; '>definitions</span> <span style='color:#696969; '>\ set Forth as main vocabulary</span>
278: <span style='color:#696969; '>\    order vocs key drop</span>
279:     selectparent <span style='color:#696969; '>(  )</span> ;
280: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>end-package</span> <span style='color:#696969; '>( -- )</span>
281:     <span style='color:#007997; '>finish-device</span>
282:     <span style='color:#000000; background:#a8a800; '>previous</span> <span style='color:#696969; '>\ set Forth as main vocabulary</span>
283:     close-dev <span style='color:#696969; '>(  )</span> ;
284: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>bprp</span> <span style='color:#696969; '>( -- )</span><span style='color:#0000e6; '> s" bus:120,123456/espdma@f,400000"</span>
285: <span style='color:#696969; '>\ /sp@f,800000</span>
286:     <span style='color:#000000; background:#a8a800; '>[']</span> execopen gobypath <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>(  )</span> ;
287: <span style='color:#696969; '>\ options/openprom</span>
288: <span style='color:#696969; '>\ Для пpовеpки пpавильности изменения значения свойства</span>
289: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>er</span> <span style='color:#696969; '>(  )</span><span style='color:#0000e6; '> s" /espdma@f,400000/esp@f,800000"</span><span style='color:#0000e6; '> s" SDDEV"</span> <span style='color:#007997; '>property</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>(  )</span> ;
290: 
291: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>.name</span> <span style='color:#696969; '>( Pnode )</span> <span style='color:#800000; font-weight:bold; '>space</span> <span style='color:#800000; font-weight:bold; '>space</span>
292:    <span style='color:#0000e6; '> s" name"</span> <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> getPhandleProperty <span style='color:#800000; font-weight:bold; '>not</span> <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>type</span> <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>( Pnode )</span> ;
293: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>ls</span> <span style='color:#696969; '>( -- )</span> nodehandle <span style='color:#007997; '>@nt</span> childhandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>dup</span>
294:     <span style='color:#e34adc; '>if</span> .name <span style='color:#696969; '>( Phandle )</span>
295:         <span style='color:#e34adc; '>begin</span> <span style='color:#800000; font-weight:bold; '>>code</span> siblinghandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#e34adc; '>while</span> .name <span style='color:#e34adc; '>repeat</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>(  )</span>
296:     <span style='color:#e34adc; '>else</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#e34adc; '>then</span> <span style='color:#800000; font-weight:bold; '>cr</span> <span style='color:#696969; '>( -- )</span> ;
297: 
