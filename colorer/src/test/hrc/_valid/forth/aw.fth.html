<html><body style='color:#000000; background:#ffffff; '><pre>
  0: <span style='color:#696969; '>\ Additional words for working BOOTMON -- LNM 05-10-1999</span>
  1: <span style='color:#0000e6; '>." Additional words for BOOTMON"</span>
  2: include? task-instdata.fth instdata.fth
  3: include? task-configur.fth configur.fth
  4: anew task-aw.fth <span style='color:#e34adc; '>decimal</span>
  5: 
  6: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>norealize</span> <span style='color:#800000; font-weight:bold; '>cr</span> <span style='color:#800000; font-weight:bold; '>r@</span> new>name
  7:    <span style='color:#0000e6; '> ."  - </span><span style='color:#ffffff; background:#808000; '>Error !!!</span><span style='color:#0000e6; '> The function "</span> id.<span style='color:#0000e6; '> ."  is not realized once </span><span style='color:#ffffff; background:#808000; '>more !!!</span><span style='color:#0000e6; '>"</span> <span style='color:#800000; font-weight:bold; '>cr</span> <span style='color:#800000; font-weight:bold; '>cr</span> ;
  8: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>.h</span> <span style='color:#800000; font-weight:bold; '>base</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#e34adc; '>hex</span> <span style='color:#800000; font-weight:bold; '>.</span> <span style='color:#800000; font-weight:bold; '>base</span> <span style='color:#800000; font-weight:bold; '>!</span> ;
  9: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>base$</span> <span style='color:#696969; '>( base, &lt;number> -- N , convert next number as hex )</span>
 10:     <span style='color:#800000; font-weight:bold; '>base</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>base</span> <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#008c00; '>32</span> lword number? num_type_single <span style='color:#800000; font-weight:bold; '>=</span> <span style='color:#800000; font-weight:bold; '>not</span>
 11:    <span style='color:#0000e6; '> abort" Not a single number!"</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>base</span> <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#800000; font-weight:bold; '>state</span> <span style='color:#800000; font-weight:bold; '>@</span>
 12:     <span style='color:#e34adc; '>IF</span> <span style='color:#000000; background:#a8a800; '>[compile]</span> <span style='color:#800000; font-weight:bold; '>literal</span> <span style='color:#e34adc; '>THEN</span> ;
 13: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>h#</span> <span style='color:#008c00; '>16</span> base$ ; <span style='color:#e34adc; '>immediate</span>
 14: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>d#</span> <span style='color:#008c00; '>10</span> base$ ; <span style='color:#e34adc; '>immediate</span>
 15: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>o#</span>  <span style='color:#008c00; '>8</span> base$ ; <span style='color:#e34adc; '>immediate</span>
 16: 
 17: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>leftsymbsrch</span> <span style='color:#696969; '>( Adr Len Symb )</span>
 18:     <span style='color:#008c00; '>0</span> <span style='color:#e34adc; '>do</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>c</span>@ <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#800000; font-weight:bold; '>=</span> <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>leave</span> <span style='color:#e34adc; '>then</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>+</span> <span style='color:#e34adc; '>loop</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>( Adr Len AdrSymb )</span> ;
 19: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>left-split</span> <span style='color:#696969; '>( Adr Len Symb -- Adr LenSymb AdrSymb+1 Len-LenSymb-1 )</span>
 20:     <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#696969; '>( Adr Len Symb Adr Len )</span>
 21:     leftsymbsrch
 22:     <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>3</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#800000; font-weight:bold; '>-</span> <span style='color:#696969; '>( Adr Len AdrSymb LenSymb )</span>
 23:     <span style='color:#800000; font-weight:bold; '>rot</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#696969; '>( Adr LenSymb AdrSymb Len )</span>
 24:     <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#008c00; '>1</span>+ <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#008c00; '>1</span>- <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#800000; font-weight:bold; '>-</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>max</span> <span style='color:#696969; '>( Adr LenSymb AdrSymb+1 Len-LenSymb-1 )</span> ;
 25: 
 26: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>rightsymbsrch</span> <span style='color:#696969; '>( Adr Len Symb )</span>
 27:     <span style='color:#008c00; '>0</span> <span style='color:#e34adc; '>do</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>c</span>@ <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#800000; font-weight:bold; '>=</span> <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>leave</span> <span style='color:#e34adc; '>then</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>-</span> <span style='color:#e34adc; '>loop</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>( Adr Len AdrSymb )</span> ;
 28: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>right-split</span> <span style='color:#696969; '>( Adr Len Symb -- Adr LenSymb AdrSymb+1 Len-LenSymb-1 )</span>
 29:     <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#800000; font-weight:bold; '>+</span> <span style='color:#008c00; '>1</span>- <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#696969; '>( Adr Len Symb Adr+Len-1 Len )</span>
 30:     rightsymbsrch
 31:     <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>3</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#800000; font-weight:bold; '>-</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>max</span> <span style='color:#696969; '>( Adr Len AdrSymb LenSymb )</span>
 32:     <span style='color:#800000; font-weight:bold; '>rot</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#696969; '>( Adr LenSymb AdrSymb Len )</span>
 33:     <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#008c00; '>1</span>+ <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#008c00; '>1</span>- <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#800000; font-weight:bold; '>-</span> <span style='color:#696969; '>( Adr LenSymb AdrSymb+1 Len-LenSymb-1 )</span> ;
 34: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>left-parse-string</span> left-split ;
 35: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>unaligned-@</span> <span style='color:#008c00; '>0</span> <span style='color:#008c00; '>4</span> <span style='color:#008c00; '>0</span> <span style='color:#e34adc; '>do</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>8</span> <span style='color:#800000; font-weight:bold; '>&lt;&lt;</span> <span style='color:#800000; font-weight:bold; '>over</span> <span style='color:#008c00; '>8</span> <span style='color:#008c00; '>c</span>@ <span style='color:#800000; font-weight:bold; '>+</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>+</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#e34adc; '>loop</span>  <span style='color:#696969; '>( Data )</span> ;
 36: <span style='color:#696969; '>\ variable #out</span>
 37: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>lcc</span> <span style='color:#696969; '>( char )</span> <span style='color:#800000; font-weight:bold; '>dup</span> h# <span style='color:#008c00; '>41</span> h# <span style='color:#008c00; '>5a</span> <span style='color:#800000; font-weight:bold; '>between</span> <span style='color:#e34adc; '>if</span> h# <span style='color:#008c00; '>20</span> <span style='color:#800000; font-weight:bold; '>+</span> <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>( char' )</span> ;
 38: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>upc</span> <span style='color:#696969; '>( char )</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#0000e6; '>ascii a</span> <span style='color:#0000e6; '>ascii z</span> <span style='color:#800000; font-weight:bold; '>between</span> <span style='color:#e34adc; '>if</span> h# <span style='color:#008c00; '>20</span> <span style='color:#800000; font-weight:bold; '>-</span> <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>( char' )</span> ;
 39: <span style='color:#696969; '>\ encode string to upper registr</span>
 40: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>stupc</span> <span style='color:#696969; '>( A L )</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>2dup</span> <span style='color:#008c00; '>0</span> <span style='color:#e34adc; '>do</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>c</span>@ upc <span style='color:#800000; font-weight:bold; '>over</span> <span style='color:#008c00; '>c</span>! <span style='color:#008c00; '>1</span>+ <span style='color:#e34adc; '>loop</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>( A L )</span> ;
 41: 
 42: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>allignhere</span> <span style='color:#696969; '>( -- )</span> <span style='color:#800000; font-weight:bold; '>here</span> <span style='color:#008c00; '>4</span> <span style='color:#800000; font-weight:bold; '>mod</span> <span style='color:#800000; font-weight:bold; '>dup</span>
 43:     <span style='color:#e34adc; '>if</span>   <span style='color:#008c00; '>4</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>-</span> <span style='color:#696969; '>( dup ." SmGr=" . )</span>
 44:          <span style='color:#008c00; '>0</span> <span style='color:#e34adc; '>do</span> <span style='color:#008c00; '>255</span> <span style='color:#008c00; '>c</span>, <span style='color:#e34adc; '>loop</span> <span style='color:#696969; '>\ Aliigen for 4</span>
 45:     <span style='color:#e34adc; '>else</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>( -- )</span> ;
 46: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>encode+</span> <span style='color:#696969; '>( Padr1 Plen1 Padr2 Plen2 -- Padr1 Plen1+len2 )</span>
 47:     <span style='color:#0000e6; '>ASCII ,</span> <span style='color:#800000; font-weight:bold; '>rot</span> <span style='color:#008c00; '>c</span>! <span style='color:#800000; font-weight:bold; '>+</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>1</span>+ <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#008c00; '>c</span>! <span style='color:#696969; '>( Padr1 Plen1+len2 )</span> ; <span style='color:#696969; '>\ ++</span>
 48: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>encode-bytes</span>  <span style='color:#800000; font-weight:bold; '>here</span> <span style='color:#800000; font-weight:bold; '>>r</span> <span style='color:#696969; '>( adr len )</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>c</span>, <span style='color:#008c00; '>0</span> <span style='color:#e34adc; '>do</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>c</span>@ <span style='color:#008c00; '>c</span>, <span style='color:#008c00; '>1</span>+ <span style='color:#e34adc; '>loop</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>(  )</span>
 49:     <span style='color:#800000; font-weight:bold; '>r></span> <span style='color:#800000; font-weight:bold; '>here</span> <span style='color:#800000; font-weight:bold; '>over</span> <span style='color:#800000; font-weight:bold; '>-</span> <span style='color:#008c00; '>1</span>- <span style='color:#696969; '>( adr len )</span> ; <span style='color:#696969; '>\ ++</span>
 50: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>encode-string</span> <span style='color:#800000; font-weight:bold; '>here</span> <span style='color:#800000; font-weight:bold; '>>r</span> <span style='color:#696969; '>( adr len )</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>c</span>, <span style='color:#008c00; '>0</span> <span style='color:#e34adc; '>do</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>c</span>@ <span style='color:#008c00; '>c</span>, <span style='color:#008c00; '>1</span>+ <span style='color:#e34adc; '>loop</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>(  )</span>
 51:     <span style='color:#008c00; '>0</span> <span style='color:#008c00; '>c</span>, <span style='color:#800000; font-weight:bold; '>r></span> <span style='color:#800000; font-weight:bold; '>here</span> <span style='color:#800000; font-weight:bold; '>over</span> <span style='color:#800000; font-weight:bold; '>-</span> <span style='color:#008c00; '>1</span>- <span style='color:#696969; '>( adr len )</span> ; <span style='color:#696969; '>\ ++</span>
 52: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>encode-int</span> <span style='color:#696969; '>( n -- Padr Plen )</span> <span style='color:#800000; font-weight:bold; '>base</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>>r</span> <span style='color:#e34adc; '>hex</span>
 53:     <span style='color:#696969; '>\ LNM variant &lt;# 0 8 0 do # loop #> ( adr len )</span>
 54:     (<span style='color:#800000; font-weight:bold; '>.</span>) <span style='color:#696969; '>\ Classic variant</span>
 55:     <span style='color:#007997; '>encode-bytes</span> <span style='color:#800000; font-weight:bold; '>r></span> <span style='color:#800000; font-weight:bold; '>base</span> <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>( Padr Plen )</span> ; <span style='color:#696969; '>\ ++</span>
 56: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>encode-2int</span> <span style='color:#800000; font-weight:bold; '>>r</span> <span style='color:#007997; '>encode-int</span> <span style='color:#800000; font-weight:bold; '>r></span> <span style='color:#007997; '>encode-int</span> <span style='color:#007997; '>encode+</span> <span style='color:#696969; '>( Padr Plen )</span> ; <span style='color:#696969; '>\ ++</span>
 57: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>//string</span> <span style='color:#800000; font-weight:bold; '>tuck</span> <span style='color:#800000; font-weight:bold; '>-</span> <span style='color:#800000; font-weight:bold; '>>r</span> <span style='color:#800000; font-weight:bold; '>+</span> <span style='color:#800000; font-weight:bold; '>r></span> ;
 58: 
 59: <span style='color:#008c00; '>15</span> <span style='color:#800000; font-weight:bold; '>constant</span> obio
 60: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>decode-bytes</span> <span style='color:#696969; '>( pAdr1 pLen1 dLen -- pAdr1 pLen1 dAdr dLen )</span>
 61:     <span style='color:#800000; font-weight:bold; '>>r</span> <span style='color:#800000; font-weight:bold; '>over</span> <span style='color:#800000; font-weight:bold; '>r@</span> <span style='color:#800000; font-weight:bold; '>+</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>r@</span> <span style='color:#800000; font-weight:bold; '>-</span> <span style='color:#800000; font-weight:bold; '>rot</span> <span style='color:#800000; font-weight:bold; '>r></span> <span style='color:#696969; '>( pAdr1 pLen1 dAdr dLen )</span> ;
 62: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>decode-space</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>0</span>=
 63:     <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>drop</span>  obio <span style='color:#800000; font-weight:bold; '>exit</span> <span style='color:#e34adc; '>then</span>   <span style='color:#800000; font-weight:bold; '>2dup</span> " obio" $=
 64:     <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>2drop</span> obio <span style='color:#800000; font-weight:bold; '>exit</span> <span style='color:#e34adc; '>then</span>   <span style='color:#800000; font-weight:bold; '>2dup</span> " io" $=
 65:     <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>2drop</span> obio <span style='color:#800000; font-weight:bold; '>exit</span> <span style='color:#e34adc; '>then</span>   <span style='color:#696969; '>( ffd2c320 )</span> <span style='color:#800000; font-weight:bold; '>dup</span> obio <span style='color:#800000; font-weight:bold; '>=</span>
 66:     <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>drop</span>  obio <span style='color:#800000; font-weight:bold; '>exit</span> <span style='color:#e34adc; '>then</span>   <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>></span>
 67:     <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>dup</span><span style='color:#0000e6; '> ." Invalid address"</span> .h <span style='color:#800000; font-weight:bold; '>cr</span> <span style='color:#800000; font-weight:bold; '>abort</span> <span style='color:#e34adc; '>then</span> ;
 68: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>decode-int</span> <span style='color:#696969; '>( Padr Plen )</span> <span style='color:#800000; font-weight:bold; '>base</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>>r</span> <span style='color:#e34adc; '>hex</span> <span style='color:#008c00; '>0</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>2swap</span> <span style='color:#800000; font-weight:bold; '>>number</span>
 69:     <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#e34adc; '>if</span> <span style='color:#008c00; '>1</span>- <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#008c00; '>1</span>+ <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#e34adc; '>then</span> <span style='color:#800000; font-weight:bold; '>2swap</span> <span style='color:#800000; font-weight:bold; '>drop</span>
 70:     <span style='color:#800000; font-weight:bold; '>r></span> <span style='color:#800000; font-weight:bold; '>base</span> <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>( Padr' Plen' N )</span> ; <span style='color:#696969; '>\ ++++ 21-02-2000</span>
 71: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>decode-unit</span> <span style='color:#0000e6; '>ascii ,</span> left-parse-string <span style='color:#800000; font-weight:bold; '>2swap</span> <span style='color:#007997; '>decode-int</span> <span style='color:#800000; font-weight:bold; '>-rot</span> decode-space ;
 72: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>decode-string</span> <span style='color:#696969; '>( pAdr pLen -- pAdr' pLen' str len )</span>
 73:     <span style='color:#800000; font-weight:bold; '>2dup</span> <span style='color:#008c00; '>0</span> <span style='color:#e34adc; '>do</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>c</span>@ <span style='color:#800000; font-weight:bold; '>not</span> <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>leave</span> <span style='color:#e34adc; '>then</span> <span style='color:#008c00; '>1</span>+ <span style='color:#e34adc; '>loop</span> <span style='color:#696969; '>( pAdr pLen pAdr' )</span>
 74:     <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>1</span>+ <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#008c00; '>3</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#800000; font-weight:bold; '>-</span> <span style='color:#696969; '>( pAdr pLen pAdr' StLen )</span>
 75:     <span style='color:#800000; font-weight:bold; '>rot</span> <span style='color:#696969; '>( pAdr pAdr' StLen pLen )</span> <span style='color:#800000; font-weight:bold; '>over</span> <span style='color:#800000; font-weight:bold; '>-</span> <span style='color:#008c00; '>1</span>- <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#800000; font-weight:bold; '>2swap</span> <span style='color:#696969; '>( pAdr' pLen' str len )</span> ; <span style='color:#696969; '>\ ++++ 03-05-2000</span>
 76: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>creanewvoc</span> <span style='color:#696969; '>( -- )</span> <span style='color:#800000; font-weight:bold; '>base</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#e34adc; '>hex</span>
 77:     voccount <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#008c00; '>1</span>+ voccount <span style='color:#800000; font-weight:bold; '>!</span>
 78:     <span style='color:#800000; font-weight:bold; '>&lt;#</span> voccount <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>#</span> <span style='color:#800000; font-weight:bold; '>#</span> <span style='color:#800000; font-weight:bold; '>#</span>
 79:     <span style='color:#0000e6; '>ascii -</span> <span style='color:#800000; font-weight:bold; '>hold</span>
 80:     <span style='color:#0000e6; '>ascii d</span> <span style='color:#800000; font-weight:bold; '>hold</span>
 81:     <span style='color:#0000e6; '>ascii o</span> <span style='color:#800000; font-weight:bold; '>hold</span>
 82:     <span style='color:#0000e6; '>ascii h</span> <span style='color:#800000; font-weight:bold; '>hold</span>
 83:     <span style='color:#0000e6; '>ascii t</span> <span style='color:#800000; font-weight:bold; '>hold</span>
 84:     <span style='color:#0000e6; '>ascii e</span> <span style='color:#800000; font-weight:bold; '>hold</span>
 85:     <span style='color:#0000e6; '>ascii m</span> <span style='color:#800000; font-weight:bold; '>hold</span>
 86:     <span style='color:#800000; font-weight:bold; '>#></span> <span style='color:#696969; '>( Adr Len )</span> <span style='color:#696969; '>\ over over type</span>
 87:     <span style='color:#800000; font-weight:bold; '>over</span> <span style='color:#800000; font-weight:bold; '>over</span> <span style='color:#007997; '>tvocabulary</span>
 88:     <span style='color:#696969; '>( also )</span> <span style='color:#800000; font-weight:bold; '>evaluate</span> <span style='color:#000000; background:#a8a800; '>definitions</span>  <span style='color:#696969; '>\ Set current Voc</span>
 89:     <span style='color:#007997; '>dictlist</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>cell+</span> voclistbase <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>-</span> <span style='color:#696969; '>\ Adres of pointer's of latest created vocabulary</span>
 90:     nodehandle <span style='color:#007997; '>@nt</span> methvochandle <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ Store PtrVoc of metod's for this node</span>
 91:     <span style='color:#800000; font-weight:bold; '>base</span> <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>( -- )</span> ;
 92: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>find_end_chain_sibling</span> <span style='color:#696969; '>( Adr )</span> <span style='color:#e34adc; '>begin</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#e34adc; '>while</span> <span style='color:#007997; '>@nt</span> siblinghandle <span style='color:#e34adc; '>repeat</span> <span style='color:#696969; '>( Adr )</span> ;
 93: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>creaendnode</span> <span style='color:#696969; '>( -- )</span>
 94:     <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>,</span>     <span style='color:#696969; '>\ place child handle</span>
 95:     <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>,</span>     <span style='color:#696969; '>\ place sibling handle</span>
 96:     <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>,</span>     <span style='color:#696969; '>\ place property voc handle</span>
 97:     <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>,</span>     <span style='color:#696969; '>\ place method voc handle</span>
 98:     <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>,</span>     <span style='color:#696969; '>\ place adress arguments</span>
 99:     <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>,</span>     <span style='color:#696969; '>\ place adress inst data</span>
100:     <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>,</span>     <span style='color:#696969; '>\ place len inst data</span>
101:     <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>,</span>     <span style='color:#696969; '>\ place ihandle 1'st instance</span>
102:     ; <span style='color:#696969; '>\ +++</span>
103: 
104: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>makenode</span> <span style='color:#696969; '>( -- )</span> allignhere <span style='color:#696969; '>( -- )</span>
105:     <span style='color:#800000; font-weight:bold; '>here</span> <span style='color:#800000; font-weight:bold; '>code></span> creanode <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ store place for begining area new node</span>
106:     nodehandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#008c00; '>0</span>= <span style='color:#696969; '>\ It is 1'st node or not</span>
107:     <span style='color:#e34adc; '>if</span>
108:        <span style='color:#800000; font-weight:bold; '>here</span> <span style='color:#800000; font-weight:bold; '>code></span> roothandle <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ store the base of tree</span>
109:        <span style='color:#800000; font-weight:bold; '>cr</span><span style='color:#0000e6; '> ." Root of tree ="</span>
110:        <span style='color:#800000; font-weight:bold; '>here</span> <span style='color:#800000; font-weight:bold; '>code></span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>.</span> <span style='color:#800000; font-weight:bold; '>,</span>  <span style='color:#696969; '>\ place protohandle</span>
111:        creanode <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>,</span> <span style='color:#696969; '>( ? More correct variant )</span> <span style='color:#696969; '>\ place parent handle</span>
112:     <span style='color:#e34adc; '>else</span>
113:        <span style='color:#800000; font-weight:bold; '>cr</span><span style='color:#0000e6; '> ." Leaf of tree ="</span>
114:        <span style='color:#800000; font-weight:bold; '>here</span> <span style='color:#800000; font-weight:bold; '>code></span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>.</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>,</span>  <span style='color:#696969; '>\ place protohandle</span>
115:       <span style='color:#0000e6; '> ."  From node ="</span>
116:        nodehandle <span style='color:#007997; '>@nt</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>code></span> <span style='color:#800000; font-weight:bold; '>.</span> <span style='color:#696969; '>( cr ( here AdrPtrNode PtrNode )</span> <span style='color:#800000; font-weight:bold; '>-rot</span>
117:        childhandle <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#008c00; '>0</span>&lt;> <span style='color:#696969; '>\ Have child?</span>
118:        <span style='color:#e34adc; '>if</span> <span style='color:#007997; '>@nt</span> siblinghandle find_end_chain_sibling <span style='color:#e34adc; '>then</span>
119:        <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ Store adres of this node as child</span>
120:        <span style='color:#800000; font-weight:bold; '>code></span> <span style='color:#800000; font-weight:bold; '>,</span> <span style='color:#696969; '>\ place parent handle</span>
121:     <span style='color:#e34adc; '>then</span> creaendnode <span style='color:#696969; '>(  )</span> ; <span style='color:#696969; '>\ +++</span>
122: 
123: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>makeinstnode</span> <span style='color:#696969; '>( -- )</span> allignhere <span style='color:#696969; '>( -- )</span>
124:     <span style='color:#800000; font-weight:bold; '>here</span> <span style='color:#800000; font-weight:bold; '>code></span> creanode <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ store place for begining area new node</span>
125:     nodehandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#008c00; '>0</span>= <span style='color:#696969; '>\ It is 1'st node or not</span>
126:     <span style='color:#e34adc; '>if</span><span style='color:#0000e6; '> abort" Tree are </span><span style='color:#ffffff; background:#808000; '>absent !!!</span><span style='color:#0000e6; '>"</span>
127:     <span style='color:#e34adc; '>else</span>
128:        <span style='color:#800000; font-weight:bold; '>cr</span><span style='color:#0000e6; '> ."      Instance="</span>
129:        <span style='color:#800000; font-weight:bold; '>here</span> <span style='color:#800000; font-weight:bold; '>code></span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>.</span> nodehandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>,</span>  <span style='color:#696969; '>\ place protohandle</span>
130:       <span style='color:#0000e6; '> ."  From node="</span>
131:        nodehandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>.</span> <span style='color:#800000; font-weight:bold; '>>code</span> <span style='color:#696969; '>( here AdrPtrNode PtrNode )</span>
132:        ihandle find_end_chain_sibling <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ Store adres of this node as instance</span>
133:        <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>,</span> <span style='color:#696969; '>\ place parent handle</span>
134:     <span style='color:#e34adc; '>then</span> creaendnode <span style='color:#696969; '>(  )</span> ; <span style='color:#696969; '>\ +++</span>
135: 
136: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>new-device</span> <span style='color:#696969; '>( -- )</span>
137:     sizedefinst <span style='color:#e34adc; '>if</span> <span style='color:#696969; '>( creanode @ cr ."  Node=" . )</span>
138:     save-instdata <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>\ Save inst data</span>
139:     <span style='color:#696969; '>\ forth definitions ( set forth vocabulary as master )</span>
140:     ini-instproc makenode   <span style='color:#696969; '>\ Create new node</span>
141:     creanode <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>dup</span> nodehandle <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#800000; font-weight:bold; '>-></span> <span style='color:#007997; '>my-self</span>  <span style='color:#696969; '>\ store last defined node as current   </span>
142:     instbase <span style='color:#800000; font-weight:bold; '>@</span> creanode <span style='color:#007997; '>@nt</span> adrinstdata <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ Store adr of area placeing new instance data</span>
143:     creanewvoc <span style='color:#696969; '>( vocabulary for methods node )</span> ; <span style='color:#696969; '>\ +++</span>
144: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>ihandle>phandle</span> <span style='color:#696969; '>( ihandle )</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#696969; '>( phandle )</span> ;
145: 
146: <span style='color:#696969; '>\ Place string in vocabulary</span>
147: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>altovoc</span> <span style='color:#696969; '>( adr len )</span> <span style='color:#008c00; '>0</span> <span style='color:#e34adc; '>do</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>c</span>@ <span style='color:#008c00; '>c</span>, <span style='color:#008c00; '>1</span>+ <span style='color:#e34adc; '>loop</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>(  )</span> ;
148: <span style='color:#696969; '>\ Place string with her lenght at the begining in vocabulary</span>
149: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>placeinvoc</span> <span style='color:#696969; '>( adr len HereAdr -- hereVoc )</span>
150:     <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>c</span>, <span style='color:#696969; '>( Here, adr, len )</span> <span style='color:#696969; '>\ Place len</span>
151:     altovoc <span style='color:#696969; '>( Here ( Store value in voc )</span> ; <span style='color:#696969; '>\ +++</span>
152: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>placeproperty</span> <span style='color:#696969; '>( Padr Plen Nadr Nlen -- Adr )</span>
153:     allignhere <span style='color:#800000; font-weight:bold; '>here</span> <span style='color:#800000; font-weight:bold; '>>r</span> <span style='color:#696969; '>( Padr Plen Nadr Nlen )</span>
154:     nodehandle <span style='color:#007997; '>@nt</span> prophandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>,</span> <span style='color:#696969; '>\ Place pointer to next property</span>
155:     <span style='color:#800000; font-weight:bold; '>2swap</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#696969; '>( Nadr Nlen Plen Padr )</span>
156:     <span style='color:#800000; font-weight:bold; '>code></span> <span style='color:#800000; font-weight:bold; '>,</span> <span style='color:#696969; '>\ Store ptr to value property</span>
157:     <span style='color:#696969; '>( 1- )</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>max</span> <span style='color:#800000; font-weight:bold; '>,</span> <span style='color:#696969; '>\ Store lenght of property</span>
158:     <span style='color:#696969; '>( Nadr Nlen )</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>c</span>, altovoc allignhere <span style='color:#696969; '>\ Alligen adress by 4</span>
159:     <span style='color:#800000; font-weight:bold; '>r></span> <span style='color:#696969; '>( PPadr )</span> ;
160: <span style='color:#696969; '>\ Create property</span>
161: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>attribute</span> <span style='color:#696969; '>( Padr, Plen, Nadr, Nlen -- AdrPropRec )</span>
162:     placeproperty <span style='color:#696969; '>( here )</span> <span style='color:#800000; font-weight:bold; '>code></span> nodehandle <span style='color:#007997; '>@nt</span> prophandle <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>( -- )</span> ;
163: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>.properties</span> <span style='color:#696969; '>( -- )</span>
164:     nodehandle <span style='color:#007997; '>@nt</span> prophandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#696969; '>( Phandle )</span> <span style='color:#800000; font-weight:bold; '>dup</span>
165:     <span style='color:#e34adc; '>if</span>  <span style='color:#696969; '>( Phandle )</span>
166:         <span style='color:#e34adc; '>begin</span>
167:             <span style='color:#800000; font-weight:bold; '>>code</span> <span style='color:#800000; font-weight:bold; '>dup</span> ptrvalprop <span style='color:#007997; '>@nt</span> <span style='color:#008c00; '>1</span>+
168:             <span style='color:#800000; font-weight:bold; '>over</span> ptrlenvalprop <span style='color:#800000; font-weight:bold; '>@</span>
169:             <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> ptrnameprop
170:             <span style='color:#800000; font-weight:bold; '>count</span> <span style='color:#800000; font-weight:bold; '>cr</span> <span style='color:#800000; font-weight:bold; '>type</span><span style='color:#0000e6; '> ." ="</span> <span style='color:#800000; font-weight:bold; '>type</span>
171:             <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>0</span>=
172:         <span style='color:#e34adc; '>until</span> <span style='color:#800000; font-weight:bold; '>drop</span>
173:     <span style='color:#e34adc; '>else</span>
174:         <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#800000; font-weight:bold; '>cr</span><span style='color:#0000e6; '> ." No property defined for this </span><span style='color:#ffffff; background:#808000; '>node!!!</span><span style='color:#0000e6; '>"</span>
175:     <span style='color:#e34adc; '>then</span> ; <span style='color:#696969; '>\ +++</span>
176: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>next-property</span> <span style='color:#696969; '>( PreviousStr, PreviousLen, Phandle - Ap Lp T | F )</span>
177:     <span style='color:#800000; font-weight:bold; '>>code</span> <span style='color:#800000; font-weight:bold; '>over</span> <span style='color:#008c00; '>0</span>=
178:     <span style='color:#e34adc; '>if</span>  <span style='color:#696969; '>\ Is the first property in list</span>
179:         <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#696969; '>( Phandle )</span> prophandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>dup</span>
180:         <span style='color:#e34adc; '>if</span>   <span style='color:#696969; '>\ Get first property name</span>
181:             <span style='color:#800000; font-weight:bold; '>>code</span> ptrnameprop <span style='color:#800000; font-weight:bold; '>count</span>
182:         <span style='color:#e34adc; '>else</span> <span style='color:#696969; '>\ Property list is empty</span>
183:             <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#800000; font-weight:bold; '>false</span>
184:         <span style='color:#e34adc; '>then</span>
185:     <span style='color:#e34adc; '>else</span> <span style='color:#696969; '>\ We must first of all find previous property in list</span>
186:         <span style='color:#696969; '>( PreviousStr, PreviousLen, Phandle )</span>
187:         prophandle <span style='color:#007997; '>@nt</span> <span style='color:#696969; '>( PtrPropList )</span>
188:         <span style='color:#e34adc; '>begin</span>
189:             <span style='color:#800000; font-weight:bold; '>dup</span> ptrnameprop <span style='color:#800000; font-weight:bold; '>count</span> <span style='color:#696969; '>( PtrNextProp, PtrName, Len )</span>
190:             <span style='color:#696969; '>\ Comparing contents</span>
191:             <span style='color:#008c00; '>4</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#008c00; '>4</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#800000; font-weight:bold; '>compare</span> <span style='color:#008c00; '>0</span>= <span style='color:#696969; '>( 1/0 )</span>
192:             <span style='color:#e34adc; '>if</span> <span style='color:#696969; '>\ We are finded previous property</span>
193:                 <span style='color:#696969; '>( PreviousStr, PreviousLen, PtrNextProp )</span>
194:                 <span style='color:#007997; '>@nt</span> ptrnameprop <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#800000; font-weight:bold; '>2drop</span>
195:                 <span style='color:#800000; font-weight:bold; '>count</span> <span style='color:#800000; font-weight:bold; '>true</span> <span style='color:#800000; font-weight:bold; '>exit</span> <span style='color:#696969; '>( NameStr, NameLen, True )</span>
196:             <span style='color:#e34adc; '>then</span>
197:             <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>>code</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#008c00; '>0</span>= <span style='color:#696969; '>( PreviousStr, PreviousLen, PtrNextProp )</span>
198:         <span style='color:#e34adc; '>until</span> <span style='color:#696969; '>( PreviousStr, PreviousLen, PtrNextProp )</span>
199:         <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#800000; font-weight:bold; '>false</span> <span style='color:#696969; '>( F )</span>
200:     <span style='color:#e34adc; '>then</span> ;
201: 
202: <span style='color:#800000; font-weight:bold; '>variable</span> PrevPropPtr <span style='color:#696969; '>\ Adres of Ptr current property</span>
203: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>eqpropname?</span> <span style='color:#696969; '>( Ptrnode -- F|T )</span>
204:     <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>>code</span> ptrnameprop <span style='color:#800000; font-weight:bold; '>count</span> <span style='color:#008c00; '>4</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#008c00; '>4</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#800000; font-weight:bold; '>compare</span> <span style='color:#008c00; '>0</span>= <span style='color:#696969; '>( F | T )</span> ; <span style='color:#696969; '>\ +++</span>
205: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>delete-property</span> <span style='color:#696969; '>( NameStr, NameLen )</span> stupc
206:     nodehandle <span style='color:#007997; '>@nt</span> <span style='color:#696969; '>( NameStr, NameLen, Phandle )</span>
207:     prophandle <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>code></span> PrevPropPtr <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>dup</span>
208:     <span style='color:#e34adc; '>if</span> <span style='color:#696969; '>\ Property list not empty</span>
209:         eqpropname?
210:         <span style='color:#e34adc; '>if</span> <span style='color:#696969; '>\ It is deleting property</span>
211:             <span style='color:#696969; '>( ,,NextPropPtr )</span> <span style='color:#800000; font-weight:bold; '>>code</span> <span style='color:#800000; font-weight:bold; '>@</span> PrevPropPtr <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ Delete Property</span>
212:         <span style='color:#e34adc; '>else</span>
213:             <span style='color:#e34adc; '>begin</span>
214:                 <span style='color:#696969; '>( NameStr, NameLen, NextPropPtr )</span> <span style='color:#800000; font-weight:bold; '>>code</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>dup</span>
215:                 <span style='color:#e34adc; '>if</span> <span style='color:#696969; '>\ Working with next property</span>
216:                     eqpropname?
217:                     <span style='color:#e34adc; '>if</span> <span style='color:#696969; '>\ It is deleting property</span>
218:                         <span style='color:#696969; '>( NameStr, NameLen, PropPtr)</span>
219:                         <span style='color:#800000; font-weight:bold; '>>code</span> <span style='color:#800000; font-weight:bold; '>@</span> PrevPropPtr <span style='color:#007997; '>@nt</span> <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#800000; font-weight:bold; '>True</span> <span style='color:#696969; '>( NameStr, NameLen, True )</span>
220:                     <span style='color:#e34adc; '>else</span>
221:                         <span style='color:#800000; font-weight:bold; '>dup</span> PrevPropPtr <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#800000; font-weight:bold; '>false</span>
222:                         <span style='color:#696969; '>( NameStr, NameLen, NextPropPtr, False )</span>
223:                     <span style='color:#e34adc; '>then</span>
224:                 <span style='color:#e34adc; '>else</span> <span style='color:#696969; '>\ Its end of list</span>
225:                     <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#800000; font-weight:bold; '>true</span>
226:                 <span style='color:#e34adc; '>then</span>
227:             <span style='color:#e34adc; '>until</span>
228:         <span style='color:#e34adc; '>then</span>
229:     <span style='color:#e34adc; '>else</span> <span style='color:#696969; '>\ Empty property list</span>
230:         <span style='color:#800000; font-weight:bold; '>drop</span>
231:     <span style='color:#e34adc; '>then</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#696969; '>\ Drop namestring</span>
232: ; <span style='color:#696969; '>\ +++</span>
233: 
234: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>ptrprop>valprop</span> <span style='color:#696969; '>( ptrprop )</span> <span style='color:#800000; font-weight:bold; '>>code</span> <span style='color:#800000; font-weight:bold; '>dup</span> ptrvalprop <span style='color:#007997; '>@nt</span> <span style='color:#008c00; '>1</span>+ <span style='color:#800000; font-weight:bold; '>swap</span> ptrlenvalprop <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#696969; '>( A L )</span> ;
235: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>getPhandleProperty</span> <span style='color:#696969; '>( NameStr, NameLen, Phandle -- Adr Len False | True )</span>
236:     <span style='color:#800000; font-weight:bold; '>>r</span> stupc <span style='color:#800000; font-weight:bold; '>r></span>
237:     <span style='color:#800000; font-weight:bold; '>>code</span> prophandle <span style='color:#696969; '>( dup PrevPropPtr ! )</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>dup</span>
238:     <span style='color:#e34adc; '>if</span> <span style='color:#696969; '>\ Property list not empty</span>
239:         eqpropname?
240:         <span style='color:#e34adc; '>if</span> <span style='color:#696969; '>\ It is finding property</span>
241:             <span style='color:#696969; '>( ,,NextPropPtr )</span> <span style='color:#696969; '>( ." It's true?" cr )</span>
242:             ptrprop>valprop <span style='color:#800000; font-weight:bold; '>False</span>
243:         <span style='color:#e34adc; '>else</span>
244:             <span style='color:#e34adc; '>begin</span>
245:                 <span style='color:#696969; '>( NameStr, NameLen, NextPropPtr )</span> <span style='color:#800000; font-weight:bold; '>>code</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>dup</span>
246:                 <span style='color:#e34adc; '>if</span> <span style='color:#696969; '>\ Working with next property</span>
247:                     eqpropname?
248:                     <span style='color:#e34adc; '>if</span> <span style='color:#696969; '>\ It is finding property</span>
249:                         <span style='color:#696969; '>( NameStr, NameLen, PropPtr)</span>
250:                         ptrprop>valprop <span style='color:#800000; font-weight:bold; '>False</span> <span style='color:#800000; font-weight:bold; '>True</span>
251:                         <span style='color:#696969; '>( ValAdr Len False True )</span>
252:                     <span style='color:#e34adc; '>else</span>
253:                         <span style='color:#696969; '>( dup >code PrevPropPtr ! )</span> <span style='color:#800000; font-weight:bold; '>false</span>
254:                         <span style='color:#696969; '>( NameStr, NameLen, NextPropPtr, False )</span>
255:                     <span style='color:#e34adc; '>then</span>
256:                 <span style='color:#e34adc; '>else</span> <span style='color:#696969; '>\ Its end of list</span>
257:                     <span style='color:#800000; font-weight:bold; '>true</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>dup</span>
258:                 <span style='color:#e34adc; '>then</span>
259:             <span style='color:#e34adc; '>until</span>
260:         <span style='color:#e34adc; '>then</span>
261:     <span style='color:#e34adc; '>else</span> <span style='color:#696969; '>\ Empty property list</span>
262:         <span style='color:#800000; font-weight:bold; '>true</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>true</span>
263:     <span style='color:#e34adc; '>then</span>
264:     <span style='color:#008c00; '>3</span> <span style='color:#800000; font-weight:bold; '>roll</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#008c00; '>3</span> <span style='color:#800000; font-weight:bold; '>roll</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>( Adr, Len, 0/1 )</span> <span style='color:#800000; font-weight:bold; '>dup</span>
265:     <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#696969; '>\ Drop namestring</span>
266:     <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>( Adr Len False | True )</span> ; <span style='color:#696969; '>\ +++</span>
267: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>get-package-property</span> <span style='color:#696969; '>( NameStr NameLen Phandle -- Adr Len False | True )</span>
268:     getPhandleProperty ;
269: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>get-my-property</span> <span style='color:#696969; '>( NameStr, NameLen -- Adr Len False | True )</span>
270:     stupc nodehandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#696969; '>( NameStr, NameLen, Phandle )</span>
271:     getPhandleProperty <span style='color:#696969; '>( Adr Len False | True )</span> ; <span style='color:#696969; '>\ +++</span>
272: 
273: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>oldplace</span> <span style='color:#696969; '>( Padr Plen PadrOldV PlenOldV PtrProperty -- AdrPropRec )</span>
274:     <span style='color:#800000; font-weight:bold; '>2dup</span> ptrlenvalprop <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ Story new lenght</span>
275:     <span style='color:#800000; font-weight:bold; '>>r</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>\ Drop old lenght</span>
276:     <span style='color:#696969; '>( Padr Plen PadrOldV )</span>
277:     <span style='color:#800000; font-weight:bold; '>over</span> <span style='color:#800000; font-weight:bold; '>over</span> <span style='color:#008c00; '>1</span>- <span style='color:#008c00; '>c</span>! <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>move</span> <span style='color:#696969; '>( -- )</span> <span style='color:#696969; '>\ Rewrite value of old property</span>
278:     <span style='color:#800000; font-weight:bold; '>r></span> <span style='color:#696969; '>( AdrPropRec )</span> ;
279: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>newplace</span> <span style='color:#696969; '>( Padr Plen PadrOldV PlenOldV PtrProperty -- AdrPropRec )</span>
280:     <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>3</span> <span style='color:#800000; font-weight:bold; '>pick</span> ptrlenvalprop <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ Story new lenght of value property</span>
281:     <span style='color:#696969; '>( PtrProperty Padr Plen )</span>
282:     <span style='color:#800000; font-weight:bold; '>here</span> placeinvoc <span style='color:#696969; '>( PtrProperty Adr )</span>
283:     <span style='color:#800000; font-weight:bold; '>code></span> <span style='color:#800000; font-weight:bold; '>over</span> ptrvalprop <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>( AdrPropRec )</span> ;
284: 
285: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>changevalueproperty</span> <span style='color:#696969; '>( Padr Plen Nadr Nlen PadrOldV PlenOldV )</span>
286: <span style='color:#696969; '>\    4 pick ( ... NewLen ) &lt; if oldplace else newplase then</span>
287:     <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#696969; '>( Padr Plen Nadr Nlen )</span>
288:     nodehandle <span style='color:#007997; '>@nt</span> prophandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#696969; '>( Padr Plen NameStr NameLen Phandle )</span>
289:     <span style='color:#e34adc; '>begin</span>
290:         eqpropname? <span style='color:#800000; font-weight:bold; '>not</span>
291:         <span style='color:#800000; font-weight:bold; '>over</span> <span style='color:#800000; font-weight:bold; '>>code</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>and</span>
292:     <span style='color:#e34adc; '>while</span>
293:         <span style='color:#800000; font-weight:bold; '>>code</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#696969; '>\ Go to next proprty</span>
294:     <span style='color:#e34adc; '>repeat</span> <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#696969; '>( Padr Plen PtrProperty )</span> <span style='color:#800000; font-weight:bold; '>dup</span>
295:     <span style='color:#e34adc; '>if</span>   <span style='color:#696969; '>( Padr Plen PtrProperty )</span>
296:          <span style='color:#800000; font-weight:bold; '>>code</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#696969; '>( Padr PtrProperty Plen PtrProperty )</span>
297:          ptrlenvalprop <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>code></span> <span style='color:#800000; font-weight:bold; '>swap</span> ptrvalprop <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>( -- )</span>
298:     <span style='color:#e34adc; '>else</span> <span style='color:#696969; '>( Padr Plen PtrProperty )</span>
299:          <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#800000; font-weight:bold; '>2drop</span><span style='color:#0000e6; '> abort" </span><span style='color:#ffffff; background:#808000; '>Error !!!</span><span style='color:#0000e6; '> Property not find in list chain"</span>
300:     <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>( AdrPropRec )</span> ;
301: 
302: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>property</span> <span style='color:#696969; '>( Padr, Plen, Nadr, Nlen -- AdrPropRec )</span>
303:     <span style='color:#696969; '>\ cr .s</span>
304:     stupc <span style='color:#696969; '>\ Name to upper registr</span>
305:     <span style='color:#696969; '>\ .s 2dup space type</span>
306:     <span style='color:#800000; font-weight:bold; '>2dup</span> get-my-property <span style='color:#e34adc; '>if</span> attribute <span style='color:#e34adc; '>else</span> changevalueproperty <span style='color:#e34adc; '>then</span> ; <span style='color:#696969; '>\ +++</span>
307: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>addproperty</span> <span style='color:#007997; '>property</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>( -- )</span> ;
308: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>device-name</span> <span style='color:#696969; '>( A L -- )</span><span style='color:#0000e6; '> ."  Name="</span> <span style='color:#800000; font-weight:bold; '>2dup</span> <span style='color:#800000; font-weight:bold; '>type</span> <span style='color:#007997; '>encode-string</span><span style='color:#0000e6; '> s" name"</span> <span style='color:#007997; '>property</span> ; <span style='color:#696969; '>\ +++</span>
309: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>device-type</span> <span style='color:#696969; '>( A L -- )</span> <span style='color:#007997; '>encode-string</span><span style='color:#0000e6; '> s" device-type"</span> <span style='color:#007997; '>property</span> ; <span style='color:#696969; '>\ +++</span>
310: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>model</span>       <span style='color:#696969; '>( A L -- )</span> <span style='color:#007997; '>encode-string</span><span style='color:#0000e6; '> s" model"</span>       <span style='color:#007997; '>property</span> ; <span style='color:#696969; '>\ +++</span>
311: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>set-args</span> <span style='color:#696969; '>( arg-str, arg-len, reg-str, reg-len )</span>
312:    <span style='color:#0000e6; '> s" reg"</span> <span style='color:#007997; '>property</span> <span style='color:#696969; '>( arg-str, arg-len )</span> <span style='color:#696969; '>\ Story Reg-str i property REG</span>
313:     placeinvoc <span style='color:#696969; '>\ Place arg-ar to voc</span>
314:     <span style='color:#696969; '>( adrargstr )</span> <span style='color:#007997; '>my-self</span> <span style='color:#800000; font-weight:bold; '>>code</span> adrarguments <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>( -- )</span> ;
315: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>izvlargs</span> <span style='color:#696969; '>( node )</span> <span style='color:#800000; font-weight:bold; '>>code</span> adrarguments <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>0</span>&lt;>
316:     <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>>code</span> <span style='color:#800000; font-weight:bold; '>count</span> <span style='color:#e34adc; '>else</span> <span style='color:#008c00; '>0</span> <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>( Adr, Len )</span> ;                    <span style='color:#696969; '>\ +</span>
317: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>my-args</span> <span style='color:#696969; '>( -- )</span> <span style='color:#007997; '>my-self</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#e34adc; '>if</span> izvlargs <span style='color:#e34adc; '>else</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>(  )</span> ; <span style='color:#696969; '>\ +</span>
318: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>typechainchild</span> <span style='color:#696969; '>( Pnode )</span>
319:     <span style='color:#e34adc; '>begin</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#e34adc; '>while</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>.</span> <span style='color:#800000; font-weight:bold; '>space</span> <span style='color:#800000; font-weight:bold; '>>code</span> childhandle   <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#e34adc; '>repeat</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>( -- )</span> ; <span style='color:#696969; '>\ +</span>
320: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>typechainsibl</span> <span style='color:#696969; '>( Pnode )</span>
321:     <span style='color:#e34adc; '>begin</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#e34adc; '>while</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>.</span> <span style='color:#800000; font-weight:bold; '>space</span> <span style='color:#800000; font-weight:bold; '>>code</span> siblinghandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#e34adc; '>repeat</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>( -- )</span> ; <span style='color:#696969; '>\ +</span>
322: 
323: <span style='color:#0000e6; '>c" bvfind"</span> <span style='color:#800000; font-weight:bold; '>find</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#800000; font-weight:bold; '>not</span> <span style='color:#000000; background:#a8a800; '>[IF]</span>
324: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>bvfind</span> <span style='color:#696969; '>( AdrW LenW VocPtr -- XtW 1 | endVoc 0 )</span>
325:     <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#696969; '>( AdrW LenW LatestTVoc )</span>
326:     <span style='color:#e34adc; '>begin</span>
327:         <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#008c00; '>0</span>&lt;>
328:         <span style='color:#e34adc; '>if</span>  <span style='color:#696969; '>( AdrW LenW Nfa )</span>
329:             <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>count</span> <span style='color:#008c00; '>4</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#008c00; '>4</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#800000; font-weight:bold; '>compare</span> <span style='color:#008c00; '>0</span>=
330:             <span style='color:#e34adc; '>if</span>  <span style='color:#696969; '>( We find it ! )</span>
331:                 <span style='color:#800000; font-weight:bold; '>false</span>
332:             <span style='color:#e34adc; '>else</span>
333:                 <span style='color:#800000; font-weight:bold; '>true</span>
334:             <span style='color:#e34adc; '>then</span>
335:         <span style='color:#e34adc; '>else</span>
336:             <span style='color:#800000; font-weight:bold; '>false</span>
337:         <span style='color:#e34adc; '>then</span>
338:     <span style='color:#e34adc; '>while</span>
339:         prevname
340:     <span style='color:#e34adc; '>repeat</span> <span style='color:#696969; '>( AdrW LenW Nfa )</span>
341:     <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#008c00; '>0</span>&lt;> <span style='color:#696969; '>( Nfa 1 | endVoc 0 )</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>over</span>
342:     <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>name></span> <span style='color:#e34adc; '>then</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#696969; '>( XtW 1 | endVoc 0 )</span> ; <span style='color:#000000; background:#a8a800; '>[THEN]</span>
343: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>.nm</span> <span style='color:#800000; font-weight:bold; '>cr</span><span style='color:#0000e6; '> ." Words-"</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>count</span> <span style='color:#800000; font-weight:bold; '>type</span> ;
344: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>xtfindinvoc</span> <span style='color:#696969; '>( Xt LNFAVoc -- Xt )</span>
345:     <span style='color:#e34adc; '>begin</span>
346:         <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#008c00; '>0</span>&lt;>
347:         <span style='color:#e34adc; '>if</span>
348:             <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>cell-</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>dup</span> is.primitive?
349:             <span style='color:#e34adc; '>if</span>
350:             <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#800000; font-weight:bold; '>true</span>
351:             <span style='color:#e34adc; '>else</span>
352:                 <span style='color:#800000; font-weight:bold; '>>code</span>
353:                 <span style='color:#e34adc; '>begin</span>
354:                     <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>0</span>&lt;>
355:                     <span style='color:#e34adc; '>if</span>
356:                         <span style='color:#008c00; '>3</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#800000; font-weight:bold; '>=</span>
357:                         <span style='color:#e34adc; '>if</span>
358:                             cr? ?pause <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#800000; font-weight:bold; '>dup</span> id. tab <span style='color:#800000; font-weight:bold; '>true</span> <span style='color:#800000; font-weight:bold; '>false</span>
359:                         <span style='color:#e34adc; '>else</span>
360:                             <span style='color:#800000; font-weight:bold; '>true</span> <span style='color:#800000; font-weight:bold; '>true</span>
361:                         <span style='color:#e34adc; '>then</span>
362:                     <span style='color:#e34adc; '>else</span>
363:                         <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>( ,, 0 )</span> <span style='color:#800000; font-weight:bold; '>true</span> <span style='color:#800000; font-weight:bold; '>swap</span>
364:                     <span style='color:#e34adc; '>then</span>
365:                 <span style='color:#e34adc; '>while</span>
366:                     <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#800000; font-weight:bold; '>cell+</span>
367:                 <span style='color:#e34adc; '>repeat</span>
368:             <span style='color:#e34adc; '>then</span>
369:         <span style='color:#e34adc; '>else</span>
370:             <span style='color:#800000; font-weight:bold; '>false</span>
371:         <span style='color:#e34adc; '>then</span>
372:     <span style='color:#e34adc; '>while</span>
373:         prevname
374:     <span style='color:#e34adc; '>repeat</span> ;
375: 
376: <span style='color:#696969; '>\ Show all words that included Xt in own body</span>
377: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>.calls</span> <span style='color:#696969; '>( xt -- )</span>
378:     <span style='color:#007997; '>dictlist</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#696969; '>( PtrVoc Xt )</span>
379:     <span style='color:#e34adc; '>begin</span>
380:         <span style='color:#800000; font-weight:bold; '>over</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#008c00; '>0</span>&lt;>
381:         <span style='color:#e34adc; '>if</span>
382:             <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>cell</span> <span style='color:#008c00; '>4</span> <span style='color:#800000; font-weight:bold; '>*</span> <span style='color:#800000; font-weight:bold; '>+</span> <span style='color:#800000; font-weight:bold; '>cr</span><span style='color:#0000e6; '> ." Voc-"</span> id.  <span style='color:#800000; font-weight:bold; '>cr</span>
383:             <span style='color:#800000; font-weight:bold; '>cell+</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#008c00; '>0</span>&lt;>
384:             <span style='color:#e34adc; '>if</span> xtfindinvoc <span style='color:#800000; font-weight:bold; '>true</span> <span style='color:#e34adc; '>else</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#e34adc; '>then</span>
385:         <span style='color:#e34adc; '>else</span>
386:             <span style='color:#800000; font-weight:bold; '>false</span>
387:         <span style='color:#e34adc; '>then</span>
388:     <span style='color:#e34adc; '>while</span>
389:         <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>swap</span>
390:     <span style='color:#e34adc; '>repeat</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#800000; font-weight:bold; '>cr</span> <span style='color:#696969; '>( -- )</span> ;
391: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>find-method</span> <span style='color:#696969; '>( MethStr MethLen Phandle -- False | Xt True )</span>
392:     <span style='color:#800000; font-weight:bold; '>>code</span> methvochandle <span style='color:#800000; font-weight:bold; '>@</span> voclistbase <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>+</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#696969; '>( MethStr MethLen Pvoc )</span>
393:     bvfind <span style='color:#696969; '>( xt true | ptrvoc false )</span>
394:     <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>0</span>= <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>( False | Xt True )</span> ;
395: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>$call-method</span> <span style='color:#696969; '>( MethStr MethLen Phandle -- )</span>
396:     nodehandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>>r</span> <span style='color:#800000; font-weight:bold; '>dup</span> nodehandle <span style='color:#800000; font-weight:bold; '>!</span>
397:     find-method <span style='color:#696969; '>( False | Xt True )</span>
398:     <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>execute</span>
399:     <span style='color:#e34adc; '>else</span><span style='color:#0000e6; '> abort" Sorry this method dosn't consist in this </span><span style='color:#ffffff; background:#808000; '>node !!!</span><span style='color:#0000e6; '>"</span>
400:     <span style='color:#e34adc; '>then</span> <span style='color:#800000; font-weight:bold; '>r></span> nodehandle <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>(  )</span> ;
401: 
402: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>headers</span> norealize ;
403: 
404: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>3drop</span> <span style='color:#696969; '>( i j k -- )</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>(  )</span> ;
405: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>2rot</span>  <span style='color:#696969; '>( 1 2 3 4 5 6 )</span>     <span style='color:#008c00; '>5</span> <span style='color:#800000; font-weight:bold; '>roll</span> <span style='color:#008c00; '>5</span> <span style='color:#800000; font-weight:bold; '>roll</span> <span style='color:#696969; '>( 3 4 5 6 1 2 )</span> ;
406: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>3rot</span>  <span style='color:#696969; '>( 1 2 3 4 5 6 7 8 )</span> <span style='color:#008c00; '>7</span> <span style='color:#800000; font-weight:bold; '>roll</span> <span style='color:#008c00; '>7</span> <span style='color:#800000; font-weight:bold; '>roll</span> <span style='color:#696969; '>( 3 4 5 6 7 8 1 2 )</span> ;
407: 
408: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>fcode-version2</span> h# <span style='color:#008c00; '>00020001</span> ;
409: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>fcode-revision</span> h# <span style='color:#008c00; '>00020001</span> ;
410: <span style='color:#800000; font-weight:bold; '>variable</span> fcode-debug? <span style='color:#008c00; '>0</span> fcode-debug? <span style='color:#800000; font-weight:bold; '>!</span> <span style='color:#696969; '>\ Flag for debuging fcode programm</span>
411: <span style='color:#800000; font-weight:bold; '>variable</span> fcode-end
412: 
413: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>scsi-selftest</span> norealize ;
414: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>..</span> <span style='color:#800000; font-weight:bold; '>.s</span> <span style='color:#696969; '>( cr ." It dont </span><span style='color:#ffffff; background:#808000; '>worked !!!</span><span style='color:#696969; '>" )</span> ;
415: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>x+</span> <span style='color:#007997; '>encode+</span> ;
416: 
417: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>get-buffers</span> <span style='color:#800000; font-weight:bold; '>here</span> <span style='color:#008c00; '>1000</span> <span style='color:#800000; font-weight:bold; '>allot</span> ;
418: 
419: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>$open-package</span> norealize ;
420: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>close-package</span> norealize ;
421: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>my-parent</span> <span style='color:#696969; '>( -- Inode )</span> <span style='color:#007997; '>my-self</span> <span style='color:#800000; font-weight:bold; '>>code</span> parenthandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#696969; '>( Inode )</span> ;
422: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>$call-parent</span> <span style='color:#696969; '>( Am Lm )</span> my-parent $call-method <span style='color:#696969; '>( </span><span style='color:#ffffff; background:#808000; '>???</span><span style='color:#696969; '> )</span> ;
423: 
424: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>version</span> norealize ;
425: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>sdc</span> <span style='color:#800000; font-weight:bold; '>.</span> norealize ;
426: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>external</span> norealize ;
427: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>end0</span>  <span style='color:#008c00; '>00</span> norealize ;
428: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>end1</span> <span style='color:#008c00; '>255</span> norealize ;
429: 
430: <span style='color:#696969; '>\ For example 3-1</span>
431: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>bounds</span> <span style='color:#008c00; '>10</span> ;
432: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>#out</span> <span style='color:#008c00; '>20</span> ;
433: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>l@</span> <span style='color:#800000; font-weight:bold; '>@</span> ;
434: 
435: <span style='color:#800000; font-weight:bold; '>defer</span> <span style='color:#008c00; '>b</span>(<span style='color:#800000; font-weight:bold; '>:</span>) <span style='color:#696969; '>( 0xb7 )</span>
436: <span style='color:#e34adc; '>decimal</span>
437: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>get-phan-inher-prop</span> <span style='color:#696969; '>( NameStr NameLen node )</span>
438:     <span style='color:#e34adc; '>begin</span>
439: <span style='color:#696969; '>\        s" name" 2 pick get-package-property</span>
440: <span style='color:#696969; '>\        not if cr ." Node=" type space then</span>
441:         <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#696969; '>( NameStr NameLen Inode )</span>
442:         get-package-property <span style='color:#696969; '>( Adr Len False | True )</span>
443:         <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#e34adc; '>if</span> <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>pick</span> <span style='color:#800000; font-weight:bold; '>>code</span> parenthandle <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#e34adc; '>else</span> <span style='color:#800000; font-weight:bold; '>false</span> <span style='color:#e34adc; '>then</span> <span style='color:#800000; font-weight:bold; '>and</span>
444:     <span style='color:#e34adc; '>while</span> <span style='color:#696969; '>( NameStr NameLen Inode )</span>
445:         <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#800000; font-weight:bold; '>>code</span> parenthandle <span style='color:#800000; font-weight:bold; '>@</span>
446:     <span style='color:#e34adc; '>repeat</span>
447:     <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#e34adc; '>if</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#e34adc; '>else</span> 2rot <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#800000; font-weight:bold; '>2swap</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#e34adc; '>then</span>
448:     <span style='color:#696969; '>( Adr Len False | True )</span> ; <span style='color:#696969; '>\ ++</span>
449: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>get-inherited-property</span> <span style='color:#696969; '>( NameStr NameLen -- Adr Len False | True )</span>
450:     <span style='color:#007997; '>my-self</span> <span style='color:#696969; '>( NameStr NameLen Inode )</span> get-phan-inher-prop <span style='color:#696969; '>( Adr Len False | True )</span> ;
451: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>decode-physadr</span> <span style='color:#696969; '>( A L -- PhysHi ...  PhysLo Aend Lend Size )</span>
452:    <span style='color:#0000e6; '> s" #address-cells"</span> nodehandle <span style='color:#800000; font-weight:bold; '>@</span> get-phan-inher-prop <span style='color:#696969; '>( Adr Len False | True )</span>
453:     <span style='color:#e34adc; '>if</span> <span style='color:#008c00; '>1</span> <span style='color:#e34adc; '>else</span> <span style='color:#007997; '>decode-int</span> <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>( A L AC )</span> <span style='color:#800000; font-weight:bold; '>>r</span>
454:     <span style='color:#800000; font-weight:bold; '>r@</span> <span style='color:#008c00; '>0</span>   <span style='color:#e34adc; '>do</span> <span style='color:#007997; '>decode-int</span> <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#e34adc; '>loop</span> 
455:     <span style='color:#800000; font-weight:bold; '>r@</span> <span style='color:#008c00; '>0</span>   <span style='color:#e34adc; '>do</span> <span style='color:#007997; '>decode-int</span> <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#e34adc; '>loop</span> 
456:     <span style='color:#800000; font-weight:bold; '>r@</span> <span style='color:#008c00; '>0</span>   <span style='color:#e34adc; '>do</span> <span style='color:#007997; '>decode-int</span> <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#e34adc; '>loop</span>
457:     <span style='color:#800000; font-weight:bold; '>r></span> <span style='color:#696969; '>\ For standart variant dup dup + + 1+ dup >r roll r@ roll r> roll</span>
458:     <span style='color:#696969; '>( PhysHi ...  PhysLo Aend Lend Size )</span> ;
459: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>decode-phys</span> <span style='color:#696969; '>( A L -- PhysHi ...  PhysLo Aend Lend Size )</span>
460:     decode-physadr <span style='color:#696969; '>( PhysHi ...  PhysLo Aend Lend Size )</span>
461:     <span style='color:#800000; font-weight:bold; '>r></span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>+</span> <span style='color:#800000; font-weight:bold; '>+</span> <span style='color:#696969; '>\ 3 *</span>
462:     <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#008c00; '>1</span>+ <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#008c00; '>0</span> <span style='color:#e34adc; '>do</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>>r</span> <span style='color:#800000; font-weight:bold; '>roll</span> <span style='color:#800000; font-weight:bold; '>r></span> <span style='color:#e34adc; '>loop</span> <span style='color:#800000; font-weight:bold; '>drop</span>
463:     <span style='color:#696969; '>( Aend Lend PhysHi ...  PhysLo Size )</span> ;
464: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>encode-phys</span> <span style='color:#696969; '>( PhysHi ...  PhysLo Size )</span>
465:    <span style='color:#0000e6; '> s" #address-cells"</span> nodehandle <span style='color:#800000; font-weight:bold; '>@</span> get-phan-inher-prop <span style='color:#696969; '>( Adr Len False | True )</span>
466: <span style='color:#696969; '>\    br0 decode-int 1  ( N ( Ncells by adress )</span>
467:     <span style='color:#e34adc; '>if</span> <span style='color:#008c00; '>1</span> <span style='color:#e34adc; '>else</span> <span style='color:#007997; '>decode-int</span> <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#e34adc; '>then</span>
468:     <span style='color:#008c00; '>3</span> <span style='color:#800000; font-weight:bold; '>*</span> <span style='color:#800000; font-weight:bold; '>dup</span> <span style='color:#800000; font-weight:bold; '>>r</span> <span style='color:#008c00; '>1</span>- <span style='color:#800000; font-weight:bold; '>roll</span> <span style='color:#007997; '>encode-int</span> <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>r></span> <span style='color:#e34adc; '>do</span> i <span style='color:#800000; font-weight:bold; '>roll</span> <span style='color:#007997; '>encode-int</span> <span style='color:#007997; '>encode+</span> -<span style='color:#008c00; '>1</span> <span style='color:#e34adc; '>+loop</span>
469:     <span style='color:#696969; '>( Padr Plen )</span> ; <span style='color:#696969; '>\ ++</span>
470: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>my-unit</span> <span style='color:#696969; '>( -- phys.lo .... phys.hi )</span>
471:    <span style='color:#0000e6; '> s" reg"</span> <span style='color:#007997; '>my-self</span> get-package-property <span style='color:#696969; '>( Adr Len False | True )</span>
472:     <span style='color:#e34adc; '>if</span> <span style='color:#696969; '>\ No property "reg" defined</span>
473:        <span style='color:#0000e6; '> s" #address-cells"</span> <span style='color:#007997; '>my-self</span> get-phan-inher-prop
474:         <span style='color:#e34adc; '>if</span> <span style='color:#008c00; '>2</span> <span style='color:#e34adc; '>else</span> <span style='color:#007997; '>decode-int</span> <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#e34adc; '>then</span> <span style='color:#800000; font-weight:bold; '>dup</span>
475:         <span style='color:#800000; font-weight:bold; '>>r</span> <span style='color:#008c00; '>0</span> <span style='color:#e34adc; '>do</span> <span style='color:#008c00; '>0</span> <span style='color:#e34adc; '>loop</span>  <span style='color:#800000; font-weight:bold; '>r@</span> <span style='color:#008c00; '>0</span> <span style='color:#e34adc; '>do</span> <span style='color:#008c00; '>0</span> <span style='color:#e34adc; '>loop</span>  <span style='color:#800000; font-weight:bold; '>r></span> <span style='color:#008c00; '>0</span> <span style='color:#e34adc; '>do</span> <span style='color:#008c00; '>0</span> <span style='color:#e34adc; '>loop</span> <span style='color:#696969; '>\ ?????</span>
476:     <span style='color:#e34adc; '>else</span> <span style='color:#696969; '>( Adr Len )</span> decode-physadr <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#696969; '>( phys.lo .... phys.hi )</span>
477:     <span style='color:#e34adc; '>then</span> <span style='color:#696969; '>(  phys.lo .... phys.hi )</span> ;
478: <span style='color:#696969; '>\ Convert interrup to CPU inerupt</span>
479: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>intr>cpu</span> ;
480: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>reg</span> <span style='color:#696969; '>( Phys.lo Phys.hi Size )</span> <span style='color:#800000; font-weight:bold; '>>r</span> <span style='color:#007997; '>encode-phys</span> <span style='color:#800000; font-weight:bold; '>r></span> <span style='color:#007997; '>encode-int</span> <span style='color:#696969; '>( A1 L1 A2 L2 )</span>
481:     <span style='color:#007997; '>encode+</span> <span style='color:#696969; '>( A L )</span><span style='color:#0000e6; '> s" reg"</span> <span style='color:#007997; '>property</span> <span style='color:#696969; '>(  )</span> ;
482: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>name</span> <span style='color:#696969; '>( adr len -- )</span> <span style='color:#007997; '>encode-string</span><span style='color:#0000e6; '> s" name"</span> <span style='color:#007997; '>property</span> <span style='color:#696969; '>( -- )</span> ;
483: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>intr</span> <span style='color:#696969; '>( Level Vector )</span> <span style='color:#800000; font-weight:bold; '>>r</span> intr>cpu <span style='color:#007997; '>encode-int</span> <span style='color:#800000; font-weight:bold; '>r></span> <span style='color:#007997; '>encode-int</span> <span style='color:#007997; '>encode+</span>
484:     <span style='color:#696969; '>( adr len )</span><span style='color:#0000e6; '> s" intr"</span> <span style='color:#007997; '>property</span> <span style='color:#696969; '>( -- )</span> ;
485: 
486: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>mask-lo-part</span> <span style='color:#696969; '>( phis.lo .... phys.hi )</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#696969; '>( phis.lo .... )</span> ; 
487: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>mask-hi-part</span> <span style='color:#696969; '>( phis.lo .... phys.hi )</span> <span style='color:#800000; font-weight:bold; '>>r</span>
488:    <span style='color:#0000e6; '> s" #address-cells"</span> <span style='color:#007997; '>my-self</span> get-phan-inher-prop <span style='color:#696969; '>( A L F | T )</span>
489:     <span style='color:#e34adc; '>if</span> <span style='color:#008c00; '>1</span> <span style='color:#e34adc; '>else</span> <span style='color:#007997; '>decode-int</span> <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#e34adc; '>then</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>&lt;&lt;</span> <span style='color:#696969; '>( ( 2 component: LO &amp; HI )</span>
490:     <span style='color:#008c00; '>0</span> <span style='color:#e34adc; '>do</span> <span style='color:#800000; font-weight:bold; '>drop</span> <span style='color:#e34adc; '>loop</span> <span style='color:#800000; font-weight:bold; '>r></span> <span style='color:#696969; '>( phis.hi )</span> ; 
491: 
492: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>my-address</span> <span style='color:#696969; '>( -- phys.lo )</span> my-unit mask-lo-part <span style='color:#696969; '>( phys.lo )</span> ;
493: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>my-space</span>   <span style='color:#696969; '>( -- phys.hi )</span> my-unit mask-hi-part <span style='color:#696969; '>( phys.hi )</span> ;
494: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>>reg-spec</span> <span style='color:#696969; '>( offset size -- encodereg )</span>
495:     <span style='color:#800000; font-weight:bold; '>>r</span> my-address <span style='color:#800000; font-weight:bold; '>+</span> my-space <span style='color:#007997; '>encode-phys</span>
496:     <span style='color:#800000; font-weight:bold; '>r></span> <span style='color:#007997; '>encode-int</span> <span style='color:#007997; '>encode+</span> <span style='color:#696969; '>( 2dup type ( A L )</span> ;
497: 
498: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>getnamehandleproperty</span> <span style='color:#696969; '>( A L A L )</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#800000; font-weight:bold; '>2drop</span> norealize
499:    <span style='color:#0000e6; '> s" 120,400000"</span> <span style='color:#696969; '>( A L )</span> ;
500: <span style='color:#800000; font-weight:bold; '>: </span><span style='color:#000000; background:#a8a800; '>btest</span> <span style='color:#696969; '>( -- bit )</span><span style='color:#0000e6; '> s" testbit"</span> get-my-property <span style='color:#696969; '>( A L F|T )</span>
501:     <span style='color:#e34adc; '>if</span><span style='color:#0000e6; '> abort" No define testbit </span><span style='color:#ffffff; background:#808000; '>property !!!</span><span style='color:#0000e6; '>"</span>
502:     <span style='color:#e34adc; '>else</span>
503:         <span style='color:#007997; '>decode-int</span> <span style='color:#800000; font-weight:bold; '>-rot</span> <span style='color:#800000; font-weight:bold; '>2drop</span> <span style='color:#696969; '>( i )</span> <span style='color:#800000; font-weight:bold; '>/mod</span> <span style='color:#696969; '>( i ost n )</span> <span style='color:#008c00; '>2</span> <span style='color:#800000; font-weight:bold; '>&lt;&lt;</span>
504:        <span style='color:#0000e6; '> s" adrtestbittable"</span><span style='color:#0000e6; '> s" /options"</span> getnamehandleproperty
505:         <span style='color:#007997; '>encode-phys</span> <span style='color:#800000; font-weight:bold; '>+</span> <span style='color:#800000; font-weight:bold; '>@</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>swap</span> <span style='color:#800000; font-weight:bold; '>&lt;&lt;</span> <span style='color:#800000; font-weight:bold; '>and</span> <span style='color:#696969; '>( bit )</span>
506:     <span style='color:#e34adc; '>then</span> ;
507: 
</pre></body></html>
