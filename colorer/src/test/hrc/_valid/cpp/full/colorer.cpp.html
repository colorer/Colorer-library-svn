<html><body style='color:#000000; background:#ffffff; '><pre>
   0: <span style='color:#696969; '>//</span>
   1: <span style='color:#696969; '>//  Copyright (c) </span><span style='color:#696969; '>Cail Lomecb</span><span style='color:#696969; '> (Igor Ruskih) 1999-2001 </span><span style='color:#0000e6; '>&lt;</span><span style='color:#7144c4; '>ruiv@uic.nnov.ru</span><span style='color:#0000e6; '>></span>
   2: <span style='color:#696969; '>//  You can use, modify, distribute this code or any other part</span>
   3: <span style='color:#696969; '>//  of colorer library in sources or in binaries only according</span>
   4: <span style='color:#696969; '>//  to Colorer License (see /doc/license.txt for more information).</span>
   5: <span style='color:#696969; '>//</span>
   6: 
   7: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '> __MSDOS__</span>
   8: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>include</span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>io.h</span><span style='color:#800000; '>></span>
   9: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>include</span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>new.h</span><span style='color:#800000; '>></span>
  10: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>include</span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>stdlib.h</span><span style='color:#800000; '>></span>
  11: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>include</span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>conio.h</span><span style='color:#800000; '>></span>
  12: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
  13: 
  14: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '> _WIN32</span>
  15: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>include</span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>io.h</span><span style='color:#800000; '>></span>
  16: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>include</span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>windows.h</span><span style='color:#800000; '>></span>
  17: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>include</span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>sys/timeb.h</span><span style='color:#800000; '>></span>
  18: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>include</span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>time.h</span><span style='color:#800000; '>></span>
  19: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>include</span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>string</span><span style='color:#800000; '>></span>
  20: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>include</span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>list</span><span style='color:#800000; '>></span>
  21: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>include</span><span style='color:#800000; '>"</span><span style='color:#40015a; '>clip.hpp</span><span style='color:#800000; '>"</span>
  22: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
  23: 
  24: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>include</span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>fcntl.h</span><span style='color:#800000; '>></span>
  25: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>include</span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>sys/stat.h</span><span style='color:#800000; '>></span>
  26: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>include</span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>stdio.h</span><span style='color:#800000; '>></span>
  27: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>include</span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>string.h</span><span style='color:#800000; '>></span>
  28: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>include</span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>colorer/classes.h</span><span style='color:#800000; '>></span>
  29: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>include</span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>regexp/cregexp.h</span><span style='color:#800000; '>></span>
  30: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>include</span><span style='color:#800000; '>&lt;</span><span style='color:#40015a; '>sgml/sgml.h</span><span style='color:#800000; '>></span>
  31: 
  32: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> LEN 256</span>
  33: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>define</span><span style='color:#004a43; '> UNIX_CFG </span><span style='color:#0000e6; '>"/usr/share/colorer/bin/.colorer.ini"</span>
  34: <span style='color:#696969; '>// load variants</span>
  35: <span style='color:#800000; font-weight:bold; '>enum</span> <span style='color:#800080; '>{</span> EREGEXP<span style='color:#808030; '>,</span> ELIST<span style='color:#808030; '>,</span> EVIEW<span style='color:#808030; '>,</span> EGEN <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
  36: <span style='color:#696969; '>// these structures contains file's lines</span>
  37: <span style='color:#800000; font-weight:bold; '>struct</span> SLines
  38: <span style='color:#800080; '>{</span>
  39:   <span style='color:#800000; font-weight:bold; '>int</span>  len<span style='color:#800080; '>;</span>
  40:   <span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>data<span style='color:#800080; '>;</span>
  41:   <span style='color:#800000; font-weight:bold; '>bool</span> newdata<span style='color:#800080; '>;</span>
  42:   <span style='color:#800000; font-weight:bold; '>void</span> dup<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
  43:   SLines<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span> newdata <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>false</span><span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
  44:   <span style='color:#808030; '>~</span>SLines<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>newdata<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>delete</span> data<span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
  45: <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
  46: 
  47: <span style='color:#800000; font-weight:bold; '>int</span> what <span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
  48: <span style='color:#800000; font-weight:bold; '>char</span> fname<span style='color:#808030; '>[</span>LEN<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
  49: <span style='color:#800000; font-weight:bold; '>char</span> basefname<span style='color:#808030; '>[</span>LEN<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
  50: <span style='color:#800000; font-weight:bold; '>char</span> frules<span style='color:#808030; '>[</span>LEN<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
  51: <span style='color:#800000; font-weight:bold; '>char</span> typedescr<span style='color:#808030; '>[</span><span style='color:#008c00; '>64</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
  52: <span style='color:#800000; font-weight:bold; '>int</span>  totallines<span style='color:#808030; '>,</span> htmlsubst<span style='color:#808030; '>,</span> cpdis <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> bkcolor <span style='color:#808030; '>=</span> <span style='color:#008000; '>0x1F</span><span style='color:#800080; '>;</span>
  53: SLines <span style='color:#808030; '>*</span>lines<span style='color:#800080; '>;</span>
  54: 
  55: PAssignData ad<span style='color:#800080; '>;</span>
  56: PAssign adata<span style='color:#800080; '>;</span>
  57: PColorData cd<span style='color:#800080; '>;</span>
  58: PColorer cc<span style='color:#800080; '>;</span>
  59: PType type<span style='color:#800080; '>;</span>
  60: PLineHL l1<span style='color:#808030; '>,</span> hlines<span style='color:#800080; '>;</span>
  61: 
  62: <span style='color:#3f5fbf; '>/////////////////////////////////////////////////////////////////////////////</span>
  63: <span style='color:#696969; '>// check for tabs</span>
  64: <span style='color:#800000; font-weight:bold; '>void</span> SLines<span style='color:#800080; '>::</span>dup<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span>
  65: <span style='color:#800080; '>{</span>
  66: <span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>od <span style='color:#808030; '>=</span> data<span style='color:#800080; '>;</span>
  67: <span style='color:#800000; font-weight:bold; '>int</span> chg <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
  68: <span style='color:#800000; font-weight:bold; '>int</span>  i<span style='color:#800080; '>;</span>
  69:   <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span>i <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> i <span style='color:#808030; '>&lt;</span> len<span style='color:#800080; '>;</span> i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span>
  70:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>data<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'\t'</span><span style='color:#808030; '>)</span> chg<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
  71:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>chg<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
  72: 
  73:   data <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>new</span> <span style='color:#800000; font-weight:bold; '>char</span><span style='color:#808030; '>[</span>len <span style='color:#808030; '>+</span> chg<span style='color:#808030; '>*</span><span style='color:#008c00; '>4</span> <span style='color:#808030; '>+</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
  74:   memset<span style='color:#808030; '>(</span>data<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> len <span style='color:#808030; '>+</span> chg<span style='color:#808030; '>*</span><span style='color:#008c00; '>4</span> <span style='color:#808030; '>+</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
  75:   strncpy<span style='color:#808030; '>(</span>data<span style='color:#808030; '>,</span> od<span style='color:#808030; '>,</span> len<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
  76:   <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span>i <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> data<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span> i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
  77:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>data<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'\t'</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
  78:       <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> j <span style='color:#808030; '>=</span> len<span style='color:#808030; '>-</span>i<span style='color:#800080; '>;</span> j<span style='color:#800080; '>;</span> j<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#808030; '>)</span>
  79:         data<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span>j<span style='color:#808030; '>+</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> data<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span>j<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
  80:       data<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>' '</span><span style='color:#800080; '>;</span>
  81:       data<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>' '</span><span style='color:#800080; '>;</span>
  82:       data<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>' '</span><span style='color:#800080; '>;</span>
  83:       data<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>' '</span><span style='color:#800080; '>;</span>
  84:       len<span style='color:#808030; '>+</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>3</span><span style='color:#800080; '>;</span>
  85:     <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
  86:   <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
  87:   newdata <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>true</span><span style='color:#800080; '>;</span>
  88: <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
  89: 
  90: <span style='color:#696969; '>// tests regular expressions</span>
  91: <span style='color:#800000; font-weight:bold; '>void</span> retest<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span>
  92: <span style='color:#800080; '>{</span>
  93: SMatches match<span style='color:#800080; '>;</span>
  94: PRegExp re<span style='color:#800080; '>;</span>
  95: <span style='color:#800000; font-weight:bold; '>bool</span> res<span style='color:#800080; '>;</span>
  96: <span style='color:#800000; font-weight:bold; '>char</span> text<span style='color:#808030; '>[</span><span style='color:#008c00; '>255</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
  97: 
  98:   re <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>new</span> CRegExp<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
  99:   <span style='color:#800000; font-weight:bold; '>do</span><span style='color:#800080; '>{</span>
 100:     printf<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>regexp:"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 101:     gets<span style='color:#808030; '>(</span>text<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 102:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>re<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>SetExpr<span style='color:#808030; '>(</span>text<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>continue</span><span style='color:#800080; '>;</span>
 103:     printf<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"exprn:"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 104:     gets<span style='color:#808030; '>(</span>text<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 105:     res <span style='color:#808030; '>=</span> re<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>Parse<span style='color:#808030; '>(</span>text<span style='color:#808030; '>,</span> <span style='color:#808030; '>&amp;</span>match<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 106:     printf<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>%s</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>match:  "</span><span style='color:#808030; '>,</span>res<span style='color:#800080; '>?</span><span style='color:#0000e6; '>"ok"</span><span style='color:#800080; '>:</span><span style='color:#0000e6; '>"error"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 107:     <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> i <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> i <span style='color:#808030; '>&lt;</span> match<span style='color:#808030; '>.</span>cMatch<span style='color:#800080; '>;</span> i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
 108:       printf<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>%d</span><span style='color:#0000e6; '>:(</span><span style='color:#0f69ff; '>%d</span><span style='color:#0000e6; '>,</span><span style='color:#0f69ff; '>%d</span><span style='color:#0000e6; '>), "</span><span style='color:#808030; '>,</span>i<span style='color:#808030; '>,</span>match<span style='color:#808030; '>.</span>s<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>,</span>match<span style='color:#808030; '>.</span>e<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 109:     <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 110:   <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>while</span><span style='color:#808030; '>(</span>text<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 111:   <span style='color:#800000; font-weight:bold; '>delete</span> re<span style='color:#800080; '>;</span>
 112: <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 113: 
 114: <span style='color:#696969; '>// loads all found types</span>
 115: <span style='color:#800000; font-weight:bold; '>void</span> <span style='color:#603000; '>list</span><span style='color:#808030; '>(</span><span style='color:#808030; '>)</span>
 116: <span style='color:#800080; '>{</span>
 117: PColorData cd<span style='color:#800080; '>;</span>
 118: PType type<span style='color:#800080; '>;</span>
 119: 
 120:   cd <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>new</span> CColorData<span style='color:#808030; '>(</span>basefname<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"./_colorer.log"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 121:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>cd<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>IsOk<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
 122:     fprintf<span style='color:#808030; '>(</span><span style='color:#603000; '>stderr</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"cannot load colorer base from </span><span style='color:#0f69ff; '>%s</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>,</span> basefname<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 123:     <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
 124:   <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 125:   fprintf<span style='color:#808030; '>(</span><span style='color:#603000; '>stderr</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>loading file types. check _colorer.log</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 126:   <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span>type <span style='color:#808030; '>=</span> cd<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>EnumTypes<span style='color:#808030; '>(</span><span style='color:#7d0045; '>NULL</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span> type<span style='color:#800080; '>;</span> type <span style='color:#808030; '>=</span> cd<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>EnumTypes<span style='color:#808030; '>(</span>type<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
 127:     printf<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>%s</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>,</span> type<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>descr<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 128:     cd<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>LoadType<span style='color:#808030; '>(</span>type<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 129:   <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 130: <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 131: 
 132: <span style='color:#696969; '>// function called from CColorer object</span>
 133: <span style='color:#800000; font-weight:bold; '>const</span> <span style='color:#800000; font-weight:bold; '>char</span><span style='color:#808030; '>*</span> GetLine<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>void</span> <span style='color:#808030; '>*</span>param<span style='color:#808030; '>,</span> CColorer <span style='color:#808030; '>*</span>who<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>int</span> lno<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>int</span><span style='color:#808030; '>*</span>len<span style='color:#808030; '>)</span>
 134: <span style='color:#800080; '>{</span>
 135:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>lno <span style='color:#808030; '>></span> totallines<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#7d0045; '>NULL</span><span style='color:#800080; '>;</span>
 136:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>len<span style='color:#808030; '>)</span> <span style='color:#808030; '>*</span>len <span style='color:#808030; '>=</span> lines<span style='color:#808030; '>[</span>lno<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len<span style='color:#800080; '>;</span>
 137:   <span style='color:#800000; font-weight:bold; '>return</span> lines<span style='color:#808030; '>[</span>lno<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#800080; '>;</span>
 138: <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 139: <span style='color:#696969; '>// search type with typedescr</span>
 140: PType seltype<span style='color:#808030; '>(</span>PColorData cd<span style='color:#808030; '>)</span>
 141: <span style='color:#800080; '>{</span>
 142: <span style='color:#800000; font-weight:bold; '>int</span> len<span style='color:#800080; '>;</span>
 143:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span><span style='color:#808030; '>*</span>typedescr<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#7d0045; '>NULL</span><span style='color:#800080; '>;</span>
 144:   len <span style='color:#808030; '>=</span> strlen<span style='color:#808030; '>(</span>typedescr<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 145:   <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span>PType tp <span style='color:#808030; '>=</span> cd<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>EnumTypes<span style='color:#808030; '>(</span><span style='color:#7d0045; '>NULL</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span> tp<span style='color:#800080; '>;</span> tp <span style='color:#808030; '>=</span> tp<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>next<span style='color:#808030; '>)</span>
 146:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>tp<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>descr <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>!</span>strnicmp<span style='color:#808030; '>(</span>tp<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>descr<span style='color:#808030; '>,</span> typedescr<span style='color:#808030; '>,</span> len<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>return</span> tp<span style='color:#800080; '>;</span>
 147:   <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#7d0045; '>NULL</span><span style='color:#800080; '>;</span>
 148: <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 149: <span style='color:#696969; '>//  load lines into array</span>
 150: <span style='color:#800000; font-weight:bold; '>bool</span> formatlines<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>data<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>int</span> len<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>int</span> no<span style='color:#808030; '>)</span>
 151: <span style='color:#800080; '>{</span>
 152: <span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>file<span style='color:#800080; '>;</span>
 153: <span style='color:#800000; font-weight:bold; '>int</span> i<span style='color:#808030; '>,</span> llen <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 154: 
 155:   totallines <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 156:   file <span style='color:#808030; '>=</span> data<span style='color:#800080; '>;</span>
 157:   <span style='color:#800000; font-weight:bold; '>while</span><span style='color:#808030; '>(</span>file <span style='color:#808030; '>&lt;</span> data <span style='color:#808030; '>+</span> len<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
 158:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>*</span>file <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'\r'</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>*</span>file <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'\n'</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
 159:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>file<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'\r'</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> file<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'\n'</span><span style='color:#808030; '>)</span> file<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 160:       <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>file<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'\n'</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> file<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'\r'</span><span style='color:#808030; '>)</span> file<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 161:       totallines<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 162:     <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 163:     file<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 164:   <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 165:   lines <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>new</span> SLines<span style='color:#808030; '>[</span>totallines<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
 166:   file <span style='color:#808030; '>=</span> data<span style='color:#800080; '>;</span>
 167:   lines<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>data <span style='color:#808030; '>=</span> file<span style='color:#800080; '>;</span>
 168:   i <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 169:   <span style='color:#800000; font-weight:bold; '>while</span><span style='color:#808030; '>(</span>file <span style='color:#808030; '>&lt;</span> data <span style='color:#808030; '>+</span> len<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
 170:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>*</span>file <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'\r'</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>*</span>file <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'\n'</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
 171:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>file<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'\r'</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> file<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'\n'</span><span style='color:#808030; '>)</span> file<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 172:       <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>file<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'\n'</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> file<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'\r'</span><span style='color:#808030; '>)</span> file<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 173:       lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len <span style='color:#808030; '>=</span> llen <span style='color:#808030; '>-</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 174:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>no<span style='color:#808030; '>)</span> lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>dup<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 175:       llen <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 176:       i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 177:       lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data <span style='color:#808030; '>=</span> file <span style='color:#808030; '>+</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 178:     <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 179:     file<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 180:     llen<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 181:   <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 182:   lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len <span style='color:#808030; '>=</span> llen <span style='color:#808030; '>-</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 183:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>no<span style='color:#808030; '>)</span> lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>dup<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 184:   <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#800000; font-weight:bold; '>true</span><span style='color:#800080; '>;</span>
 185: <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 186: 
 187: <span style='color:#696969; '>// check and substitutes characters in HTML</span>
 188: <span style='color:#800000; font-weight:bold; '>void</span> SetLine<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>line<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>src<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>int</span> len<span style='color:#808030; '>)</span>
 189: <span style='color:#800080; '>{</span>
 190:   strncpy<span style='color:#808030; '>(</span>line<span style='color:#808030; '>,</span> src<span style='color:#808030; '>,</span> len<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 191:   line<span style='color:#808030; '>[</span>len<span style='color:#808030; '>]</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 192: 
 193:   <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> i<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> line<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span> i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
 194:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>htmlsubst <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> line<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'&lt;'</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
 195:       <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> j <span style='color:#808030; '>=</span> len<span style='color:#808030; '>-</span>i<span style='color:#800080; '>;</span> j<span style='color:#800080; '>;</span> j<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#808030; '>)</span>
 196:         line<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span>j<span style='color:#808030; '>+</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> line<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span>j<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
 197:       line<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'&amp;'</span><span style='color:#800080; '>;</span>
 198:       line<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'l'</span><span style='color:#800080; '>;</span>
 199:       line<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'t'</span><span style='color:#800080; '>;</span>
 200:       line<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>';'</span><span style='color:#800080; '>;</span>
 201:       len<span style='color:#808030; '>+</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>3</span><span style='color:#800080; '>;</span>
 202:     <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 203:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>htmlsubst <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> line<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'>'</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
 204:       <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> j <span style='color:#808030; '>=</span> len<span style='color:#808030; '>-</span>i<span style='color:#800080; '>;</span> j<span style='color:#800080; '>;</span> j<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#808030; '>)</span>
 205:         line<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span>j<span style='color:#808030; '>+</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> line<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span>j<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
 206:       line<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'&amp;'</span><span style='color:#800080; '>;</span>
 207:       line<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'g'</span><span style='color:#800080; '>;</span>
 208:       line<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'t'</span><span style='color:#800080; '>;</span>
 209:       line<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>';'</span><span style='color:#800080; '>;</span>
 210:       len<span style='color:#808030; '>+</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>3</span><span style='color:#800080; '>;</span>
 211:     <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 212:     <span style='color:#696969; '>// for printf :)</span>
 213:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>line<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'%'</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
 214:       <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> j <span style='color:#808030; '>=</span> len<span style='color:#808030; '>-</span>i<span style='color:#800080; '>;</span> j<span style='color:#800080; '>;</span> j<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#808030; '>)</span>
 215:         line<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span>j<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> line<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span>j<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
 216:       line<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'%'</span><span style='color:#800080; '>;</span>
 217:       line<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'%'</span><span style='color:#800080; '>;</span>
 218:       len<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 219:       i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 220:     <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 221:   <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 222: <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 223: 
 224: <span style='color:#800000; font-weight:bold; '>class</span> ScreenBuffer<span style='color:#800080; '>{</span>
 225: <span style='color:#800000; font-weight:bold; '>public</span><span style='color:#e34adc; '>:</span>
 226:   ScreenBuffer<span style='color:#808030; '>(</span><span style='color:#603000; '>HANDLE</span> con<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> w<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> h<span style='color:#808030; '>)</span>
 227:   <span style='color:#800080; '>{</span>
 228:     buffer<span style='color:#808030; '>=</span><span style='color:#7d0045; '>NULL</span><span style='color:#800080; '>;</span>
 229:     console<span style='color:#808030; '>=</span>con<span style='color:#800080; '>;</span>
 230:     resize<span style='color:#808030; '>(</span>w<span style='color:#808030; '>,</span>h<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 231:   <span style='color:#800080; '>}</span>
 232:   <span style='color:#800000; font-weight:bold; '>void</span> resize<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> w<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> h<span style='color:#808030; '>)</span>
 233:   <span style='color:#800080; '>{</span>
 234:     <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>buffer<span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>delete</span> <span style='color:#808030; '>[</span><span style='color:#808030; '>]</span> buffer<span style='color:#800080; '>;</span>
 235:     width<span style='color:#808030; '>=</span>w<span style='color:#800080; '>;</span>
 236:     height<span style='color:#808030; '>=</span>h<span style='color:#800080; '>;</span>
 237:     size<span style='color:#808030; '>=</span>width<span style='color:#808030; '>*</span>height<span style='color:#800080; '>;</span>
 238:     buffer<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>new</span> <span style='color:#603000; '>CHAR_INFO</span><span style='color:#808030; '>[</span>size<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
 239:   <span style='color:#800080; '>}</span>
 240:   <span style='color:#800000; font-weight:bold; '>void</span> fillattr<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> x<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> y<span style='color:#808030; '>,</span><span style='color:#603000; '>WORD</span> attr<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> cnt<span style='color:#808030; '>)</span>
 241:   <span style='color:#800080; '>{</span>
 242:     <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>y<span style='color:#808030; '>></span><span style='color:#808030; '>=</span>height<span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
 243:     <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>x<span style='color:#808030; '>&lt;</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>cnt<span style='color:#808030; '>+</span><span style='color:#808030; '>=</span>x<span style='color:#800080; '>;</span>x<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span><span style='color:#800080; '>}</span>
 244:     <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>cnt<span style='color:#808030; '>&lt;</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
 245:     <span style='color:#800000; font-weight:bold; '>int</span> n<span style='color:#808030; '>=</span>x<span style='color:#808030; '>+</span>cnt<span style='color:#808030; '>&lt;</span>width<span style='color:#800080; '>?</span>cnt<span style='color:#800080; '>:</span>width<span style='color:#808030; '>-</span>x<span style='color:#800080; '>;</span>
 246:     <span style='color:#603000; '>CHAR_INFO</span> <span style='color:#808030; '>*</span>b<span style='color:#808030; '>=</span>buffer<span style='color:#808030; '>+</span>y<span style='color:#808030; '>*</span>width<span style='color:#808030; '>+</span>x<span style='color:#800080; '>;</span>
 247:     <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> i<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>i<span style='color:#808030; '>&lt;</span>n<span style='color:#800080; '>;</span>i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span>
 248:     <span style='color:#800080; '>{</span>
 249:       b<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>Attributes<span style='color:#808030; '>=</span>attr<span style='color:#800080; '>;</span>
 250:       b<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 251:     <span style='color:#800080; '>}</span>
 252:   <span style='color:#800080; '>}</span>
 253:   <span style='color:#800000; font-weight:bold; '>void</span> fillchar<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> x<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> y<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>char</span> chr<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> cnt<span style='color:#808030; '>)</span>
 254:   <span style='color:#800080; '>{</span>
 255:     <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>y<span style='color:#808030; '>></span><span style='color:#808030; '>=</span>height<span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
 256:     <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>x<span style='color:#808030; '>&lt;</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>cnt<span style='color:#808030; '>+</span><span style='color:#808030; '>=</span>x<span style='color:#800080; '>;</span>x<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span><span style='color:#800080; '>}</span>
 257:     <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>cnt<span style='color:#808030; '>&lt;</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
 258:     <span style='color:#800000; font-weight:bold; '>int</span> n<span style='color:#808030; '>=</span>x<span style='color:#808030; '>+</span>cnt<span style='color:#808030; '>&lt;</span>width<span style='color:#800080; '>?</span>cnt<span style='color:#800080; '>:</span>width<span style='color:#808030; '>-</span>x<span style='color:#800080; '>;</span>
 259:     <span style='color:#603000; '>CHAR_INFO</span> <span style='color:#808030; '>*</span>b<span style='color:#808030; '>=</span>buffer<span style='color:#808030; '>+</span>y<span style='color:#808030; '>*</span>width<span style='color:#808030; '>+</span>x<span style='color:#800080; '>;</span>
 260:     <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> i<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>i<span style='color:#808030; '>&lt;</span>n<span style='color:#800080; '>;</span>i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span>
 261:     <span style='color:#800080; '>{</span>
 262:       b<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>Char<span style='color:#808030; '>.</span>AsciiChar<span style='color:#808030; '>=</span>chr<span style='color:#800080; '>;</span>
 263:       b<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 264:     <span style='color:#800080; '>}</span>
 265:   <span style='color:#800080; '>}</span>
 266:   <span style='color:#800000; font-weight:bold; '>void</span> write<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> x<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> y<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>const</span> <span style='color:#800000; font-weight:bold; '>char</span><span style='color:#808030; '>*</span> txt<span style='color:#808030; '>)</span>
 267:   <span style='color:#800080; '>{</span>
 268:     write<span style='color:#808030; '>(</span>x<span style='color:#808030; '>,</span>y<span style='color:#808030; '>,</span>txt<span style='color:#808030; '>,</span>strlen<span style='color:#808030; '>(</span>txt<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 269:   <span style='color:#800080; '>}</span>
 270:   <span style='color:#800000; font-weight:bold; '>void</span> write<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> x<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> y<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>const</span> <span style='color:#800000; font-weight:bold; '>char</span><span style='color:#808030; '>*</span> txt<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> cnt<span style='color:#808030; '>)</span>
 271:   <span style='color:#800080; '>{</span>
 272:     <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>y<span style='color:#808030; '>></span><span style='color:#808030; '>=</span>height<span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
 273:     <span style='color:#800000; font-weight:bold; '>int</span> n<span style='color:#808030; '>=</span>x<span style='color:#808030; '>+</span>cnt<span style='color:#808030; '>&lt;</span>width<span style='color:#800080; '>?</span>cnt<span style='color:#800080; '>:</span>width<span style='color:#808030; '>-</span>x<span style='color:#800080; '>;</span>
 274:     <span style='color:#603000; '>CHAR_INFO</span> <span style='color:#808030; '>*</span>b<span style='color:#808030; '>=</span>buffer<span style='color:#808030; '>+</span>y<span style='color:#808030; '>*</span>width<span style='color:#808030; '>+</span>x<span style='color:#800080; '>;</span>
 275:     <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> i<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>i<span style='color:#808030; '>&lt;</span>n<span style='color:#800080; '>;</span>i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span>
 276:     <span style='color:#800080; '>{</span>
 277:       b<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>Char<span style='color:#808030; '>.</span>AsciiChar<span style='color:#808030; '>=</span><span style='color:#808030; '>*</span>txt<span style='color:#800080; '>;</span>
 278:       b<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>txt<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 279:     <span style='color:#800080; '>}</span>
 280:   <span style='color:#800080; '>}</span>
 281:   <span style='color:#800000; font-weight:bold; '>void</span> flush<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span>
 282:   <span style='color:#800080; '>{</span>
 283:     invalidate<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>width<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span>height<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 284:   <span style='color:#800080; '>}</span>
 285:   <span style='color:#800000; font-weight:bold; '>void</span> invalidate<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> x<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> y<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> w<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> h<span style='color:#808030; '>)</span>
 286:   <span style='color:#800080; '>{</span>
 287:     <span style='color:#603000; '>COORD</span> bufsize<span style='color:#800080; '>;</span>
 288:     bufsize<span style='color:#808030; '>.</span>X<span style='color:#808030; '>=</span>width<span style='color:#800080; '>;</span>
 289:     bufsize<span style='color:#808030; '>.</span>Y<span style='color:#808030; '>=</span>height<span style='color:#800080; '>;</span>
 290:     <span style='color:#603000; '>COORD</span> to<span style='color:#800080; '>;</span>
 291:     to<span style='color:#808030; '>.</span>X<span style='color:#808030; '>=</span>x<span style='color:#800080; '>;</span>
 292:     to<span style='color:#808030; '>.</span>Y<span style='color:#808030; '>=</span>y<span style='color:#800080; '>;</span>
 293:     <span style='color:#603000; '>SMALL_RECT</span> wnd<span style='color:#800080; '>;</span>
 294:     wnd<span style='color:#808030; '>.</span>Left<span style='color:#808030; '>=</span>x<span style='color:#800080; '>;</span>
 295:     wnd<span style='color:#808030; '>.</span>Top<span style='color:#808030; '>=</span>y<span style='color:#800080; '>;</span>
 296:     wnd<span style='color:#808030; '>.</span>Right<span style='color:#808030; '>=</span>x<span style='color:#808030; '>+</span>w<span style='color:#800080; '>;</span>
 297:     wnd<span style='color:#808030; '>.</span>Bottom<span style='color:#808030; '>=</span>y<span style='color:#808030; '>+</span>h<span style='color:#800080; '>;</span>
 298:     <span style='color:#400000; '>WriteConsoleOutput</span><span style='color:#808030; '>(</span>console<span style='color:#808030; '>,</span>buffer<span style='color:#808030; '>,</span>bufsize<span style='color:#808030; '>,</span>to<span style='color:#808030; '>,</span><span style='color:#808030; '>&amp;</span>wnd<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 299:   <span style='color:#800080; '>}</span>
 300:   <span style='color:#800000; font-weight:bold; '>int</span> W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span><span style='color:#800000; font-weight:bold; '>return</span> width<span style='color:#800080; '>;</span><span style='color:#800080; '>}</span>
 301:   <span style='color:#800000; font-weight:bold; '>int</span> H<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span><span style='color:#800000; font-weight:bold; '>return</span> height<span style='color:#800080; '>;</span><span style='color:#800080; '>}</span>
 302:   <span style='color:#800000; font-weight:bold; '>void</span> hidecursor<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span>
 303:   <span style='color:#800080; '>{</span>
 304:     savecur<span style='color:#808030; '>.</span>dwSize<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 305:     savecur<span style='color:#808030; '>.</span>bVisible<span style='color:#808030; '>=</span>TRUE<span style='color:#800080; '>;</span>
 306:     <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span><span style='color:#808030; '>!</span><span style='color:#400000; '>GetConsoleCursorInfo</span><span style='color:#808030; '>(</span>console<span style='color:#808030; '>,</span><span style='color:#808030; '>&amp;</span>savecur<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
 307:     <span style='color:#800080; '>{</span>
 308:       <span style='color:#603000; '>HANDLE</span> hnd<span style='color:#808030; '>=</span><span style='color:#400000; '>GetStdHandle</span><span style='color:#808030; '>(</span>STD_OUTPUT_HANDLE<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 309:       <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span><span style='color:#808030; '>!</span><span style='color:#400000; '>GetConsoleCursorInfo</span><span style='color:#808030; '>(</span>hnd<span style='color:#808030; '>,</span><span style='color:#808030; '>&amp;</span>savecur<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
 310:       <span style='color:#800080; '>{</span>
 311:         <span style='color:#603000; '>DWORD</span> err<span style='color:#808030; '>=</span><span style='color:#400000; '>GetLastError</span><span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 312:         savecur<span style='color:#808030; '>.</span>dwSize<span style='color:#808030; '>=</span><span style='color:#008c00; '>10</span><span style='color:#800080; '>;</span>
 313:         savecur<span style='color:#808030; '>.</span>bVisible<span style='color:#808030; '>=</span>TRUE<span style='color:#800080; '>;</span>
 314:       <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 315:     <span style='color:#800080; '>}</span>
 316:     <span style='color:#603000; '>CONSOLE_CURSOR_INFO</span> cci<span style='color:#800080; '>;</span>
 317:     cci<span style='color:#808030; '>.</span>dwSize <span style='color:#808030; '>=</span> <span style='color:#008c00; '>100</span><span style='color:#800080; '>;</span>
 318:     cci<span style='color:#808030; '>.</span>bVisible <span style='color:#808030; '>=</span> FALSE<span style='color:#800080; '>;</span>
 319:     <span style='color:#400000; '>SetConsoleCursorInfo</span><span style='color:#808030; '>(</span>console<span style='color:#808030; '>,</span> <span style='color:#808030; '>&amp;</span>cci<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 320:   <span style='color:#800080; '>}</span>
 321:   <span style='color:#800000; font-weight:bold; '>void</span> showcursor<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span>
 322:   <span style='color:#800080; '>{</span>
 323:     <span style='color:#400000; '>SetConsoleCursorInfo</span><span style='color:#808030; '>(</span>console<span style='color:#808030; '>,</span> <span style='color:#808030; '>&amp;</span>savecur<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 324:   <span style='color:#800080; '>}</span>
 325:   <span style='color:#800000; font-weight:bold; '>void</span> setcurpos<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> x<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> y<span style='color:#808030; '>)</span>
 326:   <span style='color:#800080; '>{</span>
 327:     <span style='color:#603000; '>COORD</span> c<span style='color:#800080; '>;</span>
 328:     c<span style='color:#808030; '>.</span>X<span style='color:#808030; '>=</span>x<span style='color:#800080; '>;</span>
 329:     c<span style='color:#808030; '>.</span>Y<span style='color:#808030; '>=</span>y<span style='color:#800080; '>;</span>
 330:     <span style='color:#400000; '>SetConsoleCursorPosition</span><span style='color:#808030; '>(</span>console<span style='color:#808030; '>,</span>c<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 331:   <span style='color:#800080; '>}</span>
 332: <span style='color:#800000; font-weight:bold; '>protected</span><span style='color:#e34adc; '>:</span>
 333:   <span style='color:#603000; '>CHAR_INFO</span> <span style='color:#808030; '>*</span>buffer<span style='color:#800080; '>;</span>
 334:   <span style='color:#800000; font-weight:bold; '>int</span> width<span style='color:#800080; '>;</span>
 335:   <span style='color:#800000; font-weight:bold; '>int</span> height<span style='color:#800080; '>;</span>
 336:   <span style='color:#800000; font-weight:bold; '>int</span> size<span style='color:#800080; '>;</span>
 337:   <span style='color:#603000; '>HANDLE</span> console<span style='color:#800080; '>;</span>
 338:   <span style='color:#603000; '>CONSOLE_CURSOR_INFO</span> savecur<span style='color:#800080; '>;</span>
 339: <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 340: 
 341: ScreenBuffer <span style='color:#808030; '>*</span>scrbuf<span style='color:#800080; '>;</span>
 342: 
 343: <span style='color:#603000; '>DWORD</span> CTRL_PRESSED<span style='color:#808030; '>=</span>LEFT_CTRL_PRESSED<span style='color:#808030; '>|</span>RIGHT_CTRL_PRESSED<span style='color:#800080; '>;</span>
 344: <span style='color:#603000; '>DWORD</span> ALT_PRESSED<span style='color:#808030; '>=</span>LEFT_ALT_PRESSED<span style='color:#808030; '>|</span>RIGHT_ALT_PRESSED<span style='color:#800080; '>;</span>
 345: 
 346: <span style='color:#603000; '>DWORD</span> CTRL_KEYS<span style='color:#808030; '>=</span>CTRL_PRESSED<span style='color:#808030; '>|</span>ALT_PRESSED<span style='color:#808030; '>|</span>SHIFT_PRESSED<span style='color:#800080; '>;</span>
 347: 
 348: <span style='color:#800000; font-weight:bold; '>int</span> word_left<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>const</span> <span style='color:#800000; font-weight:bold; '>char</span><span style='color:#808030; '>*</span> str<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> pos<span style='color:#808030; '>)</span>
 349: <span style='color:#800080; '>{</span>
 350:   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>pos<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 351:   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>str<span style='color:#808030; '>[</span>pos<span style='color:#808030; '>]</span><span style='color:#808030; '>!</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>' '</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> str<span style='color:#808030; '>[</span>pos<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>' '</span><span style='color:#808030; '>)</span>pos<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#800080; '>;</span>
 352:   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>str<span style='color:#808030; '>[</span>pos<span style='color:#808030; '>]</span><span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>' '</span><span style='color:#808030; '>)</span>
 353:   <span style='color:#800080; '>{</span>
 354:     <span style='color:#800000; font-weight:bold; '>while</span><span style='color:#808030; '>(</span>pos<span style='color:#808030; '>></span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> str<span style='color:#808030; '>[</span>pos<span style='color:#808030; '>]</span><span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>' '</span><span style='color:#808030; '>)</span>pos<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#800080; '>;</span>
 355:   <span style='color:#800080; '>}</span>
 356:   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>pos<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 357:   <span style='color:#800000; font-weight:bold; '>while</span><span style='color:#808030; '>(</span>pos<span style='color:#808030; '>></span><span style='color:#008c00; '>1</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> str<span style='color:#808030; '>[</span>pos<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>!</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>' '</span><span style='color:#808030; '>)</span>pos<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#800080; '>;</span>
 358:   <span style='color:#800000; font-weight:bold; '>return</span> pos<span style='color:#800080; '>;</span>
 359: <span style='color:#800080; '>}</span>
 360: 
 361: 
 362: <span style='color:#800000; font-weight:bold; '>int</span> word_right<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>const</span> <span style='color:#800000; font-weight:bold; '>char</span><span style='color:#808030; '>*</span> str<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> pos<span style='color:#808030; '>)</span>
 363: <span style='color:#800080; '>{</span>
 364:   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>str<span style='color:#808030; '>[</span>pos<span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>return</span> pos<span style='color:#800080; '>;</span>
 365:   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>str<span style='color:#808030; '>[</span>pos<span style='color:#808030; '>]</span><span style='color:#808030; '>!</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>' '</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> str<span style='color:#808030; '>[</span>pos<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>' '</span><span style='color:#808030; '>)</span>pos<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 366:   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>str<span style='color:#808030; '>[</span>pos<span style='color:#808030; '>]</span><span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>' '</span><span style='color:#808030; '>)</span>
 367:   <span style='color:#800080; '>{</span>
 368:     <span style='color:#800000; font-weight:bold; '>while</span><span style='color:#808030; '>(</span>str<span style='color:#808030; '>[</span>pos<span style='color:#808030; '>]</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> str<span style='color:#808030; '>[</span>pos<span style='color:#808030; '>]</span><span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>' '</span><span style='color:#808030; '>)</span>pos<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 369:   <span style='color:#800080; '>}</span>
 370:   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>str<span style='color:#808030; '>[</span>pos<span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>return</span> pos<span style='color:#800080; '>;</span>
 371:   <span style='color:#800000; font-weight:bold; '>while</span><span style='color:#808030; '>(</span>str<span style='color:#808030; '>[</span>pos<span style='color:#808030; '>]</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> str<span style='color:#808030; '>[</span>pos<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>!</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>' '</span><span style='color:#808030; '>)</span>pos<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 372:   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>str<span style='color:#808030; '>[</span>pos<span style='color:#808030; '>]</span><span style='color:#808030; '>)</span>pos<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 373:   <span style='color:#800000; font-weight:bold; '>return</span> pos<span style='color:#800080; '>;</span>
 374: <span style='color:#800080; '>}</span>
 375: 
 376: <span style='color:#800000; font-weight:bold; '>void</span> extend_selection<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span><span style='color:#808030; '>&amp;</span> s<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span><span style='color:#808030; '>&amp;</span> e<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> op<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> p<span style='color:#808030; '>)</span>
 377: <span style='color:#800080; '>{</span>
 378:   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>s<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
 379:   <span style='color:#800080; '>{</span>
 380:     <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>op<span style='color:#808030; '>&lt;</span>p<span style='color:#808030; '>)</span>
 381:     <span style='color:#800080; '>{</span>
 382:       s<span style='color:#808030; '>=</span>op<span style='color:#800080; '>;</span>
 383:       e<span style='color:#808030; '>=</span>p<span style='color:#800080; '>;</span>
 384:     <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 385:     <span style='color:#800080; '>{</span>
 386:       s<span style='color:#808030; '>=</span>p<span style='color:#800080; '>;</span>
 387:       e<span style='color:#808030; '>=</span>op<span style='color:#800080; '>;</span>
 388:     <span style='color:#800080; '>}</span>
 389:     <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
 390:   <span style='color:#800080; '>}</span>
 391:   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>s<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>op<span style='color:#808030; '>)</span>s<span style='color:#808030; '>=</span>p<span style='color:#800080; '>;</span>
 392:   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>e<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>op<span style='color:#808030; '>)</span>e<span style='color:#808030; '>=</span>p<span style='color:#800080; '>;</span>
 393:   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>s<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>e<span style='color:#808030; '>)</span>s<span style='color:#808030; '>=</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 394: <span style='color:#800080; '>}</span>
 395: 
 396: <span style='color:#800000; font-weight:bold; '>struct</span> ed_undo_struct<span style='color:#800080; '>{</span>
 397:   <span style='color:#666616; '>std</span><span style='color:#800080; '>::</span><span style='color:#603000; '>string</span> str<span style='color:#800080; '>;</span>
 398:   <span style='color:#800000; font-weight:bold; '>int</span> leftpos<span style='color:#800080; '>;</span>
 399:   <span style='color:#800000; font-weight:bold; '>int</span> curpos<span style='color:#800080; '>;</span>
 400:   <span style='color:#800000; font-weight:bold; '>int</span> selstart<span style='color:#800080; '>;</span>
 401:   <span style='color:#800000; font-weight:bold; '>int</span> selend<span style='color:#800080; '>;</span>
 402: <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 403: <span style='color:#800000; font-weight:bold; '>class</span> edundolist<span style='color:#800080; '>:</span><span style='color:#800000; font-weight:bold; '>public</span> <span style='color:#666616; '>std</span><span style='color:#800080; '>::</span><span style='color:#603000; '>list</span><span style='color:#800080; '>&lt;</span>ed_undo_struct<span style='color:#800080; '>></span><span style='color:#800080; '>{</span>
 404: <span style='color:#800000; font-weight:bold; '>public</span><span style='color:#e34adc; '>:</span>
 405:   <span style='color:#800000; font-weight:bold; '>void</span> push_back<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>const</span> <span style='color:#666616; '>std</span><span style='color:#800080; '>::</span><span style='color:#603000; '>string</span><span style='color:#808030; '>&amp;</span> s<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> lp<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> cp<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> ss<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> se<span style='color:#808030; '>)</span>
 406:   <span style='color:#800080; '>{</span>
 407:     ed_undo_struct st<span style='color:#800080; '>;</span>
 408:     insert<span style='color:#808030; '>(</span>end<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>st<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 409:     back<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span>str<span style='color:#808030; '>=</span>s<span style='color:#800080; '>;</span>
 410:     back<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span>leftpos<span style='color:#808030; '>=</span>lp<span style='color:#800080; '>;</span>
 411:     back<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span>curpos<span style='color:#808030; '>=</span>cp<span style='color:#800080; '>;</span>
 412:     back<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span>selstart<span style='color:#808030; '>=</span>ss<span style='color:#800080; '>;</span>
 413:     back<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span>selend<span style='color:#808030; '>=</span>se<span style='color:#800080; '>;</span>
 414:   <span style='color:#800080; '>}</span>
 415:   <span style='color:#800000; font-weight:bold; '>bool</span> changed<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>const</span> <span style='color:#666616; '>std</span><span style='color:#800080; '>::</span><span style='color:#603000; '>string</span><span style='color:#808030; '>&amp;</span> s<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> lp<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> cp<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> ss<span style='color:#808030; '>,</span><span style='color:#800000; font-weight:bold; '>int</span> se<span style='color:#808030; '>)</span>
 416:   <span style='color:#800080; '>{</span>
 417:     <span style='color:#800000; font-weight:bold; '>return</span> back<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span>leftpos<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span>lp <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> back<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span>curpos<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span>cp <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span>
 418:            back<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span>selstart<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span>ss <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> back<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span>selend<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span>se <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span>
 419:            back<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span>str<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span>s<span style='color:#800080; '>;</span>
 420:   <span style='color:#800080; '>}</span>
 421: <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 422: 
 423: 
 424: <span style='color:#800000; font-weight:bold; '>bool</span> search_input<span style='color:#808030; '>(</span><span style='color:#603000; '>HANDLE</span> conin<span style='color:#808030; '>,</span><span style='color:#666616; '>std</span><span style='color:#800080; '>::</span><span style='color:#603000; '>string</span><span style='color:#808030; '>&amp;</span> findstring<span style='color:#808030; '>)</span>
 425: <span style='color:#800080; '>{</span>
 426:   <span style='color:#666616; '>std</span><span style='color:#800080; '>::</span><span style='color:#603000; '>string</span> s<span style='color:#808030; '>=</span>findstring<span style='color:#800080; '>;</span>
 427:   scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>fillattr<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>H<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>7</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 428:   scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>fillchar<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>H<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>' '</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 429:   <span style='color:#603000; '>INPUT_RECORD</span> ir<span style='color:#800080; '>;</span>
 430:   <span style='color:#800000; font-weight:bold; '>int</span> leftpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>curpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 431:   <span style='color:#603000; '>DWORD</span> tmp<span style='color:#800080; '>;</span>
 432:   <span style='color:#800000; font-weight:bold; '>bool</span> quit<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>false</span><span style='color:#800080; '>;</span>
 433:   <span style='color:#800000; font-weight:bold; '>bool</span> retval<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>true</span><span style='color:#800080; '>;</span>
 434:   <span style='color:#800000; font-weight:bold; '>bool</span> redraw<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>true</span><span style='color:#800080; '>;</span>
 435:   <span style='color:#800000; font-weight:bold; '>int</span> selstart<span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span>selend<span style='color:#808030; '>=</span>findstring<span style='color:#808030; '>.</span>length<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 436: 
 437:   scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>showcursor<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 438: 
 439:   edundolist undo<span style='color:#800080; '>;</span>
 440:   undo<span style='color:#808030; '>.</span>push_back<span style='color:#808030; '>(</span>s<span style='color:#808030; '>,</span>leftpos<span style='color:#808030; '>,</span>curpos<span style='color:#808030; '>,</span>selstart<span style='color:#808030; '>,</span>selend<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 441:   <span style='color:#800000; font-weight:bold; '>const</span> <span style='color:#800000; font-weight:bold; '>int</span> maxundo<span style='color:#808030; '>=</span><span style='color:#008c00; '>256</span><span style='color:#800080; '>;</span>
 442: 
 443:   <span style='color:#800000; font-weight:bold; '>bool</span> skipundo<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>false</span><span style='color:#800080; '>;</span>
 444: 
 445:   <span style='color:#800000; font-weight:bold; '>while</span><span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>quit<span style='color:#808030; '>)</span>
 446:   <span style='color:#800080; '>{</span>
 447:     <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>redraw<span style='color:#808030; '>)</span>
 448:     <span style='color:#800080; '>{</span>
 449:       <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>skipundo <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> undo<span style='color:#808030; '>.</span>changed<span style='color:#808030; '>(</span>s<span style='color:#808030; '>,</span>leftpos<span style='color:#808030; '>,</span>curpos<span style='color:#808030; '>,</span>selstart<span style='color:#808030; '>,</span>selend<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
 450:       <span style='color:#800080; '>{</span>
 451:         undo<span style='color:#808030; '>.</span>push_back<span style='color:#808030; '>(</span>s<span style='color:#808030; '>,</span>leftpos<span style='color:#808030; '>,</span>curpos<span style='color:#808030; '>,</span>selstart<span style='color:#808030; '>,</span>selend<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 452:         <span style='color:#696969; '>//while(undo.size()>=maxundo)undo.pop_front();</span>
 453:       <span style='color:#800080; '>}</span>
 454:       skipundo<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>false</span><span style='color:#800080; '>;</span>
 455:       scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>fillchar<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>H<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>' '</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 456:       scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>fillattr<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>H<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>7</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 457:       <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>selstart<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
 458:       <span style='color:#800080; '>{</span>
 459:         scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>fillattr<span style='color:#808030; '>(</span>selstart<span style='color:#808030; '>-</span>leftpos<span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>H<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span><span style='color:#008000; '>0x70</span><span style='color:#808030; '>,</span>selend<span style='color:#808030; '>-</span>selstart<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 460:       <span style='color:#800080; '>}</span>
 461:       scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>write<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>H<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span>s<span style='color:#808030; '>.</span>c_str<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>+</span>leftpos<span style='color:#808030; '>,</span>s<span style='color:#808030; '>.</span>length<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span>leftpos<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 462:       scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>invalidate<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>H<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 463:       scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>setcurpos<span style='color:#808030; '>(</span>curpos<span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>H<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 464:     <span style='color:#800080; '>}</span>
 465:     redraw<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>true</span><span style='color:#800080; '>;</span>
 466:     <span style='color:#400000; '>ReadConsoleInput</span><span style='color:#808030; '>(</span>conin<span style='color:#808030; '>,</span> <span style='color:#808030; '>&amp;</span>ir<span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>&amp;</span>tmp<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 467:     <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>ir<span style='color:#808030; '>.</span>EventType <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> KEY_EVENT <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>KeyEvent<span style='color:#808030; '>.</span>bKeyDown<span style='color:#808030; '>)</span>
 468:     <span style='color:#800080; '>{</span>
 469:       <span style='color:#603000; '>DWORD</span> state<span style='color:#808030; '>=</span>ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>KeyEvent<span style='color:#808030; '>.</span>dwControlKeyState<span style='color:#808030; '>&amp;</span>CTRL_KEYS<span style='color:#800080; '>;</span>
 470:       <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>state<span style='color:#808030; '>&amp;</span>CTRL_PRESSED<span style='color:#808030; '>)</span>state<span style='color:#808030; '>|</span><span style='color:#808030; '>=</span>CTRL_PRESSED<span style='color:#800080; '>;</span>
 471:       <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>state<span style='color:#808030; '>&amp;</span>ALT_PRESSED<span style='color:#808030; '>)</span>state<span style='color:#808030; '>|</span><span style='color:#808030; '>=</span>ALT_PRESSED<span style='color:#800080; '>;</span>
 472:       <span style='color:#800000; font-weight:bold; '>int</span> shift<span style='color:#808030; '>=</span>state<span style='color:#808030; '>&amp;</span>SHIFT_PRESSED<span style='color:#800080; '>;</span>
 473:       state<span style='color:#808030; '>&amp;</span><span style='color:#808030; '>=</span><span style='color:#808030; '>~</span>SHIFT_PRESSED<span style='color:#800080; '>;</span>
 474:       <span style='color:#800000; font-weight:bold; '>int</span> pos<span style='color:#808030; '>=</span>leftpos<span style='color:#808030; '>+</span>curpos<span style='color:#800080; '>;</span>
 475:       <span style='color:#800000; font-weight:bold; '>switch</span><span style='color:#808030; '>(</span>ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>KeyEvent<span style='color:#808030; '>.</span>wVirtualKeyCode<span style='color:#808030; '>)</span>
 476:       <span style='color:#800080; '>{</span>
 477:         <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>VK_LEFT</span><span style='color:#e34adc; '>:</span>
 478:           <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>state<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>CTRL_PRESSED<span style='color:#808030; '>)</span>
 479:           <span style='color:#800080; '>{</span>
 480:             <span style='color:#800000; font-weight:bold; '>int</span> wl<span style='color:#808030; '>=</span>word_left<span style='color:#808030; '>(</span>s<span style='color:#808030; '>.</span>c_str<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>leftpos<span style='color:#808030; '>+</span>curpos<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 481:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>wl<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
 482:             <span style='color:#800080; '>{</span>
 483:               leftpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 484:               curpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 485:             <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 486:             <span style='color:#800080; '>{</span>
 487:               <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>wl<span style='color:#808030; '>&lt;</span>leftpos<span style='color:#808030; '>)</span>
 488:               <span style='color:#800080; '>{</span>
 489:                 leftpos<span style='color:#808030; '>=</span>wl<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 490:                 curpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 491:               <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 492:               <span style='color:#800080; '>{</span>
 493:                 curpos<span style='color:#808030; '>=</span>wl<span style='color:#808030; '>-</span>leftpos<span style='color:#800080; '>;</span>
 494:               <span style='color:#800080; '>}</span>
 495:             <span style='color:#800080; '>}</span>
 496:           <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 497:           <span style='color:#800080; '>{</span>
 498:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>curpos<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
 499:             <span style='color:#800080; '>{</span>
 500:               <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>leftpos<span style='color:#808030; '>></span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span>leftpos<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#800080; '>;</span>
 501:             <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 502:             <span style='color:#800080; '>{</span>
 503:               curpos<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#800080; '>;</span>
 504:             <span style='color:#800080; '>}</span>
 505:           <span style='color:#800080; '>}</span>
 506:           <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 507:         <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>VK_RIGHT</span><span style='color:#e34adc; '>:</span>
 508:           <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>state<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>CTRL_PRESSED<span style='color:#808030; '>)</span>
 509:           <span style='color:#800080; '>{</span>
 510:             <span style='color:#800000; font-weight:bold; '>int</span> wr<span style='color:#808030; '>=</span>word_right<span style='color:#808030; '>(</span>s<span style='color:#808030; '>.</span>c_str<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>leftpos<span style='color:#808030; '>+</span>curpos<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 511:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>wr<span style='color:#808030; '>></span>leftpos<span style='color:#808030; '>+</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
 512:             <span style='color:#800080; '>{</span>
 513:               leftpos<span style='color:#808030; '>=</span>wr<span style='color:#808030; '>-</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 514:               curpos<span style='color:#808030; '>=</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 515:             <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 516:             <span style='color:#800080; '>{</span>
 517:               curpos<span style='color:#808030; '>=</span>wr<span style='color:#808030; '>-</span>leftpos<span style='color:#800080; '>;</span>
 518:             <span style='color:#800080; '>}</span>
 519:           <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 520:           <span style='color:#800080; '>{</span>
 521:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>leftpos<span style='color:#808030; '>+</span>curpos<span style='color:#808030; '>></span><span style='color:#808030; '>=</span>s<span style='color:#808030; '>.</span>length<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 522:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>curpos<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>leftpos<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 523:             <span style='color:#800000; font-weight:bold; '>else</span> curpos<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 524:           <span style='color:#800080; '>}</span>
 525:           <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 526:         <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>VK_HOME</span><span style='color:#e34adc; '>:</span>
 527:           leftpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 528:           curpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 529:           <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 530:         <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>VK_END</span><span style='color:#e34adc; '>:</span>
 531:           curpos<span style='color:#808030; '>=</span>s<span style='color:#808030; '>.</span>length<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 532:           <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>curpos<span style='color:#808030; '>></span><span style='color:#808030; '>=</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
 533:           <span style='color:#800080; '>{</span>
 534:             leftpos<span style='color:#808030; '>=</span>curpos<span style='color:#808030; '>-</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 535:             curpos<span style='color:#808030; '>=</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 536:           <span style='color:#800080; '>}</span>
 537:           <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 538:         <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#0000e6; '>'Z'</span><span style='color:#e34adc; '>:</span><span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>state<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span>CTRL_PRESSED<span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 539:           state<span style='color:#808030; '>=</span>ALT_PRESSED<span style='color:#800080; '>;</span>
 540:         <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>VK_BACK</span><span style='color:#e34adc; '>:</span><span style='color:#800080; '>{</span>
 541:           <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>state<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>ALT_PRESSED <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> undo<span style='color:#808030; '>.</span>size<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>></span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span>
 542:           <span style='color:#800080; '>{</span>
 543:             undo<span style='color:#808030; '>.</span>pop_back<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 544:             s<span style='color:#808030; '>=</span>undo<span style='color:#808030; '>.</span>back<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span>str<span style='color:#800080; '>;</span>
 545:             leftpos<span style='color:#808030; '>=</span>undo<span style='color:#808030; '>.</span>back<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span>leftpos<span style='color:#800080; '>;</span>
 546:             curpos<span style='color:#808030; '>=</span>undo<span style='color:#808030; '>.</span>back<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span>curpos<span style='color:#800080; '>;</span>
 547:             selstart<span style='color:#808030; '>=</span>undo<span style='color:#808030; '>.</span>back<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span>selstart<span style='color:#800080; '>;</span>
 548:             selend<span style='color:#808030; '>=</span>undo<span style='color:#808030; '>.</span>back<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>.</span>selend<span style='color:#800080; '>;</span>
 549:             skipundo<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>true</span><span style='color:#800080; '>;</span>
 550:             <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 551:           <span style='color:#800080; '>}</span>
 552:           <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>state<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span>CTRL_PRESSED<span style='color:#808030; '>)</span>
 553:           <span style='color:#800080; '>{</span>
 554:             <span style='color:#800000; font-weight:bold; '>int</span> p<span style='color:#808030; '>=</span>leftpos<span style='color:#808030; '>+</span>curpos<span style='color:#800080; '>;</span>
 555:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>p<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 556:             s<span style='color:#808030; '>.</span>erase<span style='color:#808030; '>(</span>p<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 557:             curpos<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#800080; '>;</span>
 558:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>curpos<span style='color:#808030; '>&lt;</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span>
 559:             <span style='color:#800080; '>{</span>
 560:               <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>leftpos<span style='color:#808030; '>)</span>
 561:               <span style='color:#800080; '>{</span>
 562:                 leftpos<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#800080; '>;</span>
 563:                 curpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 564:               <span style='color:#800080; '>}</span>
 565:               <span style='color:#800000; font-weight:bold; '>else</span>
 566:                 curpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 567:             <span style='color:#800080; '>}</span>
 568:           <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 569:           <span style='color:#800080; '>{</span>
 570:             <span style='color:#800000; font-weight:bold; '>int</span> wl<span style='color:#808030; '>=</span>word_left<span style='color:#808030; '>(</span>s<span style='color:#808030; '>.</span>c_str<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>leftpos<span style='color:#808030; '>+</span>curpos<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 571:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>leftpos<span style='color:#808030; '>+</span>curpos<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span>wl<span style='color:#808030; '>)</span>
 572:             <span style='color:#800080; '>{</span>
 573:               s<span style='color:#808030; '>.</span>erase<span style='color:#808030; '>(</span>wl<span style='color:#808030; '>,</span>leftpos<span style='color:#808030; '>+</span>curpos<span style='color:#808030; '>-</span>wl<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 574:               <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>wl<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
 575:               <span style='color:#800080; '>{</span>
 576:                 leftpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 577:                 curpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 578:               <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 579:               <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>wl<span style='color:#808030; '>&lt;</span>leftpos<span style='color:#808030; '>)</span>
 580:               <span style='color:#800080; '>{</span>
 581:                 leftpos<span style='color:#808030; '>=</span>wl<span style='color:#800080; '>;</span>
 582:                 curpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 583:               <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 584:               <span style='color:#800080; '>{</span>
 585:                 curpos<span style='color:#808030; '>=</span>wl<span style='color:#808030; '>-</span>leftpos<span style='color:#800080; '>;</span>
 586:               <span style='color:#800080; '>}</span>
 587:             <span style='color:#800080; '>}</span>
 588:           <span style='color:#800080; '>}</span>
 589:           <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 590:         <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>VK_INSERT</span><span style='color:#e34adc; '>:</span><span style='color:#800080; '>{</span>
 591:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>state<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> shift<span style='color:#808030; '>)</span>
 592:             <span style='color:#800080; '>{</span>
 593:               <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>selstart<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
 594:               <span style='color:#800080; '>{</span>
 595:                 s<span style='color:#808030; '>.</span>erase<span style='color:#808030; '>(</span>selstart<span style='color:#808030; '>,</span>selend<span style='color:#808030; '>-</span>selstart<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 596:                 <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>pos<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>selend<span style='color:#808030; '>)</span>
 597:                 <span style='color:#800080; '>{</span>
 598:                   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>selstart<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
 599:                   <span style='color:#800080; '>{</span>
 600:                     leftpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 601:                     curpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 602:                   <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 603:                   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>selstart<span style='color:#808030; '>&lt;</span>leftpos<span style='color:#808030; '>)</span>
 604:                   <span style='color:#800080; '>{</span>
 605:                     leftpos<span style='color:#808030; '>=</span>selstart<span style='color:#800080; '>;</span>
 606:                     curpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 607:                   <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 608:                   <span style='color:#800080; '>{</span>
 609:                     curpos<span style='color:#808030; '>=</span>selstart<span style='color:#808030; '>-</span>leftpos<span style='color:#800080; '>;</span>
 610:                   <span style='color:#800080; '>}</span>
 611:                 <span style='color:#800080; '>}</span>
 612:                 selstart<span style='color:#808030; '>=</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 613:               <span style='color:#800080; '>}</span>
 614: 
 615: 
 616:               <span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>text<span style='color:#808030; '>=</span>PasteText<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 617:               <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>text<span style='color:#808030; '>)</span>
 618:               <span style='color:#800080; '>{</span>
 619:                 s<span style='color:#808030; '>.</span>insert<span style='color:#808030; '>(</span>leftpos<span style='color:#808030; '>+</span>curpos<span style='color:#808030; '>,</span>text<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 620:                 curpos<span style='color:#808030; '>+</span><span style='color:#808030; '>=</span>strlen<span style='color:#808030; '>(</span>text<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 621:                 <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>leftpos<span style='color:#808030; '>+</span>curpos<span style='color:#808030; '>></span><span style='color:#808030; '>=</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
 622:                 <span style='color:#800080; '>{</span>
 623:                   leftpos<span style='color:#808030; '>=</span>leftpos<span style='color:#808030; '>+</span>curpos<span style='color:#808030; '>-</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 624:                   curpos<span style='color:#808030; '>=</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 625:                 <span style='color:#800080; '>}</span>
 626:                 <span style='color:#800000; font-weight:bold; '>delete</span> text<span style='color:#800080; '>;</span>
 627:               <span style='color:#800080; '>}</span>
 628:             <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 629:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>state<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>CTRL_PRESSED <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> selstart<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
 630:             <span style='color:#800080; '>{</span>
 631:               <span style='color:#666616; '>std</span><span style='color:#800080; '>::</span><span style='color:#603000; '>string</span> c<span style='color:#800080; '>;</span>
 632:               c<span style='color:#808030; '>.</span>insert<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>s<span style='color:#808030; '>.</span>c_str<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>+</span>selstart<span style='color:#808030; '>,</span>selend<span style='color:#808030; '>-</span>selstart<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 633:               CopyText<span style='color:#808030; '>(</span>c<span style='color:#808030; '>.</span>c_str<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>c<span style='color:#808030; '>.</span>length<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 634:             <span style='color:#800080; '>}</span>
 635:           <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 636:         <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>VK_DELETE</span><span style='color:#e34adc; '>:</span><span style='color:#800080; '>{</span>
 637:           <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>selstart<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
 638:           <span style='color:#800080; '>{</span>
 639:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>state<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> shift<span style='color:#808030; '>)</span>
 640:             <span style='color:#800080; '>{</span>
 641:               <span style='color:#666616; '>std</span><span style='color:#800080; '>::</span><span style='color:#603000; '>string</span> c<span style='color:#800080; '>;</span>
 642:               c<span style='color:#808030; '>.</span>insert<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>s<span style='color:#808030; '>.</span>c_str<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>+</span>selstart<span style='color:#808030; '>,</span>selend<span style='color:#808030; '>-</span>selstart<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 643:               CopyText<span style='color:#808030; '>(</span>c<span style='color:#808030; '>.</span>c_str<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>c<span style='color:#808030; '>.</span>length<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 644:             <span style='color:#800080; '>}</span>
 645:             s<span style='color:#808030; '>.</span>erase<span style='color:#808030; '>(</span>selstart<span style='color:#808030; '>,</span>selend<span style='color:#808030; '>-</span>selstart<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 646:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>pos<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>selend<span style='color:#808030; '>)</span>
 647:             <span style='color:#800080; '>{</span>
 648:               <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>selstart<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
 649:               <span style='color:#800080; '>{</span>
 650:                 leftpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 651:                 curpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 652:               <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 653:               <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>selstart<span style='color:#808030; '>&lt;</span>leftpos<span style='color:#808030; '>)</span>
 654:               <span style='color:#800080; '>{</span>
 655:                 leftpos<span style='color:#808030; '>=</span>selstart<span style='color:#800080; '>;</span>
 656:                 curpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 657:               <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 658:               <span style='color:#800080; '>{</span>
 659:                 curpos<span style='color:#808030; '>=</span>selstart<span style='color:#808030; '>-</span>leftpos<span style='color:#800080; '>;</span>
 660:               <span style='color:#800080; '>}</span>
 661:             <span style='color:#800080; '>}</span>
 662:             pos<span style='color:#808030; '>=</span>leftpos<span style='color:#808030; '>+</span>curpos<span style='color:#800080; '>;</span>
 663:             selstart<span style='color:#808030; '>=</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 664:           <span style='color:#800080; '>}</span>
 665:           <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>state<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span>CTRL_PRESSED<span style='color:#808030; '>)</span>
 666:           <span style='color:#800080; '>{</span>
 667:             <span style='color:#800000; font-weight:bold; '>int</span> p<span style='color:#808030; '>=</span>leftpos<span style='color:#808030; '>+</span>curpos<span style='color:#800080; '>;</span>
 668:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>p<span style='color:#808030; '>></span><span style='color:#808030; '>=</span>s<span style='color:#808030; '>.</span>length<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 669:             s<span style='color:#808030; '>.</span>erase<span style='color:#808030; '>(</span>p<span style='color:#808030; '>,</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 670:           <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 671:           <span style='color:#800080; '>{</span>
 672:             <span style='color:#800000; font-weight:bold; '>int</span> n<span style='color:#808030; '>=</span>leftpos<span style='color:#808030; '>+</span>curpos<span style='color:#800080; '>;</span>
 673:             <span style='color:#800000; font-weight:bold; '>int</span> wr<span style='color:#808030; '>=</span>word_right<span style='color:#808030; '>(</span>s<span style='color:#808030; '>.</span>c_str<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>n<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 674:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>wr<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span>n<span style='color:#808030; '>)</span>
 675:             <span style='color:#800080; '>{</span>
 676:               s<span style='color:#808030; '>.</span>erase<span style='color:#808030; '>(</span>n<span style='color:#808030; '>,</span>wr<span style='color:#808030; '>-</span>n<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 677:             <span style='color:#800080; '>}</span>
 678:           <span style='color:#800080; '>}</span>
 679:           <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 680:         <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>VK_ESCAPE</span><span style='color:#e34adc; '>:</span>
 681:           retval<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>false</span><span style='color:#800080; '>;</span>
 682:           quit<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>true</span><span style='color:#800080; '>;</span>
 683:           <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 684:         <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>VK_RETURN</span><span style='color:#e34adc; '>:</span><span style='color:#800080; '>;</span>
 685:           retval<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>true</span><span style='color:#800080; '>;</span>
 686:           quit<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>true</span><span style='color:#800080; '>;</span>
 687:           <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 688: <span style='color:#e34adc; '>        </span><span style='color:#800000; font-weight:bold; '>default</span><span style='color:#e34adc; '>:</span>
 689:           redraw<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>false</span><span style='color:#800080; '>;</span>
 690:           <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 691:       <span style='color:#800080; '>}</span>
 692:       <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>KeyEvent<span style='color:#808030; '>.</span>uChar<span style='color:#808030; '>.</span>AsciiChar<span style='color:#808030; '>></span><span style='color:#808030; '>=</span><span style='color:#008c00; '>32</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> redraw<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>false</span><span style='color:#808030; '>)</span>
 693:       <span style='color:#800080; '>{</span>
 694:         <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>selstart<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
 695:         <span style='color:#800080; '>{</span>
 696:           s<span style='color:#808030; '>.</span>erase<span style='color:#808030; '>(</span>selstart<span style='color:#808030; '>,</span>selend<span style='color:#808030; '>-</span>selstart<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 697:           <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>pos<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>selend<span style='color:#808030; '>)</span>
 698:           <span style='color:#800080; '>{</span>
 699:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>selstart<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
 700:             <span style='color:#800080; '>{</span>
 701:               leftpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 702:               curpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 703:             <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 704:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>selstart<span style='color:#808030; '>&lt;</span>leftpos<span style='color:#808030; '>)</span>
 705:             <span style='color:#800080; '>{</span>
 706:               leftpos<span style='color:#808030; '>=</span>selstart<span style='color:#800080; '>;</span>
 707:               curpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 708:             <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 709:             <span style='color:#800080; '>{</span>
 710:               curpos<span style='color:#808030; '>=</span>selstart<span style='color:#808030; '>-</span>leftpos<span style='color:#800080; '>;</span>
 711:             <span style='color:#800080; '>}</span>
 712:           <span style='color:#800080; '>}</span>
 713:           selstart<span style='color:#808030; '>=</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 714:         <span style='color:#800080; '>}</span>
 715: 
 716:         <span style='color:#800000; font-weight:bold; '>char</span> str<span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>=</span><span style='color:#800080; '>{</span>ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>KeyEvent<span style='color:#808030; '>.</span>uChar<span style='color:#808030; '>.</span>AsciiChar<span style='color:#808030; '>,</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 717:         s<span style='color:#808030; '>.</span>insert<span style='color:#808030; '>(</span>leftpos<span style='color:#808030; '>+</span>curpos<span style='color:#808030; '>,</span>str<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 718:         <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>curpos<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
 719:         <span style='color:#800080; '>{</span>
 720:           curpos<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 721:         <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 722:         <span style='color:#800080; '>{</span>
 723:           leftpos<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 724:         <span style='color:#800080; '>}</span>
 725:         redraw<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>true</span><span style='color:#800080; '>;</span>
 726:       <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 727:       <span style='color:#800080; '>{</span>
 728:         <span style='color:#800000; font-weight:bold; '>int</span> newpos<span style='color:#808030; '>=</span>leftpos<span style='color:#808030; '>+</span>curpos<span style='color:#800080; '>;</span>
 729:         <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>newpos<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span>pos <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>state<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> state<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>CTRL_PRESSED<span style='color:#808030; '>)</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> shift<span style='color:#808030; '>)</span>
 730:         <span style='color:#800080; '>{</span>
 731:           extend_selection<span style='color:#808030; '>(</span>selstart<span style='color:#808030; '>,</span>selend<span style='color:#808030; '>,</span>pos<span style='color:#808030; '>,</span>newpos<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 732:         <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 733:         <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>newpos<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span>pos<span style='color:#808030; '>)</span>
 734:         <span style='color:#800080; '>{</span>
 735:           selstart<span style='color:#808030; '>=</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 736:         <span style='color:#800080; '>}</span>
 737:       <span style='color:#800080; '>}</span>
 738:     <span style='color:#800080; '>}</span>
 739:   <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 740:   scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>hidecursor<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 741:   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>retval<span style='color:#808030; '>)</span>
 742:   <span style='color:#800080; '>{</span>
 743:     findstring<span style='color:#808030; '>=</span>s<span style='color:#800080; '>;</span>
 744:   <span style='color:#800080; '>}</span>
 745:   <span style='color:#800000; font-weight:bold; '>return</span> retval<span style='color:#800080; '>;</span>
 746: <span style='color:#800080; '>}</span>
 747: 
 748: <span style='color:#696969; '>// viewing file with coloring</span>
 749: <span style='color:#696969; '>// note that it has different variants for different systems</span>
 750: <span style='color:#800000; font-weight:bold; '>void</span> view<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span>
 751: <span style='color:#800080; '>{</span>
 752: <span style='color:#800000; font-weight:bold; '>int</span> topline<span style='color:#808030; '>,</span> leftpos<span style='color:#808030; '>,</span> i<span style='color:#808030; '>,</span> clr<span style='color:#800080; '>;</span>
 753:   cd <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>new</span> CColorData<span style='color:#808030; '>(</span>basefname<span style='color:#808030; '>,</span> <span style='color:#7d0045; '>NULL</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 754:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>cd<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>IsOk<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
 755:     fprintf<span style='color:#808030; '>(</span><span style='color:#603000; '>stderr</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"cannot load colorer base from </span><span style='color:#0f69ff; '>%s</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>,</span> basefname<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 756:     <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
 757:   <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 758:   adata <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>new</span> CAssign<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 759:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>adata<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>load<span style='color:#808030; '>(</span>frules<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
 760:     fprintf<span style='color:#808030; '>(</span><span style='color:#603000; '>stderr</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"cannot load region rules from </span><span style='color:#0f69ff; '>%s</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>,</span> frules<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 761:     <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
 762:   <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 763: 
 764:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>*</span>typedescr<span style='color:#808030; '>)</span> type <span style='color:#808030; '>=</span> seltype<span style='color:#808030; '>(</span>cd<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 765:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span><span style='color:#808030; '>*</span>typedescr <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>!</span>type<span style='color:#808030; '>)</span> type <span style='color:#808030; '>=</span> cd<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>SelType<span style='color:#808030; '>(</span>fname<span style='color:#808030; '>,</span> GetLine<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 766:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>type<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
 767:   ad <span style='color:#808030; '>=</span> adata<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>getcdata<span style='color:#808030; '>(</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 768:   bkcolor <span style='color:#808030; '>=</span> ad<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>fore <span style='color:#808030; '>+</span> <span style='color:#808030; '>(</span>ad<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>back<span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#008c00; '>4</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 769: 
 770:   hlines <span style='color:#808030; '>=</span> clrCreateRegions<span style='color:#808030; '>(</span>totallines<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 771:   cd<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>LoadType<span style='color:#808030; '>(</span>type<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 772:   cc <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>new</span> CColorer<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 773:   cc<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>SetServices<span style='color:#808030; '>(</span>GetLine<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> clrAddRegion<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> hlines<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 774:   cc<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>SetColoringSrc<span style='color:#808030; '>(</span>type<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 775:   clrSetFirstLine<span style='color:#808030; '>(</span>hlines<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 776:   cc<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>QuickParse<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> totallines<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 777: <span style='color:#696969; '>//  cc->FullParse(0, 0 ,totallines, totallines);</span>
 778: <span style='color:#696969; '>//  return;</span>
 779: 
 780:   clrAssignRegions<span style='color:#808030; '>(</span>hlines<span style='color:#808030; '>,</span> adata<span style='color:#808030; '>,</span> ad<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 781:   leftpos <span style='color:#808030; '>=</span> topline <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 782: 
 783: <span style='color:#696969; '>// WIN32 - draws through consoles</span>
 784: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '> _WIN32</span>
 785: <span style='color:#603000; '>CONSOLE_SCREEN_BUFFER_INFO</span> csbi<span style='color:#800080; '>;</span>
 786: <span style='color:#603000; '>HANDLE</span> hCon<span style='color:#808030; '>,</span> hConI<span style='color:#800080; '>;</span>
 787: <span style='color:#603000; '>INPUT_RECORD</span> ir<span style='color:#800080; '>;</span>
 788: <span style='color:#603000; '>COORD</span> coor<span style='color:#800080; '>;</span>
 789: <span style='color:#603000; '>DWORD</span> tmp<span style='color:#800080; '>;</span>
 790: 
 791:   hCon <span style='color:#808030; '>=</span> <span style='color:#400000; '>GetStdHandle</span><span style='color:#808030; '>(</span>STD_OUTPUT_HANDLE<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 792:   hConI<span style='color:#808030; '>=</span> <span style='color:#400000; '>GetStdHandle</span><span style='color:#808030; '>(</span>STD_INPUT_HANDLE<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 793:   <span style='color:#400000; '>GetConsoleScreenBufferInfo</span><span style='color:#808030; '>(</span>hCon<span style='color:#808030; '>,</span> <span style='color:#808030; '>&amp;</span>csbi<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 794: 
 795: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifndef</span><span style='color:#004a43; '> __DPMI32__</span>
 796:   hCon <span style='color:#808030; '>=</span> <span style='color:#400000; '>CreateConsoleScreenBuffer</span><span style='color:#808030; '>(</span>GENERIC_WRITE<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> CONSOLE_TEXTMODE_BUFFER<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 797:   <span style='color:#400000; '>SetConsoleActiveScreenBuffer</span><span style='color:#808030; '>(</span>hCon<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 798: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
 799:   <span style='color:#400000; '>SetConsoleMode</span><span style='color:#808030; '>(</span>hConI<span style='color:#808030; '>,</span>ENABLE_WINDOW_INPUT<span style='color:#808030; '>|</span>ENABLE_MOUSE_INPUT<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 800:   <span style='color:#666616; '>std</span><span style='color:#800080; '>::</span><span style='color:#603000; '>string</span> findstring<span style='color:#808030; '>=</span><span style='color:#0000e6; '>"/"</span><span style='color:#800080; '>;</span>
 801:   scrbuf<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>new</span> ScreenBuffer<span style='color:#808030; '>(</span>hCon<span style='color:#808030; '>,</span>csbi<span style='color:#808030; '>.</span>dwSize<span style='color:#808030; '>.</span>X<span style='color:#808030; '>,</span>csbi<span style='color:#808030; '>.</span>dwSize<span style='color:#808030; '>.</span>Y<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 802: 
 803:   scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>hidecursor<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 804: 
 805:   <span style='color:#800000; font-weight:bold; '>bool</span> quit<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>false</span><span style='color:#800080; '>;</span>
 806: 
 807:   <span style='color:#800000; font-weight:bold; '>int</span> selstartline<span style='color:#808030; '>=</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 808:   <span style='color:#800000; font-weight:bold; '>int</span> selstartpos<span style='color:#808030; '>,</span>selendline<span style='color:#808030; '>,</span>selendpos<span style='color:#800080; '>;</span>
 809: 
 810:   <span style='color:#800000; font-weight:bold; '>int</span> fndline<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>fndpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 811: 
 812:   <span style='color:#800000; font-weight:bold; '>int</span> mselecting<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 813: 
 814:   <span style='color:#800000; font-weight:bold; '>do</span><span style='color:#800080; '>{</span>
 815:     <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span>i<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>i<span style='color:#808030; '>&lt;</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>H<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span>
 816:     <span style='color:#800080; '>{</span>
 817:       scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>fillattr<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>i<span style='color:#808030; '>,</span>bkcolor<span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 818:       scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>fillchar<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>i<span style='color:#808030; '>,</span><span style='color:#008000; '>0x20</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 819:     <span style='color:#800080; '>}</span>
 820:     <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span>i <span style='color:#808030; '>=</span> topline<span style='color:#800080; '>;</span> i <span style='color:#808030; '>&lt;</span> topline <span style='color:#808030; '>+</span> csbi<span style='color:#808030; '>.</span>dwSize<span style='color:#808030; '>.</span>Y<span style='color:#800080; '>;</span> i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>,</span> coor<span style='color:#808030; '>.</span>Y <span style='color:#808030; '>=</span> i<span style='color:#808030; '>-</span>topline<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
 821:       coor<span style='color:#808030; '>.</span>X <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 822:       coor<span style='color:#808030; '>.</span>Y <span style='color:#808030; '>=</span> i<span style='color:#808030; '>-</span>topline<span style='color:#800080; '>;</span> <span style='color:#696969; '>// my gcc has </span><span style='color:#ffffff; background:#808000; '>bug here :(</span>
 823: 
 824:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>i <span style='color:#808030; '>></span><span style='color:#808030; '>=</span> totallines<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>continue</span><span style='color:#800080; '>;</span>
 825:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> leftpos<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>continue</span><span style='color:#800080; '>;</span>
 826: 
 827:       <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span>l1 <span style='color:#808030; '>=</span> hlines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>next<span style='color:#800080; '>;</span> l1<span style='color:#800080; '>;</span> l1 <span style='color:#808030; '>=</span> l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>next<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
 828:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>ad<span style='color:#808030; '>.</span>type <span style='color:#808030; '>></span> <span style='color:#008000; '>0xFF</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>continue</span><span style='color:#800080; '>;</span>
 829:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>end <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span> l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>end <span style='color:#808030; '>=</span> lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len<span style='color:#800080; '>;</span>
 830:         coor<span style='color:#808030; '>.</span>X <span style='color:#808030; '>=</span> l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>start <span style='color:#808030; '>-</span> leftpos<span style='color:#800080; '>;</span>
 831:         <span style='color:#800000; font-weight:bold; '>int</span> len <span style='color:#808030; '>=</span> l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>end <span style='color:#808030; '>-</span> l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>start<span style='color:#800080; '>;</span>
 832:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>coor<span style='color:#808030; '>.</span>X <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
 833:           len <span style='color:#808030; '>+</span><span style='color:#808030; '>=</span> coor<span style='color:#808030; '>.</span>X<span style='color:#800080; '>;</span>
 834:           coor<span style='color:#808030; '>.</span>X <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 835:         <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 836:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>len <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>continue</span><span style='color:#800080; '>;</span>
 837:         clr <span style='color:#808030; '>=</span> l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>ad<span style='color:#808030; '>.</span>fore <span style='color:#808030; '>+</span> <span style='color:#808030; '>(</span>l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>ad<span style='color:#808030; '>.</span>back<span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#008c00; '>4</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 838: 
 839:         scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>fillattr<span style='color:#808030; '>(</span>coor<span style='color:#808030; '>.</span>X<span style='color:#808030; '>,</span>coor<span style='color:#808030; '>.</span>Y<span style='color:#808030; '>,</span>clr<span style='color:#808030; '>,</span>len<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 840:       <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 841:       coor<span style='color:#808030; '>.</span>X <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 842:       <span style='color:#800000; font-weight:bold; '>int</span> n<span style='color:#808030; '>=</span>csbi<span style='color:#808030; '>.</span>dwSize<span style='color:#808030; '>.</span>X <span style='color:#808030; '>&lt;</span> lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len<span style='color:#808030; '>-</span>leftpos <span style='color:#800080; '>?</span> csbi<span style='color:#808030; '>.</span>dwSize<span style='color:#808030; '>.</span>X <span style='color:#800080; '>:</span> lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len<span style='color:#808030; '>-</span>leftpos<span style='color:#800080; '>;</span>
 843:       scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>write<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>coor<span style='color:#808030; '>.</span>Y<span style='color:#808030; '>,</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#808030; '>+</span>leftpos<span style='color:#808030; '>,</span>n<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 844:     <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 845:     <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>selstartline<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
 846:     <span style='color:#800080; '>{</span>
 847:       <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span>i<span style='color:#808030; '>=</span>selstartline<span style='color:#800080; '>;</span>i<span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span>selendline<span style='color:#800080; '>;</span>i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span>
 848:       <span style='color:#800080; '>{</span>
 849:         <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>i<span style='color:#808030; '>&lt;</span>topline <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> i<span style='color:#808030; '>></span>topline<span style='color:#808030; '>+</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>H<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>continue</span><span style='color:#800080; '>;</span>
 850:         <span style='color:#800000; font-weight:bold; '>int</span> s<span style='color:#808030; '>,</span>e<span style='color:#800080; '>;</span>
 851:         <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>i<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>selstartline <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> i<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>selendline<span style='color:#808030; '>)</span>
 852:         <span style='color:#800080; '>{</span>
 853:           s<span style='color:#808030; '>=</span>selstartpos<span style='color:#800080; '>;</span>
 854:           e<span style='color:#808030; '>=</span>selendpos<span style='color:#800080; '>;</span>
 855:         <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 856:         <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>i<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>selstartline<span style='color:#808030; '>)</span>
 857:         <span style='color:#800080; '>{</span>
 858:           s<span style='color:#808030; '>=</span>selstartpos<span style='color:#800080; '>;</span>
 859:           e<span style='color:#808030; '>=</span>s<span style='color:#808030; '>+</span>leftpos<span style='color:#808030; '>+</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 860:         <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 861:         <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>i<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>selendline<span style='color:#808030; '>)</span>
 862:         <span style='color:#800080; '>{</span>
 863:           s<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 864:           e<span style='color:#808030; '>=</span>selendpos<span style='color:#800080; '>;</span>
 865:         <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 866:         <span style='color:#800080; '>{</span>
 867:           s<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 868:           e<span style='color:#808030; '>=</span>leftpos<span style='color:#808030; '>+</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 869:         <span style='color:#800080; '>}</span>
 870:         scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>fillattr<span style='color:#808030; '>(</span>s<span style='color:#808030; '>-</span>leftpos<span style='color:#808030; '>,</span>i<span style='color:#808030; '>-</span>topline<span style='color:#808030; '>,</span><span style='color:#008000; '>0x30</span><span style='color:#808030; '>,</span>e<span style='color:#808030; '>-</span>s<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 871:       <span style='color:#800080; '>}</span>
 872:     <span style='color:#800080; '>}</span>
 873:     <span style='color:#696969; '>// flush buffer</span>
 874:     scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>flush<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 875: 
 876:     <span style='color:#696969; '>// managing the keyboard</span>
 877:     <span style='color:#800000; font-weight:bold; '>do</span><span style='color:#800080; '>{</span>
 878:       <span style='color:#400000; '>ReadConsoleInput</span><span style='color:#808030; '>(</span>hConI<span style='color:#808030; '>,</span> <span style='color:#808030; '>&amp;</span>ir<span style='color:#808030; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>&amp;</span>tmp<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 879: 
 880:       <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>ir<span style='color:#808030; '>.</span>EventType <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> MOUSE_EVENT<span style='color:#808030; '>)</span>
 881:       <span style='color:#800080; '>{</span>
 882:         <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>MouseEvent<span style='color:#808030; '>.</span>dwEventFlags <span style='color:#808030; '>&amp;</span> MOUSE_WHEELED<span style='color:#808030; '>)</span>
 883:         <span style='color:#800080; '>{</span>
 884:           ir<span style='color:#808030; '>.</span>EventType<span style='color:#808030; '>=</span>KEY_EVENT<span style='color:#800080; '>;</span>
 885:           ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>KeyEvent<span style='color:#808030; '>.</span>bKeyDown<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>true</span><span style='color:#800080; '>;</span>
 886:           ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>KeyEvent<span style='color:#808030; '>.</span>wVirtualKeyCode<span style='color:#808030; '>=</span>
 887:             ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>MouseEvent<span style='color:#808030; '>.</span>dwButtonState<span style='color:#808030; '>&amp;</span><span style='color:#008000; '>0xff000000</span><span style='color:#006600; '>L</span><span style='color:#800080; '>?</span>VK_DOWN<span style='color:#800080; '>:</span>VK_UP<span style='color:#800080; '>;</span>
 888:         <span style='color:#800080; '>}</span>
 889:         <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>MouseEvent<span style='color:#808030; '>.</span>dwButtonState<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>FROM_LEFT_1ST_BUTTON_PRESSED <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>!</span>mselecting<span style='color:#808030; '>)</span>
 890:         <span style='color:#800080; '>{</span>
 891:           mselecting<span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 892:           <span style='color:#800000; font-weight:bold; '>int</span> x<span style='color:#808030; '>=</span>ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>MouseEvent<span style='color:#808030; '>.</span>dwMousePosition<span style='color:#808030; '>.</span>X<span style='color:#800080; '>;</span>
 893:           <span style='color:#800000; font-weight:bold; '>int</span> y<span style='color:#808030; '>=</span>ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>MouseEvent<span style='color:#808030; '>.</span>dwMousePosition<span style='color:#808030; '>.</span>Y<span style='color:#800080; '>;</span>
 894:           selstartline<span style='color:#808030; '>=</span>selendline<span style='color:#808030; '>=</span>topline<span style='color:#808030; '>+</span>y<span style='color:#800080; '>;</span>
 895:           selstartpos<span style='color:#808030; '>=</span>selendpos<span style='color:#808030; '>=</span>leftpos<span style='color:#808030; '>+</span>x<span style='color:#800080; '>;</span>
 896:           <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 897:         <span style='color:#800080; '>}</span>
 898:         <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span><span style='color:#808030; '>!</span><span style='color:#808030; '>(</span>ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>MouseEvent<span style='color:#808030; '>.</span>dwButtonState<span style='color:#808030; '>&amp;</span>FROM_LEFT_1ST_BUTTON_PRESSED<span style='color:#808030; '>)</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> mselecting<span style='color:#808030; '>)</span>
 899:         <span style='color:#800080; '>{</span>
 900:           mselecting<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 901:         <span style='color:#800080; '>}</span>
 902:         <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>MouseEvent<span style='color:#808030; '>.</span>dwEventFlags <span style='color:#808030; '>&amp;</span> MOUSE_MOVED<span style='color:#808030; '>)</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>mselecting<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
 903:         <span style='color:#800080; '>{</span>
 904:           <span style='color:#800000; font-weight:bold; '>int</span> x<span style='color:#808030; '>=</span>leftpos<span style='color:#808030; '>+</span>ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>MouseEvent<span style='color:#808030; '>.</span>dwMousePosition<span style='color:#808030; '>.</span>X<span style='color:#800080; '>;</span>
 905:           <span style='color:#800000; font-weight:bold; '>int</span> y<span style='color:#808030; '>=</span>topline<span style='color:#808030; '>+</span>ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>MouseEvent<span style='color:#808030; '>.</span>dwMousePosition<span style='color:#808030; '>.</span>Y<span style='color:#800080; '>;</span>
 906:           selendline<span style='color:#808030; '>=</span>y<span style='color:#800080; '>;</span>
 907:           selendpos<span style='color:#808030; '>=</span>x<span style='color:#800080; '>;</span>
 908:           <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>selendline<span style='color:#808030; '>&lt;</span>selstartline <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>(</span>selendline<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>selstartline <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> selendpos<span style='color:#808030; '>&lt;</span>selstartpos<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
 909:           <span style='color:#800080; '>{</span>
 910:             y<span style='color:#808030; '>=</span>selstartline<span style='color:#800080; '>;</span>
 911:             x<span style='color:#808030; '>=</span>selstartpos<span style='color:#800080; '>;</span>
 912:             selstartline<span style='color:#808030; '>=</span>selendline<span style='color:#800080; '>;</span>
 913:             selstartpos<span style='color:#808030; '>=</span>selendpos<span style='color:#800080; '>;</span>
 914:             selendline<span style='color:#808030; '>=</span>y<span style='color:#800080; '>;</span>
 915:             selendpos<span style='color:#808030; '>=</span>x<span style='color:#800080; '>;</span>
 916:           <span style='color:#800080; '>}</span>
 917:           <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 918:         <span style='color:#800080; '>}</span>
 919:       <span style='color:#800080; '>}</span>
 920:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>ir<span style='color:#808030; '>.</span>EventType <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> KEY_EVENT <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>KeyEvent<span style='color:#808030; '>.</span>bKeyDown<span style='color:#808030; '>)</span>
 921:       <span style='color:#800080; '>{</span>
 922:         <span style='color:#696969; '>// moving view position</span>
 923:         <span style='color:#800000; font-weight:bold; '>bool</span> redraw<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>true</span><span style='color:#800080; '>;</span>
 924:         <span style='color:#800000; font-weight:bold; '>int</span> oldtol<span style='color:#808030; '>=</span>topline<span style='color:#800080; '>;</span>
 925:         <span style='color:#800000; font-weight:bold; '>switch</span><span style='color:#808030; '>(</span>ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>KeyEvent<span style='color:#808030; '>.</span>wVirtualKeyCode<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
 926:           <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>VK_UP</span><span style='color:#e34adc; '>:</span>
 927:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>topline<span style='color:#808030; '>)</span> topline<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#800080; '>;</span>
 928:             <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 929:           <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>VK_DOWN</span><span style='color:#e34adc; '>:</span>
 930:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>topline<span style='color:#808030; '>+</span>csbi<span style='color:#808030; '>.</span>dwSize<span style='color:#808030; '>.</span>Y <span style='color:#808030; '>&lt;</span> totallines<span style='color:#808030; '>)</span> topline<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 931:             <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 932:           <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>VK_LEFT</span><span style='color:#e34adc; '>:</span>
 933:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>leftpos<span style='color:#808030; '>)</span> leftpos<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#800080; '>;</span>
 934:             <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 935:           <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>VK_RIGHT</span><span style='color:#e34adc; '>:</span>
 936:             leftpos<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
 937:             <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 938:           <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>VK_PRIOR</span><span style='color:#e34adc; '>:</span>
 939:             topline<span style='color:#808030; '>-</span><span style='color:#808030; '>=</span>csbi<span style='color:#808030; '>.</span>dwSize<span style='color:#808030; '>.</span>Y<span style='color:#800080; '>;</span>
 940:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>topline <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> topline <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 941:             <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 942:           <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>VK_NEXT</span><span style='color:#e34adc; '>:</span>
 943:             topline <span style='color:#808030; '>+</span><span style='color:#808030; '>=</span> csbi<span style='color:#808030; '>.</span>dwSize<span style='color:#808030; '>.</span>Y<span style='color:#800080; '>;</span>
 944:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>topline <span style='color:#808030; '>></span> totallines<span style='color:#808030; '>-</span>csbi<span style='color:#808030; '>.</span>dwSize<span style='color:#808030; '>.</span>Y<span style='color:#808030; '>)</span> topline <span style='color:#808030; '>=</span> totallines<span style='color:#808030; '>-</span>csbi<span style='color:#808030; '>.</span>dwSize<span style='color:#808030; '>.</span>Y<span style='color:#800080; '>;</span>
 945:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>topline <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> topline <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 946:             <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 947:           <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>VK_HOME</span><span style='color:#e34adc; '>:</span>
 948:             leftpos <span style='color:#808030; '>=</span> topline <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 949:             <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 950:           <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>VK_END</span><span style='color:#e34adc; '>:</span>
 951:             topline <span style='color:#808030; '>=</span> totallines<span style='color:#808030; '>-</span>csbi<span style='color:#808030; '>.</span>dwSize<span style='color:#808030; '>.</span>Y<span style='color:#800080; '>;</span>
 952:             <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>topline <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> topline <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 953:             leftpos <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 954:             <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 955:           <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>VK_ESCAPE</span><span style='color:#e34adc; '>:</span>
 956:             quit<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>true</span><span style='color:#800080; '>;</span>
 957:             <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 958:           <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>VK_INSERT</span><span style='color:#e34adc; '>:</span>
 959:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>selstartline<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
 960:             <span style='color:#800080; '>{</span>
 961:               <span style='color:#666616; '>std</span><span style='color:#800080; '>::</span><span style='color:#603000; '>string</span> s<span style='color:#800080; '>;</span>
 962:               <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>selstartline<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>selendline<span style='color:#808030; '>)</span>
 963:               <span style='color:#800080; '>{</span>
 964:                 s<span style='color:#808030; '>.</span>insert<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>lines<span style='color:#808030; '>[</span>selstartline<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#808030; '>+</span>selstartpos<span style='color:#808030; '>,</span>selendpos<span style='color:#808030; '>-</span>selstartpos<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 965:               <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 966:               <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span>i<span style='color:#808030; '>=</span>selstartline<span style='color:#800080; '>;</span>i<span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span>selendline<span style='color:#800080; '>;</span>i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span>
 967:               <span style='color:#800080; '>{</span>
 968:                 <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>i<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>selstartline<span style='color:#808030; '>)</span>
 969:                 <span style='color:#800080; '>{</span>
 970:                   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>selstartpos<span style='color:#808030; '>&lt;</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len<span style='color:#808030; '>)</span>
 971:                   <span style='color:#800080; '>{</span>
 972:                     s<span style='color:#808030; '>.</span>insert<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#808030; '>,</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len<span style='color:#808030; '>-</span>selstartpos<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 973:                     s<span style='color:#808030; '>+</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\r</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 974:                   <span style='color:#800080; '>}</span>
 975:                 <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 976:                 <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>i<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span>selendline<span style='color:#808030; '>)</span>
 977:                 <span style='color:#800080; '>{</span>
 978:                   <span style='color:#800000; font-weight:bold; '>int</span> n<span style='color:#808030; '>=</span>selendpos<span style='color:#800080; '>;</span>
 979:                   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len<span style='color:#808030; '>&lt;</span>n<span style='color:#808030; '>)</span>n<span style='color:#808030; '>=</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len<span style='color:#800080; '>;</span>
 980:                   s<span style='color:#808030; '>.</span>append<span style='color:#808030; '>(</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#808030; '>,</span>n<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 981:                   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>selendpos<span style='color:#808030; '>></span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len<span style='color:#808030; '>)</span>s<span style='color:#808030; '>+</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\r</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 982:                 <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
 983:                 <span style='color:#800080; '>{</span>
 984:                   s<span style='color:#808030; '>.</span>append<span style='color:#808030; '>(</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#808030; '>,</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 985:                   s<span style='color:#808030; '>+</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\r</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 986:                 <span style='color:#800080; '>}</span>
 987:               <span style='color:#800080; '>}</span>
 988:               CopyText<span style='color:#808030; '>(</span>s<span style='color:#808030; '>.</span>c_str<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span>s<span style='color:#808030; '>.</span>length<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 989:             <span style='color:#800080; '>}</span>
 990: <span style='color:#e34adc; '>          </span><span style='color:#800000; font-weight:bold; '>default</span><span style='color:#e34adc; '>:</span>
 991:             redraw<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>false</span><span style='color:#800080; '>;</span>
 992:             <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
 993:         <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 994:         <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>oldtol<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span>topline<span style='color:#808030; '>)</span>
 995:         <span style='color:#800080; '>{</span>
 996:           fndline<span style='color:#808030; '>=</span>topline<span style='color:#800080; '>;</span>
 997:           fndpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
 998:         <span style='color:#800080; '>}</span>
 999:         <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>KeyEvent<span style='color:#808030; '>.</span>uChar<span style='color:#808030; '>.</span>AsciiChar<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>'/'</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>KeyEvent<span style='color:#808030; '>.</span>uChar<span style='color:#808030; '>.</span>AsciiChar<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>'n'</span><span style='color:#808030; '>)</span>
1000:         <span style='color:#800080; '>{</span>
1001:           <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>ir<span style='color:#808030; '>.</span>Event<span style='color:#808030; '>.</span>KeyEvent<span style='color:#808030; '>.</span>uChar<span style='color:#808030; '>.</span>AsciiChar<span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>'n'</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> search_input<span style='color:#808030; '>(</span>hConI<span style='color:#808030; '>,</span>findstring<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
1002:           <span style='color:#800080; '>{</span>
1003:             <span style='color:#800000; font-weight:bold; '>int</span> i<span style='color:#800080; '>;</span>
1004:             <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span>i<span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>i<span style='color:#808030; '>&lt;</span>findstring<span style='color:#808030; '>.</span>length<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span>
1005:             <span style='color:#800080; '>{</span>
1006:               <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>findstring<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>'/'</span><span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
1007:               <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>findstring<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>'\\'</span><span style='color:#808030; '>)</span>i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
1008:             <span style='color:#800080; '>}</span>
1009:             <span style='color:#800000; font-weight:bold; '>bool</span> global<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>false</span><span style='color:#800080; '>;</span>
1010:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>i<span style='color:#808030; '>></span><span style='color:#808030; '>=</span>findstring<span style='color:#808030; '>.</span>length<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>findstring<span style='color:#808030; '>+</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"/"</span><span style='color:#800080; '>;</span>
1011:             <span style='color:#800000; font-weight:bold; '>else</span>
1012:             <span style='color:#800080; '>{</span>
1013:               <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> j<span style='color:#808030; '>=</span>i<span style='color:#800080; '>;</span>j<span style='color:#808030; '>&lt;</span>findstring<span style='color:#808030; '>.</span>length<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>j<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span>
1014:               <span style='color:#800080; '>{</span>
1015:                 <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>findstring<span style='color:#808030; '>[</span>j<span style='color:#808030; '>]</span><span style='color:#808030; '>=</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>'g'</span><span style='color:#808030; '>)</span>
1016:                 <span style='color:#800080; '>{</span>
1017:                   global<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>true</span><span style='color:#800080; '>;</span>
1018:                 <span style='color:#800080; '>}</span>
1019:               <span style='color:#800080; '>}</span>
1020:             <span style='color:#800080; '>}</span>
1021:             CRegExp re<span style='color:#800080; '>;</span>
1022:             re<span style='color:#808030; '>.</span>SetExpr<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>const_cast</span><span style='color:#800080; '>&lt;</span><span style='color:#800000; font-weight:bold; '>char</span><span style='color:#808030; '>*</span><span style='color:#800080; '>></span><span style='color:#808030; '>(</span>findstring<span style='color:#808030; '>.</span>c_str<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1023:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>re<span style='color:#808030; '>.</span>IsOk<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
1024:             <span style='color:#800080; '>{</span>
1025:               scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>fillattr<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>H<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span><span style='color:#008000; '>0xce</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1026:               scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>fillchar<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>H<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>' '</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1027:               scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>write<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>H<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"Invalid rexexp:"</span><span style='color:#808030; '>+</span>findstring<span style='color:#808030; '>)</span><span style='color:#808030; '>.</span>c_str<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1028:               scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>flush<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1029:               redraw<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>false</span><span style='color:#800080; '>;</span>
1030:               <span style='color:#800000; font-weight:bold; '>continue</span><span style='color:#800080; '>;</span>
1031:             <span style='color:#800080; '>}</span>
1032:             SMatches m<span style='color:#800080; '>;</span>
1033:             <span style='color:#800000; font-weight:bold; '>bool</span> found<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>false</span><span style='color:#800080; '>;</span>
1034:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>global<span style='color:#808030; '>)</span>
1035:             <span style='color:#800080; '>{</span>
1036:               <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>re<span style='color:#808030; '>.</span>Parse<span style='color:#808030; '>(</span>lines<span style='color:#808030; '>[</span>fndline<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#808030; '>+</span>fndpos<span style='color:#808030; '>,</span>lines<span style='color:#808030; '>[</span>fndline<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#808030; '>,</span>
1037:                           lines<span style='color:#808030; '>[</span>totallines<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#808030; '>+</span>lines<span style='color:#808030; '>[</span>totallines<span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len<span style='color:#808030; '>,</span><span style='color:#808030; '>&amp;</span>m<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
1038:               <span style='color:#800080; '>{</span>
1039:                 <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span>i<span style='color:#808030; '>=</span>fndline<span style='color:#800080; '>;</span>i<span style='color:#808030; '>&lt;</span>totallines<span style='color:#800080; '>;</span>i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span>
1040:                 <span style='color:#800080; '>{</span>
1041:                   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>lines<span style='color:#808030; '>[</span>fndline<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#808030; '>+</span>m<span style='color:#808030; '>.</span>s<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>></span><span style='color:#808030; '>=</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span>
1042:                      lines<span style='color:#808030; '>[</span>fndline<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#808030; '>+</span>m<span style='color:#808030; '>.</span>s<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#808030; '>+</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len<span style='color:#808030; '>)</span>
1043:                   <span style='color:#800080; '>{</span>
1044:                     selstartline<span style='color:#808030; '>=</span>i<span style='color:#800080; '>;</span>
1045:                     selstartpos<span style='color:#808030; '>=</span>lines<span style='color:#808030; '>[</span>fndline<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#808030; '>+</span>m<span style='color:#808030; '>.</span>s<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>-</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#800080; '>;</span>
1046:                   <span style='color:#800080; '>}</span>
1047:                   <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>lines<span style='color:#808030; '>[</span>fndline<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#808030; '>+</span>m<span style='color:#808030; '>.</span>e<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>></span><span style='color:#808030; '>=</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span>
1048:                      lines<span style='color:#808030; '>[</span>fndline<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#808030; '>+</span>m<span style='color:#808030; '>.</span>e<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#808030; '>+</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len<span style='color:#808030; '>)</span>
1049:                   <span style='color:#800080; '>{</span>
1050:                     selendline<span style='color:#808030; '>=</span>i<span style='color:#800080; '>;</span>
1051:                     selendpos<span style='color:#808030; '>=</span>lines<span style='color:#808030; '>[</span>fndline<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#808030; '>+</span>m<span style='color:#808030; '>.</span>e<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>-</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#800080; '>;</span>
1052:                     <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
1053:                   <span style='color:#800080; '>}</span>
1054:                 <span style='color:#800080; '>}</span>
1055:                 fndline<span style='color:#808030; '>=</span>selstartline<span style='color:#800080; '>;</span>
1056:                 fndpos<span style='color:#808030; '>=</span>selstartpos<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1057:                 found<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>true</span><span style='color:#800080; '>;</span>
1058:               <span style='color:#800080; '>}</span>
1059:             <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
1060:             <span style='color:#800080; '>{</span>
1061:               <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span>i<span style='color:#808030; '>=</span>fndline<span style='color:#800080; '>;</span>i<span style='color:#808030; '>&lt;</span>totallines<span style='color:#800080; '>;</span>i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span>
1062:               <span style='color:#800080; '>{</span>
1063:                 <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>re<span style='color:#808030; '>.</span>Parse<span style='color:#808030; '>(</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#808030; '>+</span>fndpos<span style='color:#808030; '>,</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#808030; '>,</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#808030; '>+</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len<span style='color:#808030; '>,</span><span style='color:#808030; '>&amp;</span>m<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
1064:                 <span style='color:#800080; '>{</span>
1065:                   selstartline<span style='color:#808030; '>=</span>i<span style='color:#800080; '>;</span>
1066:                   fndline<span style='color:#808030; '>=</span>i<span style='color:#800080; '>;</span>
1067:                   fndpos<span style='color:#808030; '>=</span>m<span style='color:#808030; '>.</span>s<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1068:                   selstartpos<span style='color:#808030; '>=</span>m<span style='color:#808030; '>.</span>s<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
1069:                   selendline<span style='color:#808030; '>=</span>i<span style='color:#800080; '>;</span>
1070:                   selendpos<span style='color:#808030; '>=</span>m<span style='color:#808030; '>.</span>e<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
1071:                   found<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>true</span><span style='color:#800080; '>;</span>
1072:                   <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
1073:                 <span style='color:#800080; '>}</span>
1074:                 fndpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1075:               <span style='color:#800080; '>}</span>
1076:             <span style='color:#800080; '>}</span>
1077:             <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>found<span style='color:#808030; '>)</span>
1078:             <span style='color:#800080; '>{</span>
1079:               scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>fillattr<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>H<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span><span style='color:#008000; '>0xce</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1080:               scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>fillchar<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>H<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>' '</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>W<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1081:               scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>write<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>H<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span><span style='color:#0000e6; '>"Not found"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1082:               scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>flush<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1083:               redraw<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>false</span><span style='color:#800080; '>;</span>
1084:               fndline<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1085:               fndpos<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1086:               <span style='color:#800000; font-weight:bold; '>continue</span><span style='color:#800080; '>;</span>
1087:             <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>else</span>
1088:             <span style='color:#800080; '>{</span>
1089:               <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>selstartline<span style='color:#808030; '>></span><span style='color:#808030; '>=</span>topline<span style='color:#808030; '>+</span>scrbuf<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>H<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> selstartline<span style='color:#808030; '>&lt;</span>topline<span style='color:#808030; '>)</span>
1090:               <span style='color:#800080; '>{</span>
1091:                 topline<span style='color:#808030; '>=</span>selstartline<span style='color:#808030; '>-</span><span style='color:#008c00; '>4</span><span style='color:#800080; '>;</span>
1092:                 <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>topline<span style='color:#808030; '>&lt;</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span>topline<span style='color:#808030; '>=</span><span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1093:               <span style='color:#800080; '>}</span>
1094:             <span style='color:#800080; '>}</span>
1095:           <span style='color:#800080; '>}</span>
1096:           redraw<span style='color:#808030; '>=</span><span style='color:#800000; font-weight:bold; '>true</span><span style='color:#800080; '>;</span>
1097:         <span style='color:#800080; '>}</span>
1098:         <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>(</span>redraw<span style='color:#808030; '>)</span><span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
1099:       <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1100:     <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>while</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>true</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1101:   <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>while</span><span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>quit<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1102: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifndef</span><span style='color:#004a43; '> __DPMI32__</span>
1103:   <span style='color:#400000; '>SetConsoleActiveScreenBuffer</span><span style='color:#808030; '>(</span><span style='color:#400000; '>GetStdHandle</span><span style='color:#808030; '>(</span>STD_OUTPUT_HANDLE<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1104: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
1105:   <span style='color:#400000; '>CloseHandle</span><span style='color:#808030; '>(</span>hCon<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1106:   <span style='color:#800000; font-weight:bold; '>delete</span> scrbuf<span style='color:#800080; '>;</span>
1107: 
1108: <span style='color:#696969; '>// ms dos uses video buffer</span>
1109: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>elif</span><span style='color:#004a43; '> </span><span style='color:#004a43; '>defined</span><span style='color:#004a43; '> __MSDOS__</span>
1110: 
1111: <span style='color:#800000; font-weight:bold; '>int</span> j<span style='color:#808030; '>,</span> ch<span style='color:#800080; '>;</span>
1112: <span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>vm <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>char</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#008000; '>0xb8000000</span><span style='color:#800080; '>;</span>
1113: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '> _DPMI_</span>
1114: <span style='color:#800000; font-weight:bold; '>unsigned</span> <span style='color:#800000; font-weight:bold; '>int</span> vmsel<span style='color:#808030; '>=</span><span style='color:#008000; '>0xb800</span><span style='color:#800080; '>;</span>
1115: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
1116: 
1117: <span style='color:#696969; '>// DataCompBoy: get selector for videobuffer</span>
1118: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '> _DPMI_</span>
1119:   <span style='color:#004a43; '>asm</span><span style='color:#800080; '>{</span>
1120:     <span style='color:#800000; font-weight:bold; '>mov</span> <span style='color:#000080; '>ax</span><span style='color:#808030; '>,</span> <span style='color:#008000; '>0002h</span>
1121:     <span style='color:#800000; font-weight:bold; '>mov</span> <span style='color:#000080; '>bx</span><span style='color:#808030; '>,</span> vmsel
1122:     <span style='color:#800000; font-weight:bold; '>int</span> <span style='color:#008000; '>31h</span>
1123:     <span style='color:#800000; font-weight:bold; '>mov</span> vmsel<span style='color:#808030; '>,</span> <span style='color:#000080; '>ax</span>
1124:   <span style='color:#800080; '>}</span>
1125:   vm<span style='color:#808030; '>=</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>char</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#808030; '>(</span>vmsel<span style='color:#808030; '>*</span><span style='color:#008000; '>0x10000</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1126: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
1127: <span style='color:#696969; '>// DataCompBoy: end</span>
1128: 
1129:   topline <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1130:   <span style='color:#800000; font-weight:bold; '>do</span><span style='color:#800080; '>{</span>
1131:     <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span>i <span style='color:#808030; '>=</span> topline<span style='color:#800080; '>;</span> i <span style='color:#808030; '>&lt;</span> topline <span style='color:#808030; '>+</span> <span style='color:#008c00; '>25</span><span style='color:#800080; '>;</span> i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1132:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>i <span style='color:#808030; '>></span><span style='color:#808030; '>=</span> totallines<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>continue</span><span style='color:#800080; '>;</span>
1133:       l1 <span style='color:#808030; '>=</span> hlines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>next<span style='color:#800080; '>;</span>
1134:       <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span>j <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> j <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>80</span><span style='color:#800080; '>;</span>j<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1135:         vm<span style='color:#808030; '>[</span><span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>i<span style='color:#808030; '>-</span>topline<span style='color:#808030; '>)</span><span style='color:#808030; '>*</span><span style='color:#008c00; '>80</span> <span style='color:#808030; '>+</span> j<span style='color:#808030; '>)</span><span style='color:#808030; '>*</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#008000; '>0x20</span><span style='color:#800080; '>;</span>
1136:         vm<span style='color:#808030; '>[</span><span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>i<span style='color:#808030; '>-</span>topline<span style='color:#808030; '>)</span><span style='color:#808030; '>*</span><span style='color:#008c00; '>80</span> <span style='color:#808030; '>+</span> j<span style='color:#808030; '>)</span><span style='color:#808030; '>*</span><span style='color:#008c00; '>2</span> <span style='color:#808030; '>+</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> bkcolor<span style='color:#800080; '>;</span>
1137:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len<span style='color:#808030; '>-</span>leftpos <span style='color:#808030; '>></span> j<span style='color:#808030; '>)</span>
1138:           vm<span style='color:#808030; '>[</span><span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>i<span style='color:#808030; '>-</span>topline<span style='color:#808030; '>)</span><span style='color:#808030; '>*</span><span style='color:#008c00; '>80</span> <span style='color:#808030; '>+</span> j<span style='color:#808030; '>)</span><span style='color:#808030; '>*</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data<span style='color:#808030; '>[</span>j<span style='color:#808030; '>+</span>leftpos<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
1139:       <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1140:       <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span><span style='color:#800080; '>;</span> l1<span style='color:#800080; '>;</span> l1 <span style='color:#808030; '>=</span> l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>next<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1141:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len<span style='color:#808030; '>-</span>leftpos <span style='color:#808030; '>&lt;</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>continue</span><span style='color:#800080; '>;</span>
1142:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>ad<span style='color:#808030; '>.</span>type <span style='color:#808030; '>></span> <span style='color:#008000; '>0xFF</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>continue</span><span style='color:#800080; '>;</span>
1143:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>end <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span> l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>end <span style='color:#808030; '>=</span> lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len<span style='color:#800080; '>;</span>
1144:         clr <span style='color:#808030; '>=</span> l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>ad<span style='color:#808030; '>.</span>fore <span style='color:#808030; '>+</span> <span style='color:#808030; '>(</span>l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>ad<span style='color:#808030; '>.</span>back<span style='color:#808030; '>&lt;</span><span style='color:#808030; '>&lt;</span><span style='color:#008c00; '>4</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1145:         <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span>j <span style='color:#808030; '>=</span> l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>start<span style='color:#800080; '>;</span> j <span style='color:#808030; '>&lt;</span> l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>end<span style='color:#800080; '>;</span> j<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1146:           <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>j<span style='color:#808030; '>-</span>leftpos <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>continue</span><span style='color:#800080; '>;</span>
1147:           vm<span style='color:#808030; '>[</span><span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>i<span style='color:#808030; '>-</span>topline<span style='color:#808030; '>)</span><span style='color:#808030; '>*</span><span style='color:#008c00; '>80</span> <span style='color:#808030; '>+</span> j<span style='color:#808030; '>-</span>leftpos<span style='color:#808030; '>)</span><span style='color:#808030; '>*</span><span style='color:#008c00; '>2</span> <span style='color:#808030; '>+</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> clr<span style='color:#800080; '>;</span>
1148:         <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1149:       <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1150:     <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1151:     <span style='color:#800000; font-weight:bold; '>while</span><span style='color:#808030; '>(</span>ch <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> ch<span style='color:#808030; '>!</span><span style='color:#808030; '>=</span><span style='color:#008c00; '>27</span><span style='color:#808030; '>)</span>
1152:       ch <span style='color:#808030; '>=</span> getch<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1153:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>ch<span style='color:#808030; '>)</span> ch <span style='color:#808030; '>=</span> getch<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1154:     <span style='color:#800000; font-weight:bold; '>switch</span><span style='color:#808030; '>(</span>ch<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1155:       <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#0000e6; '>'H'</span><span style='color:#e34adc; '>:</span>
1156:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>topline<span style='color:#808030; '>)</span> topline<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#800080; '>;</span>
1157:         <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
1158:       <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#0000e6; '>'P'</span><span style='color:#e34adc; '>:</span>
1159:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>topline <span style='color:#808030; '>+</span> <span style='color:#008c00; '>25</span> <span style='color:#808030; '>&lt;</span> totallines<span style='color:#808030; '>)</span> topline<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
1160:         <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
1161:       <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#0000e6; '>'K'</span><span style='color:#e34adc; '>:</span>
1162:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>leftpos<span style='color:#808030; '>)</span> leftpos<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#800080; '>;</span>
1163:         <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
1164:       <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#0000e6; '>'M'</span><span style='color:#e34adc; '>:</span>
1165:         leftpos<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
1166:         <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
1167:       <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#0000e6; '>'I'</span><span style='color:#e34adc; '>:</span>
1168:         topline <span style='color:#808030; '>-</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>25</span><span style='color:#800080; '>;</span>
1169:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>topline <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> topline <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1170:         <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
1171:       <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#0000e6; '>'Q'</span><span style='color:#e34adc; '>:</span>
1172:         topline <span style='color:#808030; '>+</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>25</span><span style='color:#800080; '>;</span>
1173:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>topline <span style='color:#808030; '>></span> totallines <span style='color:#808030; '>-</span> <span style='color:#008c00; '>25</span><span style='color:#808030; '>)</span> topline <span style='color:#808030; '>=</span> totallines <span style='color:#808030; '>-</span> <span style='color:#008c00; '>25</span><span style='color:#800080; '>;</span>
1174:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>topline <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> topline <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1175:         <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
1176:       <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#0000e6; '>'G'</span><span style='color:#e34adc; '>:</span>
1177:         topline <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1178:         leftpos <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1179:         <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
1180:       <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#0000e6; '>'O'</span><span style='color:#e34adc; '>:</span>
1181:         leftpos <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1182:         topline <span style='color:#808030; '>=</span> totallines <span style='color:#808030; '>-</span> <span style='color:#008c00; '>25</span><span style='color:#800080; '>;</span>
1183:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>topline <span style='color:#808030; '>&lt;</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> topline <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1184:         <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
1185:     <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1186:   <span style='color:#800080; '>}</span><span style='color:#800000; font-weight:bold; '>while</span><span style='color:#808030; '>(</span>ch <span style='color:#808030; '>!</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>27</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1187: 
1188: <span style='color:#696969; '>//  UNIX systems - hmm...</span>
1189: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>else</span>
1190: 
1191: <span style='color:#800000; font-weight:bold; '>int</span> ll<span style='color:#800080; '>;</span>
1192: <span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>line<span style='color:#808030; '>,</span> t<span style='color:#808030; '>[</span><span style='color:#008c00; '>1024</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
1193:   <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span>i <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> i <span style='color:#808030; '>&lt;</span> totallines<span style='color:#800080; '>;</span> i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1194:     line <span style='color:#808030; '>=</span> GetLine<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> i<span style='color:#808030; '>,</span> <span style='color:#808030; '>&amp;</span>ll<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1195:     strncpy<span style='color:#808030; '>(</span>t<span style='color:#808030; '>,</span> line<span style='color:#808030; '>,</span> ll<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1196:     t<span style='color:#808030; '>[</span>ll<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1197:     printf<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>%s</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>,</span>t<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1198:   <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1199: 
1200: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
1201: 
1202:   clrDestroyRegions<span style='color:#808030; '>(</span>hlines<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1203:   <span style='color:#800000; font-weight:bold; '>delete</span> adata<span style='color:#800080; '>;</span>
1204:   <span style='color:#800000; font-weight:bold; '>delete</span> cc<span style='color:#800080; '>;</span>
1205:   <span style='color:#800000; font-weight:bold; '>delete</span> cd<span style='color:#800080; '>;</span>
1206: <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1207: 
1208: <span style='color:#696969; '>// prints to stdout formatted and colored text with selected rules (-i&lt;fname>)</span>
1209: <span style='color:#800000; font-weight:bold; '>void</span> htmlout<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span>
1210: <span style='color:#800080; '>{</span>
1211: PAssignData ad<span style='color:#800080; '>;</span>
1212: <span style='color:#800000; font-weight:bold; '>char</span> tmpline<span style='color:#808030; '>[</span><span style='color:#008c00; '>512</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
1213: <span style='color:#800000; font-weight:bold; '>int</span> i<span style='color:#808030; '>,</span> pos<span style='color:#800080; '>;</span>
1214: 
1215:   cd <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>new</span> CColorData<span style='color:#808030; '>(</span>basefname<span style='color:#808030; '>,</span> <span style='color:#7d0045; '>NULL</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1216:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>cd<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>IsOk<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1217:     fprintf<span style='color:#808030; '>(</span><span style='color:#603000; '>stderr</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"cannot load colorer base from </span><span style='color:#0f69ff; '>%s</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>,</span> basefname<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1218:     <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
1219:   <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1220:   adata <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>new</span> CAssign<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1221:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>adata<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>load<span style='color:#808030; '>(</span>frules<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1222:     fprintf<span style='color:#808030; '>(</span><span style='color:#603000; '>stderr</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"cannot load region rules from </span><span style='color:#0f69ff; '>%s</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>,</span> frules<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1223:     <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
1224:   <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1225:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>*</span>typedescr<span style='color:#808030; '>)</span> type <span style='color:#808030; '>=</span> seltype<span style='color:#808030; '>(</span>cd<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1226:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span><span style='color:#808030; '>*</span>typedescr <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#808030; '>!</span>type<span style='color:#808030; '>)</span> type <span style='color:#808030; '>=</span> cd<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>SelType<span style='color:#808030; '>(</span>fname<span style='color:#808030; '>,</span> GetLine<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1227:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>type<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
1228: 
1229:   hlines <span style='color:#808030; '>=</span> clrCreateRegions<span style='color:#808030; '>(</span>totallines<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1230:   cd<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>LoadType<span style='color:#808030; '>(</span>type<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1231:   cc <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>new</span> CColorer<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1232:   cc<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>SetServices<span style='color:#808030; '>(</span>GetLine<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> clrAddRegion<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> hlines<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1233:   cc<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>SetColoringSrc<span style='color:#808030; '>(</span>type<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1234:   cc<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>QuickParse<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> totallines<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1235: <span style='color:#696969; '>//  cc->FullParse(0, 0 ,totallines, totallines);</span>
1236: 
1237:   <span style='color:#696969; '>// in this order only!</span>
1238:   clrAssignRegions<span style='color:#808030; '>(</span>hlines<span style='color:#808030; '>,</span> adata<span style='color:#808030; '>,</span> adata<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>getcdata<span style='color:#808030; '>(</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1239:   clrCompactRegions<span style='color:#808030; '>(</span>hlines<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1240: 
1241:   ad <span style='color:#808030; '>=</span> adata<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>getcdata<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1242:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>ad<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>stext<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1243:     fprintf<span style='color:#808030; '>(</span><span style='color:#603000; '>stderr</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"bad rules file</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1244:     <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
1245:   <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1246:   printf<span style='color:#808030; '>(</span>ad<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>stext<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1247:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>cpdis<span style='color:#808030; '>)</span> printf<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>created with colorer library version 4ever. type '</span><span style='color:#0f69ff; '>%s</span><span style='color:#0000e6; '>'"</span><span style='color:#808030; '>,</span> type<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>descr<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1248:   printf<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1249:   <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span>i <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> i <span style='color:#808030; '>&lt;</span> totallines<span style='color:#800080; '>;</span> i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1250:     pos <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1251:     <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span>l1 <span style='color:#808030; '>=</span> hlines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>next<span style='color:#800080; '>;</span> l1<span style='color:#800080; '>;</span> l1 <span style='color:#808030; '>=</span> l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>next<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1252:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>end <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span> l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>end <span style='color:#808030; '>=</span> lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len<span style='color:#800080; '>;</span>
1253:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>ad<span style='color:#808030; '>.</span>type <span style='color:#808030; '>></span> <span style='color:#008000; '>0xFF</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>continue</span><span style='color:#800080; '>;</span>
1254:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>start <span style='color:#808030; '>></span> pos<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1255:         SetLine<span style='color:#808030; '>(</span>tmpline<span style='color:#808030; '>,</span> lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data <span style='color:#808030; '>+</span> pos<span style='color:#808030; '>,</span> l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>start <span style='color:#808030; '>-</span> pos<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1256:         pos <span style='color:#808030; '>=</span> l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>start<span style='color:#800080; '>;</span>
1257:         printf<span style='color:#808030; '>(</span>tmpline<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1258:       <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1259:       SetLine<span style='color:#808030; '>(</span>tmpline<span style='color:#808030; '>,</span> lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data <span style='color:#808030; '>+</span> pos<span style='color:#808030; '>,</span> l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>end <span style='color:#808030; '>-</span> l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>start<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1260:       pos <span style='color:#808030; '>+</span><span style='color:#808030; '>=</span> l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>end <span style='color:#808030; '>-</span> l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>start<span style='color:#800080; '>;</span>
1261: 
1262:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>ad<span style='color:#808030; '>.</span>bsback<span style='color:#808030; '>)</span> printf<span style='color:#808030; '>(</span>l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>ad<span style='color:#808030; '>.</span>sback<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1263:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>ad<span style='color:#808030; '>.</span>bstext<span style='color:#808030; '>)</span> printf<span style='color:#808030; '>(</span>l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>ad<span style='color:#808030; '>.</span>stext<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1264:       printf<span style='color:#808030; '>(</span>tmpline<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1265:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>ad<span style='color:#808030; '>.</span>betext<span style='color:#808030; '>)</span> printf<span style='color:#808030; '>(</span>l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>ad<span style='color:#808030; '>.</span>etext<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1266:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>ad<span style='color:#808030; '>.</span>beback<span style='color:#808030; '>)</span> printf<span style='color:#808030; '>(</span>l1<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>ad<span style='color:#808030; '>.</span>eback<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1267:     <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1268:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>pos <span style='color:#808030; '>&lt;</span> lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1269:       SetLine<span style='color:#808030; '>(</span>tmpline<span style='color:#808030; '>,</span> lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>data <span style='color:#808030; '>+</span> pos<span style='color:#808030; '>,</span> lines<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>.</span>len <span style='color:#808030; '>-</span> pos<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1270:       printf<span style='color:#808030; '>(</span>tmpline<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1271:     <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1272:     printf<span style='color:#808030; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1273:   <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1274:   ad <span style='color:#808030; '>=</span> adata<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>getcdata<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1275:   printf<span style='color:#808030; '>(</span>ad<span style='color:#808030; '>-</span><span style='color:#808030; '>></span>etext<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1276: 
1277:   clrDestroyRegions<span style='color:#808030; '>(</span>hlines<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1278:   <span style='color:#800000; font-weight:bold; '>delete</span> adata<span style='color:#800080; '>;</span>
1279:   <span style='color:#800000; font-weight:bold; '>delete</span> cc<span style='color:#800080; '>;</span>
1280:   <span style='color:#800000; font-weight:bold; '>delete</span> cd<span style='color:#800080; '>;</span>
1281: <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1282: 
1283: <span style='color:#696969; '>// opens file and reads it</span>
1284: <span style='color:#800000; font-weight:bold; '>void</span> parse<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> no<span style='color:#808030; '>)</span>
1285: <span style='color:#800080; '>{</span>
1286: <span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>data<span style='color:#800080; '>;</span>
1287: <span style='color:#800000; font-weight:bold; '>struct</span> stat fst<span style='color:#800080; '>;</span>
1288:   <span style='color:#800000; font-weight:bold; '>int</span> file <span style='color:#808030; '>=</span> open<span style='color:#808030; '>(</span>fname<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1289:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>file <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1290:     fprintf<span style='color:#808030; '>(</span><span style='color:#603000; '>stderr</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"cannot open file </span><span style='color:#0f69ff; '>%s</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>,</span> fname<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1291:     <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
1292:   <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1293:   fstat<span style='color:#808030; '>(</span>file<span style='color:#808030; '>,</span> <span style='color:#808030; '>&amp;</span>fst<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1294:   <span style='color:#800000; font-weight:bold; '>int</span> len <span style='color:#808030; '>=</span> fst<span style='color:#808030; '>.</span>st_size<span style='color:#800080; '>;</span>
1295:   data <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>new</span> <span style='color:#800000; font-weight:bold; '>char</span><span style='color:#808030; '>[</span>len<span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
1296:   memset<span style='color:#808030; '>(</span>data<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> len<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1297:   len <span style='color:#808030; '>=</span> read<span style='color:#808030; '>(</span>file<span style='color:#808030; '>,</span> data<span style='color:#808030; '>,</span> len<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1298:   close<span style='color:#808030; '>(</span>file<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1299: 
1300:   formatlines<span style='color:#808030; '>(</span>data<span style='color:#808030; '>,</span> len<span style='color:#808030; '>,</span> no<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1301: 
1302:   no<span style='color:#800080; '>?</span>view<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>:</span>htmlout<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1303: 
1304:   <span style='color:#800000; font-weight:bold; '>delete</span><span style='color:#808030; '>[</span><span style='color:#808030; '>]</span> lines<span style='color:#800080; '>;</span>
1305:   <span style='color:#800000; font-weight:bold; '>delete</span> data<span style='color:#800080; '>;</span>
1306: <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1307: 
1308: <span style='color:#696969; '>// parameters</span>
1309: <span style='color:#800000; font-weight:bold; '>void</span> printerr<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span>
1310: <span style='color:#800080; '>{</span>
1311: fprintf<span style='color:#808030; '>(</span><span style='color:#603000; '>stderr</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"use: colorer -(l|r|h|v) [-i&lt;name>] [-c] [-d] [-t&lt;type>] &lt;fname></span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
1312:        <span style='color:#0000e6; '>"  -l        test and load full database</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
1313:        <span style='color:#0000e6; '>"  -r        regexp tests</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
1314:        <span style='color:#0000e6; '>"  -h        generates plain coloring from file &lt;fname> (uses rulesgen param)</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
1315:        <span style='color:#0000e6; '>"  -v        view file &lt;fname> (uses rulesview param)</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
1316:        <span style='color:#0000e6; '>"  -i&lt;name>  load coloring rules with name 'rules&lt;name>'</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
1317:        <span style='color:#0000e6; '>"  -t&lt;type>  try to use type &lt;type> instead of type autodetection</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
1318:        <span style='color:#0000e6; '>"  -d        disable html symbols substitutions</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
1319:        <span style='color:#0000e6; '>"  -c        disable information header</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
1320:        <span style='color:#0000e6; '>"colorer uses colorer.ini file, placed in its directory(win/dos)</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
1321:        <span style='color:#0000e6; '>"or .colorer.ini in /usr/share/colorer/bin/ in unix systems</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
1322:        <span style='color:#0000e6; '>"this file contain base file paths.</span><span style='color:#0f69ff; '>\n</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span>
1323:        <span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1324: <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1325: 
1326: 
1327: <span style='color:#800000; font-weight:bold; '>void</span> getparams<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> argc<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>argv<span style='color:#808030; '>[</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span>
1328: <span style='color:#800080; '>{</span>
1329:   <span style='color:#696969; '>// checking parameters</span>
1330:   <span style='color:#808030; '>*</span>frules <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1331:   htmlsubst <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1332:   <span style='color:#800000; font-weight:bold; '>for</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> i <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span> i <span style='color:#808030; '>&lt;</span> argc<span style='color:#800080; '>;</span> i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1333:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>argv<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>!</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>'-'</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> argv<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>!</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'/'</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1334:       strcpy<span style='color:#808030; '>(</span>fname<span style='color:#808030; '>,</span> argv<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1335:       <span style='color:#800000; font-weight:bold; '>continue</span><span style='color:#800080; '>;</span>
1336:     <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1337:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>argv<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'r'</span><span style='color:#808030; '>)</span> what <span style='color:#808030; '>=</span> EREGEXP<span style='color:#800080; '>;</span>
1338:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>argv<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'l'</span><span style='color:#808030; '>)</span> what <span style='color:#808030; '>=</span> ELIST<span style='color:#800080; '>;</span>
1339:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>argv<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'v'</span><span style='color:#808030; '>)</span> what <span style='color:#808030; '>=</span> EVIEW<span style='color:#800080; '>;</span>
1340:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>argv<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'h'</span><span style='color:#808030; '>)</span> what <span style='color:#808030; '>=</span> EGEN<span style='color:#800080; '>;</span>
1341:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>argv<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'d'</span><span style='color:#808030; '>)</span> htmlsubst <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1342:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>argv<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'c'</span><span style='color:#808030; '>)</span> cpdis <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1343:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>argv<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'t'</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>i<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span> <span style='color:#808030; '>&lt;</span> argc <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> argv<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1344:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>argv<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span> strcpy<span style='color:#808030; '>(</span>typedescr<span style='color:#808030; '>,</span> argv<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>+</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1345:       <span style='color:#800000; font-weight:bold; '>else</span><span style='color:#800080; '>{</span>
1346:         strcpy<span style='color:#808030; '>(</span>typedescr<span style='color:#808030; '>,</span> argv<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1347:         i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
1348:       <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1349:     <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1350:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>argv<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'i'</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>(</span>i<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span> <span style='color:#808030; '>&lt;</span> argc <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> argv<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1351:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>argv<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span> strcpy<span style='color:#808030; '>(</span>frules<span style='color:#808030; '>,</span> argv<span style='color:#808030; '>[</span>i<span style='color:#808030; '>]</span><span style='color:#808030; '>+</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1352:       <span style='color:#800000; font-weight:bold; '>else</span><span style='color:#800080; '>{</span>
1353:         strcpy<span style='color:#808030; '>(</span>frules<span style='color:#808030; '>,</span> argv<span style='color:#808030; '>[</span>i<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1354:         i<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#800080; '>;</span>
1355:       <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1356:     <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1357:   <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1358:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span><span style='color:#808030; '>*</span>frules <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> what <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> EVIEW<span style='color:#808030; '>)</span> strcpy<span style='color:#808030; '>(</span>frules<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"view"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1359:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span><span style='color:#808030; '>*</span>frules <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> what <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> EGEN<span style='color:#808030; '>)</span> strcpy<span style='color:#808030; '>(</span>frules<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"gen"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1360: <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1361: 
1362: <span style='color:#800000; font-weight:bold; '>void</span> getfparams<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>char</span><span style='color:#808030; '>*</span> param0<span style='color:#696969; '>/*DCB*/</span><span style='color:#808030; '>)</span>
1363: <span style='color:#800080; '>{</span>
1364: <span style='color:#800000; font-weight:bold; '>char</span> cname<span style='color:#808030; '>[</span><span style='color:#008c00; '>256</span><span style='color:#808030; '>]</span><span style='color:#808030; '>,</span> tmpname<span style='color:#808030; '>[</span><span style='color:#008c00; '>64</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
1365: <span style='color:#800000; font-weight:bold; '>int</span> len<span style='color:#800080; '>;</span>
1366: <span style='color:#800000; font-weight:bold; '>bool</span> setrules <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>false</span><span style='color:#800080; '>;</span>
1367: <span style='color:#603000; '>FILE</span> <span style='color:#808030; '>*</span>file<span style='color:#800080; '>;</span>
1368: 
1369: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '> _WIN32</span>
1370:   len <span style='color:#808030; '>=</span> <span style='color:#400000; '>GetModuleFileName</span><span style='color:#808030; '>(</span><span style='color:#400000; '>GetModuleHandle</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> cname<span style='color:#808030; '>,</span> <span style='color:#008c00; '>256</span><span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1371:   <span style='color:#800000; font-weight:bold; '>while</span><span style='color:#808030; '>(</span>cname<span style='color:#808030; '>[</span>len<span style='color:#808030; '>]</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> cname<span style='color:#808030; '>[</span>len<span style='color:#808030; '>]</span> <span style='color:#808030; '>!</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'\\'</span><span style='color:#808030; '>)</span> len<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#800080; '>;</span>
1372:   strcpy<span style='color:#808030; '>(</span>cname<span style='color:#808030; '>+</span>len<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"colorer.ini"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1373: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>elif</span><span style='color:#004a43; '> </span><span style='color:#004a43; '>defined</span><span style='color:#004a43; '> __MSDOS__</span>
1374: <span style='color:#696969; '>//DataCompBoy: begin</span>
1375:   strcpy<span style='color:#808030; '>(</span>cname<span style='color:#808030; '>,</span> param0<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1376:   len <span style='color:#808030; '>=</span> strlen<span style='color:#808030; '>(</span>cname<span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1377:   <span style='color:#800000; font-weight:bold; '>while</span><span style='color:#808030; '>(</span>cname<span style='color:#808030; '>[</span>len<span style='color:#808030; '>]</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> cname<span style='color:#808030; '>[</span>len<span style='color:#808030; '>]</span> <span style='color:#808030; '>!</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'\\'</span><span style='color:#808030; '>)</span> len<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#800080; '>;</span>
1378:   strcpy<span style='color:#808030; '>(</span>cname<span style='color:#808030; '>+</span>len<span style='color:#808030; '>+</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"colorer.ini"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1379: <span style='color:#696969; '>//DataCompBoy: end</span>
1380: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>else</span>
1381:   strcpy<span style='color:#808030; '>(</span>cname<span style='color:#808030; '>,</span> UNIX_CFG<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1382: <span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
1383: 
1384: 
1385:   file <span style='color:#808030; '>=</span> fopen<span style='color:#808030; '>(</span>cname<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"r"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1386:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>file<span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span>
1387: 
1388:   <span style='color:#800000; font-weight:bold; '>while</span><span style='color:#808030; '>(</span>fgets<span style='color:#808030; '>(</span>cname<span style='color:#808030; '>,</span> <span style='color:#008c00; '>256</span><span style='color:#808030; '>,</span> file<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1389:     len <span style='color:#808030; '>=</span> strlen<span style='color:#808030; '>(</span>cname<span style='color:#808030; '>)</span><span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
1390:     <span style='color:#800000; font-weight:bold; '>while</span><span style='color:#808030; '>(</span>cname<span style='color:#808030; '>[</span>len<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'\r'</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> cname<span style='color:#808030; '>[</span>len<span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'\n'</span><span style='color:#808030; '>)</span>
1391:       cname<span style='color:#808030; '>[</span>len<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1392:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>strncmp<span style='color:#808030; '>(</span>cname<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"base="</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>5</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1393:        strcpy<span style='color:#808030; '>(</span>basefname<span style='color:#808030; '>,</span> cname<span style='color:#808030; '>+</span><span style='color:#008c00; '>5</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1394:     <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1395:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>setrules<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1396:       len <span style='color:#808030; '>=</span> sprintf<span style='color:#808030; '>(</span>tmpname<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"rules.</span><span style='color:#0f69ff; '>%s</span><span style='color:#0000e6; '>="</span><span style='color:#808030; '>,</span> frules<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1397:       <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>!</span>strncmp<span style='color:#808030; '>(</span>cname<span style='color:#808030; '>,</span> tmpname<span style='color:#808030; '>,</span> len<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1398:         strcpy<span style='color:#808030; '>(</span>frules<span style='color:#808030; '>,</span> cname<span style='color:#808030; '>+</span>len<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1399:         setrules <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>true</span><span style='color:#800080; '>;</span>
1400:       <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1401:     <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1402:   <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1403:   fclose<span style='color:#808030; '>(</span>file<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1404: <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1405: 
1406: <span style='color:#696969; '>// hm...</span>
1407: <span style='color:#800000; font-weight:bold; '>int</span> <span style='color:#400000; '>main</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>int</span> argc<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>char</span> <span style='color:#808030; '>*</span>argv<span style='color:#808030; '>[</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span>
1408: <span style='color:#800080; '>{</span>
1409:   fprintf<span style='color:#808030; '>(</span><span style='color:#603000; '>stderr</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>colorer library ``forever''</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1410:   fprintf<span style='color:#808030; '>(</span><span style='color:#603000; '>stderr</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"copyright (c) 1999-2001 cail lomecb/igor ruskih</span><span style='color:#0f69ff; '>\n</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1411: 
1412:   getparams<span style='color:#808030; '>(</span>argc<span style='color:#808030; '>,</span> argv<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1413:   getfparams<span style='color:#808030; '>(</span>argv<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#696969; '>/*DCB*/</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1414: 
1415:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>what <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1416:     printerr<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1417:     <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1418:   <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1419:   <span style='color:#800000; font-weight:bold; '>switch</span><span style='color:#808030; '>(</span>what<span style='color:#808030; '>)</span><span style='color:#800080; '>{</span>
1420:     <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>EREGEXP</span><span style='color:#e34adc; '>:</span>
1421:       retest<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1422:       <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
1423:     <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>ELIST</span><span style='color:#e34adc; '>:</span>
1424:       <span style='color:#603000; '>list</span><span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1425:       <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
1426:     <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>EVIEW</span><span style='color:#e34adc; '>:</span>
1427:       parse<span style='color:#808030; '>(</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1428:       <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
1429:     <span style='color:#800000; font-weight:bold; '>case </span><span style='color:#7d0045; '>EGEN</span><span style='color:#e34adc; '>:</span>
1430:       parse<span style='color:#808030; '>(</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1431:       <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
1432: <span style='color:#e34adc; '>    </span><span style='color:#800000; font-weight:bold; '>default</span><span style='color:#e34adc; '>:</span>
1433:       printerr<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
1434:       <span style='color:#800000; font-weight:bold; '>break</span><span style='color:#800080; '>;</span>
1435:   <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1436:   <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
1437: <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
1438: 
</pre></body></html>
