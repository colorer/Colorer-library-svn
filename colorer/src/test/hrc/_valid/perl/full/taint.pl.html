  0: <span style='color:#696969; '>#!</span><span style='color:#007997; '>./perl</span><span style='color:#bb7977; font-weight:bold; '> -T</span>
  1: <span style='color:#696969; '>#</span>
  2: <span style='color:#696969; '># Taint tests by Tom Phoenix </span><span style='color:#0000e6; '>&lt;</span><span style='color:#7144c4; '>rootbeer@teleport.com</span><span style='color:#0000e6; '>></span><span style='color:#696969; '>.</span>
  3: <span style='color:#696969; '>#</span>
  4: <span style='color:#696969; '># I don't claim to know all about tainting. If anyone sees</span>
  5: <span style='color:#696969; '># tests that I've missed here, please add them. But this is</span>
  6: <span style='color:#696969; '># better than having no tests at all, right?</span>
  7: <span style='color:#696969; '>#</span>
  8: 
  9: <span style='color:#800000; font-weight:bold; '>BEGIN</span> <span style='color:#800080; '>{</span>
 10:     <span style='color:#400000; '>chdir</span> <span style='color:#0000e6; '>'t'</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>-d</span> <span style='color:#0000e6; '>'t'</span><span style='color:#800080; '>;</span>
 11:     <span style='color:#400000; '>unshift</span> @INC<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'../lib'</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>-d</span> <span style='color:#0000e6; '>'../lib'</span><span style='color:#800080; '>;</span>
 12: <span style='color:#800080; '>}</span>
 13: 
 14: <span style='color:#800000; font-weight:bold; '>use</span> <span style='color:#800000; font-weight:bold; '>strict</span><span style='color:#800080; '>;</span>
 15: <span style='color:#800000; font-weight:bold; '>use</span> Config<span style='color:#800080; '>;</span>
 16: 
 17: <span style='color:#696969; '># We do not want the whole taint.t to fail</span>
 18: <span style='color:#696969; '># just because Errno possibly failing.</span>
 19: <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>require</span> <span style='color:#bb7977; font-weight:bold; '>Errno</span><span style='color:#800080; '>;</span> import <span style='color:#bb7977; font-weight:bold; '>Errno</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 20: 
 21: <span style='color:#800000; font-weight:bold; '>BEGIN</span> <span style='color:#800080; '>{</span>
 22:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$^O <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'VMS'</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> <span style='color:#808030; '>!</span><span style='color:#800000; font-weight:bold; '>defined</span><span style='color:#808030; '>(</span>$Config<span style='color:#808030; '>{</span>d_setenv<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 23:       $ENV<span style='color:#808030; '>{</span>PATH<span style='color:#808030; '>}</span> <span style='color:#808030; '>=</span> $ENV<span style='color:#808030; '>{</span>PATH<span style='color:#808030; '>}</span><span style='color:#800080; '>;</span>
 24:       $ENV<span style='color:#808030; '>{</span>TERM<span style='color:#808030; '>}</span> <span style='color:#808030; '>=</span> $ENV<span style='color:#808030; '>{</span>TERM<span style='color:#808030; '>}</span> <span style='color:#808030; '>ne</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>?</span> $ENV<span style='color:#808030; '>{</span>TERM<span style='color:#808030; '>}</span> <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>'dummy'</span><span style='color:#800080; '>;</span>
 25:   <span style='color:#800080; '>}</span>
 26:   <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$Config<span style='color:#808030; '>{</span>d_shm<span style='color:#808030; '>}</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> $Config<span style='color:#808030; '>{</span>d_msg<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 27:      <span style='color:#800000; font-weight:bold; '>require</span> <span style='color:#bb7977; font-weight:bold; '>IPC</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>SysV</span><span style='color:#800080; '>;</span>
 28:      <span style='color:#bb7977; font-weight:bold; '>IPC</span><span style='color:#808030; '>::</span><span style='color:#bb7977; font-weight:bold; '>SysV</span><span style='color:#808030; '>-></span>import<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>qw</span><span style='color:#800000; '>(</span><span style='color:#0000e6; '>IPC_PRIVATE IPC_RMID IPC_CREAT S_IRWXU</span><span style='color:#800000; '>)</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 29:   <span style='color:#800080; '>}</span>
 30: <span style='color:#800080; '>}</span>
 31: 
 32: <span style='color:#800000; font-weight:bold; '>my</span> $Is_VMS <span style='color:#808030; '>=</span> $^O <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'VMS'</span><span style='color:#800080; '>;</span>
 33: <span style='color:#800000; font-weight:bold; '>my</span> $Is_MSWin32 <span style='color:#808030; '>=</span> $^O <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'MSWin32'</span><span style='color:#800080; '>;</span>
 34: <span style='color:#800000; font-weight:bold; '>my</span> $Is_Dos <span style='color:#808030; '>=</span> $^O <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'dos'</span><span style='color:#800080; '>;</span>
 35: <span style='color:#800000; font-weight:bold; '>my</span> $Invoke_Perl <span style='color:#808030; '>=</span> $Is_VMS <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>'MCR Sys$Disk:[]Perl.'</span> <span style='color:#808030; '>:</span>
 36:                   $Is_MSWin32 <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>'.\perl'</span> <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>'./perl'</span><span style='color:#800080; '>;</span>
 37: <span style='color:#800000; font-weight:bold; '>my</span> @MoreEnv <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>qw</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>IFS CDPATH ENV BASH_ENV</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
 38: 
 39: <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$Is_VMS<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 40:     <span style='color:#800000; font-weight:bold; '>my</span> <span style='color:#808030; '>(</span>%old<span style='color:#808030; '>,</span> $x<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 41:     <span style='color:#800000; font-weight:bold; '>for</span> $x <span style='color:#808030; '>(</span><span style='color:#0000e6; '>'DCL$PATH'</span><span style='color:#808030; '>,</span> @MoreEnv<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 42:     <span style='color:#808030; '>(</span>$old<span style='color:#808030; '>{</span>$x<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> $ENV<span style='color:#808030; '>{</span>$x<span style='color:#808030; '>}</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>*</span><span style='color:#808030; '>)</span><span style='color:#808030; '>$</span><span style='color:#800000; '>/</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#400000; '>exists</span> $ENV<span style='color:#808030; '>{</span>$x<span style='color:#808030; '>}</span><span style='color:#800080; '>;</span>
 43:     <span style='color:#800080; '>}</span>
 44: <span style='color:#000000; background:#ffffff; '>    </span><span style='color:#800000; background:#ffffff; font-weight:bold; '>eval</span><span style='color:#000000; background:#ffffff; '> </span><span style='color:#800000; background:#ffffff; '>&lt;&lt;</span><span style='color:#e34adc; background:#ffffff; '>EndOfCleanup</span><span style='color:#800080; background:#ffffff; '>;</span><span style='color:#0000e6; '></span>
 45: <span style='color:#0000e6; '>    END {</span>
 46: <span style='color:#0000e6; '>        </span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>ENV{PATH} = '' if $Config</span><span style='color:#808030; '>{</span><span style='color:#0000e6; '>d_setenv</span><span style='color:#808030; '>}</span><span style='color:#0000e6; '>;</span>
 47: <span style='color:#0000e6; '>        warn "# Note: logical name 'PATH' may have been deleted</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>";</span>
 48: <span style='color:#0000e6; '>        </span><span style='color:#0f69ff; '>\@</span><span style='color:#0000e6; '>ENV{keys %old} = values %old;</span>
 49: <span style='color:#0000e6; '>    }</span>
 50: <span style='color:#e34adc; '>EndOfCleanup</span>
 51: <span style='color:#800080; '>}</span>
 52: 
 53: <span style='color:#696969; '># Sources of taint:</span>
 54: <span style='color:#696969; '>#   The empty tainted value, for tainting strings</span>
 55: <span style='color:#800000; font-weight:bold; '>my</span> $TAINT <span style='color:#808030; '>=</span> <span style='color:#400000; '>substr</span><span style='color:#808030; '>(</span>$^X<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 56: <span style='color:#696969; '>#   A tainted zero, useful for tainting numbers</span>
 57: <span style='color:#800000; font-weight:bold; '>my</span> $TAINT0 <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>+</span> $TAINT<span style='color:#800080; '>;</span>
 58: 
 59: <span style='color:#696969; '># This taints each argument passed. All must be lvalues.</span>
 60: <span style='color:#696969; '># Side effect: It also stringifies them. :-(</span>
 61: <span style='color:#800000; font-weight:bold; '>sub</span> taint_these <span style='color:#808030; '>(</span>@<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 62:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span>@_<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> $_ <span style='color:#808030; '>.</span><span style='color:#808030; '>=</span> $TAINT <span style='color:#800080; '>}</span>
 63: <span style='color:#800080; '>}</span>
 64: 
 65: <span style='color:#696969; '># How to identify taint when you see it</span>
 66: <span style='color:#800000; font-weight:bold; '>sub</span> any_tainted <span style='color:#808030; '>(</span>@<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 67:     <span style='color:#808030; '>not</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>join</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>""</span><span style='color:#808030; '>,</span>@_<span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#400000; '>kill</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> <span style='color:#008c00; '>1</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
 68: <span style='color:#800080; '>}</span>
 69: <span style='color:#800000; font-weight:bold; '>sub</span> tainted <span style='color:#808030; '>(</span>$<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 70:     any_tainted @_<span style='color:#800080; '>;</span>
 71: <span style='color:#800080; '>}</span>
 72: <span style='color:#800000; font-weight:bold; '>sub</span> all_tainted <span style='color:#808030; '>(</span>@<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 73:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span>@_<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#008c00; '>0</span> <span style='color:#800000; font-weight:bold; '>unless</span> tainted $_ <span style='color:#800080; '>}</span>
 74:     <span style='color:#008c00; '>1</span><span style='color:#800080; '>;</span>
 75: <span style='color:#800080; '>}</span>
 76: 
 77: <span style='color:#800000; font-weight:bold; '>sub</span> test <span style='color:#808030; '>(</span>$$<span style='color:#808030; '>;</span>$<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 78:     <span style='color:#800000; font-weight:bold; '>my</span><span style='color:#808030; '>(</span>$serial<span style='color:#808030; '>,</span> $boolean<span style='color:#808030; '>,</span> $diag<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> @_<span style='color:#800080; '>;</span>
 79:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$boolean<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 80:     <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok $serial</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 81:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
 82:     <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"not ok $serial</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 83:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>split</span> <span style='color:#800000; font-weight:bold; '>m</span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>m</span><span style='color:#808030; '>,</span> $diag<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
 84:         <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"# $_"</span><span style='color:#800080; '>;</span>
 85:     <span style='color:#800080; '>}</span>
 86:     <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800000; font-weight:bold; '>unless</span>
 87:         $diag <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span>
 88:         <span style='color:#808030; '>or</span> <span style='color:#400000; '>substr</span><span style='color:#808030; '>(</span>$diag<span style='color:#808030; '>,</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 89:     <span style='color:#800080; '>}</span>
 90: <span style='color:#800080; '>}</span>
 91: 
 92: <span style='color:#696969; '># We need an external program to call.</span>
 93: <span style='color:#800000; font-weight:bold; '>my</span> $ECHO <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span>$Is_MSWin32 <span style='color:#808030; '>?</span> <span style='color:#0000e6; '>".</span><span style='color:#0f69ff; '>\\</span><span style='color:#0000e6; '>echo</span><span style='color:#0000e6; '>$$</span><span style='color:#0000e6; '>"</span> <span style='color:#808030; '>:</span> <span style='color:#0000e6; '>"./echo</span><span style='color:#0000e6; '>$$</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
 94: <span style='color:#800000; font-weight:bold; '>END</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>unlink</span> $ECHO <span style='color:#800080; '>}</span>
 95: <span style='color:#400000; '>open</span> PROG<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"> $ECHO"</span> <span style='color:#808030; '>or</span> <span style='color:#800000; font-weight:bold; '>die</span> <span style='color:#0000e6; '>"Can't create $ECHO: </span><span style='color:#0000e6; '>$!</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 96: <span style='color:#800000; font-weight:bold; '>print</span> PROG <span style='color:#0000e6; '>'print "@ARGV\n"'</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
 97: <span style='color:#400000; '>close</span> PROG<span style='color:#800080; '>;</span>
 98: <span style='color:#800000; font-weight:bold; '>my</span> $echo <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"$Invoke_Perl $ECHO"</span><span style='color:#800080; '>;</span>
 99: 
100: <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"</span><span style='color:#008c00; '>1</span><span style='color:#0000e6; '>.</span><span style='color:#008000; '>.151</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
101: 
102: <span style='color:#696969; '># First, let's make sure that Perl is checking the dangerous</span>
103: <span style='color:#696969; '># environment variables. Maybe they aren't set yet, so we'll</span>
104: <span style='color:#696969; '># taint them ourselves.</span>
105: <span style='color:#800080; '>{</span>
106:     $ENV<span style='color:#808030; '>{</span><span style='color:#0000e6; '>'DCL$PATH'</span><span style='color:#808030; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>''</span> <span style='color:#800000; font-weight:bold; '>if</span> $Is_VMS<span style='color:#800080; '>;</span>
107: 
108:     $ENV<span style='color:#808030; '>{</span>PATH<span style='color:#808030; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>''</span><span style='color:#800080; '>;</span>
109:     <span style='color:#400000; '>delete</span> @ENV<span style='color:#808030; '>{</span>@MoreEnv<span style='color:#808030; '>}</span><span style='color:#800080; '>;</span>
110:     $ENV<span style='color:#808030; '>{</span>TERM<span style='color:#808030; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'dumb'</span><span style='color:#800080; '>;</span>
111: 
112:     test <span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#0000e6; background:#ffffe8; '>`</span><span style='color:#000000; background:#ffffe8; '>$echo </span><span style='color:#008c00; background:#ffffe8; '>1</span><span style='color:#0000e6; background:#ffffe8; '>`</span> <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>"</span><span style='color:#008c00; '>1</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
113: 
114:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$Is_MSWin32 <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> $Is_VMS <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> $Is_Dos<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
115:     <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"# Environment tainting tests skipped</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
116:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>..</span><span style='color:#008c00; '>5</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok $_</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800080; '>}</span>
117:     <span style='color:#800080; '>}</span>
118:     <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
119:     <span style='color:#800000; font-weight:bold; '>my</span> @vars <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span><span style='color:#0000e6; '>'PATH'</span><span style='color:#808030; '>,</span> @MoreEnv<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
120:     <span style='color:#800000; font-weight:bold; '>while</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>my</span> $v <span style='color:#808030; '>=</span> $vars<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
121:         <span style='color:#800000; font-weight:bold; '>local</span> $ENV<span style='color:#808030; '>{</span>$v<span style='color:#808030; '>}</span> <span style='color:#808030; '>=</span> $TAINT<span style='color:#800080; '>;</span>
122:         <span style='color:#800000; font-weight:bold; '>last</span> <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#0000e6; background:#ffffe8; '>`</span><span style='color:#000000; background:#ffffe8; '>$echo </span><span style='color:#008c00; background:#ffffe8; '>1</span><span style='color:#0000e6; background:#ffffe8; '>`</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
123:         <span style='color:#800000; font-weight:bold; '>last</span> <span style='color:#800000; font-weight:bold; '>unless</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure </span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>ENV{$v}</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
124:         <span style='color:#400000; '>shift</span> @vars<span style='color:#800080; '>;</span>
125:     <span style='color:#800080; '>}</span>
126:     test <span style='color:#008c00; '>2</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>!</span>@vars<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>$vars</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
127: 
128:     <span style='color:#696969; '># tainted $TERM is unsafe only if it contains metachars</span>
129:     <span style='color:#800000; font-weight:bold; '>local</span> $ENV<span style='color:#808030; '>{</span>TERM<span style='color:#808030; '>}</span><span style='color:#800080; '>;</span>
130:     $ENV<span style='color:#808030; '>{</span>TERM<span style='color:#808030; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'e=mc2'</span><span style='color:#800080; '>;</span>
131:     test <span style='color:#008c00; '>3</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#0000e6; background:#ffffe8; '>`</span><span style='color:#000000; background:#ffffe8; '>$echo </span><span style='color:#008c00; background:#ffffe8; '>1</span><span style='color:#0000e6; background:#ffffe8; '>`</span> <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>"</span><span style='color:#008c00; '>1</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
132:     $ENV<span style='color:#808030; '>{</span>TERM<span style='color:#808030; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'e=mc2'</span> <span style='color:#808030; '>.</span> $TAINT<span style='color:#800080; '>;</span>
133:     test <span style='color:#008c00; '>4</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#0000e6; background:#ffffe8; '>`</span><span style='color:#000000; background:#ffffe8; '>$echo </span><span style='color:#008c00; background:#ffffe8; '>1</span><span style='color:#0000e6; background:#ffffe8; '>`</span> <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#800080; '>;</span>
134:     test <span style='color:#008c00; '>5</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure </span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>ENV</span><span style='color:#808030; '>{</span><span style='color:#008c00; '>TERM</span><span style='color:#808030; '>}</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
135:     <span style='color:#800080; '>}</span>
136: 
137:     <span style='color:#800000; font-weight:bold; '>my</span> $tmp<span style='color:#800080; '>;</span>
138:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$^O <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'os2'</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> $^O <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'amigaos'</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> $Is_MSWin32 <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> $Is_Dos<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
139:     <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"# all directories are writeable</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
140:     <span style='color:#800080; '>}</span>
141:     <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
142:     $tmp <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>grep</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>defined</span> <span style='color:#808030; '>and</span> <span style='color:#800000; font-weight:bold; '>-d</span> <span style='color:#808030; '>and</span> <span style='color:#808030; '>(</span><span style='color:#400000; '>stat</span> _<span style='color:#808030; '>)</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span> <span style='color:#808030; '>&amp;</span> <span style='color:#008c00; '>2</span> <span style='color:#800080; '>}</span>
143:              <span style='color:#800000; font-weight:bold; '>qw</span><span style='color:#800000; '>(</span><span style='color:#0000e6; '>sys$scratch /tmp /var/tmp /usr/tmp</span><span style='color:#800000; '>)</span><span style='color:#808030; '>,</span>
144:              @ENV<span style='color:#808030; '>{</span><span style='color:#800000; font-weight:bold; '>qw</span><span style='color:#800000; '>(</span><span style='color:#0000e6; '>TMP TEMP</span><span style='color:#800000; '>)</span><span style='color:#808030; '>}</span><span style='color:#808030; '>)</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span>
145:         <span style='color:#808030; '>or</span> <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"# can't find world-writeable directory to test PATH</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
146:     <span style='color:#800080; '>}</span>
147: 
148:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$tmp<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
149:     <span style='color:#800000; font-weight:bold; '>local</span> $ENV<span style='color:#808030; '>{</span>PATH<span style='color:#808030; '>}</span> <span style='color:#808030; '>=</span> $tmp<span style='color:#800080; '>;</span>
150:     test <span style='color:#008c00; '>6</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#0000e6; background:#ffffe8; '>`</span><span style='color:#000000; background:#ffffe8; '>$echo </span><span style='color:#008c00; background:#ffffe8; '>1</span><span style='color:#0000e6; background:#ffffe8; '>`</span> <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#800080; '>;</span>
151:     test <span style='color:#008c00; '>7</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure directory in </span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>ENV</span><span style='color:#808030; '>{</span><span style='color:#008c00; '>PATH</span><span style='color:#808030; '>}</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
152:     <span style='color:#800080; '>}</span>
153:     <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
154:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>6</span><span style='color:#808030; '>..</span><span style='color:#008c00; '>7</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok $_ # Skipped: all directories are writeable</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800080; '>}</span>
155:     <span style='color:#800080; '>}</span>
156: 
157:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$Is_VMS<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
158:     $ENV<span style='color:#808030; '>{</span><span style='color:#0000e6; '>'DCL$PATH'</span><span style='color:#808030; '>}</span> <span style='color:#808030; '>=</span> $TAINT<span style='color:#800080; '>;</span>
159:     test <span style='color:#008c00; '>8</span><span style='color:#808030; '>,</span>  <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#0000e6; background:#ffffe8; '>`</span><span style='color:#000000; background:#ffffe8; '>$echo </span><span style='color:#008c00; background:#ffffe8; '>1</span><span style='color:#0000e6; background:#ffffe8; '>`</span> <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#800080; '>;</span>
160:     test <span style='color:#008c00; '>9</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure </span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>ENV{DCL</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>PATH}</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
161:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$tmp<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
162:         $ENV<span style='color:#808030; '>{</span><span style='color:#0000e6; '>'DCL$PATH'</span><span style='color:#808030; '>}</span> <span style='color:#808030; '>=</span> $tmp<span style='color:#800080; '>;</span>
163:         test <span style='color:#008c00; '>10</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#0000e6; background:#ffffe8; '>`</span><span style='color:#000000; background:#ffffe8; '>$echo </span><span style='color:#008c00; background:#ffffe8; '>1</span><span style='color:#0000e6; background:#ffffe8; '>`</span> <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#800080; '>;</span>
164:         test <span style='color:#008c00; '>11</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure directory in </span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>ENV{DCL</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>PATH}</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
165:     <span style='color:#800080; '>}</span>
166:     <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
167:         <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>10</span><span style='color:#808030; '>..</span><span style='color:#008c00; '>11</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok $_ # Skipped: can't find world-writeable directory to test DCL</span><span style='color:#0f69ff; '>\$</span><span style='color:#0000e6; '>PATH</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800080; '>}</span>
168:     <span style='color:#800080; '>}</span>
169:     $ENV<span style='color:#808030; '>{</span><span style='color:#0000e6; '>'DCL$PATH'</span><span style='color:#808030; '>}</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>''</span><span style='color:#800080; '>;</span>
170:     <span style='color:#800080; '>}</span>
171:     <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
172:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>8</span><span style='color:#808030; '>..</span><span style='color:#008c00; '>11</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok $_ # Skipped: This is not VMS</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span>
173:     <span style='color:#800080; '>}</span>
174: <span style='color:#800080; '>}</span>
175: 
176: <span style='color:#696969; '># Let's see that we can taint and untaint as needed.</span>
177: <span style='color:#800080; '>{</span>
178:     <span style='color:#800000; font-weight:bold; '>my</span> $foo <span style='color:#808030; '>=</span> $TAINT<span style='color:#800080; '>;</span>
179:     test <span style='color:#008c00; '>12</span><span style='color:#808030; '>,</span> tainted $foo<span style='color:#800080; '>;</span>
180: 
181:     <span style='color:#696969; '># That was a sanity check. If it failed, stop the insanity!</span>
182:     <span style='color:#800000; font-weight:bold; '>die</span> <span style='color:#0000e6; '>"Taint checks don't seem to be enabled"</span> <span style='color:#800000; font-weight:bold; '>unless</span> tainted $foo<span style='color:#800080; '>;</span>
183: 
184:     $foo <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"foo"</span><span style='color:#800080; '>;</span>
185:     test <span style='color:#008c00; '>13</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted $foo<span style='color:#800080; '>;</span>
186: 
187:     taint_these<span style='color:#808030; '>(</span>$foo<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
188:     test <span style='color:#008c00; '>14</span><span style='color:#808030; '>,</span> tainted $foo<span style='color:#800080; '>;</span>
189: 
190:     <span style='color:#800000; font-weight:bold; '>my</span> @list <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>..</span><span style='color:#008c00; '>10</span><span style='color:#800080; '>;</span>
191:     test <span style='color:#008c00; '>15</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> any_tainted @list<span style='color:#800080; '>;</span>
192:     taint_these @list<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>5</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>7</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>9</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
193:     test <span style='color:#008c00; '>16</span><span style='color:#808030; '>,</span> any_tainted @list<span style='color:#800080; '>;</span>
194:     test <span style='color:#008c00; '>17</span><span style='color:#808030; '>,</span> all_tainted @list<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>5</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>7</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>9</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
195:     test <span style='color:#008c00; '>18</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> any_tainted @list<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>4</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>6</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>8</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
196: 
197:     <span style='color:#808030; '>(</span>$foo<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> $foo <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
198:     test <span style='color:#008c00; '>19</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted $foo<span style='color:#800080; '>;</span>
199: 
200:     $foo <span style='color:#808030; '>=</span> $1 <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#0000e6; '>'bar'</span> <span style='color:#808030; '>.</span> $TAINT<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
201:     test <span style='color:#008c00; '>20</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted $foo<span style='color:#800080; '>;</span>
202:     test <span style='color:#008c00; '>21</span><span style='color:#808030; '>,</span> $foo <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'bar'</span><span style='color:#800080; '>;</span>
203: 
204:     <span style='color:#800080; '>{</span>
205:       <span style='color:#800000; font-weight:bold; '>use</span> re <span style='color:#0000e6; '>'taint'</span><span style='color:#800080; '>;</span>
206: 
207:       <span style='color:#808030; '>(</span>$foo<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span><span style='color:#0000e6; '>'bar'</span> <span style='color:#808030; '>.</span> $TAINT<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
208:       test <span style='color:#008c00; '>22</span><span style='color:#808030; '>,</span> tainted $foo<span style='color:#800080; '>;</span>
209:       test <span style='color:#008c00; '>23</span><span style='color:#808030; '>,</span> $foo <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'bar'</span><span style='color:#800080; '>;</span>
210: 
211:       $foo <span style='color:#808030; '>=</span> $1 <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#0000e6; '>'bar'</span> <span style='color:#808030; '>.</span> $TAINT<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
212:       test <span style='color:#008c00; '>24</span><span style='color:#808030; '>,</span> tainted $foo<span style='color:#800080; '>;</span>
213:       test <span style='color:#008c00; '>25</span><span style='color:#808030; '>,</span> $foo <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'bar'</span><span style='color:#800080; '>;</span>
214:     <span style='color:#800080; '>}</span>
215: 
216:     $foo <span style='color:#808030; '>=</span> $1 <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#0000e6; '>'bar'</span> <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#0000e6; '>$TAINT</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
217:     test <span style='color:#008c00; '>26</span><span style='color:#808030; '>,</span> tainted $foo<span style='color:#800080; '>;</span>
218:     test <span style='color:#008c00; '>27</span><span style='color:#808030; '>,</span> $foo <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'bar'</span><span style='color:#800080; '>;</span>
219: 
220:     <span style='color:#800000; font-weight:bold; '>my</span> $pi <span style='color:#808030; '>=</span> <span style='color:#008c00; '>4</span> <span style='color:#808030; '>*</span> <span style='color:#400000; '>atan2</span><span style='color:#808030; '>(</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>+</span> $TAINT0<span style='color:#800080; '>;</span>
221:     test <span style='color:#008c00; '>28</span><span style='color:#808030; '>,</span> tainted $pi<span style='color:#800080; '>;</span>
222: 
223:     <span style='color:#808030; '>(</span>$pi<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> $pi <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>\d</span><span style='color:#808030; '>+</span><span style='color:#0f69ff; '>\.</span><span style='color:#0000e6; '>\d</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
224:     test <span style='color:#008c00; '>29</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted $pi<span style='color:#800080; '>;</span>
225:     test <span style='color:#008c00; '>30</span><span style='color:#808030; '>,</span> <span style='color:#400000; '>sprintf</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#007997; '>%</span><span style='color:#808030; '>.</span><span style='color:#007997; '>5f</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>,</span> $pi<span style='color:#808030; '>)</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'3.14159'</span><span style='color:#800080; '>;</span>
226: <span style='color:#800080; '>}</span>
227: 
228: <span style='color:#696969; '># How about command-line arguments? The problem is that we don't</span>
229: <span style='color:#696969; '># always get some, so we'll run another process with some.</span>
230: <span style='color:#800080; '>{</span>
231:     <span style='color:#800000; font-weight:bold; '>my</span> $arg <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"./arg</span><span style='color:#0000e6; '>$$</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
232:     <span style='color:#400000; '>open</span> PROG<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"> $arg"</span> <span style='color:#808030; '>or</span> <span style='color:#800000; font-weight:bold; '>die</span> <span style='color:#0000e6; '>"Can't create $arg: </span><span style='color:#0000e6; '>$!</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
233:     <span style='color:#800000; font-weight:bold; '>print</span> PROG <span style='color:#800000; font-weight:bold; '>q</span><span style='color:#800000; '>{</span><span style='color:#0000e6; '></span>
234: <span style='color:#0000e6; '>    eval { join('', @ARGV), kill 0 };</span>
235: <span style='color:#0000e6; '>    exit 0 if $@ =~ /^Insecure dependency/;</span>
236: <span style='color:#0000e6; '>    print "# Oops: \$@ was [$@]\n";</span>
237: <span style='color:#0000e6; '>    exit 1;</span>
238: <span style='color:#0000e6; '>    </span><span style='color:#800000; '>}</span><span style='color:#800080; '>;</span>
239:     <span style='color:#400000; '>close</span> PROG<span style='color:#800080; '>;</span>
240:     <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; background:#ffffe8; '>`</span><span style='color:#000000; background:#ffffe8; '>$Invoke_Perl "-T" $arg and some suspect arguments</span><span style='color:#0000e6; background:#ffffe8; '>`</span><span style='color:#800080; '>;</span>
241:     test <span style='color:#008c00; '>31</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>!</span>$?<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"Exited with status </span><span style='color:#0000e6; '>$?</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
242:     <span style='color:#400000; '>unlink</span> $arg<span style='color:#800080; '>;</span>
243: <span style='color:#800080; '>}</span>
244: 
245: <span style='color:#696969; '># Reading from a file should be tainted</span>
246: <span style='color:#800080; '>{</span>
247:     <span style='color:#800000; font-weight:bold; '>my</span> $file <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'./TEST'</span><span style='color:#800080; '>;</span>
248:     test <span style='color:#008c00; '>32</span><span style='color:#808030; '>,</span> <span style='color:#400000; '>open</span><span style='color:#808030; '>(</span>FILE<span style='color:#808030; '>,</span> $file<span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"Couldn't open '$file': </span><span style='color:#0000e6; '>$!</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
249: 
250:     <span style='color:#800000; font-weight:bold; '>my</span> $block<span style='color:#800080; '>;</span>
251:     <span style='color:#400000; '>sysread</span><span style='color:#808030; '>(</span>FILE<span style='color:#808030; '>,</span> $block<span style='color:#808030; '>,</span> <span style='color:#008c00; '>100</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
252:     <span style='color:#800000; font-weight:bold; '>my</span> $line <span style='color:#808030; '>=</span> <span style='color:#40015a; '>&lt;FILE></span><span style='color:#800080; '>;</span>
253:     <span style='color:#400000; '>close</span> FILE<span style='color:#800080; '>;</span>
254:     test <span style='color:#008c00; '>33</span><span style='color:#808030; '>,</span> tainted $block<span style='color:#800080; '>;</span>
255:     test <span style='color:#008c00; '>34</span><span style='color:#808030; '>,</span> tainted $line<span style='color:#800080; '>;</span>
256: <span style='color:#800080; '>}</span>
257: 
258: <span style='color:#696969; '># Globs should be forbidden, except under VMS,</span>
259: <span style='color:#696969; '>#   which doesn't spawn an external program.</span>
260: <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>1</span>  <span style='color:#696969; '># built-in glob</span>
261:     <span style='color:#808030; '>or</span> $Is_VMS<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
262:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>35</span><span style='color:#808030; '>..</span><span style='color:#008c00; '>36</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok $_</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span>
263: <span style='color:#800080; '>}</span>
264: <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
265:     <span style='color:#800000; font-weight:bold; '>my</span> @globs <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#40015a; '>&lt;</span><span style='color:#808030; '>*</span><span style='color:#40015a; '>></span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
266:     test <span style='color:#008c00; '>35</span><span style='color:#808030; '>,</span> @globs <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
267: 
268:     @globs <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>glob</span> <span style='color:#0000e6; '>'*'</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
269:     test <span style='color:#008c00; '>36</span><span style='color:#808030; '>,</span> @globs <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
270: <span style='color:#800080; '>}</span>
271: 
272: <span style='color:#696969; '># Output of commands should be tainted</span>
273: <span style='color:#800080; '>{</span>
274:     <span style='color:#800000; font-weight:bold; '>my</span> $foo <span style='color:#808030; '>=</span> <span style='color:#0000e6; background:#ffffe8; '>`</span><span style='color:#000000; background:#ffffe8; '>$echo abc</span><span style='color:#0000e6; background:#ffffe8; '>`</span><span style='color:#800080; '>;</span>
275:     test <span style='color:#008c00; '>37</span><span style='color:#808030; '>,</span> tainted $foo<span style='color:#800080; '>;</span>
276: <span style='color:#800080; '>}</span>
277: 
278: <span style='color:#696969; '># Certain system variables should be tainted</span>
279: <span style='color:#800080; '>{</span>
280:     test <span style='color:#008c00; '>38</span><span style='color:#808030; '>,</span> all_tainted $^X<span style='color:#808030; '>,</span> $0<span style='color:#800080; '>;</span>
281: <span style='color:#800080; '>}</span>
282: 
283: <span style='color:#696969; '># Results of matching should all be untainted</span>
284: <span style='color:#800080; '>{</span>
285:     <span style='color:#800000; font-weight:bold; '>my</span> $foo <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"abcdefghi"</span> <span style='color:#808030; '>.</span> $TAINT<span style='color:#800080; '>;</span>
286:     test <span style='color:#008c00; '>39</span><span style='color:#808030; '>,</span> tainted $foo<span style='color:#800080; '>;</span>
287: 
288:     $foo <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>def</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
289:     test <span style='color:#008c00; '>40</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> any_tainted $`<span style='color:#808030; '>,</span> $&amp;<span style='color:#808030; '>,</span> $'<span style='color:#800080; '>;</span>
290: 
291:     $foo <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>.</span><span style='color:#808030; '>.</span><span style='color:#808030; '>)</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>.</span><span style='color:#808030; '>.</span><span style='color:#808030; '>)</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>.</span><span style='color:#808030; '>.</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
292:     test <span style='color:#008c00; '>41</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> any_tainted $1<span style='color:#808030; '>,</span> $2<span style='color:#808030; '>,</span> $3<span style='color:#808030; '>,</span> $+<span style='color:#800080; '>;</span>
293: 
294:     <span style='color:#800000; font-weight:bold; '>my</span> @bar <span style='color:#808030; '>=</span> $foo <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>.</span><span style='color:#808030; '>.</span><span style='color:#808030; '>)</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>.</span><span style='color:#808030; '>.</span><span style='color:#808030; '>)</span><span style='color:#808030; '>(</span><span style='color:#808030; '>.</span><span style='color:#808030; '>.</span><span style='color:#808030; '>.</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
295:     test <span style='color:#008c00; '>42</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> any_tainted @bar<span style='color:#800080; '>;</span>
296: 
297:     test <span style='color:#008c00; '>43</span><span style='color:#808030; '>,</span> tainted $foo<span style='color:#800080; '>;</span>    <span style='color:#696969; '># $foo should still be tainted!</span>
298:     test <span style='color:#008c00; '>44</span><span style='color:#808030; '>,</span> $foo <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>"abcdefghi"</span><span style='color:#800080; '>;</span>
299: <span style='color:#800080; '>}</span>
300: 
301: <span style='color:#696969; '># Operations which affect files can't use tainted data.</span>
302: <span style='color:#800080; '>{</span>
303:     test <span style='color:#008c00; '>45</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>chmod</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> $TAINT <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'chmod'</span><span style='color:#800080; '>;</span>
304:     test <span style='color:#008c00; '>46</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
305: 
306:     <span style='color:#696969; '># There is no feature test in $Config{} for truncate,</span>
307:     <span style='color:#696969; '>#   so we allow for the possibility that it's missing.</span>
308:     test <span style='color:#008c00; '>47</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>truncate</span> <span style='color:#0000e6; '>'NoSuChFiLe'</span><span style='color:#808030; '>,</span> $TAINT0 <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'truncate'</span><span style='color:#800080; '>;</span>
309:     test <span style='color:#008c00; '>48</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>?</span><span style='color:#800000; font-weight:bold; '>:</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800080; '>|</span><span style='color:#0000e6; '>truncate not implemented</span><span style='color:#808030; '>)</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
310: 
311:     test <span style='color:#008c00; '>49</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>rename</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> $TAINT <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'rename'</span><span style='color:#800080; '>;</span>
312:     test <span style='color:#008c00; '>50</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
313: 
314:     test <span style='color:#008c00; '>51</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>unlink</span> $TAINT <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'unlink'</span><span style='color:#800080; '>;</span>
315:     test <span style='color:#008c00; '>52</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
316: 
317:     test <span style='color:#008c00; '>53</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>utime</span> $TAINT <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'utime'</span><span style='color:#800080; '>;</span>
318:     test <span style='color:#008c00; '>54</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
319: 
320:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$Config<span style='color:#808030; '>{</span>d_chown<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
321:     test <span style='color:#008c00; '>55</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>chown</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>,</span> $TAINT <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'chown'</span><span style='color:#800080; '>;</span>
322:     test <span style='color:#008c00; '>56</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
323:     <span style='color:#800080; '>}</span>
324:     <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
325:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>55</span><span style='color:#808030; '>..</span><span style='color:#008c00; '>56</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok $_ # Skipped: chown() is not available</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800080; '>}</span>
326:     <span style='color:#800080; '>}</span>
327: 
328:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$Config<span style='color:#808030; '>{</span>d_link<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
329:     test <span style='color:#008c00; '>57</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>link</span> $TAINT<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>''</span> <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'link'</span><span style='color:#800080; '>;</span>
330:     test <span style='color:#008c00; '>58</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
331:     <span style='color:#800080; '>}</span>
332:     <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
333:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>57</span><span style='color:#808030; '>..</span><span style='color:#008c00; '>58</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok $_ # Skipped: link() is not available</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800080; '>}</span>
334:     <span style='color:#800080; '>}</span>
335: 
336:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$Config<span style='color:#808030; '>{</span>d_symlink<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
337:     test <span style='color:#008c00; '>59</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>symlink</span> $TAINT<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>''</span> <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'symlink'</span><span style='color:#800080; '>;</span>
338:     test <span style='color:#008c00; '>60</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
339:     <span style='color:#800080; '>}</span>
340:     <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
341:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>59</span><span style='color:#808030; '>..</span><span style='color:#008c00; '>60</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok $_ # Skipped: symlink() is not available</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800080; '>}</span>
342:     <span style='color:#800080; '>}</span>
343: <span style='color:#800080; '>}</span>
344: 
345: <span style='color:#696969; '># Operations which affect directories can't use tainted data.</span>
346: <span style='color:#800080; '>{</span>
347:     test <span style='color:#008c00; '>61</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>mkdir</span> $TAINT0<span style='color:#808030; '>,</span> $TAINT <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'mkdir'</span><span style='color:#800080; '>;</span>
348:     test <span style='color:#008c00; '>62</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
349: 
350:     test <span style='color:#008c00; '>63</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>rmdir</span> $TAINT <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'rmdir'</span><span style='color:#800080; '>;</span>
351:     test <span style='color:#008c00; '>64</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
352: 
353:     test <span style='color:#008c00; '>65</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>chdir</span> $TAINT <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'chdir'</span><span style='color:#800080; '>;</span>
354:     test <span style='color:#008c00; '>66</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
355: 
356:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$Config<span style='color:#808030; '>{</span>d_chroot<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
357:     test <span style='color:#008c00; '>67</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>chroot</span> $TAINT <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'chroot'</span><span style='color:#800080; '>;</span>
358:     test <span style='color:#008c00; '>68</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
359:     <span style='color:#800080; '>}</span>
360:     <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
361:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>67</span><span style='color:#808030; '>..</span><span style='color:#008c00; '>68</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok $_ # Skipped: chroot() is not available</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800080; '>}</span>
362:     <span style='color:#800080; '>}</span>
363: <span style='color:#800080; '>}</span>
364: 
365: <span style='color:#696969; '># Some operations using files can't use tainted data.</span>
366: <span style='color:#800080; '>{</span>
367:     <span style='color:#800000; font-weight:bold; '>my</span> $foo <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"imaginary library"</span> <span style='color:#808030; '>.</span> $TAINT<span style='color:#800080; '>;</span>
368:     test <span style='color:#008c00; '>69</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>require</span> $foo <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'require'</span><span style='color:#800080; '>;</span>
369:     test <span style='color:#008c00; '>70</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
370: 
371:     <span style='color:#800000; font-weight:bold; '>my</span> $filename <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"./taintB</span><span style='color:#0000e6; '>$$</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>    <span style='color:#696969; '># NB: $filename isn't tainted!</span>
372:     <span style='color:#800000; font-weight:bold; '>END</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>unlink</span> $filename <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#800000; font-weight:bold; '>defined</span> $filename <span style='color:#800080; '>}</span>
373:     $foo <span style='color:#808030; '>=</span> $filename <span style='color:#808030; '>.</span> $TAINT<span style='color:#800080; '>;</span>
374:     <span style='color:#400000; '>unlink</span> $filename<span style='color:#800080; '>;</span>    <span style='color:#696969; '># in any case</span>
375: 
376:     test <span style='color:#008c00; '>71</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>open</span> FOO<span style='color:#808030; '>,</span> $foo <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'open for read'</span><span style='color:#800080; '>;</span>
377:     test <span style='color:#008c00; '>72</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>        <span style='color:#696969; '># NB: This should be allowed</span>
378: 
379:     <span style='color:#696969; '># Try first new style but allow also old style.</span>
380:     test <span style='color:#008c00; '>73</span><span style='color:#808030; '>,</span> $!<span style='color:#800080; '>{</span>ENOENT<span style='color:#800080; '>}</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span>
381:     $! <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>2</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#696969; '># File not found</span>
382:     <span style='color:#808030; '>(</span>$Is_Dos <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> $! <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>22</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span>
383:     <span style='color:#808030; '>(</span>$^O <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'mint'</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> $! <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>33</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
384: 
385:     test <span style='color:#008c00; '>74</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>open</span> FOO<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"> $foo"</span> <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'open for write'</span><span style='color:#800080; '>;</span>
386:     test <span style='color:#008c00; '>75</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
387: <span style='color:#800080; '>}</span>
388: 
389: <span style='color:#696969; '># Commands to the system can't use tainted data</span>
390: <span style='color:#800080; '>{</span>
391:     <span style='color:#800000; font-weight:bold; '>my</span> $foo <span style='color:#808030; '>=</span> $TAINT<span style='color:#800080; '>;</span>
392: 
393:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$^O <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>'amigaos'</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
394:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>76</span><span style='color:#808030; '>..</span><span style='color:#008c00; '>79</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok $_ # Skipped: open('|') is not available</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800080; '>}</span>
395:     <span style='color:#800080; '>}</span>
396:     <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
397:     test <span style='color:#008c00; '>76</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>open</span> FOO<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"| x$foo"</span> <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'popen to'</span><span style='color:#800080; '>;</span>
398:     test <span style='color:#008c00; '>77</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
399: 
400:     test <span style='color:#008c00; '>78</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>open</span> FOO<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"x$foo |"</span> <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'popen from'</span><span style='color:#800080; '>;</span>
401:     test <span style='color:#008c00; '>79</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
402:     <span style='color:#800080; '>}</span>
403: 
404:     test <span style='color:#008c00; '>80</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>exec</span> $TAINT <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'exec'</span><span style='color:#800080; '>;</span>
405:     test <span style='color:#008c00; '>81</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
406: 
407:     test <span style='color:#008c00; '>82</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>system</span> $TAINT <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'system'</span><span style='color:#800080; '>;</span>
408:     test <span style='color:#008c00; '>83</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
409: 
410:     $foo <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"*"</span><span style='color:#800080; '>;</span>
411:     taint_these $foo<span style='color:#800080; '>;</span>
412: 
413:     test <span style='color:#008c00; '>84</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#0000e6; background:#ffffe8; '>`</span><span style='color:#000000; background:#ffffe8; '>$echo </span><span style='color:#008c00; background:#ffffe8; '>1</span><span style='color:#000000; background:#ffffe8; '>$foo</span><span style='color:#0000e6; background:#ffffe8; '>`</span> <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'backticks'</span><span style='color:#800080; '>;</span>
414:     test <span style='color:#008c00; '>85</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
415: 
416:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$Is_VMS<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#696969; '># wildcard expansion doesn't invoke shell, so is safe</span>
417:     test <span style='color:#008c00; '>86</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>join</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>glob</span> $foo <span style='color:#800080; '>}</span> <span style='color:#808030; '>)</span> <span style='color:#808030; '>ne</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'globbing'</span><span style='color:#800080; '>;</span>
418:     test <span style='color:#008c00; '>87</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
419:     <span style='color:#800080; '>}</span>
420:     <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
421:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>86</span><span style='color:#808030; '>..</span><span style='color:#008c00; '>87</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok $_ # Skipped: this is not VMS</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span>
422:     <span style='color:#800080; '>}</span>
423: <span style='color:#800080; '>}</span>
424: 
425: <span style='color:#696969; '># Operations which affect processes can't use tainted data.</span>
426: <span style='color:#800080; '>{</span>
427:     test <span style='color:#008c00; '>88</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>kill</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> $TAINT <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'kill'</span><span style='color:#800080; '>;</span>
428:     test <span style='color:#008c00; '>89</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
429: 
430:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$Config<span style='color:#808030; '>{</span>d_setpgrp<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
431:     test <span style='color:#008c00; '>90</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>setpgrp</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> $TAINT <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'setpgrp'</span><span style='color:#800080; '>;</span>
432:     test <span style='color:#008c00; '>91</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
433:     <span style='color:#800080; '>}</span>
434:     <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
435:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>90</span><span style='color:#808030; '>..</span><span style='color:#008c00; '>91</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok $_ # Skipped: setpgrp() is not available</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800080; '>}</span>
436:     <span style='color:#800080; '>}</span>
437: 
438:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$Config<span style='color:#808030; '>{</span>d_setprior<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
439:     test <span style='color:#008c00; '>92</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>setpriority</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> $TAINT<span style='color:#808030; '>,</span> $TAINT <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'setpriority'</span><span style='color:#800080; '>;</span>
440:     test <span style='color:#008c00; '>93</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
441:     <span style='color:#800080; '>}</span>
442:     <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
443:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>92</span><span style='color:#808030; '>..</span><span style='color:#008c00; '>93</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok $_ # Skipped: setpriority() is not available</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800080; '>}</span>
444:     <span style='color:#800080; '>}</span>
445: <span style='color:#800080; '>}</span>
446: 
447: <span style='color:#696969; '># Some miscellaneous operations can't use tainted data.</span>
448: <span style='color:#800080; '>{</span>
449:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$Config<span style='color:#808030; '>{</span>d_syscall<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
450:     test <span style='color:#008c00; '>94</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>syscall</span> $TAINT <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'syscall'</span><span style='color:#800080; '>;</span>
451:     test <span style='color:#008c00; '>95</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
452:     <span style='color:#800080; '>}</span>
453:     <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
454:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>94</span><span style='color:#808030; '>..</span><span style='color:#008c00; '>95</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok $_ # Skipped: syscall() is not available</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800080; '>}</span>
455:     <span style='color:#800080; '>}</span>
456: 
457:     <span style='color:#800080; '>{</span>
458:     <span style='color:#800000; font-weight:bold; '>my</span> $foo <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"x"</span> <span style='color:#808030; '>x</span> <span style='color:#008c00; '>979</span><span style='color:#800080; '>;</span>
459:     taint_these $foo<span style='color:#800080; '>;</span>
460:     <span style='color:#800000; font-weight:bold; '>local</span> *FOO<span style='color:#800080; '>;</span>
461:     <span style='color:#800000; font-weight:bold; '>my</span> $temp <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"./taintC</span><span style='color:#0000e6; '>$$</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
462:     <span style='color:#800000; font-weight:bold; '>END</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>unlink</span> $temp <span style='color:#800080; '>}</span>
463:     test <span style='color:#008c00; '>96</span><span style='color:#808030; '>,</span> <span style='color:#400000; '>open</span><span style='color:#808030; '>(</span>FOO<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"> $temp"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"Couldn't open $temp for write: </span><span style='color:#0000e6; '>$!</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
464: 
465:     test <span style='color:#008c00; '>97</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>ioctl</span> FOO<span style='color:#808030; '>,</span> $TAINT<span style='color:#808030; '>,</span> $foo <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'ioctl'</span><span style='color:#800080; '>;</span>
466:     test <span style='color:#008c00; '>98</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
467: 
468:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$Config<span style='color:#808030; '>{</span>d_fcntl<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
469:         test <span style='color:#008c00; '>99</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>fcntl</span> FOO<span style='color:#808030; '>,</span> $TAINT<span style='color:#808030; '>,</span> $foo <span style='color:#800080; '>}</span> <span style='color:#808030; '>eq</span> <span style='color:#0000e6; '>''</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>'fcntl'</span><span style='color:#800080; '>;</span>
470:         test <span style='color:#008c00; '>100</span><span style='color:#808030; '>,</span> $@ <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#808030; '>^</span><span style='color:#0000e6; '>Insecure dependency</span><span style='color:#800000; '>/</span><span style='color:#808030; '>,</span> $@<span style='color:#800080; '>;</span>
471:     <span style='color:#800080; '>}</span>
472:     <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
473:         <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>99</span><span style='color:#808030; '>..</span><span style='color:#008c00; '>100</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok $_ # Skipped: fcntl() is not available</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800080; '>}</span>
474:     <span style='color:#800080; '>}</span>
475: 
476:     <span style='color:#400000; '>close</span> FOO<span style='color:#800080; '>;</span>
477:     <span style='color:#800080; '>}</span>
478: <span style='color:#800080; '>}</span>
479: 
480: <span style='color:#696969; '># Some tests involving references</span>
481: <span style='color:#800080; '>{</span>
482:     <span style='color:#800000; font-weight:bold; '>my</span> $foo <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>'abc'</span> <span style='color:#808030; '>.</span> $TAINT<span style='color:#800080; '>;</span>
483:     <span style='color:#800000; font-weight:bold; '>my</span> $fooref <span style='color:#808030; '>=</span> <span style='color:#808030; '>\</span>$foo<span style='color:#800080; '>;</span>
484:     test <span style='color:#008c00; '>101</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted $fooref<span style='color:#800080; '>;</span>
485:     test <span style='color:#008c00; '>102</span><span style='color:#808030; '>,</span> tainted $$fooref<span style='color:#800080; '>;</span>
486:     test <span style='color:#008c00; '>103</span><span style='color:#808030; '>,</span> tainted $foo<span style='color:#800080; '>;</span>
487: <span style='color:#800080; '>}</span>
488: 
489: <span style='color:#696969; '># Some tests involving assignment</span>
490: <span style='color:#800080; '>{</span>
491:     <span style='color:#800000; font-weight:bold; '>my</span> $foo <span style='color:#808030; '>=</span> $TAINT0<span style='color:#800080; '>;</span>
492:     <span style='color:#800000; font-weight:bold; '>my</span> $bar <span style='color:#808030; '>=</span> $foo<span style='color:#800080; '>;</span>
493:     test <span style='color:#008c00; '>104</span><span style='color:#808030; '>,</span> all_tainted $foo<span style='color:#808030; '>,</span> $bar<span style='color:#800080; '>;</span>
494:     test <span style='color:#008c00; '>105</span><span style='color:#808030; '>,</span> tainted<span style='color:#808030; '>(</span>$foo <span style='color:#808030; '>=</span> $bar<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
495:     test <span style='color:#008c00; '>106</span><span style='color:#808030; '>,</span> tainted<span style='color:#808030; '>(</span>$bar <span style='color:#808030; '>=</span> $bar<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
496:     test <span style='color:#008c00; '>107</span><span style='color:#808030; '>,</span> tainted<span style='color:#808030; '>(</span>$bar <span style='color:#808030; '>+</span><span style='color:#808030; '>=</span> $bar<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
497:     test <span style='color:#008c00; '>108</span><span style='color:#808030; '>,</span> tainted<span style='color:#808030; '>(</span>$bar <span style='color:#808030; '>-</span><span style='color:#808030; '>=</span> $bar<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
498:     test <span style='color:#008c00; '>109</span><span style='color:#808030; '>,</span> tainted<span style='color:#808030; '>(</span>$bar <span style='color:#808030; '>*</span><span style='color:#808030; '>=</span> $bar<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
499:     test <span style='color:#008c00; '>110</span><span style='color:#808030; '>,</span> tainted<span style='color:#808030; '>(</span>$bar<span style='color:#808030; '>+</span><span style='color:#808030; '>+</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
500:     test <span style='color:#008c00; '>111</span><span style='color:#808030; '>,</span> tainted<span style='color:#808030; '>(</span>$bar <span style='color:#808030; '>/</span><span style='color:#808030; '>=</span> $bar<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
501:     test <span style='color:#008c00; '>112</span><span style='color:#808030; '>,</span> tainted<span style='color:#808030; '>(</span>$bar <span style='color:#808030; '>+</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
502:     test <span style='color:#008c00; '>113</span><span style='color:#808030; '>,</span> tainted<span style='color:#808030; '>(</span>$bar <span style='color:#808030; '>-</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
503:     test <span style='color:#008c00; '>114</span><span style='color:#808030; '>,</span> tainted<span style='color:#808030; '>(</span>$bar <span style='color:#808030; '>*</span><span style='color:#808030; '>=</span> <span style='color:#808030; '>-</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
504:     test <span style='color:#008c00; '>115</span><span style='color:#808030; '>,</span> tainted<span style='color:#808030; '>(</span>$bar <span style='color:#808030; '>/</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
505:     test <span style='color:#008c00; '>116</span><span style='color:#808030; '>,</span> tainted<span style='color:#808030; '>(</span>$bar<span style='color:#808030; '>-</span><span style='color:#808030; '>-</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
506:     test <span style='color:#008c00; '>117</span><span style='color:#808030; '>,</span> $bar <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span>
507: <span style='color:#800080; '>}</span>
508: 
509: <span style='color:#696969; '># Test assignment and return of lists</span>
510: <span style='color:#800080; '>{</span>
511:     <span style='color:#800000; font-weight:bold; '>my</span> @foo <span style='color:#808030; '>=</span> <span style='color:#808030; '>(</span><span style='color:#0000e6; '>"A"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"tainted"</span> <span style='color:#808030; '>.</span> $TAINT<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"B"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
512:     test <span style='color:#008c00; '>118</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted $foo<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
513:     test <span style='color:#008c00; '>119</span><span style='color:#808030; '>,</span>     tainted $foo<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
514:     test <span style='color:#008c00; '>120</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted $foo<span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
515:     <span style='color:#800000; font-weight:bold; '>my</span> @bar <span style='color:#808030; '>=</span> @foo<span style='color:#800080; '>;</span>
516:     test <span style='color:#008c00; '>121</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted $bar<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
517:     test <span style='color:#008c00; '>122</span><span style='color:#808030; '>,</span>     tainted $bar<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
518:     test <span style='color:#008c00; '>123</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted $bar<span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
519:     <span style='color:#800000; font-weight:bold; '>my</span> @baz <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#0000e6; '>"A"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"tainted"</span> <span style='color:#808030; '>.</span> $TAINT<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"B"</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
520:     test <span style='color:#008c00; '>124</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted $baz<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
521:     test <span style='color:#008c00; '>125</span><span style='color:#808030; '>,</span>     tainted $baz<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
522:     test <span style='color:#008c00; '>126</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted $baz<span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
523:     <span style='color:#800000; font-weight:bold; '>my</span> @plugh <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800000; font-weight:bold; '>q</span><span style='color:#800000; '>[</span><span style='color:#0000e6; '> "A", "tainted" . $TAINT, "B" </span><span style='color:#800000; '>]</span><span style='color:#800080; '>;</span>
524:     test <span style='color:#008c00; '>127</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted $plugh<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
525:     test <span style='color:#008c00; '>128</span><span style='color:#808030; '>,</span>     tainted $plugh<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
526:     test <span style='color:#008c00; '>129</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted $plugh<span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
527:     <span style='color:#800000; font-weight:bold; '>my</span> $nautilus <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>sub</span> <span style='color:#800080; '>{</span> <span style='color:#0000e6; '>"A"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"tainted"</span> <span style='color:#808030; '>.</span> $TAINT<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"B"</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
528:     test <span style='color:#008c00; '>130</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#808030; '>&amp;</span>$nautilus<span style='color:#808030; '>)</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
529:     test <span style='color:#008c00; '>131</span><span style='color:#808030; '>,</span>     tainted <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#808030; '>&amp;</span>$nautilus<span style='color:#808030; '>)</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
530:     test <span style='color:#008c00; '>132</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#808030; '>&amp;</span>$nautilus<span style='color:#808030; '>)</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
531:     <span style='color:#800000; font-weight:bold; '>my</span> @xyzzy <span style='color:#808030; '>=</span> <span style='color:#808030; '>&amp;</span>$nautilus<span style='color:#800080; '>;</span>
532:     test <span style='color:#008c00; '>133</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted $xyzzy<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
533:     test <span style='color:#008c00; '>134</span><span style='color:#808030; '>,</span>     tainted $xyzzy<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
534:     test <span style='color:#008c00; '>135</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted $xyzzy<span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
535:     <span style='color:#800000; font-weight:bold; '>my</span> $red_october <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>sub</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>return</span> <span style='color:#0000e6; '>"A"</span><span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"tainted"</span> <span style='color:#808030; '>.</span> $TAINT<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"B"</span> <span style='color:#800080; '>}</span><span style='color:#800080; '>;</span>
536:     test <span style='color:#008c00; '>136</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#808030; '>&amp;</span>$red_october<span style='color:#808030; '>)</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
537:     test <span style='color:#008c00; '>137</span><span style='color:#808030; '>,</span>     tainted <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#808030; '>&amp;</span>$red_october<span style='color:#808030; '>)</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
538:     test <span style='color:#008c00; '>138</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#808030; '>&amp;</span>$red_october<span style='color:#808030; '>)</span><span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
539:     <span style='color:#800000; font-weight:bold; '>my</span> @corge <span style='color:#808030; '>=</span> <span style='color:#808030; '>&amp;</span>$red_october<span style='color:#800080; '>;</span>
540:     test <span style='color:#008c00; '>139</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted $corge<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
541:     test <span style='color:#008c00; '>140</span><span style='color:#808030; '>,</span>     tainted $corge<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
542:     test <span style='color:#008c00; '>141</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted $corge<span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span><span style='color:#800080; '>;</span>
543: <span style='color:#800080; '>}</span>
544: 
545: <span style='color:#696969; '># Test for system/library calls returning string data of dubious origin.</span>
546: <span style='color:#800080; '>{</span>
547:     <span style='color:#696969; '># No reliable %Config check for getpw*</span>
548:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>eval</span> <span style='color:#800080; '>{</span> <span style='color:#400000; '>setpwent</span><span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span> <span style='color:#400000; '>getpwent</span><span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span> <span style='color:#008c00; '>1</span> <span style='color:#800080; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
549:     <span style='color:#400000; '>setpwent</span><span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
550:     <span style='color:#800000; font-weight:bold; '>my</span> @getpwent <span style='color:#808030; '>=</span> <span style='color:#400000; '>getpwent</span><span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
551:     <span style='color:#800000; font-weight:bold; '>die</span> <span style='color:#0000e6; '>"getpwent: </span><span style='color:#0000e6; '>$!</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800000; font-weight:bold; '>unless</span> <span style='color:#808030; '>(</span>@getpwent<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
552:     test <span style='color:#008c00; '>142</span><span style='color:#808030; '>,</span><span style='color:#808030; '>(</span>    <span style='color:#808030; '>not</span> tainted $getpwent<span style='color:#808030; '>[</span><span style='color:#008c00; '>0</span><span style='color:#808030; '>]</span>
553:               <span style='color:#808030; '>and</span>     tainted $getpwent<span style='color:#808030; '>[</span><span style='color:#008c00; '>1</span><span style='color:#808030; '>]</span>
554:               <span style='color:#808030; '>and</span> <span style='color:#808030; '>not</span> tainted $getpwent<span style='color:#808030; '>[</span><span style='color:#008c00; '>2</span><span style='color:#808030; '>]</span>
555:               <span style='color:#808030; '>and</span> <span style='color:#808030; '>not</span> tainted $getpwent<span style='color:#808030; '>[</span><span style='color:#008c00; '>3</span><span style='color:#808030; '>]</span>
556:               <span style='color:#808030; '>and</span> <span style='color:#808030; '>not</span> tainted $getpwent<span style='color:#808030; '>[</span><span style='color:#008c00; '>4</span><span style='color:#808030; '>]</span>
557:               <span style='color:#808030; '>and</span> <span style='color:#808030; '>not</span> tainted $getpwent<span style='color:#808030; '>[</span><span style='color:#008c00; '>5</span><span style='color:#808030; '>]</span>
558:               <span style='color:#808030; '>and</span>     tainted $getpwent<span style='color:#808030; '>[</span><span style='color:#008c00; '>6</span><span style='color:#808030; '>]</span>        <span style='color:#696969; '># ge?cos</span>
559:               <span style='color:#808030; '>and</span> <span style='color:#808030; '>not</span> tainted $getpwent<span style='color:#808030; '>[</span><span style='color:#008c00; '>7</span><span style='color:#808030; '>]</span>
560:           <span style='color:#808030; '>and</span>     tainted $getpwent<span style='color:#808030; '>[</span><span style='color:#008c00; '>8</span><span style='color:#808030; '>]</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>    <span style='color:#696969; '># shell</span>
561:     <span style='color:#400000; '>endpwent</span><span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
562:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
563:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>142</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok $_ # Skipped: getpwent() is not available</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800080; '>}</span>
564:     <span style='color:#800080; '>}</span>
565: 
566:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$Config<span style='color:#808030; '>{</span>d_readdir<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#696969; '># pretty hard to imagine not</span>
567:     <span style='color:#800000; font-weight:bold; '>local</span><span style='color:#808030; '>(</span>*D<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
568:     <span style='color:#400000; '>opendir</span><span style='color:#808030; '>(</span>D<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"op"</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>or</span> <span style='color:#800000; font-weight:bold; '>die</span> <span style='color:#0000e6; '>"opendir: </span><span style='color:#0000e6; '>$!</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
569:     <span style='color:#800000; font-weight:bold; '>my</span> $readdir <span style='color:#808030; '>=</span> <span style='color:#400000; '>readdir</span><span style='color:#808030; '>(</span>D<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
570:     test <span style='color:#008c00; '>143</span><span style='color:#808030; '>,</span> tainted $readdir<span style='color:#800080; '>;</span>
571:     <span style='color:#400000; '>closedir</span><span style='color:#808030; '>(</span>OP<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
572:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
573:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>143</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok $_ # Skipped: readdir() is not available</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span> <span style='color:#800080; '>}</span>
574:     <span style='color:#800080; '>}</span>
575: 
576:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$Config<span style='color:#808030; '>{</span>d_readlink<span style='color:#808030; '>}</span> <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> $Config<span style='color:#808030; '>{</span>d_symlink<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
577:     <span style='color:#800000; font-weight:bold; '>my</span> $symlink <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"sl</span><span style='color:#0000e6; '>$$</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
578:     <span style='color:#400000; '>unlink</span><span style='color:#808030; '>(</span>$symlink<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
579:     <span style='color:#400000; '>symlink</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"/something/naughty"</span><span style='color:#808030; '>,</span> $symlink<span style='color:#808030; '>)</span> <span style='color:#808030; '>or</span> <span style='color:#800000; font-weight:bold; '>die</span> <span style='color:#0000e6; '>"symlink: </span><span style='color:#0000e6; '>$!</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
580:     <span style='color:#800000; font-weight:bold; '>my</span> $readlink <span style='color:#808030; '>=</span> <span style='color:#400000; '>readlink</span><span style='color:#808030; '>(</span>$symlink<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
581:     test <span style='color:#008c00; '>144</span><span style='color:#808030; '>,</span> tainted $readlink<span style='color:#800080; '>;</span>
582:     <span style='color:#400000; '>unlink</span><span style='color:#808030; '>(</span>$symlink<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
583:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
584:     <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#008c00; '>144</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span> <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok $_ # Skipped: readlink() or symlink() is not available</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span> <span style='color:#800080; '>}</span>
585:     <span style='color:#800080; '>}</span>
586: <span style='color:#800080; '>}</span>
587: 
588: <span style='color:#696969; '># test bitwise ops (regression </span><span style='color:#ffffff; background:#808000; '>bug)</span>
589: <span style='color:#800080; '>{</span>
590:     <span style='color:#800000; font-weight:bold; '>my</span> $why <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"y"</span><span style='color:#800080; '>;</span>
591:     <span style='color:#800000; font-weight:bold; '>my</span> $j <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"x"</span> <span style='color:#808030; '>|</span> $why<span style='color:#800080; '>;</span>
592:     test <span style='color:#008c00; '>145</span><span style='color:#808030; '>,</span> <span style='color:#808030; '>not</span> tainted $j<span style='color:#800080; '>;</span>
593:     $why <span style='color:#808030; '>=</span> $TAINT<span style='color:#808030; '>.</span><span style='color:#0000e6; '>"y"</span><span style='color:#800080; '>;</span>
594:     $j <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"x"</span> <span style='color:#808030; '>|</span> $why<span style='color:#800080; '>;</span>
595:     test <span style='color:#008c00; '>146</span><span style='color:#808030; '>,</span>     tainted $j<span style='color:#800080; '>;</span>
596: <span style='color:#800080; '>}</span>
597: 
598: <span style='color:#696969; '># test target of substitution (regression </span><span style='color:#ffffff; background:#808000; '>bug)</span>
599: <span style='color:#800080; '>{</span>
600:     <span style='color:#800000; font-weight:bold; '>my</span> $why <span style='color:#808030; '>=</span> $TAINT<span style='color:#808030; '>.</span><span style='color:#0000e6; '>"y"</span><span style='color:#800080; '>;</span>
601:     $why <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>y</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>z</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
602:     test <span style='color:#008c00; '>147</span><span style='color:#808030; '>,</span>     tainted $why<span style='color:#800080; '>;</span>
603: 
604:     <span style='color:#800000; font-weight:bold; '>my</span> $z <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"[z]"</span><span style='color:#800080; '>;</span>
605:     $why <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>$z</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>zee</span><span style='color:#800000; '>/</span><span style='color:#800080; '>;</span>
606:     test <span style='color:#008c00; '>148</span><span style='color:#808030; '>,</span>     tainted $why<span style='color:#800080; '>;</span>
607: 
608:     $why <span style='color:#808030; '>=</span><span style='color:#808030; '>~</span> <span style='color:#800000; font-weight:bold; '>s</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>e</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>'-'.</span><span style='color:#0000e6; '>$$</span><span style='color:#800000; '>/</span><span style='color:#800000; font-weight:bold; '>ge</span><span style='color:#800080; '>;</span>
609:     test <span style='color:#008c00; '>149</span><span style='color:#808030; '>,</span>     tainted $why<span style='color:#800080; '>;</span>
610: <span style='color:#800080; '>}</span>
611: 
612: <span style='color:#696969; '># test shmread</span>
613: <span style='color:#800080; '>{</span>
614:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$Config<span style='color:#808030; '>{</span>d_shm<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
615:     <span style='color:#800000; font-weight:bold; '>no</span> <span style='color:#800000; font-weight:bold; '>strict</span> <span style='color:#0000e6; '>'subs'</span><span style='color:#800080; '>;</span>
616:     <span style='color:#800000; font-weight:bold; '>my</span> $sent <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"foobar"</span><span style='color:#800080; '>;</span>
617:     <span style='color:#800000; font-weight:bold; '>my</span> $rcvd<span style='color:#800080; '>;</span>
618:     <span style='color:#800000; font-weight:bold; '>my</span> $size <span style='color:#808030; '>=</span> <span style='color:#008c00; '>2000</span><span style='color:#800080; '>;</span>
619:     <span style='color:#800000; font-weight:bold; '>my</span> $id <span style='color:#808030; '>=</span> <span style='color:#400000; '>shmget</span><span style='color:#808030; '>(</span>IPC_PRIVATE<span style='color:#808030; '>,</span> $size<span style='color:#808030; '>,</span> S_IRWXU<span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span>
620:         <span style='color:#400000; '>warn</span> <span style='color:#0000e6; '>"# shmget failed: </span><span style='color:#0000e6; '>$!</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
621:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $id<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
622:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#400000; '>shmwrite</span><span style='color:#808030; '>(</span>$id<span style='color:#808030; '>,</span> $sent<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>60</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
623:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#400000; '>shmread</span><span style='color:#808030; '>(</span>$id<span style='color:#808030; '>,</span> $rcvd<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>60</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
624:             <span style='color:#400000; '>substr</span><span style='color:#808030; '>(</span>$rcvd<span style='color:#808030; '>,</span> <span style='color:#400000; '>index</span><span style='color:#808030; '>(</span>$rcvd<span style='color:#808030; '>,</span> <span style='color:#0000e6; '>"\</span><span style='color:#008c00; '>0</span><span style='color:#0000e6; '>"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>''</span><span style='color:#800080; '>;</span>
625:         <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
626:             <span style='color:#400000; '>warn</span> <span style='color:#0000e6; '>"# shmread failed: </span><span style='color:#0000e6; '>$!</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
627:         <span style='color:#800080; '>}</span>
628:         <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
629:         <span style='color:#400000; '>warn</span> <span style='color:#0000e6; '>"# shmwrite failed: </span><span style='color:#0000e6; '>$!</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
630:         <span style='color:#800080; '>}</span>
631:         <span style='color:#400000; '>shmctl</span><span style='color:#808030; '>(</span>$id<span style='color:#808030; '>,</span> IPC_RMID<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#400000; '>warn</span> <span style='color:#0000e6; '>"# shmctl failed: </span><span style='color:#0000e6; '>$!</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
632:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
633:         <span style='color:#400000; '>warn</span> <span style='color:#0000e6; '>"# shmget failed: </span><span style='color:#0000e6; '>$!</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
634:     <span style='color:#800080; '>}</span>
635: 
636:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$rcvd <span style='color:#808030; '>eq</span> $sent<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
637:         test <span style='color:#008c00; '>150</span><span style='color:#808030; '>,</span> tainted $rcvd<span style='color:#800080; '>;</span>
638:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
639:         <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok </span><span style='color:#008c00; '>150</span><span style='color:#0000e6; '> # Skipped: SysV shared memory operation failed</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
640:     <span style='color:#800080; '>}</span>
641:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
642:     <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok </span><span style='color:#008c00; '>150</span><span style='color:#0000e6; '> # Skipped: SysV shared memory is not available</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
643:     <span style='color:#800080; '>}</span>
644: <span style='color:#800080; '>}</span>
645: 
646: <span style='color:#696969; '># test msgrcv</span>
647: <span style='color:#800080; '>{</span>
648:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$Config<span style='color:#808030; '>{</span>d_msg<span style='color:#808030; '>}</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
649:     <span style='color:#800000; font-weight:bold; '>no</span> <span style='color:#800000; font-weight:bold; '>strict</span> <span style='color:#0000e6; '>'subs'</span><span style='color:#800080; '>;</span>
650:     <span style='color:#800000; font-weight:bold; '>my</span> $id <span style='color:#808030; '>=</span> <span style='color:#400000; '>msgget</span><span style='color:#808030; '>(</span>IPC_PRIVATE<span style='color:#808030; '>,</span> IPC_CREAT <span style='color:#808030; '>|</span> S_IRWXU<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
651: 
652:     <span style='color:#800000; font-weight:bold; '>my</span> $sent      <span style='color:#808030; '>=</span> <span style='color:#0000e6; '>"message"</span><span style='color:#800080; '>;</span>
653:     <span style='color:#800000; font-weight:bold; '>my</span> $type_sent <span style='color:#808030; '>=</span> <span style='color:#008c00; '>1234</span><span style='color:#800080; '>;</span>
654:     <span style='color:#800000; font-weight:bold; '>my</span> $rcvd<span style='color:#800080; '>;</span>
655:     <span style='color:#800000; font-weight:bold; '>my</span> $type_rcvd<span style='color:#800080; '>;</span>
656: 
657:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>defined</span> $id<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
658:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#400000; '>msgsnd</span><span style='color:#808030; '>(</span>$id<span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>pack</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"l! a*"</span><span style='color:#808030; '>,</span> $type_sent<span style='color:#808030; '>,</span> $sent<span style='color:#808030; '>)</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
659:         <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span><span style='color:#400000; '>msgrcv</span><span style='color:#808030; '>(</span>$id<span style='color:#808030; '>,</span> $rcvd<span style='color:#808030; '>,</span> <span style='color:#008c00; '>60</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
660:             <span style='color:#808030; '>(</span>$type_rcvd<span style='color:#808030; '>,</span> $rcvd<span style='color:#808030; '>)</span> <span style='color:#808030; '>=</span> <span style='color:#800000; font-weight:bold; '>unpack</span><span style='color:#808030; '>(</span><span style='color:#0000e6; '>"l! a*"</span><span style='color:#808030; '>,</span> $rcvd<span style='color:#808030; '>)</span><span style='color:#800080; '>;</span>
661:         <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
662:             <span style='color:#400000; '>warn</span> <span style='color:#0000e6; '>"# msgrcv failed</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
663:         <span style='color:#800080; '>}</span>
664:         <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
665:         <span style='color:#400000; '>warn</span> <span style='color:#0000e6; '>"# msgsnd failed</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
666:         <span style='color:#800080; '>}</span>
667:         <span style='color:#400000; '>msgctl</span><span style='color:#808030; '>(</span>$id<span style='color:#808030; '>,</span> IPC_RMID<span style='color:#808030; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>|</span><span style='color:#808030; '>|</span> <span style='color:#400000; '>warn</span> <span style='color:#0000e6; '>"# msgctl failed: </span><span style='color:#0000e6; '>$!</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
668:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
669:         <span style='color:#400000; '>warn</span> <span style='color:#0000e6; '>"# msgget failed</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
670:     <span style='color:#800080; '>}</span>
671: 
672:     <span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>$rcvd <span style='color:#808030; '>eq</span> $sent <span style='color:#808030; '>&amp;</span><span style='color:#808030; '>&amp;</span> $type_sent <span style='color:#808030; '>=</span><span style='color:#808030; '>=</span> $type_rcvd<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
673:         test <span style='color:#008c00; '>151</span><span style='color:#808030; '>,</span> tainted $rcvd<span style='color:#800080; '>;</span>
674:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
675:         <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok </span><span style='color:#008c00; '>151</span><span style='color:#0000e6; '> # Skipped: SysV message queue operation failed</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
676:     <span style='color:#800080; '>}</span>
677:     <span style='color:#800080; '>}</span> <span style='color:#800000; font-weight:bold; '>else</span> <span style='color:#800080; '>{</span>
678:     <span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"ok </span><span style='color:#008c00; '>151</span><span style='color:#0000e6; '> # Skipped: SysV message queues are not available</span><span style='color:#0f69ff; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#800080; '>;</span>
679:     <span style='color:#800080; '>}</span>
680: <span style='color:#800080; '>}</span>
681: 
682: 
